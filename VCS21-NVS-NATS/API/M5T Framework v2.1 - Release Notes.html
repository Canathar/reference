<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Release Notes - M5T Framework v2.1.8</title>
<link rel="SHORTCUT ICON" href="http://www.m5t.com/favicon.ico" type="image/ico">
<style type="text/css">
body
{
    font-family: Arial, Helvetica, sans-serif;
    color: #000000;
    font-size: 10pt;
    font-style: normal;
    font-weight: normal;
    text-decoration: none;
    margin: 5px 5px 5px 5px;
}
/* Anything red */
.red
{
    color: red;
}
/* hyperlink color */
a:link
{
    color: Blue;
}
a:visited
{
    color: Purple;
}
a:active
{
    color: Red;
}
a:hover
{
    color: Red;
}
/* clickable buttons */
input
{
    background-color: lightblue;
    border-style: solid;
    border-color: #000000;
    border-width: 1px;
    font-size: 10px;
}
/* navlist is a special case of ul for the table of contents */
ul#navlist
{
    padding: 0 0 0 0;
    margin: 15px 0px 15px 0px;
    list-style-type: none;
    width: 100%;
    color: #fff;
    font-weight: bold;
    display: block;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}
ul#navlist li
{
    float: left;
    display: inline;
}
ul#navlist li a
{
    margin: 0 0 0 20px;
    width: 100px;
    height: 20px;
    float: left;
    border: 1px solid gray;
    text-decoration: none;
    color: White;
    background: #036;
}
ul#navlist li a:visited
{
    background: ActiveBorder;
    border: 1px solid gray;
    color: AppWorkspace;
}
ul#navlist li a:hover
{
    background: #369;
    border: 1px solid gray;
}
ul#navlist li a:active
{
    background: gray;
    border: 1px solid gray;
    color: Black;
}
/* Release notes title */
h1
{
    color: #8B0000;
    font-size: 20pt;
    font-weight: bold;
    margin: 0px 0px 0px 0px;
}
/* Section titles */
h2
{
    color: #00008B;
    font-size: 15pt;
    font-weight: bold;
    margin: 10px 0px 10px 0px;
}
/* Currently unused, left for flexibility */
h3
{
    color: #696969;
    font-size: 12pt;
    font-weight: 800;
    margin: 0px 0px 0px 0px;
}
/* Sections within a CR */
h4
{
    color: #00008B;
    font-weight: 800;
    font-size: 10pt;
    margin: 0px 0px 0px 0px;
    padding: 5px 5px 5px 5px;
}
/* Small bottom copyright */
.copyright
{
    color: #003399;
    font-size: 8pt;
}
/* Text in the History of Changes section. Note that list items are
   additionally indented by html */
.cr
{
    margin-left: 30pt;
    margin-right: 30pt;
}
/* All preformatted text */
pre.cr
{
    font-family: monospace;
    font-size: 9pt;
}
/* All Preformatted text in the History of Changes section */
pre.cr
{
    margin-left: 60pt;
    margin-right: 60pt;
    color:blue;
    background: lightblue;
}
/* Division containing the complete CR detail */
div.detail
{
    border-style: groove
}
/* Division containing only the CR synopsis */
div.synopsis
{
    border-style: none
}
/* The label links in the History of Changes*/
a.label
{
  color: #00008B;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 11pt;
  font-weight: 800;
}
/* Type of release hyperlink for LAG*/
p.LAG
{
    color:red;
    font-size: 15pt;
}
/* Any error case that will show up in BIG RED */
.error
{
    color: red;
    font-size: 30pt;
}
</style>
</head>
<body>
<a href="http://www.m5t.com"><img src="http://www.m5t.com/img/header/logo_top.jpg" usemap="#Maplogo" border="0" height="91" width="1000"></a><br><br><a name="top"></a><h1><b>
M5T Framework</b></h1>
<h2><b>Version 2.1.8</b></h2>
<ul id="navlist">
<li><a href="#intro">About</a></li>
<li><a href="#upguide">Update Guide</a></li>
<li><a href="#knownissues">Known Issues</a></li>
<li><a href="#relhistory">History</a></li>
<li><a href="#licensing">Third-Party</a></li>
<li><a href="#export">Export</a></li>
</ul>
<br><br><a name="intro"></a><h2>About this Release</h2>
<p><b>Media5 Product Life Cycle Process :</b> Phase 5 - Field Validation & Pre-production (GA).</p>
<p><b>This release is a Snapshot; a Snapshot release has passed all test suites but on a subset of the product's supported targets (OS/CPU).</p>
<p><b>M5T Product Code :</b> </p>
<p>
A few minor features have been added.  Find out the details in the New Features and Improvements section below.
</p>
<br><a href="#top">back to top</a>
<hr>
<a name="upguide"></a><h2>Update Guide</h2>
<p>No modifications to the application are necessary when updating to this version.</p>
<p>Updating to <b>2.1.8</b>: <a href="#CR24903">CR#24903</a>.</p>
<p>Updating to <b>2.1.7</b>: <a href="#CR23996">CR#23996</a>, <a href="#CR23208">CR#23208</a>.</p>
<p>Updating to <b>2.1.7</b>: <a href="#CR23066">CR#23066</a>, <a href="#CR23304">CR#23304</a>, <a href="#CR23446">CR#23446</a>, <a href="#CR23524">CR#23524</a>.</p>
<p>Updating to <b>2.1.6</b>: <a href="#CR18361">CR#18361</a>, <a href="#CR22280">CR#22280</a>, <a href="#CR22522">CR#22522</a>, <a href="#CR22957">CR#22957</a>, <a href="#CR22918">CR#22918</a>, <a href="#CR23130">CR#23130</a>, <a href="#CR23141">CR#23141</a>.</p>
<p>Updating to <b>2.1.5</b>: <a href="#CR21014">CR#21014</a>, <a href="#CR21585">CR#21585</a>, <a href="#CR21593">CR#21593</a>, <a href="#CR21697">CR#21697</a>, <a href="#CR21050">CR#21050</a>, <a href="#CR21435">CR#21435</a>, <a href="#CR21724">CR#21724</a>.</p>
<p>Updating to <b>2.1.4</b>: <a href="#CR18122">CR#18122</a>, <a href="#CR18873">CR#18873</a>, <a href="#CR19464">CR#19464</a>, <a href="#CR19655">CR#19655</a>, <a href="#CR19801">CR#19801</a>, <a href="#CR20297">CR#20297</a>, <a href="#CR19829">CR#19829</a>, <a href="#CR19776">CR#19776</a>, <a href="#CR20355">CR#20355</a>, <a href="#CR20546">CR#20546</a>, <a href="#CR20685">CR#20685</a>, <a href="#CR21028">CR#21028</a>, <a href="#CR17637">CR#17637</a>, <a href="#CR19001">CR#19001</a>, <a href="#CR19104">CR#19104</a>, <a href="#CR19270">CR#19270</a>, <a href="#CR19413">CR#19413</a>, <a href="#CR19286">CR#19286</a>, <a href="#CR19472">CR#19472</a>, <a href="#CR19676">CR#19676</a>, <a href="#CR19232">CR#19232</a>, <a href="#CR20404">CR#20404</a>, <a href="#CR20420">CR#20420</a>, <a href="#CR20505">CR#20505</a>, <a href="#CR20506">CR#20506</a>, <a href="#CR20526">CR#20526</a>, <a href="#CR20565">CR#20565</a>, <a href="#CR20820">CR#20820</a>, <a href="#CR20865">CR#20865</a>, <a href="#CR20896">CR#20896</a>, <a href="#CR20940">CR#20940</a>, <a href="#CR20990">CR#20990</a>, <a href="#CR18312">CR#18312</a>.</p>
<p>Updating to <b>2.1.3</b>: <a href="#CR18203">CR#18203</a>, <a href="#CR18266">CR#18266</a>, <a href="#CR18232">CR#18232</a>, <a href="#CR18383">CR#18383</a>, <a href="#CR18388">CR#18388</a>, <a href="#CR18403">CR#18403</a>, <a href="#CR17204">CR#17204</a>, <a href="#CR18685">CR#18685</a>, <a href="#CR17559">CR#17559</a>, <a href="#CR18329">CR#18329</a>.</p>
<p>Updating to <b>2.1.2</b>: <a href="#CR17596">CR#17596</a>, <a href="#CR17672">CR#17672</a>, <a href="#CR17583">CR#17583</a>, <a href="#CR17608">CR#17608</a>, <a href="#CR17611">CR#17611</a>, <a href="#CR17585">CR#17585</a>, <a href="#CR17764">CR#17764</a>.</p>
<p>Updating to <b>2.1.1</b>: <a href="#CR17228">CR#17228</a>, <a href="#CR17238">CR#17238</a>, <a href="#CR17250">CR#17250</a>, <a href="#CR17266">CR#17266</a>, <a href="#CR17313">CR#17313</a>, <a href="#CR16971">CR#16971</a>, <a href="#CR16992">CR#16992</a>, <a href="#CR17007">CR#17007</a>, <a href="#CR17015">CR#17015</a>, <a href="#CR16284">CR#16284</a>, <a href="#CR17293">CR#17293</a>.</p>
<br><a href="#top">back to top</a>
<hr>
<a name="knownissues"></a><h2>Known Issues</h2>
<a name="CR19982"><div class="synopsis" id="CR19982_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19982')">CR#19982</a> :</b> Cast increases required alignment warnings.<br></div>
<div class="detail" id="CR19982_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19982')">CR#19982</a> :</b> Cast increases required alignment warnings.<br><p class="cr">
There are some warnings related to "cast increases required alignment" while compiling with gcc for a target having alignment constraint only when the -Wcast-align compiler option is used. These warnings cannot be removed.
</p>
</div>
<a name="CR19984"><div class="synopsis" id="CR19984_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19984')">CR#19984</a> :</b> Known issue with uClib's res_query function.<br></div>
<div class="detail" id="CR19984_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19984')">CR#19984</a> :</b> Known issue with uClib's res_query function.<br><p class="cr">
Due to unexpected results returned by uClib's res_query function (different results compared to libc's res_query), the feature MXD_PORTABLE_RESOLVER_ENABLE_SUPPORT must be activated when building with this library.
</p>
</div>
<a name="CR21056"><div class="synopsis" id="CR21056_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21056')">CR#21056</a> :</b> The parsing of IPv6 Addresses with Embedded IPv4 Addresses is broken.<br></div>
<div class="detail" id="CR21056_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21056')">CR#21056</a> :</b> The parsing of IPv6 Addresses with Embedded IPv4 Addresses is broken.<br><p class="cr">
The parsing of IPv6 Addresses with Embedded IPv4 Addresses by CSocketAddr is currently broken.
</p>
</div>
<a name="CR21723"><div class="synopsis" id="CR21723_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21723')">CR#21723</a> :</b> MX_PACK macros generate warnings under GCC 4.1.1<br></div>
<div class="detail" id="CR21723_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21723')">CR#21723</a> :</b> MX_PACK macros generate warnings under GCC 4.1.1<br><p class="cr">
MX_PACK_MEMBER and MX_PACK_STRUCT can generate warnings under GCC 4.1.1 if these MX_PACK calls are considered to have no effect.
</p>
<p class="cr">
Even if this is the case, when compiled with GCC 4.1.1, it may be different for other compilers. For this reason we will keep the warning.
</p>
</div>
<a name="CR22032"><div class="synopsis" id="CR22032_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22032')">CR#22032</a> :</b> Compilation error when passing a templated type with more than one argument to MX_NEW.<br></div>
<div class="detail" id="CR22032_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22032')">CR#22032</a> :</b> Compilation error when passing a templated type with more than one argument to MX_NEW.<br><p class="cr">
When calling the MX_NEW macro with a templated type that has more than one argument, a compilation failure is generated. This has been observed both when MXD_MEMORY_ALLOCATOR_ENABLE_SUPPORT is defined and not defined.
</p>
</div>
<a name="CR19931"><div class="synopsis" id="CR19931_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19931')">CR#19931</a> :</b> Known issue with NAPTR in Windows Vista.<br></div>
<div class="detail" id="CR19931_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19931')">CR#19931</a> :</b> Known issue with NAPTR in Windows Vista.<br><p class="cr">
Under Windows Vista, dnsapi.lib crashes when NAPTR responses have answer records. As a work around, the portable resolver can be used.
</p>
</div>
<a name="CR19941"><div class="synopsis" id="CR19941_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19941')">CR#19941</a> :</b> Known issue with QoS under Windows Vista.<br></div>
<div class="detail" id="CR19941_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19941')">CR#19941</a> :</b> Known issue with QoS under Windows Vista.<br><p class="cr">
Serious regressions have been observed when using the GQoS API, stated to be still supported (though deprecated). The broken API should be fixed in Windows Vista SP1.
</p>
</div>
<a name="CR21076"><div class="synopsis" id="CR21076_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21076')">CR#21076</a> :</b> Known Issue: IPv6 site local addresses behaviour is different on Windows with regards to other OSes.<br></div>
<div class="detail" id="CR21076_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21076')">CR#21076</a> :</b> Known Issue: IPv6 site local addresses behaviour is different on Windows with regards to other OSes.<br><p class="cr">
On Windows XP and Windows 2003, it is not possible to bind to an IPv6 SiteLocal address that does not have a ScopeId while it is possible to do so on other Operating Systems (Including Windows Vista). Furthermore, on Windows Vista, the effective address returned by the bind call will contain the ScopeId of the SiteLocal address that has been used.
</p>
<p class="cr">
These differences in behaviour across different Operating Systems will cause inconsistent behaviour in the Framework's CUdpSocket::Bind and CTcpSocket::Bind methods when called with an IPv6 SiteLocal address without ScopeId.
</p>
<p class="cr">
Note that IPv6 SiteLocal addresses are deprecated and should not be used. This is documented in RFC 3879 (see RFC 4193 for a replacement).
</p>
</div>
<a name="CR21572"><div class="synopsis" id="CR21572_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21572')">CR#21572</a> :</b> Known Issue: CTestCKerberos crashes under Solaris 10.<br></div>
<div class="detail" id="CR21572_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21572')">CR#21572</a> :</b> Known Issue: CTestCKerberos crashes under Solaris 10.<br><p class="cr">
The CTestCKerberos test case crashes under Solaris 10. The reason for this crash is unknown and must be investigated.
</p>
</div>
<a name="CR22019"><div class="synopsis" id="CR22019_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22019')">CR#22019</a> :</b> Known issue with CUdpSocket::Send() in VxWorks 6.5.<br></div>
<div class="detail" id="CR22019_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22019')">CR#22019</a> :</b> Known issue with CUdpSocket::Send() in VxWorks 6.5.<br><p class="cr">
When trying to send more than 9972 bytes using CUdpSocket::Send() or CUdpSocket::SendTo() on VxWorks 6.5, the operating system returns an error. This has been observed even when CUdpSocket::SetTransmitBufferSize() is called beforehand with a bigger value.
</p>
</div>
<a name="CR22950"><div class="synopsis" id="CR22950_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22950')">CR#22950</a> :</b> Known Issue - Memory leak detection tools reporting certain false positives inside the Framework<br></div>
<div class="detail" id="CR22950_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22950')">CR#22950</a> :</b> Known Issue - Memory leak detection tools reporting certain false positives inside the Framework<br><p class="cr">
Memory validation tools run on the M5T framework report certain memory leaks that are false. These either occur inside OS specific code or the tools are not able to properly handle the allocation and deallocation locations.
</p>
<p class="cr">
For rational Purify 7.0.0 Windows
</p>
<ul>
<li class="cr">MxVsnprintf leaks inside OS method vsnprintf once per thread.</li>
<li class="cr">MxStringToUint leaks inside isdigit once per thread context</li>
<li class="cr">rand leaks once per thread context</li>
<li class="cr">CWindowsResolver::Send leaks inside WmiOpenBlock and DllUnregisterServer</li>
<li class="cr">fprintf inside  CThread test.</li>
<li class="cr">ValidateIpV6Str</li>
</ul>
<p class="cr">
For Valgrind 3.2.1 Linux
</p>
<ul>
<li class="cr">CUnixResolver::Send leaks in res_query</li>
<li class="cr">InitializeCAsyncResolver leaks in pthread_setspecific</li>
<li class="cr">GetLocalIPv6Addr</li>
</ul>
</div>
<a name="CR23471"><div class="synopsis" id="CR23471_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23471')">CR#23471</a> :</b> Known issue: Tls and Tcp sockets cannot be reused under Symbian.<br></div>
<div class="detail" id="CR23471_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23471')">CR#23471</a> :</b> Known issue: Tls and Tcp sockets cannot be reused under Symbian.<br><p class="cr">

</p>
</div>
<br><a href="#top">back to top</a>
<hr>
<script type="text/javascript" language="javascript">
function show_hide(id)
{
    var detail = document.getElementById(id+"_CrExpanded")
    if(detail.style.visibility == "hidden")
    {
        detail.style.visibility = "visible";
        detail.style.display = "block";
    }
    else
    {
        detail.style.visibility = "hidden";
        detail.style.display = "none";
    }
    var synopsis = document.getElementById(id+"_CrCollapsed")
    if(synopsis.style.visibility == "hidden")
    {
        synopsis.style.visibility = "visible";
        synopsis.style.display = "inline";
    }
    else
    {
        synopsis.style.visibility = "hidden";
        synopsis.style.display = "none";
    }
}
function show_hide_label(id)
{
    var labelExpanded = document.getElementById(id+"_LabelExpanded")
    if(labelExpanded.style.visibility == "hidden")
    {
        labelExpanded.style.visibility = "visible";
        labelExpanded.style.display = "block";
    }
    else
    {
        labelExpanded.style.visibility = "hidden";
        labelExpanded.style.display = "none";
    }
    var labelCollapsed = document.getElementById(id+"_LabelCollapsed")
    if(labelCollapsed.style.visibility == "hidden")
    {
        labelCollapsed.style.visibility = "visible";
        labelCollapsed.style.display = "inline";
    }
    else
    {
        labelCollapsed.style.visibility = "hidden";
        labelCollapsed.style.display = "none";
    }
}
function expandAllCrs(bHide)
{
    var aDivisions = document.getElementsByTagName("div");
    var uNbDiv = aDivisions.length;
    var i=1;
    // First div is the collapsed CR, the second is the expanded CR.
    //---------------------------------------------------------------
    while(i<uNbDiv)
    {
        if(bHide>0)
        {
            aDivisions[i].style.visibility = "hidden";
            aDivisions[i].style.display = "none";
            aDivisions[i-1].style.visibility = "visible";
            aDivisions[i-1].style.display = "inline";
        }
        else
        {
            aDivisions[i].style.visibility = "visible";
            aDivisions[i].style.display = "block";
            aDivisions[i-1].style.visibility = "hidden";
            aDivisions[i-1].style.display = "none";
        }
        // Increment by two to skip to the next collapsed/expanded div pair.
        //-------------------------------------------------------------------
        i +=2;
    }
}
function expandFirstLabel()
{
    var aDivisions = document.getElementsByTagName("div");
    var uNbDiv = aDivisions.length;
    var i=0;
    var count=0;
    while( i < uNbDiv && count < 2 )
    {
        if(aDivisions[i].id.match("_Label")!=null)
        {
            if(aDivisions[i].id.match("_LabelExpanded")!=null)
            {
                aDivisions[i].style.visibility = "visible";
                aDivisions[i].style.display = "block";
            }
            else
            {
                aDivisions[i].style.visibility = "hidden";
                aDivisions[i].style.display = "none";
            }
            count +=1;
        }
        i +=1;
    }
}
</script>
<a name="relhistory"></a><h2>History of Changes</h2>
<p>Click on the Version and the CR number to see the details.</p>
<p>You can also use the following buttons to affect all Versions and CRs:</p>
<input name="showAll" type="button" onclick="expandAllCrs(0)" value="Show All Descriptions (Printer friendly)"><br><input name="hideAll" type="button" onclick="expandAllCrs(1)" value="Hide All Descriptions">
<hr>
<div id="label2.1.8.17_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.8.17')">Version 2.1.8</a> (build 17) - Snapshot: Created on May 25, 2010
</div>
<div id="label2.1.8.17_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.8.17')">Version 2.1.8</a> (build 17) - Snapshot: Created on May 25, 2010
<br><br><h3>New Features and Improvements</h3>
<a name="CR25027"><div class="synopsis" id="CR25027_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR25027')">CR#25027</a> :</b> Add parameters to CEventDriven::Activate() used when a ServicingThread must be created.
</div>
<div class="detail" id="CR25027_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR25027')">CR#25027</a> :</b> Add parameters to CEventDriven::Activate() used when a ServicingThread must be created.
<h4>Description</h4>
<p class="cr">
The CEventDrivent::Activate() method's signature was modified for:
</p>
<p class="cr">
CEventDriven::Activate(IN IEComUnknown* pIEComUnknown,
                                       IN const char* pszName = NULL,
                                       IN uint32_t uStackSize = 0,
                                       IN CThread::EPriority ePriority = CThread::eNORMAL)
</p>
<p class="cr">
The added parameters allow a servicing thread to be created with the desired parameters instead of the default parameters.
</p>
</div>
<br><a name="CR25090"><div class="synopsis" id="CR25090_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR25090')">CR#25090</a> :</b> Add CTransition and CState design pattern.
</div>
<div class="detail" id="CR25090_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR25090')">CR#25090</a> :</b> Add CTransition and CState design pattern.
<h4>Description</h4>
<p class="cr">
         Add a state machine design patter to through CTransition and CSatate.
</p>

</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR25022"><div class="synopsis" id="CR25022_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR25022')">CR#25022</a> :</b> CAsyncUdpSocket::SetAsyncUnconnectedIoSocketMgr() should enables event when the socket is bound.
</div>
<div class="detail" id="CR25022_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR25022')">CR#25022</a> :</b> CAsyncUdpSocket::SetAsyncUnconnectedIoSocketMgr() should enables event when the socket is bound.
<h4>Description</h4>
<p class="cr">
When CAsyncUdpSocket::SetAsyncUnconnectedIoSocketMgr() was used after the socket was bound, the socket event (uSOCKET_READABLE) event was not enabled. This CR fixes this situation.
</p>
</div>
<br><a name="CR25073"><div class="synopsis" id="CR25073_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR25073')">CR#25073 (Incidents 3910, 3968)</a> :</b> CFile does not compile with gcc 4.4.3 
</div>
<div class="detail" id="CR25073_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR25073')">CR#25073 (Incidents 3910, 3968)</a> :</b> CFile does not compile with gcc 4.4.3 
<h4>Description</h4>
Corrected wrong macro condition in CFile.h, preventing a compilation with gcc 4.4.3.
</div>
<br><a name="CR25159"><div class="synopsis" id="CR25159_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR25159')">CR#25159</a> :</b> MxStringToUint and MxStringToInt do not check overflow
</div>
<div class="detail" id="CR25159_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR25159')">CR#25159</a> :</b> MxStringToUint and MxStringToInt do not check overflow
<h4>Description</h4>
<p class="cr">
MxStringToUint and MxStringToInt now returns resFE_FAIL if the parsed string overflow an integer. Returned value will be set to 0 when an overflow occurs.
</p>
</div>
<br><a name="CR25279"><div class="synopsis" id="CR25279_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR25279')">CR#25279</a> :</b> CAsyncUdpSocket must report EvAsyncSocketMgrClosed even if socket closure has failed. 
</div>
<div class="detail" id="CR25279_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR25279')">CR#25279</a> :</b> CAsyncUdpSocket must report EvAsyncSocketMgrClosed even if socket closure has failed. 
<h4>Description</h4>
<p class="cr">
    CAsyncUdpSocket does not report any callback event when the closure of the
socket fails. This is a problem since the manager of the socket may be waiting
after the EvAsyncSocketMgrClosed event.
</p>

<p class="cr">
    This problem has been encountered on Symbian as in some circumstances where
the wifi network is disconnected, the udp socket fails to be closed as
KErrCancel is returned by m_pUdpSocket-&gt;Shutdown().
</p>
</div>
<br><a name="CR25485"><div class="synopsis" id="CR25485_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR25485')">CR#25485 (Incident 3941)</a> :</b> Handle IPv6 addresses in accordance to RFC 4291 updated by draft-ietf-6man-text-addr-representation-07. 
</div>
<div class="detail" id="CR25485_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR25485')">CR#25485 (Incident 3941)</a> :</b> Handle IPv6 addresses in accordance to RFC 4291 updated by draft-ietf-6man-text-addr-representation-07. 
<h4>Description</h4>
<p class="cr">
Updated CSocketAddr::GetAddress so it respects the requirements of draft-ietf-6man-text-addr-representation-07 :
</p>
<ul>
<li class="cr">Leading zeros MUST be suppressed.</li>
<li class="cr">A single 16-bit 0 field MUST be represented as 0.</li>
<li class="cr">The use of symbol "::" MUST be used to its maximum capability.</li>
<li class="cr">The symbol "::" MUST NOT be used to shorten just one 16-bit 0 field.</li>
<li class="cr">The longest run of consecutive 16-bit 0 fields MUST be shortened</li>
<li class="cr">When the length of the consecutive 16-bit 0 fields are equal, the first sequence of zero bits MUST be shortened.</li>
<li class="cr">The characters "a", "b", "c", "d", "e", "f" in an IPv6 address MUST be represented in lower case.</li>
</ul>
</div>
<br><a name="CR25614"><div class="synopsis" id="CR25614_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR25614')">CR#25614 (Incident 3973)</a> :</b> Seed the PRNG when using CSecurePrngMitosFw 
</div>
<div class="detail" id="CR25614_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR25614')">CR#25614 (Incident 3973)</a> :</b> Seed the PRNG when using CSecurePrngMitosFw 
<h4>Description</h4>
<p class="cr">
InitializeSeed is called in CSecurePrngMitosFw::InitializeCSecurePrngMitosFw() so the PRNG is seeded at startup rather than on the first random number generation, as it used to be.
</p>
</div>
<br></div>
<br>
<hr>
<div id="label2.1.8.16_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.8.16')">Version 2.1.8</a> (build 16): Created on January 11, 2010
</div>
<div id="label2.1.8.16_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.8.16')">Version 2.1.8</a> (build 16): Created on January 11, 2010
<br><br><h3>New Features and Improvements</h3>
<a name="CR24093"><div class="synopsis" id="CR24093_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24093')">CR#24093 (Incident 3530)</a> :</b> Add configuration to make IPv6 scope always explicit.
</div>
<div class="detail" id="CR24093_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24093')">CR#24093 (Incident 3530)</a> :</b> Add configuration to make IPv6 scope always explicit.
<h4>Description</h4>
<p class="cr">
    We need to add configuration to make IPv6 scope always explicit.
</p>

<p class="cr">
 The MXD_IPV6_SCOPE_ID_MANDATORY_IN_ALL_ADDRESSES configuration has been added. When defined in the PreFrameworkCfg.h file or in the makefile, all IPv6 addresses returned as a string by the CSocketAddr class will contain a scope ID (0 is there was none).
</p>

<p class="cr">
    Also fixed some parsing problems when scope IDs are specified in an IPv6 address.
</p>
</div>
<br><a name="CR24091"><div class="synopsis" id="CR24091_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24091')">CR#24091 (Incident 3469)</a> :</b> Add support for the thread id in the traces for the Linux platform.
</div>
<div class="detail" id="CR24091_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24091')">CR#24091 (Incident 3469)</a> :</b> Add support for the thread id in the traces for the Linux platform.
<h4>Description</h4>
<p class="cr">
Traces now showing the thread ID under Linux.
</p>
</div>
<br><a name="CR24306"><div class="synopsis" id="CR24306_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24306')">CR#24306 (Incident 3601)</a> :</b> Add a getter method to get m_pSsl when TLS is used with openSsl 
</div>
<div class="detail" id="CR24306_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24306')">CR#24306 (Incident 3601)</a> :</b> Add a getter method to get m_pSsl when TLS is used with openSsl 
<h4>Description</h4>
<p class="cr">
A GetSsl method should be provided to get the SSL* when using OpenSsl library and TLS socket.
</p>

<p class="cr">
CAsyncTlsSocketOpenSsl now implements the new IAsyncTlsOpenSsl interface that provides the GetSsl method.
</p>
</div>
<br><a name="CR24363"><div class="synopsis" id="CR24363_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24363')">CR#24363</a> :</b> Implement smart pointer classes.
</div>
<div class="detail" id="CR24363_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24363')">CR#24363</a> :</b> Implement smart pointer classes.
<h4>Description</h4>
<p class="cr">
Smart pointer classes need to be implemented in the Framework.
</p>
<p class="cr">
The CAutoPtr class has been added to handle any object allocated in memory. It will automatically delete the object when it gets destroyed.
</p>
<p class="cr">
The CSharedPtr class has been added to handle reference counted objects. It can also be used for ECOM objects. It will automatically manage the reference count of the object.
</p>
</div>
<br><a name="CR24508"><div class="synopsis" id="CR24508_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24508')">CR#24508 (Incident 3601)</a> :</b> Add the possibility to notify the manager when a TLS renegotiation is completed.
</div>
<div class="detail" id="CR24508_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24508')">CR#24508 (Incident 3601)</a> :</b> Add the possibility to notify the manager when a TLS renegotiation is completed.
<h4>Description</h4>
<p class="cr">
Currently, the IAsyncTlsRenegotiationMgr::EvAsyncTlsRenegotiationMgrRenegotiated() event is reported only when IAsyncTlsRenegotiation::RenegotiateA() is used to initiate the TLS renegotiation. However, there are some cases that the application desires to be notified when any TLS renegotiations (manual or auto renegotiation) are completed successfully.
</p>

<p class="cr">
The EnableAllRenegotiationNotifications(IN bool bEnable) was added to the IAsyncTlsRenegotiation interface. If not called or called with false, IAsyncTlsRenegotiationMgr::EvAsyncTlsRenegotiationMgrRenegotiated() will be reported only when IAsyncTlsRenegotiation::RenegotiateA() was used to initiate the renegotiation. If called with true, all events will be reported at the completion of TLS renegotiations regardless of whether they were initiated locally or by the peer.
</p>
</div>
<br><a name="CR24796"><div class="synopsis" id="CR24796_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24796')">CR#24796 (Incident 3573)</a> :</b> Add the equivalent of a host file to the Resolver.
</div>
<div class="detail" id="CR24796_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24796')">CR#24796 (Incident 3573)</a> :</b> Add the equivalent of a host file to the Resolver.
<h4>Description</h4>
<p class="cr">
The addition of a CHostFile class in the Resolver folder would be very helpful. It allows the application to configure DNS records locally when it is impossible to do so on the server.
</p>

<p class="cr">
A new macro has been added to FrameworkCfg.h: MXD_RESOLVER_HOST_FILE_ENABLE_SUPPORT. This needs to be defined to use the host file feature. The host file can be queried by using CASyncResolver::GetHostFile that returns a pointer to the CHostFile.
</p>

</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR23714"><div class="synopsis" id="CR23714_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23714')">CR#23714 (Incidents 3408, 3675, 3680)</a> :</b> Resolved SRV records are not ordered according to their priority and weight.
</div>
<div class="detail" id="CR23714_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23714')">CR#23714 (Incidents 3408, 3675, 3680)</a> :</b> Resolved SRV records are not ordered according to their priority and weight.
<h4>Description</h4>
<p class="cr">
SRV records returned by GetSrvRecord were not sorted according to their priority and weight as per RFC 2782. The algorithm proposed in the RFC has been implemented to resolve the problem. Note that the algorithm is executed even if the response was cached.
</p>
</div>
<br><a name="CR23752"><div class="synopsis" id="CR23752_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23752')">CR#23752 (Incidents 3390, 3469)</a> :</b> 
TLS socket closure not handled correctly while waiting for the end of the TLS handshake.
</div>
<div class="detail" id="CR23752_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23752')">CR#23752 (Incidents 3390, 3469)</a> :</b> 
TLS socket closure not handled correctly while waiting for the end of the TLS handshake.
<h4>Description</h4>
<p class="cr">
When a TLS client socket succeeds at establishing a TCP connection with a server, a closure is requested by the application and the TLS connection times out, the socket is never closed.
</p>
<h4>Solution</h4>
<p class="cr">
When the TLS connection timer expires, the TLS socket checks whether a closure has been requested. If so, it triggers the closure of the socket and eventually, IAsyncSocketMgr::EvAsyncSocketMgrClosed() is called.
</p>
</div>
<br><a name="CR23817"><div class="synopsis" id="CR23817_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23817')">CR#23817 (Incident 3428)</a> :</b> Incorrect error handling if SSL_new fails for AsyncTlsSockets.
</div>
<div class="detail" id="CR23817_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23817')">CR#23817 (Incident 3428)</a> :</b> Incorrect error handling if SSL_new fails for AsyncTlsSockets.
<h4>Description</h4>
<p class="cr">
Currently, we do not validate if the SSL_new method returns a valid pointer before using it. We should handle the case that SSL_new fails.
</p>
<h4>Solution</h4>
<p class="cr">
We now verify that SSL_new returns a valid pointer before using it. Otherwise, an error is returned. SSL_CTX_new return's value is now handled earlier to bypass a problem where an invalid pointer is also returned.
</p>
</div>
<br><a name="CR24109"><div class="synopsis" id="CR24109_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24109')">CR#24109</a> :</b> Add the possibility to prevent non authoritative responses from being cached.
</div>
<div class="detail" id="CR24109_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24109')">CR#24109</a> :</b> Add the possibility to prevent non authoritative responses from being cached.
<h4>Description</h4>
<p class="cr">
The resolver cache object must be configurable to allow or prevent non-authoritative answers from being cached.
</p>
<h4>Solution</h4>
<p class="cr">
Added configuration methods to enable or disable non-authoritative response cache. When disabled, the AA flag from the DNS response header is validated before storing the answer in the cache.
</p>
<p class="cr">
Added CAsyncResolver::EnableCacheNonAuthoritativeResponse and CAsyncResolver::DisableCacheNonAuthoritativeResponse
</p>
</div>
<br><a name="CR24149"><div class="synopsis" id="CR24149_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24149')">CR#24149</a> :</b> Asynchronous TLS client socket cannot be reused once closed. 
</div>
<div class="detail" id="CR24149_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24149')">CR#24149</a> :</b> Asynchronous TLS client socket cannot be reused once closed. 
<h4>Description</h4>
<p class="cr">
The asynchronous TLS socket cannot be reused once closed. The problem lies in the fact that when the TLS socket is closed, it releases the internal TCP socket.
</p>
<p class="cr">
For "accepted" client sockets, this is correct because when such a socket gets closed it will most likely not be reused and be released. However, for client sockets, this is incorrect since the TLS socket never recreates its underlying TCP socket. Therefore, any attempt to reuse it fails.
</p>
<p class="cr">
Thus, the asynchronous TLS socket has been modified to not release its internal TCP socket when it gets closed. The m_pPeerCertificateChain management has also been updated to make sure that the pointer is valid at all times. The Mocana implementation suffered from a crash when a socket reuse was attempted. The crash occurred because the m_pPeerCertificateChain pointer was released and never recreated when the socket got closed.
</p>
<p class="cr">
Another problem that was discovered and fixed is that once the TLS socket got the to CLOSING_TLS state and called CloseA on its internal TCP socket, it could report the EvAsyncSocketMgrClosed event more than once to its manager event if the TLS socket CloseA method had been called only once. The EvAsyncSocketMgrClosed event must be reported for each call to the CloseA method, not much not less. To fix this, a new state (eCLOSING_TCP) has been introduced, as proposed by the Technical Lead. Using this state the TLS socket is now able to report the EvAsyncSocketMgrClosed only when appropriate.
</p>
</div>
<br><a name="CR24040"><div class="synopsis" id="CR24040_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24040')">CR#24040 (Incident 3469)</a> :</b> A network error in the UDP tracing can generate an infinite loop. 
</div>
<div class="detail" id="CR24040_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24040')">CR#24040 (Incident 3469)</a> :</b> A network error in the UDP tracing can generate an infinite loop. 
<h4>Description</h4>
<p class="cr">
When the sending operation fails in the UDP tracing output handler, a trace is generated in SocketErrors.  However, in the case of an unrecoverable network error (for example, when the local IP address has changed) this trace starts an infinite loop, since the code re-enters in the UDP tracing and the call to Send generates the same error again.
</p>
<p class="cr">
This issue was fixed by introducing a boolean in the CUdpTracing class to avoid reentering in the tracing method in the case that an unrecoverable network error generates an error trace.
</p>
</div>
<br><a name="CR24092"><div class="synopsis" id="CR24092_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24092')">CR#24092 (Incident 3469)</a> :</b> Force the close of the underlying TCP socket of the TLS socket and empty the send/receive buffers when the shutdown timer expires.
</div>
<div class="detail" id="CR24092_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24092')">CR#24092 (Incident 3469)</a> :</b> Force the close of the underlying TCP socket of the TLS socket and empty the send/receive buffers when the shutdown timer expires.
<h4>Description</h4>
<p class="cr">
The shutdown timer of the TLS socket may expire because of a network error.  When this situation occurs, the underlying TCP socket close must be forced instead of graceful.
</p>
<p class="cr">
Also, in the particular case where the local address has changed, there may be some data left in the send/receive buffers when the socket is closed.  This data must be discarded.
</p>
<p class="cr">
Those issues have been corrected in CAsyncTlsSocketBase.cpp,  CAsyncTlsSocketOpenSsl.cpp and  CAsyncTlsSocketMocanaSs.cpp, where the the socket close is forced upon the expiration of the shutdown timer and the send/receive buffers are emptied when the resources held by the socket are released.
</p>
</div>
<br><a name="CR24190"><div class="synopsis" id="CR24190_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24190')">CR#24190 (Incidents 3408, 3675, 3680)</a> :</b> The resolver does not resolve all targets when the response contains many SRV records
</div>
<div class="detail" id="CR24190_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24190')">CR#24190 (Incidents 3408, 3675, 3680)</a> :</b> The resolver does not resolve all targets when the response contains many SRV records
<h4>Description</h4>
<p class="cr">
The resolver does not make all recursive queries required to resolve all the targets in SRV records when there are many SRV records in the response.
</p>

<p class="cr">
The following situation was noticed:
<ol>
<li class="cr">An application sends a DNS SRV request using the NetworkTools function GetSrvRecord().</li>
<li class="cr">The name server responds with three SRV records with no additional records; as a result none of the targets in SRV records are resolved.</li>
<li class="cr">The resolver only resolves the target (recursive A query) of the last SRV record returned by the name server (it should resolve all three targets).</li>
<li class="cr">GetSrvRecord() returns only one SRV record that was resolved (the third SRV record from the name server response).</li>
</ol>
</p>
<p class="cr">
The problem was resolved by forcing another query as soon as an unresolved target is found. Note that all responses to recursive queries are appended to the original response.
</p>
</div>
<br><a name="CR24206"><div class="synopsis" id="CR24206_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24206')">CR#24206</a> :</b> Diffie-Hellman keys computed by OpenSSL are not padded.
</div>
<div class="detail" id="CR24206_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24206')">CR#24206</a> :</b> Diffie-Hellman keys computed by OpenSSL are not padded.
<h4>Description</h4>
<p class="cr">
Diffie-Hellman keys generated by DH_generate_key and DH_compute_key in the OpenSSL version of CDiffieHellman are not padded and make the asserts added by the CR 20940 fail.
</p>

<p class="cr">
The public and shared key are now padded with leading zeros before being returned to the application to make sure that they are of the appropriate size.
</p>
</div>
<br><a name="CR24213"><div class="synopsis" id="CR24213_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24213')">CR#24213 (Incident 3585)</a> :</b> MxStringToUint asserts when a character is not an ASCII character.
</div>
<div class="detail" id="CR24213_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24213')">CR#24213 (Incident 3585)</a> :</b> MxStringToUint asserts when a character is not an ASCII character.
<h4>Description</h4>
<p class="cr">
    Problem: MxStringToUint asserts when a character is not an ASCII character.
</p>

<p class="cr">
    Solution: In MxStringFormat.cpp, char characters are now always casted to unsigned char before calling isdigit or isalpha.
</p>
</div>
<br><a name="CR24359"><div class="synopsis" id="CR24359_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24359')">CR#24359</a> :</b> Optimize ::FindSorted for all containers. 
</div>
<div class="detail" id="CR24359_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24359')">CR#24359</a> :</b> Optimize ::FindSorted for all containers. 
<h4>Description</h4>
<p class="cr">
In its current implementation, all containers FindSorted() take too much processing cycles to complete the search. This is partly due to the fact that the compare method is called multiple times within each loop iteration.
</p>

<p class="cr">
Also, when the helper method returns, there is no way to know whether or not the item being looked for was found. So, another comparison must be done each time again.
</p>

<p class="cr">
All container's FindSorted() algorithms were modified to minimize the number of calls to the comparison method.
</p>
<p class="cr">
Also, the helper method called by CVectorBase::FindSorted() was modified to return whether or not it has found the item. This saves yet another comparison method call.
</p>
<p class="cr">
The following containers were modified:
<ul>
<li class="cr">CList</li>
<li class="cr">CVList</li>
<li class="cr">CAATree</li>
<li class="cr">CVector was previously fixed via CR23518</li>
</ul>
</p>
</div>
<br><a name="CR24525"><div class="synopsis" id="CR24525_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24525')">CR#24525 (Incident 3675)</a> :</b> SRV request response records must be properly ordered even when the OS resolver is used.
</div>
<div class="detail" id="CR24525_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24525')">CR#24525 (Incident 3675)</a> :</b> SRV request response records must be properly ordered even when the OS resolver is used.
<h4>Description</h4>
<p class="cr">
The SRV records received in responses to SRV DNS queries must be sorted according to RFC 2782 in all circumstances.
</p>
<p class="cr">
Formerly only the portable resolver did the sort, now all implementations, even those based on the underlying OS, will perform the sort.
</p>
</div>
<br><a name="CR24526"><div class="synopsis" id="CR24526_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24526')">CR#24526 (Incident 3675)</a> :</b> SRV response records received for NAPTR requests must be properly sorted.
</div>
<div class="detail" id="CR24526_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24526')">CR#24526 (Incident 3675)</a> :</b> SRV response records received for NAPTR requests must be properly sorted.
<h4>Description</h4>
<p class="cr">
The SRV records received in responses to NAPTR DNS queries must be sorted according to RFC 2782 in all circumstances.
</p>
<p class="cr">
Formerly SRV records were not sorted when present in NAPTR query responses. This has been changed so that SRV records present in the response and additional records section of a DNS response get properly sorted before being returned to the caller.
</p>
</div>
<br><a name="CR24757"><div class="synopsis" id="CR24757_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24757')">CR#24757 (Incident 3777)</a> :</b> Documentation: Must add trace level description in Programmer's Guide.
</div>
<div class="detail" id="CR24757_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24757')">CR#24757 (Incident 3777)</a> :</b> Documentation: Must add trace level description in Programmer's Guide.
<h4>Description</h4>
<p class="cr">
The Framework documentation should state how the tracing mechanism is used in M5T packages.
</p>
<p class="cr">
A subsection detailing the internal use of the tracing mechanism in M5T packages has been added to the "General Tracing Configuration" section.
</p>
</div>
<br><a name="CR24754"><div class="synopsis" id="CR24754_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24754')">CR#24754 (Incident 3756)</a> :</b> Must be possible to access multiple common names in certificates. 
</div>
<div class="detail" id="CR24754_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24754')">CR#24754 (Incident 3756)</a> :</b> Must be possible to access multiple common names in certificates. 
<h4>Description</h4>
<p class="cr">
It is possible to add multiple names to the subject and issuer parts of the certificate but no API is currently available to get these different names. APIs to get the multiple names must be added.
</p>
</div>
<br><a name="CR24903"><div class="synopsis" id="CR24903_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24903')">CR#24903</a> :</b> MxStringToByteArray should not be endian dependent
</div>
<div class="detail" id="CR24903_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24903')">CR#24903</a> :</b> MxStringToByteArray should not be endian dependent
<h4>Description</h4>
<p class="cr">
MxStringToByteArray and MxByteArrayToString are currently dependent on the endianness of the platform used. The array used has to be filled in the different byte ordering. This does not make sense in an array of bytes. The methods have been reworked and now only work with arrays where the most significant byte is located at the index 0 of the array.
</p>
<h4 class="red">Application Updates Required</h4>
<p class="cr">
In MxStringFormat.h/cpp, the functions MxStringToByteArray and MxByteArrayToString have been renamed to MxStringToByteArrayNumber and MxByteArrayNumberToString
</p>

</div>
<br></div>
<br>
<hr>
<div id="label2.1.7.15_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.7.15')">Version 2.1.7</a> (build 15): Created on May 22, 2009
</div>
<div id="label2.1.7.15_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.7.15')">Version 2.1.7</a> (build 15): Created on May 22, 2009
<br><br><h3>Bug Fixes</h3>
<a name="CR24066"><div class="synopsis" id="CR24066_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR24066')">CR#24066 (Incidents 3486, 3674)</a> :</b> No packet can be received from a DNS server that is back online after being down when using the portable resolver.
</div>
<div class="detail" id="CR24066_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR24066')">CR#24066 (Incidents 3486, 3674)</a> :</b> No packet can be received from a DNS server that is back online after being down when using the portable resolver.
<h4>Description</h4>
<p class="cr">
No packet can be received from a DNS server that is back after being down when using the portable resolver.  The reason is that the UDP socket for the server must be reconnected after being notified that the peer is down.  Note that this problem is probably dependent on the behavior of the underlying operating system regarding connected UDP sockets (it has been observed under Linux 2.4).
</p>
<h4>Solution</h4>
<p class="cr">
When a call to Recv fails the underlying socket is now reconnected.
</p>
</div>
<br></div>
<br>
<hr>
<div id="label2.1.7.14_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.7.14')">Version 2.1.7</a> (build 14): Created on April 30, 2009
</div>
<div id="label2.1.7.14_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.7.14')">Version 2.1.7</a> (build 14): Created on April 30, 2009
<br><br><h3>New Features and Improvements</h3>
<a name="CR23806"><div class="synopsis" id="CR23806_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23806')">CR#23806</a> :</b> Add a macro changing a NULL pointer to "".
</div>
<div class="detail" id="CR23806_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23806')">CR#23806</a> :</b> Add a macro changing a NULL pointer to "".
<h4>Description</h4>
<p class="cr">
    It would be useful to have a macro changing a NULL C-string pointer to an empty string (i.e. "").
</p>
<h4>Solution</h4>
<p class="cr">
    Added the MX_MAKE_NULL_EMPTY_STRING macro to Basic/MxMacro.h. When the given pointer is NULL, g_szEMPTY_STRING is returned.
</p>
</div>
<br><a name="CR23996"><div class="synopsis" id="CR23996_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23996')">CR#23996</a> :</b> Need to verify if an IPv4 address is a multicast address.
</div>
<div class="detail" id="CR23996_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23996')">CR#23996</a> :</b> Need to verify if an IPv4 address is a multicast address.
<h4>Description</h4>
<p class="cr">
It would be much convenient, e.g. for SDP message generation, to know if an IPv4-CSocketAddr is a multicast address.
</p>
<h4>Solution</h4>
<p class="cr">
Added CSocketAddr::IsInetAddressMulticast(), which verifies if the address is an IPv4 multicast address.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Added CSocketAddr::IsInetAddressMulticast()
</p>

</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR23208"><div class="synopsis" id="CR23208_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23208')">CR#23208 (Incident 3284)</a> :</b> DNS resolver must handle responses longer than 512 bytes.
</div>
<div class="detail" id="CR23208_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23208')">CR#23208 (Incident 3284)</a> :</b> DNS resolver must handle responses longer than 512 bytes.
<h4>Description</h4>
<p class="cr">
When using the native OS resolver on Windows, Linux and VxWorks, the default behavior is to resolve using UDP. When the answer is bigger than the maximum UDP packet size of 512 bytes, the TC bit of the header of the answer is set to 1 and the actual answer is truncated. Then, the native resolver retries using TCP. The Framework does not support receiving an answer bigger than 512 bytes as we always expected to receive a UDP packet.
</p>

<p class="cr">
As for the Framework Portable Resolver, we only support sending and receiving UDP packets. Receiving an answer with the TC bit set to 1 should cause a failure as we cannot receive the entire answer.
</p>
<h4>Solution</h4>
<p class="cr">
Macro MXD_MAX_DNS_PACKET_LENGTH has been added to let the user configure the wanted maximum size of the DNS packet to accept. The default value is set to 512. In the case that there is a failure at receiving the answer, its value should be increased.
</p>
<p class="cr">
The TC bit of the DNS answer headers' list is now validated and the parser returns an error in the case that its value is 1.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Receiving a DNS packet having the truncated flag at 1 now results as a failure of the DNS query. This behaviour should only happen when using the portable resolver since native resolvers fallback on TCP after receiving a truncated UDP packet.
</p>

</div>
<br><a name="CR23951"><div class="synopsis" id="CR23951_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23951')">CR#23951 (Incident 3480)</a> :</b> CSocketAddr::SetSinAddress() implementation causes a GCC compiler optimization problem on MIPS architecture
</div>
<div class="detail" id="CR23951_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23951')">CR#23951 (Incident 3480)</a> :</b> CSocketAddr::SetSinAddress() implementation causes a GCC compiler optimization problem on MIPS architecture
<h4>Description</h4>
<p class="cr">
When the CSocketAddr::SetSinAddress(IN const uint8_t* puAddress) is being optimized by the compiler, the generated code always copies four bytes instead of 16 for IPv6. This problem was noticed with GCC v3.2 and 3.3 targeted for the MIPS architecture and for the eCos 2.0 operating system.
</p>
<h4>Solution</h4>
<p class="cr">
  The problematic code was modified to work around this compiler problem.
</p>
</div>
<br><br><h3>Documentation Updates</h3>
<a name="CR23855"><div class="synopsis" id="CR23855_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23855')">CR#23855</a> :</b> Clarify utilisation of mxt_opaque macros.
</div>
<div class="detail" id="CR23855_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23855')">CR#23855</a> :</b> Clarify utilisation of mxt_opaque macros.
<h4>Description</h4>
<p class="cr">
Add documentation in opaque macros about their usage being mandatory and add some examples.
</p>
<h4>Solution</h4>
<p class="cr">
Documentation and examples were added.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
    The documentation of the following macros were updated: MX_OPQ_TO_VOIDPTR, MX_VOIDPTR_TO_OPQ, MX_INT32_TO_OPQ, MX_OPQ_TO_INT32, MX_UINT32_TO_OPQ and MX_OPQ_TO_UINT32.
</p>

</div>
<br></div>
<br>
<hr>
<div id="label2.1.7.13_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.7.13')">Version 2.1.7</a> (build 13): Created on February 16, 2009
</div>
<div id="label2.1.7.13_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.7.13')">Version 2.1.7</a> (build 13): Created on February 16, 2009
<br><br><h3>New Features and Improvements</h3>
<a name="CR23066"><div class="synopsis" id="CR23066_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23066')">CR#23066 (Incident 3234)</a> :</b> Must add a way to have a timeout when doing a TCP connect.
</div>
<div class="detail" id="CR23066_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23066')">CR#23066 (Incident 3234)</a> :</b> Must add a way to have a timeout when doing a TCP connect.
<h4>Description</h4>
<p class="cr">
When doing a TCP connect to a host that does not answer, the timeout is dependent on the OS. The Framework must provide a way to specify this TCP connect timeout.
</p>
<h4>Solution</h4>
<p class="cr">
Added the define MXD_NETWORK_ASYNCSOCKET_CONNECT_TIMEOUT_MS, which defines the TCP connect timeout for all TCP asynchronous sockets. This can be used to configure all TCP asynchronous sockets at compile time. By default, this is the max value of a 64-bit unsigned integer. If the OS timer is smaller than this value, it has priority.
</p>
<p class="cr">
Added the method CAsyncTcpSocket::SetConnectTimeoutMs, which specifies the TCP connect timeout for a particular socket. It can be used to configure TCP asynchronous sockets at runtime. If the OS timer is smaller than this value, it has priority.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Added the method IAsyncSocketTcpOptions::SetConnectTimeout.
</p>

</div>
<br><a name="CR23304"><div class="synopsis" id="CR23304_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23304')">CR#23304 (Incident 3187)</a> :</b> Add amd64 target support.
</div>
<div class="detail" id="CR23304_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23304')">CR#23304 (Incident 3187)</a> :</b> Add amd64 target support.
<h4>Description</h4>
<p class="cr">
The M5T framework must support a new target: Linux26_amd64_gcc412. The amd64 is the first 64 bits target supported by the M5T Framework. This new supported target uses the GCC 4.1.2 tool chain with the -m64 option and is targeted for the Linux 2.6 operating system. The generated code will comply with the LP64 data model whereas the current 32 bits M5T Framework code was solely dedicated for ILP32 data model. The major differences between LP64 and ILP32 data models reside on pointer and long types, which have passed from 32 bits to 64 bits in LP64.
</p>
<h4>Solution</h4>
<p class="cr">
An automatic detection mechanism was added for this new amd64 target. When it is detected, the new architecture MXD_ARCH_AMD64 is defined. Furthermore, when the combination of compiler, OS and architecture (GCC, LINUX and AMD64) is detected, the new MXD_DATA_MODEL_LP64 is defined. In other cases, MXD_DATA_MODEL_ILP32 is defined.
</p>

<p class="cr">
Since mxt_opaque is defined as a void*, it is now 64 bits under the amd64 target instead of 32 bits for other platforms. For this reason, many warnings occurred when trying to assign an integer from a mxt_opaque on amd64 target. To help the programmer, the following macros were added to ease the mxt_opaque conversions: MX_INT32_TO_OPQ(), MX_OPQ_TO_INT32(), MX_UINT32_TO_OPQ(), MX_OPQ_TO_UINT32(), MX_VOIDPTR_TO_OPQ() and MX_OPQ_TO_VOIDPTR(). Also, all the FW code was scanned for any mxt_opaque cast occurrences and was modified to use these macros.
</p>

<p class="cr">
In many files, the code was modified to avoid the "type-punning" warnings under the amd64 target. However, these modifications do not impact the code size nor the performance.
</p>

<p class="cr">
MX_PACK_MEMBER macro was defined to nothing when GCC 4.1 and above is used to eliminate a warning. More information can be found in file MxPack.h
</p>

<p class="cr">
Some CPrivateKey methods, that were using an unsigned integer type parameter instead of a mxt_opaque, were modified to use a mxt_opaque. Some classes related to CPrivateKey were also fixed.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Some methods in the following classes were modified to use a mxt_opaque type instead of an unsigned integer: CPrivateKey, CPrivateKeyMocana, CPrivateKeyOpenSsl, CPrivateKeyOverride, CPkcs12 and IPassPhrase.
</p>
<p class="cr">
IAsyncServerSocket was added with a "templated" version of QueryAcceptedOptionsIf method to ease its usage.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The Programmer's Guide and the release note file were updated to indicate the new supported target.
</p>

</div>
<br><a name="CR23359"><div class="synopsis" id="CR23359_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23359')">CR#23359 (Incident 3187)</a> :</b> Implement CAtomic for amd64 target.
</div>
<div class="detail" id="CR23359_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23359')">CR#23359 (Incident 3187)</a> :</b> Implement CAtomic for amd64 target.
<h4>Description</h4>
<p class="cr">
Implement CAtomic for amd64 target.
</p>
<h4>Solution</h4>
<p class="cr">
Since the amd64 architecture is based on x64, it supports the same assembler instructions. As a result, the same implementation is used. Conditional compilation was modified to enable CAtomicLinuxi386.h when compiling the amd64 architecture.
</p>
</div>
<br><a name="CR23364"><div class="synopsis" id="CR23364_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23364')">CR#23364 (Incident 3187)</a> :</b> Add a define for minimal alignment.
</div>
<div class="detail" id="CR23364_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23364')">CR#23364 (Incident 3187)</a> :</b> Add a define for minimal alignment.
<h4>Description</h4>
<p class="cr">
The Framework sub-allocator (CSubAllocator) uses a hardcoded alignement constant = 8. This constant must be used through a defined in FrameworkCfg.h
</p>
<h4>Solution</h4>
<p class="cr">
MXD_MINIMAL_ALIGNMENT_IN_BYTES was added in FrameworkCfg.h. By default, It is initialized to 4 for a 32 bits platform or to 8 for a 64 bits platform. This new define is now used in CSubAllocator to determine the required alignment.
</p>
</div>
<br><a name="CR23446"><div class="synopsis" id="CR23446_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23446')">CR#23446 (Incident 3199)</a> :</b> Functions must be added that convert from a string to a byte array of any size and the opposite.
</div>
<div class="detail" id="CR23446_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23446')">CR#23446 (Incident 3199)</a> :</b> Functions must be added that convert from a string to a byte array of any size and the opposite.
<h4>Description</h4>
<p class="cr">
Functions must be added that convert from a string of any size to a byte array  and the opposite. The functions must work as if the byte array represents an unsigned integer of the given size. They must provide similar functionality to the functions atoi and itoa but without being limited by the max size of the int.
</p>
<h4>Solution</h4>
<p class="cr">
Added functions that convert from a string to a byte array of any size and the opposite in MxStringFormat.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Added in MxStringFormat.h/cpp the functions MxStringToByteArray and MxByteArrayToString.
</p>

</div>
<br><a name="CR23492"><div class="synopsis" id="CR23492_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23492')">CR#23492</a> :</b> Support gcc 4.2 : resolve compilation warnings.
</div>
<div class="detail" id="CR23492_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23492')">CR#23492</a> :</b> Support gcc 4.2 : resolve compilation warnings.
<h4>Description</h4>
<p class="cr">
Using gcc 4.2 compilation with the Framework results as new warnings appearing. They must be resolved.
</p>
<h4>Solution</h4>
<p class="cr">
gcc 4.2 is now supported by pkg_Framework.
</p>
<p class="cr">
Uses of char* with quoted string are now declared as const char*. In the case that we really want to use a char*, a const_cast has been used to remove the const behaviour of the quoted string.
</p>
</div>
<br><a name="CR23550"><div class="synopsis" id="CR23550_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23550')">CR#23550</a> :</b> Add the new result code resFE_NOT_FOUND
</div>
<div class="detail" id="CR23550_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23550')">CR#23550</a> :</b> Add the new result code resFE_NOT_FOUND
<h4>Description</h4>
<p class="cr">
There is no result code indicating an element not found error.
</p>
<h4>Solution</h4>
<p class="cr">
New resFE_NOT_FOUND error code was added in the EMxResultSharedFailErrorCodeId enum, one description string was also added in the g_aszResultPkgSharedMsgFailError array.
</p>
</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR22038"><div class="synopsis" id="CR22038_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22038')">CR#22038 (Incident 2864)</a> :</b> Internal calls to CloseA in TLS server socket are reported to the manager.
</div>
<div class="detail" id="CR22038_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22038')">CR#22038 (Incident 2864)</a> :</b> Internal calls to CloseA in TLS server socket are reported to the manager.
<h4>Description</h4>
<p class="cr">
    AsyncTlsSocket currently cannot be reused once closed. It should (as documented).
</p>
<p class="cr">
    TLS server socket calls CloseA on the internal socket, even if the socket is already closed, when the socket is released (UninitializeInstance). When the operation is done, EvSocketMgrClosed tries to notify the TLS socket's manager. This can lead to a crash since the manager has already released the socket and it's probably already deleted. The manager doesn't expect to receive EvSocketMgrClosed again since it has already called CloseA itself, received the EvSocketMgrClosed and released the socket.
</p>
<h4>Solution</h4>
<p class="cr">
    CAsyncTlsSocketBase::InitializeInstance now queries its interface using QueryTcpSocketInterfaces, which was updated to reuse the internal socket.
</p>
<p class="cr">
    CAsyncTlsServerSocketBase::ReleaseResources now sets the TlsAsyncSocketMgr to Null before closing the internal socket. This prevents the second callback.
</p>
</div>
<br><a name="CR23012"><div class="synopsis" id="CR23012_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23012')">CR#23012 (Incident 3238)</a> :</b> Compilation problem in assert configuration.
</div>
<div class="detail" id="CR23012_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23012')">CR#23012 (Incident 3238)</a> :</b> Compilation problem in assert configuration.
<h4>Description</h4>
<p class="cr">
    There is a compilation error if MXD_ASSERT_TRACE_OVERRIDE is defined.
</p>
<h4>Solution</h4>
<p class="cr">
    Corrected the compilation problem introduced by the fix of CR 17157.
</p>
</div>
<br><a name="CR23178"><div class="synopsis" id="CR23178_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23178')">CR#23178 (Incident 3278)</a> :</b> If MXD_OS_NONE is defined MxConfig should not try to redefine MXD_OS_x. 
</div>
<div class="detail" id="CR23178_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23178')">CR#23178 (Incident 3278)</a> :</b> If MXD_OS_NONE is defined MxConfig should not try to redefine MXD_OS_x. 
<h4>Description</h4>
<p class="cr">
When the MXD_OS_NONE macro is defined, MxConfig.h code still tries to determine the current OS.  If MXD_OS_NONE is purposefully defined but the code is compiled on a known OS such as Linux/Windows, more than one MXD_OS_x will be defined, which causes problems.
</p>
<h4>Solution</h4>
<p class="cr">
Moved the check for the MXD_OS_NONE macro definition as the first check for operating systems, so system-specific internal macros are not if MXD_OS_NONE is defined.
</p>
</div>
<br><a name="CR23263"><div class="synopsis" id="CR23263_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23263')">CR#23263 (Incident 3294)</a> :</b> Compilation problem for VxWorks 6.6
</div>
<div class="detail" id="CR23263_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23263')">CR#23263 (Incident 3294)</a> :</b> Compilation problem for VxWorks 6.6
<h4>Description</h4>
<p class="cr">
    The following compilation error is found when trying to compile on VxWorks 6.6 on GCC 4.1.2 :
<pre class="cr">
      ./M5TFramework/Basic/MxFault.cpp:376: error: 'struct windTcb' has no member named 'name'
</pre>
</p>
<h4>Solution</h4>
<p class="cr">
    The error occurs in the handler for VxWorks-mips exceptions because the thread TCB structure must no longer be used.  From the VxWorks 5.5 to 6.6 Migration Guide : "The task name is now stored as part of the generic object structure, and can no longer be referenced directly from the TCB. For complete portability use taskName() instead."
(http://www.slac.stanford.edu/grp/cd/soft/vxworks/doc/6.6/vxworks_5.5_migration_guide_6.6.pdf)
</p>
<p class="cr">
The GenericErrorHandler now uses taskName() on all VxWorks-mips platforms.
</p>
</div>
<br><a name="CR23270"><div class="synopsis" id="CR23270_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23270')">CR#23270</a> :</b> If this server socket is not in the socket factory list the accepted socket are created with the socket factory.
</div>
<div class="detail" id="CR23270_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23270')">CR#23270</a> :</b> If this server socket is not in the socket factory list the accepted socket are created with the socket factory.
<h4>Description</h4>
<p class="cr">
When a server socket is not in the socket factory list, we will not use the socket factory to create the accepted socket because we do not want it to be part of the list either. This applies to situations where a socket would be encapsulated in a higher level type of socket for code reuse. As such, the TLS encapsulates a TCP socket but what the users really have in hands is only a TLS socket, the fact that it reuses the TCP socket internally must be completely hidden. That is why it must not be possible to access and modify such encapsulated sockets by iterating the socket factory list.
</p>
<h4>Solution</h4>
<p class="cr">
In the CAsyncSocketFactory, added the IsAsyncSocketInList function that returns whether or not the socket is present in the internal list of sockets.
</p>
<p class="cr">
When a TCP or a TLS server socket accepts a socket, we validate if the server socket is in the internal list of the CAsyncSocketFactory. If not, the socket is created without using the socket factory, otherwise the creation is made with the CAsyncSocketFactory as before.
</p>
</div>
<br><a name="CR23278"><div class="synopsis" id="CR23278_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23278')">CR#23278 (Incident 3294)</a> :</b> OpenSSL deprecated function must not be used.
</div>
<div class="detail" id="CR23278_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23278')">CR#23278 (Incident 3294)</a> :</b> OpenSSL deprecated function must not be used.
<h4>Description</h4>
<p class="cr">
CDiffieHellmanOpenSsl uses the deprecated OpenSSL function DH_generate_parameters.
</p>
<h4>Solution</h4>
<p class="cr">
The DH_generate_parameters function was replaced by the newer DH_generate_parameters_ex function to do the same functionality.
</p>
</div>
<br><a name="CR23300"><div class="synopsis" id="CR23300_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23300')">CR#23300</a> :</b> Xml: Problem with Copy and SetName.
</div>
<div class="detail" id="CR23300_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23300')">CR#23300</a> :</b> Xml: Problem with Copy and SetName.
<h4>Description</h4>
<p class="cr">
A few bugs were found in the XML implementation. Here is the list of problems.
</p>
<ul>
<li class="cr">There is a bug with CXmlElement::CreateChildElement (by copy). It does not allow to use eNSDECLARE_FORCE and eNSPOS_AS_COPY when inserting between two child elements or when there are no child elements in the parent element.</li>
<li class="cr">No events are reported when SetValue is called with a string shorter than the current value (when string is reused).</li>
<li class="cr">No events are reported when SetValue is called with NULL.</li>
<li class="cr">After copying an element that does not have a namespace into an element that has a namespace, the element still points to the oldnamespace (which may or may not exist anymore)</li>
</ul>
<h4>Solution</h4>
<p class="cr">
CXmlElement::CreateChildElement (by copy) now calls GetNamespaceDeclarationElement and the PrivateCreateElement, which takes a CXmlElement for namespace declaration. This results in the namespace of the created element to be declared on itself (as specified in the documentation) and the rest of the namespaces will be declared as the copied element.
</p>

<p class="cr">
Reworked the implementation of CXmlElement::PrivateSetValue in order for events to be reported when ReuseString and when the value to set is NULL.
</p>

<p class="cr">
In CXmlElement::CopyHelper, m_pstElementNamespace is always set to NULL before calling PrivateSetNamespace.
</p>
</div>
<br><a name="CR23319"><div class="synopsis" id="CR23319_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23319')">CR#23319 (Incident 3239)</a> :</b> Update Update Guide with point that came up during incident 3239.
</div>
<div class="detail" id="CR23319_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23319')">CR#23319 (Incident 3239)</a> :</b> Update Update Guide with point that came up during incident 3239.
<h4>Description</h4>
<p class="cr">
During the resolution of the incident 3239, some error or missing information was found in the "M5T Framework 2.1 update from v2.0.ppt" document.
</p>
<h4>Solution</h4>
<p class="cr">
Here is a list of the corrections:
<ul>
<li class="cr">Updated the list of changed or removed files.</li>
<li class="cr">The memory allocator problems were not caused by the update from 2.0.</li>
<li class="cr">The changes in the tracing mechanism already have a section in the update guide.</li>
<li class="cr">Mentioned that MX_RINSPECT is gone.</li>
</ul>
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Update done in the "M5T Framework 2.1 update from v2.0.ppt" document.
</p>

</div>
<br><a name="CR23362"><div class="synopsis" id="CR23362_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23362')">CR#23362 (Incident 3304)</a> :</b> Tthe operator= in TlsSession doesn't restore the masterSecret CBlob on Mocana.
</div>
<div class="detail" id="CR23362_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23362')">CR#23362 (Incident 3304)</a> :</b> Tthe operator= in TlsSession doesn't restore the masterSecret CBlob on Mocana.
<h4>Description</h4>
<p class="cr">
    The assignment operator in TlsSession only restores the sessionId CBlob, but does not restore the MasterSecret CBlob when Mocana is used as a base class.
</p>
<h4>Solution</h4>
<p class="cr">
    Corrected the TlsSession assignment operator to use the one from the base class.
</p>
</div>
<br><a name="CR23363"><div class="synopsis" id="CR23363_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23363')">CR#23363</a> :</b> Add templated version of QueryIf to IECOMUNKNOWN macros.
</div>
<div class="detail" id="CR23363_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23363')">CR#23363</a> :</b> Add templated version of QueryIf to IECOMUNKNOWN macros.
<h4>Description</h4>
<p class="cr">
When calling the templated QueryIf() method from an ECom object implementing multiples ECom interfaces, the MX_DECLARE_DELEGATING_IECOMUNKNOWN or MX_DECLARE_IECOMUNKNOWN is called instead of the IEcomUnknown::QueryIf() version. Since these macros do not implement the templated version of QueryIf(), this leads to a compilation error.
</p>
<h4>Solution</h4>
<p class="cr">
A templated QueryIf() method has been added to the macro MX_DECLARE_IECOMUNKNOWN in EComDef.h. The following fixes have been selected as a possible solution for the templated QueryIf() method implementation in the MX_DECLARE_DELEGATING_IECOMUNKNOWN macro.
</p>

<ol>
<li class="cr">
First method:
</li>
<pre class="cr">
template&lt;class _Type&gt; mxt_result QueryIf(OUT _Type** ppInterface)
{
    if (ppInterface != NULL)
    {
        return GetOwnerIEComUnknown()-&gt;QueryIf((*ppInterface)-&gt;GetIID(),
                                               reinterpret_cast&lt;void**&gt;(ppInterface));
    }
    return resFE_INVALID_ARGUMENT;
}
</pre>
<li class="cr">
Second method:
</li>
<pre class="cr">
template&lt;class _Type&gt; mxt_result QueryIf(OUT _Type** ppInterface)
{
    if (ppInterface != NULL)
    {
        return QueryIf((*ppInterface)-&gt;GetIID(),
                       reinterpret_cast&lt;void**&gt;(ppInterface));
    }
    return resFE_INVALID_ARGUMENT;
}
</pre>
</ol>

<p class="cr">
In the two cases, since a templated method cannot be virtual, a call to QueryIf() from a base class calls its own QueryIf(), which derogates from the current behaviour of the non-templated version where its child QueryIf() is called instead. The main difference between these two implementations is that in the first case, the templated QueryIf() method retrieves the owner interface from the base class and a call to QueryIf() is done on it (because the base class cannot access the QueryIf() method of its child). In the second case, the templated QueryIf() method calls its virtual non-templated QueryIf() method which is implemented in its child.
</p>

<p class="cr">
In these two cases, ultimately the owner interface will be the same, so the interface querying will be using the same NonDelegatingQueryIf() method, but the second method is following the current implemented behaviour. For this reason, the second method has been chosen.
</p>
</div>
<br><a name="CR23444"><div class="synopsis" id="CR23444_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23444')">CR#23444 (Incident 3341)</a> :</b> Fix capacity problem in CList::Move.
</div>
<div class="detail" id="CR23444_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23444')">CR#23444 (Incident 3341)</a> :</b> Fix capacity problem in CList::Move.
<h4>Description</h4>
<p class="cr">
There is a bug in CList::Move for the capacity of both lists. The source list capacity is decreased by the amount of items it contained before and the destination's list capacity is increased by the number of items the source list contained. This problem can easily be reproduced with the Merge method (which calls Move).
</p>
<h4>Solution</h4>
<p class="cr">
Correctly set number of block left (m_blockAllocator.m_uBlockCount) for both lists when pDestinationListBase-&gt;m_blockAllocator == pSourceListBase-&gt;m_blockAllocator instead of simply setting the list size.
</p>
</div>
<br><a name="CR23518"><div class="synopsis" id="CR23518_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23518')">CR#23518</a> :</b> Optimize CVectorBase::FindSorted().
</div>
<div class="detail" id="CR23518_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23518')">CR#23518</a> :</b> Optimize CVectorBase::FindSorted().
<h4>Description</h4>
<p class="cr">
In its current implementation, CVectorBase::FindSorted() takes too much processing cycles to complete the research. This is partly due to the fact that the compare method is called multiple times within each loop iteration.
</p>

<p class="cr">
Also, when the helper method returns, there is no way to know if the item being looked for was found or not. So, another comparison must be done each time again.
</p>
<h4>Solution</h4>
<p class="cr">
Modified the CVectorBase::FindSorted() algorithm to call once the comparison method for each loop iteration.
</p>
<p class="cr">
Also, modified the helper method called by CVectorBase::FindSorted() to return whether or not it found the item. This saves yet another comparison method call.
</p>
</div>
<br><a name="CR23524"><div class="synopsis" id="CR23524_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23524')">CR#23524 (Incident 3239)</a> :</b> MxTraceCallOutputHandler may cause a dead lock.
</div>
<div class="detail" id="CR23524_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23524')">CR#23524 (Incident 3239)</a> :</b> MxTraceCallOutputHandler may cause a dead lock.
<h4>Description</h4>
<p class="cr">
CUdpTracing may cause a dead lock in the following conditions:
<ul>
<li class="cr">MXD_TRACE_USE_EXTERNAL_THREAD is defined</li>
<li class="cr">MXD_TRACE_USE_MEMORY_QUEUE_BUFFER is defined</li>
<li class="cr">the output handler output traces</li>
</ul>
</p>
<p class="cr">
When using CUdpTracing with an external thread, the conditions above are met. CUdpTracing::TraceToUdp() is used as a trace output handler. The sequence of events is the following:
<pre class="cr">
      External thread                                 Resolver thread
        |--&gt; MxTraceCallOutputHandler
              |--&gt; The MemoryQueue (MQ) mutex is lock
              |--&gt; TraceToUdp
                    |--&gt; GetHostByName
                          |-------------------------&gt; GetHostByName
                                                        |--&gt; TRACE
                                                              |--&gt; The MemoryQueue (MQ) is lock
  *** DEAD LOCK
 (waiting for GetHostByName to complete)                      (waiting for MQ)
</pre>
</p>
<h4>Solution</h4>
<p class="cr">
CUdpTracing was fixed to asynchronously resolve the address in TraceToUdp. This way, the external thread does not wait for the address resolving to terminate and thus avoids the dead lock condition. The CUdpTracing class was also transformed in a singleton to ease the implementation of the asynchronous resolver interface. The CTestCUdpTracing::TestCUdpTracingCR23254 test method was added to test the dead lock condition. Test configuration 5 was also modified to enable this test. PreFrameworkCfg and m5tmake.cfg were modified for this purpose.
</p>

<p class="cr">
The gs_bMxTraceCallOutputHandlerInUse variable was added to MxTraceKernel.cpp. It is set to true each time the MxTraceCallOutputHandler method is entered and to false when it is exited. This indicator is used to avoid calling two gs_memoryQueue.Instance()-&gt;Pop() in a row (without calling PopFinalize in the middle). This situation occurs when an output handler outputs a trace and the memory queue if full. The call stack is the following:
<pre class="cr">
 MxTraceCallOutputHandler
   |--&gt; gs_memoryQueue.Instance()-&gt;Pop()
   |--&gt; Output handler is called
          |--&gt; TRACE
                |--&gt; MxTraceNewMemoryQueueBuffer
                       |--&gt; if gs_memoryQueue.Instance()-&gt;Push failed (buffer is full)
                              |--&gt; if !gs_bMxTraceCallOutputHandlerInUse ******
                                     |--&gt; gs_memoryQueue.Instance()-&gt;Pop()
</pre>
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
A new parameter was added to CUdpTracing::Initialize(). This new parameter is named uFqdnValidationPeriodMs and it has a default value = 30. When this parameter is not used, the Fqdn period is the same as before.
</p>

</div>
<br><a name="CR23542"><div class="synopsis" id="CR23542_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23542')">CR#23542</a> :</b> The CAsyncSocketFactory::CallConfigurationMgr() method MUST be called from async sockets before Bind().
</div>
<div class="detail" id="CR23542_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23542')">CR#23542</a> :</b> The CAsyncSocketFactory::CallConfigurationMgr() method MUST be called from async sockets before Bind().
<h4>Description</h4>
<p class="cr">
The CAsyncSocketFactory::CallConfigurationMgr() method MUST be called from asynchronous  sockets before Bind(). This is necessary since the internal synchronous socket used by the asynchronous socket needs to be created before calling the manager to have access to the synchronous socket's handle.
</p>
<h4>Solution</h4>
<p class="cr">
Modified CAsyncUdpSocket,CAsyncTlsSocketBase, CAsyncTcpSocket and CAsyncTcpServerSocket so that they call the CAsyncSocketFactory::CallConfigurationMgr() method before calling Bind() on their internal synchronous socket.
</p>
<p class="cr">
Modified the CAsyncSocketFactory::CreateAsyncSocket() method so that it no longer calls the CAsyncSocketFactory::CallConfigurationMgr() method upon socket creation.
</p>
<p class="cr">
The CAsyncSocketFactory::CallConfigurationMgr() method method is now public, but undocumented. It is meant to be called only from inside asynchronous sockets.
</p>
</div>
<br><a name="CR23560"><div class="synopsis" id="CR23560_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23560')">CR#23560</a> :</b> Do not increment the TotalReleaseCounter when the Release method is called with a NULL pointer.
</div>
<div class="detail" id="CR23560_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23560')">CR#23560</a> :</b> Do not increment the TotalReleaseCounter when the Release method is called with a NULL pointer.
<h4>Description</h4>
<p class="cr">
The total release counter is incremented when the Release( ) method is called with a NULL pointer argument. This is a wrong behaviour that may cause some errors to the algorithm that determines if a clean up is required.
</p>
<h4>Solution</h4>
<p class="cr">
The total release counter is now incremented after the argument test.
</p>
</div>
<br><a name="CR23660"><div class="synopsis" id="CR23660_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23660')">CR#23660</a> :</b> CMemoryAllocator must reset its block header's signatures before releasing it.
</div>
<div class="detail" id="CR23660_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23660')">CR#23660</a> :</b> CMemoryAllocator must reset its block header's signatures before releasing it.
<h4>Description</h4>
<p class="cr">
The Framework's memory allocator (CMemoryAllocator) does not currently reset the block header's signatures when deallocating a block.
</p>
<p class="cr">
This is problematic if the memory is reused and not re-initialized, because the block's signature will wrongly appear within the object itself. When trying to release the said object, the wrong signature will be found and an assertion will happen.
</p>
<h4>Solution</h4>
<p class="cr">
The block header's signatures are now reset to a deletion signature so that releasing a freed block will now be caught by an assert.
</p>
</div>
<br><br><h3>Documentation Updates</h3>
<a name="CR23260"><div class="synopsis" id="CR23260_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23260')">CR#23260 (Incident 3239)</a> :</b> Documentation of MX_NEW/MX_DELETE defines should reflect their recommended mandatory use.
</div>
<div class="detail" id="CR23260_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23260')">CR#23260 (Incident 3239)</a> :</b> Documentation of MX_NEW/MX_DELETE defines should reflect their recommended mandatory use.
<h4>Description</h4>
<p class="cr">
    The documentation of MX_NEW, MX_DELETE, MX_NEW_ARRAY, and MX_DELETE_ARRAY should mention as a best practice that they should always be used even if the memory allocator is not enabled.
</p>
<h4>Solution</h4>
<p class="cr">
  No changes in code done, only updated the documentation.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
    The documentation of MX_NEW, MX_DELETE, MX_NEW_ARRAY, and MX_DELETE_ARRAY has been updated to mention that they should be used.
</p>

</div>
<br></div>
<br>
<hr>
<div id="label2.1.6.10_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.6.10')">Version 2.1.6</a> (build 10): Created on November 28, 2008
</div>
<div id="label2.1.6.10_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.6.10')">Version 2.1.6</a> (build 10): Created on November 28, 2008
<br><br><h3>New Features and Improvements</h3>
<a name="CR18361"><div class="synopsis" id="CR18361_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18361')">CR#18361</a> :</b> Uniform and full support of the CFile class accross all operating systems.
</div>
<div class="detail" id="CR18361_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18361')">CR#18361</a> :</b> Uniform and full support of the CFile class accross all operating systems.
<h4>Description</h4>
<p class="cr">
The CFile class has never been truly properly supported on all platforms with a unified behaviour. This class needs to be properly updated to have equivalent support on all platforms and to have the same behaviour on all platforms.
</p>
<p class="cr">
It is impossible for some methods (such as ChangeMode) to have a unified behaviour as all operating systems do not give the same level of control over the files. This is also true for the CFile::Stat method.
</p>
<h4>Solution</h4>
<p class="cr">
Reworked the CFile class to be fully usable and have an identical behaviour (where possible) on all operating systems. CFile is now a full class instead of only a header file.
</p>
<p class="cr">
Created a new class to handle file management methods (Rename, Remove, ChangeMode and CreateNewDir) that previously were in CFile. These methods are now deprecated from the CFile interface.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The following methods using CBlobs have been added to CFile:
</p>
<ul>
<li class="cr">Read(CBlob, unsigned int): Reads unsigned int bytes into a CBlob;</li>
<li class="cr">Read(CBlob): Reads complete file to a CBlob;</li>
<li class="cr">Write(CBlob, unsigned int): Writes unsigned int bytes from the CBlob;</li>
<li class="cr">Write(CBlob): Writes the complete CBlob to the file.</li>
</ul>
<p class="cr">
The following methods of CFile have been deprecated and should be replaced by the corresponding method in CFileTools:
</p>
<ul>
<li class="cr">CFile::MxRemove is replaced by CFileTools::Remove</li>
<li class="cr">CFile::MxRename is replaced by CFileTools::Rename</li>
<li class="cr">CFile::MxChmod is replaced by CFileTools::ChangeMode</li>
</ul>
<p class="cr">
CFileTools also have a method to create a directory: CreateNewDir.
</p>
<p class="cr">
The following CFile methods now return a mxt_result instead of a boolean value.
<ul>
<li class="cr">Open</li>
<li class="cr">Close</li>
<li class="cr">Stat</li>
<li class="cr">Truncate</li>
</ul>
</p>

</div>
<br><a name="CR22020"><div class="synopsis" id="CR22020_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22020')">CR#22020</a> :</b> Add optional parameter to CSocketAddr::SetAddress to force strict parsing.
</div>
<div class="detail" id="CR22020_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22020')">CR#22020</a> :</b> Add optional parameter to CSocketAddr::SetAddress to force strict parsing.
<h4>Description</h4>
<p class="cr">
Add optional parameter to CSocketAddr::CSocketAddr constructor and CSocketAddr::SetAddress method to force strict parsing. Only the version with a char* parameter of the constructor and the method are concerned about this CR and fix.
</p>
<h4>Solution</h4>
<p class="cr">
In the CSocketAddr constructor and SetAddress, added a new optional parameter named bForceFourParts. The default value of this parameter is false. When this parameter is true, the parsing fails if the address is incomplete. When it is false, the normal behavior is expected.
This new parameter is forwarded down to the AtoN method. A validation has been added to the AtoN method to verify if the address is composed of four parts when bForceFourParts is enabled.
</p>
</div>
<br><a name="CR22280"><div class="synopsis" id="CR22280_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22280')">CR#22280</a> :</b> Add trace levels control at node level.
</div>
<div class="detail" id="CR22280_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22280')">CR#22280</a> :</b> Add trace levels control at node level.
<h4>Description</h4>
<p class="cr">
The tracing mechanism must provide finer control over tracing levels. The actual global tracing level affects all nodes in the system. There must be a way to assign different tracing levels to each and every specific node.
</p>
<h4>Solution</h4>
<p class="cr">
The global variable g_eMxTraceLevelsEnabled, which used to define the active trace levels at global scope, has been replaced by a trace level variable within each node.
</p>
<p class="cr">
The following functions have been added to the tracing mechanism to control the nodes specific trace level.
</p>
<ul>
<li class="cr">MxTraceEnableNodeLevel()</li>
<li class="cr">MxTraceDisableNodeLevel()</li>
<li class="cr">MxTraceEnableNodeMaxLevel()</li>
<li class="cr">MxTraceGetNodeLevelsEnabled()</li>
</ul>
<p class="cr">
The following functions, which allow controlling trace activation at global scope, have been modified to simply rely on the added methods leaving their existing behaviour unchanged.
</p>
<ul>
<li class="cr">MxTraceEnableLevel()</li>
<li class="cr">MxTraceDisableLevel()</li>
<li class="cr">MxTraceEnableMaxLevel()</li>
<li class="cr">MxTraceGetLevelsEnabled()</li>
</ul>

<p class="cr">
NOTE: Mixing calls to the system wide API and the node level API is discouraged because changes made on a specific node may be invalidated by a subsequent system wide change. This also explains why set of method system wide method is considered deprecated in favour of the new API.
</p>

<h4 class="red">Behaviour Change</h4>
<p class="cr">
The behaviour of the already existing method MxTraceEnableMaxLevel has been slightly changed. The previous behaviour was the equivalent of an assignment and had the effect of loosing any previous levels set. The new behaviour is as it should have been equivalent to a logical OR and leaves levels already enabled in their original state.
</p>

</div>
<br><a name="CR22411"><div class="synopsis" id="CR22411_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22411')">CR#22411</a> :</b> Add CString::ToUpperCase() function.
</div>
<div class="detail" id="CR22411_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22411')">CR#22411</a> :</b> Add CString::ToUpperCase() function.
<h4>Description</h4>
<p class="cr">
A new method ToUpperCase must be added to CString class.
</p>
<h4>Solution</h4>
<p class="cr">
   Added a ToUpperCase method to the CString class.
</p>
</div>
<br><a name="CR22522"><div class="synopsis" id="CR22522_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22522')">CR#22522</a> :</b> Improve performance of M5T crypto implementation.
</div>
<div class="detail" id="CR22522_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22522')">CR#22522</a> :</b> Improve performance of M5T crypto implementation.
<h4>Description</h4>
<p class="cr">
The performance of the following M5T hash functions must be improved: Md5, Sha1, Sha2, Md5Mac, Sha1Mac and Sha2Mac. The optimisation may be done at two different levels: the algorithm itself and the possibility to not re-hash the key at each call of Begin() for Mac algoritms. This later will be useful when many packets require to be hashed with the same key as it is done in SRTP for example.
</p>
<p class="cr">
The M5T AES implementation of the Begin() method must also be optimised. When a default key is used and the Begin() method is called with a NULL key, the key must be set only once in the AES algoritm instead of being set each time.
</p>
<p class="cr">
A particular attention must be payed to the TI DSP 64X target. Specific optimisation for this target must be performed when possible.
</p>
<p class="cr">
The usage of Sha1, Sha1Mac, Sha2, Sha2Mac, Md5 and Md5Mac API required that some uint8_t pointers argument to be aligned on a 32 bits boundary otherwise they could fail on some platforms.
</p>
<h4>Solution</h4>
<p class="cr">
The Sha1 algoritm has been optimised mostly by handling 32 bits data instead of 8 bits data. The MX_SHA1_REVERSE_BYTES macro has been added to improve performance for the TI DSP 64X target.
</p>

<p class="cr">
Md5, Sha1, Sha2, Md5Mac, Sha1Mac and Sha2Mac M5T implementation have been added with a SetState() method to allow setting the internal state of a hash object from another one. As a result, it is now possible to pre-initalize a hash-mac object with a key and then use it to re-initialize the state of another hash-mac object. This way, the key is not re-hashed and a lot of CPU cycles are saved.
</p>

<p class="cr">
The HMacReset()  and HMacResult() methods signature have been modified to provide to the user both innerhash and outerhash objects that will be used to pre-initialized a hash-mac object.
</p>

<p class="cr">
The M5T AES implementation SetDefaultKey() and Begin() have been modified to detect when a default key is set and to set the AES key only when a this new default key is set.
</p>

<p class="cr">
CSha1MitosFw, CSha1MacMitosFw, CSha2MitosFw, CSha2MacMitosFw, CMd5MitosFw, CMd5MacMitosFw,  CHMacMitosFw and CSecurePrngMitosFw have been modified to handle external API uint8_t* argument when they are not aligned on a 32 bits boundary.
</p>

<p class="cr">
mxt_UNALIGNED_INT16, mxt_UNALIGNED_UINT16, mxt_UNALIGNED_INT32 and mxt_UNALIGNED_UINT32 support has been added for code the composer platform to ease unaligned buffer handling.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
CHash and CHmac have been added with a SetState() method. Note that all M5T implementations of hash and hash-mac algoritm require to implement the SetState() method since this is a pure virtual method.
</p>

<p class="cr">
HMacReset()  and HMacResult() methods signature have been modified to provide to the user both innerhash and outerhash objects that will be used to pre-initialized a hash-mac object.
</p>

</div>
<br><a name="CR22865"><div class="synopsis" id="CR22865_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22865')">CR#22865</a> :</b> Add support to access the internal CSubAllocator counters and accumulators.
</div>
<div class="detail" id="CR22865_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22865')">CR#22865</a> :</b> Add support to access the internal CSubAllocator counters and accumulators.
<h4>Description</h4>
<p class="cr">
Add allocation and release counters to the SubAllocator class.
</p>
<p class="cr">
Add new methods: GetTotalAllocatedBytes, GetTotalAvailableBytes, GetTotalNumAllocations, GetTotalNumReleases and Renew to SubAllocator.
</p>
<h4>Solution</h4>
<p class="cr">
 Added the public methods GetTotalAllocatedBytes, GetTotalAvailableBytes, GetTotalNumAllocations, GetTotalNumReleases and Renew to the SubAllocator class.
</p>
</div>
<br><a name="CR22957"><div class="synopsis" id="CR22957_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22957')">CR#22957</a> :</b> Rework IXmlDocument and CXmlElement.
</div>
<div class="detail" id="CR22957_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22957')">CR#22957</a> :</b> Rework IXmlDocument and CXmlElement.
<h4>Description</h4>
<p class="cr">
    The following changes must be done to XML support:
</p>

<ul>
<li class="cr">Add an opaque identifier.</li>
<li class="cr">Add the ability to receive information when an element or document is modified.</li>
<li class="cr">Add support for a dictionary containing element names, namespace URIs and attribute names.</li>
<li class="cr">Move namespace declaration and support to the xml element.</li>
<li class="cr">Permit to insert CXmlElement instances anywhere in an XML document.</li>
</ul>
<p class="cr">
Here are the required changes to CXmlElement:
</p>
<ul>
<li class="cr"> Add namespace declaration behavior.</li>
<li class="cr"> Add the possibility to declare namespace on parent, root, current or new element.</li>
<li class="cr"> Add the possibility to handle an element declared namespace.</li>
<li class="cr"> Add a Copy method and creation by copy.</li>
<li class="cr"> Add an opaque identifier.</li>
<li class="cr"> Attributes must not be added when using default namespace as they are not qualified by the default namespace.</li>
</ul>

<h4>Solution</h4>
<p class="cr">
    Reworked CXmlElement to contain declared namespaces and the namespace with which it is associated.
</p>

<p class="cr">
Added the new parameter ENsDeclarationPosition ePosition to CXmlElement::CreateElement, CXmlElement::CreateChildElement and CXmlElement::SetChildElement. This new parameter is used to specify where the namepace should be declared.
</p>

<p class="cr">
Added three new methods to CXmlElement to let the application handle an element declared namespace directly. The methods are the following:
</p>
<ul>
<li class="cr"> GetDeclaredNamespaces </li>
<li class="cr"> UpdateDeclaredNamespace </li>
<li class="cr"> DeleteDeclaredNamespace </li>
</ul>
<p class="cr">
</p>

<p class="cr">
Added the new parameter ENsDeclarationPosition ePosition to CXmlElement::CreateElement, CXmlElement::CreateChildElement and CXmlElement::SetChildElement. This new parameter is used to specify where the namepace should be declared.
</p>

<p class="cr">
Added a new CXmlElement::Copy method. This method copies an element into another element.
</p>

<p class="cr">
Added a version of CreateChildElement. That creates a new element by copying another element.
</p>

<p class="cr">
Added GetOpaque and SetOpaque to CXmlElement.
</p>

<p class="cr">
Attributes can no longer be declared using the default namespace when using CXmlElement.
</p>

<p class="cr">
Added events notification on patch manager and document manager throughout CXmlElment and CXmlDocument.
</p>

<p class="cr">
    Reworked CXmlElement to minimize its memory use.
</p>

<p class="cr">
    Added support for a dictionary in the name of a CXmlElement, the URI of a namespace and the name of an attribute. The dictionary permits to reuse a string instead of having to copy a string multiple times in each component using the same string. The dictionary can be set on the IXmlDocument.
</p>

<p class="cr">
    Added methods to insert CXmlElement instances anywhere in an XML document.
</p>


<h4 class="red">Interface Change</h4>
<p class="cr">
    IXmlDocument interface:
</p>

<ul>
<li class="cr">Added SetDictionary.</li>
<li class="cr">Added GetDictionary.</li>
<li class="cr">Added SetPatchManager.</li>
<li class="cr">Added GetPatchManager.</li>
<li class="cr">Added SetDocumentManager.</li>
<li class="cr">Added GetDocumentManager.</li>
<li class="cr">Added SetOpaque.</li>
<li class="cr">Added GetOpaque.</li>
<li class="cr">Added the "const char* pszNamespacePrefix" parameter to CreateRootElement.</li>
<li class="cr">Moved SNamespace structure definition to CXmlElement.</li>
<li class="cr">Removed DefineNamespace.</li>
</ul>

<p class="cr">
Added Xml/IXmlPatchMgr and Xml/IXmlDocumentMgr to package. These interfaces are managers of an IXmlDocument.
</p>

<p class="cr">
Added CXmlElement::ENsDeclarationBehavior, there are four possible behaviors when declaring namespaces.
<p class="cr">

<p class="cr">
Added CXmlElement::ENsDeclarationPosition, this enumeration describes where a namespace must be created. There are five possibilities: the newly created element, the parent element, the root element, this element and as copied element.
<p class="cr">

<p class="cr">
    CXmlElement class:
</p>

<ul>
<li class="cr">Added GetNamespaceByUri that gets a namespace from its URI if it is accessible from the element.</li>
<li class="cr">Added GetNamespaceByPrefix that gets a namespace from its prefix if it is accessible from the element.</li>
<li class="cr">Added DeclareNamespace that declares a namespace in an element.</li>
<li class="cr">Added GetNamespacePrefix const that returns the prefix of the element's namespace.</li>
<li class="cr">Added SetAttribute that updates an attribute if absent or creates it.</li>
<li class="cr">Added CreateElement that creates an element at a specific location.</li>
<li class="cr">Added SetChildElement that updates and element or creates it if it is absent.</li>
<li class="cr">Modified CreateChildElement so it creates and inserts an element at a defined place.</li>
<li class="cr">AppendAttribute now returns a mxt_result.</li>
<li class="cr">Added SNamespace structure definition.</li>
<li class="cr">Added SIdentificationInfo structure definition.</li>
</ul>

<h4 class="red">Documentation Update</h4>
<p class="cr">
    Updated the documentation for the changed interfaces.
</p>

</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR17252"><div class="synopsis" id="CR17252_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17252')">CR#17252</a> :</b> MX_HI32 does not compile when the custom type for the 64bits values is used.
</div>
<div class="detail" id="CR17252_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17252')">CR#17252</a> :</b> MX_HI32 does not compile when the custom type for the 64bits values is used.
<h4>Description</h4>
<p class="cr">
The MX_HI32 macro does not compile when MXD_64BITS_CUSTOM_TYPE is defined.
</p>
<h4>Solution</h4>
<p class="cr">
Removed  the MX_DEFINEUINT64(0x00000000FFFFFFFF) mask from MX_HI32.
</p>
</div>
<br><a name="CR22317"><div class="synopsis" id="CR22317_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22317')">CR#22317</a> :</b> CFile::Read can indicate an error instead of an end of file on WinCE when errorno is already set.
</div>
<div class="detail" id="CR22317_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22317')">CR#22317</a> :</b> CFile::Read can indicate an error instead of an end of file on WinCE when errorno is already set.
<h4>Description</h4>
<p class="cr">
CFile::Read can indicate an error instead of an end of file on Windows CE when errorno has already been set to an error value by a preceding call.
</p>
<h4>Solution</h4>
<p class="cr">
Errorno is now set to a known value (zero) before performing the read.
</p>
</div>
<br><a name="CR22397"><div class="synopsis" id="CR22397_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22397')">CR#22397</a> :</b> crashing async socket factory
</div>
<div class="detail" id="CR22397_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22397')">CR#22397</a> :</b> crashing async socket factory
<h4>Description</h4>
<p class="cr">
    A crash can occur in CAsyncSocketFactory::CreateAsyncSocket when passing a type array (apszType) containing a NULL item. The method should handle this.
</p>
<h4>Solution</h4>
<p class="cr">
    The method CAsyncSocketFactory::CreateAsyncSocket returns resFE_INVALID_ARGUMENT if one of the items in the type array (apszType) is NULL.
</p>
</div>
<br><a name="CR22489"><div class="synopsis" id="CR22489_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22489')">CR#22489 (Incident 3047)</a> :</b> Optimize CSecureSeedMitosFw::GenerateSeed().
</div>
<div class="detail" id="CR22489_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22489')">CR#22489 (Incident 3047)</a> :</b> Optimize CSecureSeedMitosFw::GenerateSeed().
<h4>Description</h4>
<p class="cr">
  The CSecureSeedMitosFw::GenerateSeed is taken from OpenSSL. The new version of OpenSSL (0.9.8h) contains many optimisations to this code. It must be updated to include these optimisations since it was reported that execution of the method can take up to 15 seconds on Windows.
</p>
<h4>Solution</h4>
<p class="cr">
  Updated the CSecureSeedMitosFw class to include bug fixes and performance improvements made in OpenSSL 0.9.8h. Only the Windows and Linux implementation were updated since other OSes are not supported by OpenSSL.
</p>
</div>
<br><a name="CR22509"><div class="synopsis" id="CR22509_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22509')">CR#22509</a> :</b> GetAllLocalIpAddress returns addresses of 0.0.0.0 for unconnected network.
</div>
<div class="detail" id="CR22509_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22509')">CR#22509</a> :</b> GetAllLocalIpAddress returns addresses of 0.0.0.0 for unconnected network.
<h4>Description</h4>
<p class="cr">
  In windows, the vector returned by GetAllLocalIpAddresses contains addresses 0.0.0.0 for disconnected interfaces. This involves comparing the address with eINET_ANY by the user which is inconvenient.
</p>
<h4>Solution</h4>
<p class="cr">
  Prevent the GetAllLocalIpAddresses function to append eINET_ANY addresses in the output vector.
</p>
<p class="cr">
  The function GetAdaptersInfo (In the IP Helper Functions from Microsoft) returns 0.0.0.0 if the operational status of the interface is down (Although this is not documented on MSDN website, a lot of help forums mention this.)
</p>
</div>
<br><a name="CR22518"><div class="synopsis" id="CR22518_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22518')">CR#22518 (Incident 3042)</a> :</b> Ctimer::GetSystemUpTime returns inconsistent values under  Linux 2.6
</div>
<div class="detail" id="CR22518_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22518')">CR#22518 (Incident 3042)</a> :</b> Ctimer::GetSystemUpTime returns inconsistent values under  Linux 2.6
<h4>Description</h4>
<p class="cr">
The value returned by times() under Linux 2.6 is different from Linux 2.4. To uniformize the behaviour on both Linux versions, ms_uLastSysUpTimeTick should be initialized to the value returned by times.
</p>
<p class="cr">
To have a consistent value accross several processes, the value stored by the kernel in /proc/uptime  should be used as starting point if available.
</p>
<h4>Solution</h4>
<p class="cr">
ms_uLastSysUpTimeTick is now initialized from the value returned by Times() instead of 0.
</p>
<p class="cr">
ms_uSysUpTimeTick is now initialized with the value read from /proc/uptime when available.
</p>
</div>
<br><a name="CR22530"><div class="synopsis" id="CR22530_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22530')">CR#22530</a> :</b> Add a CFrameworkInitializer::IsInitialized() method.
</div>
<div class="detail" id="CR22530_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22530')">CR#22530</a> :</b> Add a CFrameworkInitializer::IsInitialized() method.
<h4>Description</h4>
<p class="cr">
A CFrameworkInitializer::IsInitialized() method is needed to support the new static initializer template.
</p>
<h4>Solution</h4>
<p class="cr">
Added the CFrameworkInitializer::IsInitialized() method. It returns true when the initialization count of the Framework is at least 1.
</p>
<p class="cr">
Added the g_stInitializer tracing node. This tracing node is to be used by all CXXInitializer() classes to  trace initialization methods.
</p>
</div>
<br><a name="CR22569"><div class="synopsis" id="CR22569_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22569')">CR#22569</a> :</b> CPortableResolver::Send must not set a different query ID for the same query.
</div>
<div class="detail" id="CR22569_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22569')">CR#22569</a> :</b> CPortableResolver::Send must not set a different query ID for the same query.
<h4>Description</h4>
<p class="cr">
CPortableResolver::Send generates a new transaction ID for every query. If the query is not successfully sent, CPortableResolver::EvAsyncIoSocketMgrReadyToSend is called. This calls Send again to resend the query but it generates a new transaction ID even if the query is the same. This causes a problem especially for Symbian since each Send must be done twice in order to function properly.  The transaction ID must be generated only once per query.
</p>
<h4>Solution</h4>
<p class="cr">
The transaction ID in CPortableResolver::Send is generated only once per query.
</p>
</div>
<br><a name="CR22573"><div class="synopsis" id="CR22573_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22573')">CR#22573 (Incident 3061)</a> :</b> There must be a trace for all errors of CServicingThread::PostMessage.
</div>
<div class="detail" id="CR22573_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22573')">CR#22573 (Incident 3061)</a> :</b> There must be a trace for all errors of CServicingThread::PostMessage.
<h4>Description</h4>
<p class="cr">
    There is a missing error trace in CServicingThread when Signal() fails.
</p>
<h4>Solution</h4>
<p class="cr">
    Added the missing error trace.
</p>
</div>
<br><a name="CR22586"><div class="synopsis" id="CR22586_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22586')">CR#22586</a> :</b> Synchronous layer of asynchronous portable resolver never returns when no servers are set.
</div>
<div class="detail" id="CR22586_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22586')">CR#22586</a> :</b> Synchronous layer of asynchronous portable resolver never returns when no servers are set.
<h4>Description</h4>
<p class="cr">
Performing a synchronous GetHostByName through the old NetworkTools interface or the new CResolver class has a chance to never return if it is called while there are no name servers set in the portable resolver.
</p>
<h4>Solution</h4>
<p class="cr">
Added a return code validation in CAsyncResolver::Query for the QueryA. If it is resFE_INVALID_STATE, EvAsyncResolverUserResponseReceived is called with an emtpy list, meaning that the query failed. That event would never have been called otherwise.
</p>
</div>
<br><a name="CR22715"><div class="synopsis" id="CR22715_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22715')">CR#22715</a> :</b> Crash in CPortableResolver in server fallback.
</div>
<div class="detail" id="CR22715_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22715')">CR#22715</a> :</b> Crash in CPortableResolver in server fallback.
<h4>Description</h4>
<p class="cr">
These is a crash in the server fallback inside the CPortableResolver class.
When a call to SwitchNameServer() is made, a transaction is removed from the transaction vector. In certain conditions only seen under VxWorks, the number of transactions reaches 0 and the size is not updated. Trying to access the element that has been deleted causes an access violation.
</p>
<h4>Solution</h4>
<p class="cr">
The size of the vector is now properly updated when the transaction count is decremented. This makes it impossible for the buffer overflow situation to occur.
</p>
</div>
<br><a name="CR22798"><div class="synopsis" id="CR22798_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22798')">CR#22798</a> :</b> Static initializer circular dependency between CCrypto & CSecurePrng
</div>
<div class="detail" id="CR22798_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22798')">CR#22798</a> :</b> Static initializer circular dependency between CCrypto & CSecurePrng
<h4>Description</h4>
<p class="cr">
    CCrypto is initialized before CSecurePrng in the static initializers. However CCrypto uses CSecurePrng in its static initializer. The effect is that a seed could be invalid if the CSecurePrng needs a service from CCrypto that isn't initialized yet. Worse, the program might crash when CCrypto calls the not initialized yet CSecurePrng.
</p>
<h4>Solution</h4>
<p class="cr">
     Moved the generation and the randomization of the seed in the CFrameworkInitializer where it is called after both the CCrypto and CSecurePrng are initialized.
</p>
</div>
<br><a name="CR22856"><div class="synopsis" id="CR22856_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22856')">CR#22856 (Incident 3163)</a> :</b> CSntpClient can delete itself before GetTimeS called from another thread returns.
</div>
<div class="detail" id="CR22856_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22856')">CR#22856 (Incident 3163)</a> :</b> CSntpClient can delete itself before GetTimeS called from another thread returns.
<h4>Description</h4>
<p class="cr">
The CSntpClient class can be deleted before the GetTimeS method called from the CTimeUpdater::Behavior method returns. As the external time source in the CTimeUpdater (CSntpClient) is set externally from another thread, it is entirely possible that it gets deleted before the CTimeUpdater::Behavior has completed.
</p>
<h4>Solution</h4>
<p class="cr">
Added a call to m_semQueryServerExclusivity.Wait(); in CSntpClient::Terminate() to make sure any ongoing queries are completed before releasing the object.
</p>
</div>
<br><a name="CR22905"><div class="synopsis" id="CR22905_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22905')">CR#22905</a> :</b> CallConfigurationMgr must not be public and should be performed automatically by the CAsyncSocketFactory code.
</div>
<div class="detail" id="CR22905_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22905')">CR#22905</a> :</b> CallConfigurationMgr must not be public and should be performed automatically by the CAsyncSocketFactory code.
<h4>Description</h4>
<p class="cr">
    The CAsyncSocketFactory::CallConfigurationMgr function must not be public. It should rather be called automatically by CAsyncSocketFactory::CreateAsyncSocket().
</p>
<h4>Solution</h4>
<p class="cr">
    The CAsyncSocketFactory::CallConfigurationMgr function is now declared private. The function is called by CAsyncSocketFactory::CreateAsyncSocket when the creation of the socket succeeded. If the CallConfigurationMgr fails, the socket is released.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
    References to CallConfigurationMgr in the interface have been removed. Documentation of the CAsyncSocketFactory::CreateAsyncSocket function has been updated.
</p>

</div>
<br><a name="CR22918"><div class="synopsis" id="CR22918_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22918')">CR#22918</a> :</b> Incorrect use of sizeof(gs_pszUDP)-1 in CAsyncSocketFactory
</div>
<div class="detail" id="CR22918_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22918')">CR#22918</a> :</b> Incorrect use of sizeof(gs_pszUDP)-1 in CAsyncSocketFactory
<h4>Description</h4>
<p class="cr">
Operator sizeof is used on string constants declared as "const char* const" which returns the size of the pointer and not the size of the pointed string. In this case, it is pure luck that makes it work since the pointed strings are 3 characters long. This must be fixed by either using "strlen" or a more efficient way or modifying the constants to be declared has "const char []".
</p>
<h4>Solution</h4>
<p class="cr">
The "const char []" declaration has been used to keep a high efficiency. Thus, all asynchronous socket factory related constants have been redeclared as "const char []" and the sizeof operator has been kept. Constants have also been renamed from "gs_psz" to "gs_sz".
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Asynchronous socket factory related constants have been renamed:
<ul>
<li class="cr">gs_pszUDP -&gt; gs_szUDP</li>
<li class="cr">gs_pszTCP -&gt; gs_szTCP</li>
<li class="cr">gs_pszOPTION_CLIENT -&gt; gs_szOPTION_CLIENT</li>
<li class="cr">gs_pszOPTION_ACCEPTED -&gt; gs_szOPTION_ACCEPTED</li>
<li class="cr">gs_pszOPTION_SERVER -&gt; gs_szOPTION_SERVER</li>
<li class="cr">gs_pszTLS -&gt; gs_szTLS</li>
</ul>
</p>

</div>
<br><a name="CR22982"><div class="synopsis" id="CR22982_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22982')">CR#22982</a> :</b> CAsyncTcpServerSocket::AcceptA() notifies it's manager of a successful connection even when the connection attempt fails.
</div>
<div class="detail" id="CR22982_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22982')">CR#22982</a> :</b> CAsyncTcpServerSocket::AcceptA() notifies it's manager of a successful connection even when the connection attempt fails.
<h4>Description</h4>
<p class="cr">
When a call to AcceptA() on a CAsyncTcpServerSocket is made, it triggers a call to the accept() OS method. Should that low-level call fail, the CAsyncTcpServerSocket calls the EvAsyncServerSocketMgrConnectionAccepted() callback, before calling EvAsyncServerSocketMgrConnectionFailed(). This is wrong, as only EvAsyncServerSocketMgrConnectionFailed() should be called in case of an error.
</p>
<h4>Solution</h4>
<p class="cr">
The error management code in CAsyncTcpServerSocket::InternalAcceptA() has been modified to correctly manage the case where accept() fails.
</p>
<p class="cr">
The code inside the CAsyncTcpServerSocket::InternalAcceptA() has been optimised to avoid creating a CTcpSocket when an error occurs and to increase code reuse across all supported platforms.
</p>
<p class="cr">
An error trace is now systematically done in SocketErrors::GetSocketErrorId(). This trace is done on a new trace node to avoid spamming the trace log when not investigating a network error.
</p>
<p class="cr">
Changed the tracing level from debug extra to debug in CAsyncTlsSocket to ease debugging.
</p>
</div>
<br><a name="CR23011"><div class="synopsis" id="CR23011_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23011')">CR#23011 (Incident 3238)</a> :</b> Compilation problem in traces configuration.
</div>
<div class="detail" id="CR23011_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23011')">CR#23011 (Incident 3238)</a> :</b> Compilation problem in traces configuration.
<h4>Description</h4>
<p class="cr">
If MXD_TRACE_USE_MEMORY_QUEUE_BUFFER is defined but MXD_TRACE_ENABLE_SUPPORT is not, the Framework will not compile.
</p>
<h4>Solution</h4>
<p class="cr">
All the code protected by MXD_TRACE_USE_MEMORY_QUEUE_BUFFER is also protected by MXD_TRACE_ENABLE_SUPPORT to correct the compilation errors.
</p>
</div>
<br><a name="CR23034"><div class="synopsis" id="CR23034_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23034')">CR#23034 (Incident 3153)</a> :</b> Forked process makes sockets staying in CLOSE_WAIT.
</div>
<div class="detail" id="CR23034_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23034')">CR#23034 (Incident 3153)</a> :</b> Forked process makes sockets staying in CLOSE_WAIT.
<h4>Description</h4>
<p class="cr">
On some operating systems like Linux and Solaris, socket handles are duplicated in child processes. This has the effect that all the processes need to call close on the socket in order to actually close the socket.
</p>
<h4>Solution</h4>
<p class="cr">
In the Create method of CTcpSocket, CUdpSocket and CTcpServerSocket, sets the FD_CLOEXEC option on the socket handle. This will force the socket to close even if some child processes have forked from the current process. This applies only to Linux and Solaris.
</p>
<p class="cr">
Note that this also prevents child process to have access to open sockets of the parent process.
</p>
</div>
<br><a name="CR23053"><div class="synopsis" id="CR23053_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23053')">CR#23053</a> :</b> InitializeCAsyncResolver might freeze if called 2 times.
</div>
<div class="detail" id="CR23053_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23053')">CR#23053</a> :</b> InitializeCAsyncResolver might freeze if called 2 times.
<h4>Description</h4>
<p class="cr">
    On VxWorks 5.4, InitializeCAsyncResolver might freeze if it is called twice. Since the application isn't released completely in VxWorks 5.4, the static variables aren't reset either. The singleton object CAsyncResolver was released but its pointer was not set to NULL. At the next execution of the application, when it should have instantiated a new CAsyncResolver, the singleton pointer (ms_pInstance) wasn't NULL, which caused the problem met.
</p>
<h4>Solution</h4>
<p class="cr">
    Set the ms_pInstance to NULL after its release.
</p>
</div>
<br><a name="CR23063"><div class="synopsis" id="CR23063_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23063')">CR#23063</a> :</b> StartThread does not allow to use the OS default stack size for Windows CE.
</div>
<div class="detail" id="CR23063_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23063')">CR#23063</a> :</b> StartThread does not allow to use the OS default stack size for Windows CE.
<h4>Description</h4>
<p class="cr">
It is not possible to use the default stack size of the operating system on Windows CE when creating a new thread because the STACK_SIZE_PARAM_IS_A_RESERVATION flag is always defined.
</p>
<h4>Solution</h4>
<p class="cr">
The STACK_SIZE_PARAM_IS_A_RESERVATION flag is now set on Windows CE only when the stack size determined by the uStackSize parameter given to CThread::StartThread and by the MXD_DEFAULT_THREAD_STACK_SIZE macro is different than zero.
</p>
</div>
<br><a name="CR23107"><div class="synopsis" id="CR23107_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23107')">CR#23107</a> :</b> DNS resolver question parsing error.
</div>
<div class="detail" id="CR23107_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23107')">CR#23107</a> :</b> DNS resolver question parsing error.
<h4>Description</h4>
<p class="cr">
When the DNS resolver parses a response and there are no records after the "Questions" field, a parsing error will occur (the method CResolverCore::ParseQuestion() will return NULL).
</p>
<p class="cr">
In CResolverCore::ParseQuestion(), the following if statement must be modified:
<pre class="cr">
 if (MX_RIS_S(ExpandName(pblobPacket, pstQuestion-&gt;m_strName)) &amp;&amp;
        pblobPacket-&gt;GetUnreadSize() &gt; (sizeof(uint16_t) + sizeof(uint16_t)))
</pre>
</p>
<p class="cr">
The "&gt;" must be changed with "&gt;=" to ensure that a DNS response packet that ends with a "Question" field (without any Records) parses successfully.
</p>

<h4>Solution</h4>
<p class="cr">
The "&gt;" was changed with "&gt;=" to ensure that a DNS response packet that ends with a "Question" field (without any Records) parses successfully.
</p>
</div>
<br><a name="CR23130"><div class="synopsis" id="CR23130_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23130')">CR#23130</a> :</b> Crash when calling method CString::Format() using a specific parameter. 
</div>
<div class="detail" id="CR23130_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23130')">CR#23130</a> :</b> Crash when calling method CString::Format() using a specific parameter. 
<h4>Description</h4>
<p class="cr">
It is possible to cause a crash while using the CString::Format() method to convert a char* argument to a string using %s. There are two CString::Format() declarations:
</p>
<ol>
<li class="cr">mxt_result Format(IN unsigned int uIndex, IN const char *pszFormat, va_list args)</li>
<li class="cr">mxt_result Format(IN unsigned int uIndex, IN const char *pszFormat, ...)</li>
</ol>
<p class="cr">
When calling the CString::Format() method without using a va_list as an argument, the second Format() method is called and a va_list is created with the passed arguments. va_list is type defined as a char* in the Windows SDK, so when the following code is called:
</p>
<pre class="cr">
CString strConvertedString;
strConvertedString.Format(0, "%s", "abcd");
</pre>
<p class="cr">
the first CString::Format() method is called instead of the second one, since a char* argument is given to the method when calling it using "abcd". In that case, the method behaves as if a va_list type has been passed but it is in fact a string. To work properly, the first CString::Format() method does need to have a valid va_list argument, initialized by a call to va_start, which is done in the second CString::Format() method. By bypassing this, unexpected behaviour can occur.
</p>
<p class="cr">
A fix should be made to call the first CString::Format() method only when there is actually a va_list as a parameter, not when a string is used.
</p>
<h4>Solution</h4>
<p class="cr">
To fix the problem, the first CString::Format() method has been renamed to CString::FormatV(), to specify that this method is used to take a va_list parameter. When CString::Format() is used, a variable arguments list is created and CString::FormatV() is called. CString::FormatV() should be used directly only when a va_list is already created.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
"CString::Format(IN unsigned int uIndex, IN const char *pszFormat, va_list args)" has been renamed to "CString::FormatV(IN unsigned int uIndex, IN const char *pszFormat, va_list args)" to discern the differences between the two methods. Previous calls to CString::Format() with a va_list argument MUST be changed to calls to CString::FormatV() to keep the same behaviour.
</p>

</div>
<br><a name="CR23141"><div class="synopsis" id="CR23141_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR23141')">CR#23141</a> :</b> XML element with a single value MUST be written on a single line.
</div>
<div class="detail" id="CR23141_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR23141')">CR#23141</a> :</b> XML element with a single value MUST be written on a single line.
<h4>Description</h4>
<p class="cr">
There are problems with XML schema enumerator that allows only the enumerated values to be present inside an element. This means that any whitespace characters (\r, \n, \t and spaces) must NOT be written.
</p>
<h4>Solution</h4>
<p class="cr">
Since there is no easy way to know if it is an enumerated value or not, all values are now written on the same line as the element start and end tags.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
The value of an XML element is now written on the same line as its start tag. The end tag is also written on the same line as the start tag is no child element is present.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
Changed the signature of PFNDataWriter to allow sending a result of the writing operation.
</p>
<p class="cr">
Updated StartDocument to always receive a pointer to a blob instead of allowing NULL and creating it itself. Allowing the method to create a blob had the side effect that the capacity on the blob was never reserved, and this had the effect of the blob doing a large number of allocations when data is serialized into it. We now force the caller to pass a blob in order to avoid this problem. Note that the caller must reserve the capacity on the blob before calling StartDocument.
</p>

</div>
<br><br><h3>Documentation Updates</h3>
<a name="CR22094"><div class="synopsis" id="CR22094_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22094')">CR#22094 (Incident 2929)</a> :</b> Add a programmer's guide section about the asynchronous socket factory.
</div>
<div class="detail" id="CR22094_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22094')">CR#22094 (Incident 2929)</a> :</b> Add a programmer's guide section about the asynchronous socket factory.
<h4>Description</h4>
<p class="cr">
The Programmer's Guide is lacking information on the Asynchronous socket factory.
</p>
<h4>Solution</h4>
<p class="cr">
Added section 7 to document the asynchronous socket factory's features.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
A new section presenting the Asynchronous Socket Factory's features has been added to the document.
</p>

</div>
<br><a name="CR22275"><div class="synopsis" id="CR22275_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22275')">CR#22275</a> :</b> Complete section on Asynchronous Socket Factory in the Programmer's guide.
</div>
<div class="detail" id="CR22275_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22275')">CR#22275</a> :</b> Complete section on Asynchronous Socket Factory in the Programmer's guide.
<h4>Description</h4>
<p class="cr">
Section 7 in the Framework's Programmer's Guide is incomplete. It should have the complete information related to the socket factory and any additional information regarding sockets to help users better understanding it.
</p>
<h4>Solution</h4>
<p class="cr">
Updated section 7 on Asynchronous Socket Factory.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The section presenting the Asynchronous Socket Factory's features has been updated.
</p>

</div>
<br><a name="CR22320"><div class="synopsis" id="CR22320_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22320')">CR#22320</a> :</b> API reference section "2.4.3.1 - Parameters qualifier" is documented as "Deprecated since 2.1.4".
</div>
<div class="detail" id="CR22320_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22320')">CR#22320</a> :</b> API reference section "2.4.3.1 - Parameters qualifier" is documented as "Deprecated since 2.1.4".
<h4>Description</h4>
<p class="cr">
     The section "2.4.3.1 - Parameters qualifier" (describing IN, OUT, INOUT, TO, TOA, etc.) is marked as "Deprecated since 2.1.4" in the M5T Framework SAFE v2.1 API Reference. This is probably caused by the deprecated flag of the macro TO added to fix CR 20638.
</p>
<h4>Solution</h4>
<p class="cr">
    A new group has been created (BASIC_DEPRECATED_MACROS) and added under the BASIC group in the ApiRefStructure.h. The parameters qualifier TO has been moved to that section.
</p>
<p class="cr">
    Reordered the deprecated APIs section of the introduction to fit page layout (now in the order of appearance).
</p>
<p class="cr">
    Added a "See also" section to link the "Parameters qualifier" to the "Deprecated parameters qualifier" for easier navigation through the document.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
    In the API Reference :
<ul>
<li class="cr">The introduction of deprecated APIs list has been updated.</li>
<li class="cr">The section 2.4.3.1 is no longer flagged as "Deprecated since 2.1.4.".</li>
<li class="cr">A new section 2.4.4 - Deprecated Macros has been added.</li>
<li class="cr">A new section 2.4.4.1 - Deprecated parameters qualifier has been added.</li>
<li class="cr">Both sections 2.4.3.1(Parameters qualifier) and 2.4.4.1(Deprecated parameters qualifier) have a new "See Also" section that links them together.</li>
</ul>
</p>

</div>
<br></div>
<br>
<hr>
<div id="label2.1.5.8_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.5.8')">Version 2.1.5</a> (build 8): Created on May 12, 2008
</div>
<div id="label2.1.5.8_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.5.8')">Version 2.1.5</a> (build 8): Created on May 12, 2008
<br><br><h3>New Features and Improvements</h3>
<a name="CR21036"><div class="synopsis" id="CR21036_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21036')">CR#21036</a> :</b> CRsaMocanaSs::PrivateKeyEncrypt and  CRsaMocanaSs::PublicKeyDecrypt are not implemented.
</div>
<div class="detail" id="CR21036_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21036')">CR#21036</a> :</b> CRsaMocanaSs::PrivateKeyEncrypt and  CRsaMocanaSs::PublicKeyDecrypt are not implemented.
<h4>Description</h4>
<p class="cr">
At this point, the functions CRsaMocanaSs::PrivateKeyEncrypt and CRsaMocanaSs::PublicKeyDecrypt are not implemented and should be eventually implemented to allow an implementation to encrypt with the private key and decrypt with the public key.
</p>
<h4>Solution</h4>
<p class="cr">
Implemented the CRsaMocanaSs::PrivateKeyEncrypt() and CRsaMocanaSs::PublicKeyDecrypt() methods using the Mocana API methods.
</p>
</div>
<br><a name="CR21014"><div class="synopsis" id="CR21014_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21014')">CR#21014</a> :</b> Add custom thread priority mechanism
</div>
<div class="detail" id="CR21014_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21014')">CR#21014</a> :</b> Add custom thread priority mechanism
<h4>Description</h4>
<p class="cr">
For some clients the number of thread priorities, defined with the CThread::EPriority enumerated typed, is not sufficient.
</p>

<p class="cr">
We need to implement a simple mechanism that will allow the addition of custom thread priorities. This mechanism must have as little impact as possible on the actual code.
</p>
<h4>Solution</h4>
<p class="cr">
In CThread.h, the EPriority enumerated type is now equal to:
</p>

<pre class="cr">
    enum EPriority
    {
        eLOWEST,
        eLOW,
        eNORMAL,
        eHIGH,
        eHIGHEST,
        MXD_THREAD_PRIORITY_EXTENSION
        // Must be the last and must not be used.
        eTHREAD_PRIORITY_ENUM_SIZE
    };
</pre>

<p class="cr">
eTHREAD_PRIORITY_ENUM_SIZE is only used to indicate the number of scheduling priorities. eTHREAD_PRIORITY_ENUM_SIZE must never be used when calling the CThread::StartThread method (or any other method with a CThread::EPriority parameter).
</p>

<p class="cr">
By default, in FrameworkCfg.h, MXD_THREAD_PRIORITY_EXTENSION is defined to nothing. If MXD_THREAD_PRIORITY_EXTENSION is not redefined, it has no impact on the code. If needed, MXD_THREAD_PRIORITY_EXTENSION must be redefined in PreFrameworkCfg.h. When redefining MXD_THREAD_PRIORITY_EXTENSION, the following defines must also be redefined in PreFrameworkCfg.h:
</p>

<ul>
<li class="cr">MXD_astVXWORKS_THREAD_SCHEDULING_INFO</li>
<li class="cr">MXD_astPOSIX_THREAD_SCHEDULING_INFO</li>
<li class="cr">MXD_astWINDOWS_THREAD_SCHEDULING_INFO</li>
</ul>

<p class="cr">
For example, if MXD_THREAD_PRIORITY_EXTENSION is defined as ?#define MXD_THREAD_PRIORITY_EXTENSION eAVERAGE, eCRITICAL,?, the scheduling priorities are then:
</p>

<pre class="cr">
    enum EPriority
    {
        eLOWEST,
        eLOW,
        eNORMAL,
        eHIGH,
        eHIGHEST,
        eAVERAGE,
        eCRITICAL,
        eTHREAD_PRIORITY_ENUM_SIZE
    };
</pre>

<p class="cr">
Note the comma after each additional scheduling. Each additional scheduling priority must be followed by a comma.
</p>

<p class="cr">
In CThread.cpp, the size of the g_astThreadSchedulingInfo structure is now initialized with CThread:: eTHREAD_PRIORITY_ENUM_SIZE instead of CThread::eHIGHEST + 1.
</p>

<p class="cr">
The CThread::StartThread method now returns resFE_MITOSFW_KERNEL_THREAD_CREATION if the EPriority parameter is invalid (smaller than eLOWEST, equal to eTHREAD_PRIORITY_ENUM_SIZE or greater than eTHREAD_PRIORITY_ENUM_SIZE).
</p>

<p class="cr">
In FrameworkCfg.h, there is now a verification to make sure that if MXD_THREAD_PRIORITY_EXTENSION is defined, MXD_astVXWORKS_THREAD_SCHEDULING_INFO or MXD_astPOSIX_THREAD_SCHEDULING_INFO or MXD_astWINDOWS_THREAD_SCHEDULING_INFO is defined (depending on the actual operating system).
</p>

<p class="cr">
In m5tmake.cfg, for the MXD_TFW_CONFIG001 configuration, the KernelTests/CTestCThread.cpp file is now included in the compilation. All the other files within the KernelTests directory are still excluded.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
It is now possible to add custom thread priorities using the MXD_THREAD_PRIORITY_EXTENSION define. This define adds new values to the CThread::EPriority enumerated type.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
In FrameworkCfg.h, addition of the Doc-O-Matic documentation for the MXD_THREAD_PRIORITY_EXTENSION define.
</p>

</div>
<br><a name="CR21086"><div class="synopsis" id="CR21086_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21086')">CR#21086 (Incident 2643)</a> :</b> When SetSockOptTos fails under Windwos, verify that the registry is properly configured.
</div>
<div class="detail" id="CR21086_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21086')">CR#21086 (Incident 2643)</a> :</b> When SetSockOptTos fails under Windwos, verify that the registry is properly configured.
<h4>Description</h4>
<p class="cr">
Add code to detect that the registry is properly configured when SetSockOptTos() fails under Windows. This detection code should generate trace events and not modify the current behaviour of SetSockOptTos().
</p>
<h4>Solution</h4>
<p class="cr">
When setsockopt() fails we trace the following:
<ul>
<li class="cr">
We can open the registry key ?SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters? in read-mode.</li>
<li class="cr">
Read the value, type and length of the registry value DisableUserTOSSetting.
</li>
<li class="cr">
Ensure that DisableUserTOSSetting is of proper type and length.
</li>
</ul>
</p>
<p class="cr">
All errors are traced.
</p>
</div>
<br><a name="CR21440"><div class="synopsis" id="CR21440_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21440')">CR#21440</a> :</b> Add a define to enable/disable trace nodes by default during registration.
</div>
<div class="detail" id="CR21440_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21440')">CR#21440</a> :</b> Add a define to enable/disable trace nodes by default during registration.
<h4>Description</h4>
<p class="cr">
It should be possible to have traces disabled by default in MxTraceRegisterNode. Add a define to do that in MxConfig.h.
</p>
<h4>Solution</h4>
<p class="cr">
Added MXD_TRACE_NODES_ENABLED_AT_REGISTRATION in MxConfig.h.
</p>

<p class="cr">
In MxTraceRegisterNode pstNode-&gt;m_bEnabled is now set to MXD_TRACE_NODES_ENABLED_AT_REGISTRATION instead of true. Note that the default value of MXD_TRACE_NODES_ENABLED_AT_REGISTRATION is true.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The API reference document has been updated for MXD_TRACE_NODES_ENABLED_AT_REGISTRATION.
</p>

</div>
<br><a name="CR20902"><div class="synopsis" id="CR20902_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20902')">CR#20902</a> :</b> Add support for Vxworks 6.5.
</div>
<div class="detail" id="CR20902_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20902')">CR#20902</a> :</b> Add support for Vxworks 6.5.
<h4>Description</h4>
<p class="cr">
The VxWorks 6.5 operating system must be supported on the pentium platform.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">Added an error code, resFE_MITOSFW_NET_SOCK_CLOSED, for sockets closed by peers on VxWorks 6.5. The error code returned in that case is different and is now handled in SocketErrors.cpp.</li>
<li class="cr">Fixed compilation errors in MxDef, CSocketAddr and ResolverHelpers.</li>
<li class="cr">Added defines for VxWorks 6.0, 6.5 and 6.6 in MxConfig.h.</li>
<li class="cr">The SetNagle method from SocketOptions is not supported on VxWorks 6.5.</li>
<li class="cr">Implemented the NetworkTools::GetLocalIPAddr() method for the VxWorks 6.5 OS.</li>
<li class="cr">Modified the TracePrintStackFrame function from MxTraceKernel.cpp to use symByValueFind() instead of symFindByValue(), which is deprecated in Vxworks 6.5.</li>
</ul>
</div>
<br><a name="CR21585"><div class="synopsis" id="CR21585_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21585')">CR#21585 (Incident 2698)</a> :</b> Add a new method to CThread to return the native Linux thread ID.
</div>
<div class="detail" id="CR21585_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21585')">CR#21585 (Incident 2698)</a> :</b> Add a new method to CThread to return the native Linux thread ID.
<h4>Description</h4>
<p class="cr">
There is currently no way to retrieve the native Linux thread ID set when a thread is created in the Framework. It could be useful to get the ID of a thread to match it with its value returned using a 'ps' command under Linux.
</p>
<h4>Solution</h4>
<p class="cr">
A new GetNativeThreadId() method has been added to CThread that returns the native thread ID. This method has been added for the Linux platform only.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
GetNativeThreadId() method has been added to CThread to return the native thread ID. This method is only functional under Linux and under other platforms returns an error.
</p>

</div>
<br><a name="CR21593"><div class="synopsis" id="CR21593_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21593')">CR#21593</a> :</b> Implement asynchronous resolver
</div>
<div class="detail" id="CR21593_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21593')">CR#21593</a> :</b> Implement asynchronous resolver
<h4>Description</h4>
<p class="cr">
Currently in the Framework, DNS queries are synchronous. This means that each and every application blocks on every DNS query. Applications that cannot block are forced to implement a  mechanism that uses an additional thread to render queries asynchronous. This mechanism is often very basic, sequential and inefficient.
</p>
<p class="cr">
The application also needs to handle recursion itself when the nameserver does not support it. For example, the Windows nameserver service will not recursively query SRV records for NAPTR replacements specifying to do so. However, Bind 9 does. This pushes unwanted complexity into the application when it should instead reside in a centralized component like the Framework.
</p>
<h4>Solution</h4>
<p class="cr">
An object-oriented approach has been taken to provide DNS query asynchronism. While providing this feature, synchronous DNS queries are still available either by using the original global functions or by using the new CResolver class, which serves only as a synchronization wrapper (or decorator) around CAsyncResolver, the asynchronous resolver.
</p>
<p class="cr">
The asynchronous resolver provides the mechanisms for queueing queries and sending them using the configured use of the DNS API, if the response is not present in the cache. It also provides a mechanism to 'piggyback' transactions on other ones, in order not to send multiple queries for the same question. Moreover, the asynchronous resolver provides support for processing queries in parallel, instead of being limiting to processing queries serially.
</p>
<p class="cr">
The asynchronous resolver will also perform recursive queries in order to completely answer a question.
</p>
<p class="cr">
Finally, the portable resolver has been updated to use the asynchronous socket interface, instead of the current synchronous one.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Other than the asynchronous DNS resolver interface, the resolver performs DNS query recursion and uses the asynchronous socket interfaces.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
There are now interfaces for the synchronous, CResolver, and the asynchronous, CAsyncResolver, resolver. Original synchronous resolver global functions are still accessible, but marked as deprecated. Users are now invited to use the CResolver or CAsyncResolver classes.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
Interfaces for the (a)synchronous resolver are documented in the Resolver section of the API reference.
</p>

</div>
<br><a name="CR21607"><div class="synopsis" id="CR21607_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21607')">CR#21607</a> :</b> Add IPv6 support for Vxworks 6.5.
</div>
<div class="detail" id="CR21607_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21607')">CR#21607</a> :</b> Add IPv6 support for Vxworks 6.5.
<h4>Description</h4>
<p class="cr">
IPv6 needs to be supported on the VxWorks 6.5 operating system.
</p>
<h4>Solution</h4>
<p class="cr">
Implemented the GetLocalIPv6Addr() method from NetworkTools for the VxWorks 6.5 operating system.
</p>
<p class="cr">
Modified the way TCP connections are detected in CAsyncTcpSocket under Vxworks 6.5. The getsockopt() function is now used like on Linux.
</p>
<p class="cr">
The CSocket::SetBroadcast() method now does nothing when called on an IPv6 socket.
</p>
</div>
<br><a name="CR21612"><div class="synopsis" id="CR21612_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21612')">CR#21612 (Incident 2822)</a> :</b> Add native resolver support in VxWorks 6.5.
</div>
<div class="detail" id="CR21612_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21612')">CR#21612 (Incident 2822)</a> :</b> Add native resolver support in VxWorks 6.5.
<h4>Description</h4>
<p class="cr">
It is necessary for the Framework to build on VxWorks 6.5 when using the native resolver. That is, when MXD_PORTABLE_RESOLVER_ENABLE_SUPPORT is not defined.
</p>
<h4>Solution</h4>
<p class="cr">
Since the IP stack used in VxWorks 6.5 is changed from previous versions, it is not possible to re-use the same native resolver code. Moreover, there are no equivalents to the resolvDNExpand() and resolvQuery() functions. Therefore, it is not possible to implement a full featured native resolver under VxWorks 6.5.
</p>
<p class="cr">
Modified the GetHostByName(), GetHostByAddr(), GetNaptrRecord() and GetSrvRecord() methods so that they build under VxWorks 6.5 when MXD_PORTABLE_RESOLVER_ENABLE_SUPPORT is not defined. GetHostByName() and GetHostByAddr() map directly to the gethostbyname() and gethostbyaddr() system methods, while GetNaptrRecord() and GetSrvRecord() always return failures.
</p>
<p class="cr">
Modified ResolverHelpers and ResolverCache so that they build under VxWorks 6.5 when MXD_PORTABLE_RESOLVER_ENABLE_SUPPORT is not defined.
</p>
</div>
<br><a name="CR21697"><div class="synopsis" id="CR21697_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21697')">CR#21697</a> :</b> Create a sub-allocator for the cap classes.
</div>
<div class="detail" id="CR21697_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21697')">CR#21697</a> :</b> Create a sub-allocator for the cap classes.
<h4>Description</h4>
<p class="cr">
In the development of any protocol stack, the need for efficient memory allocation arises. The M5T protocol stacks are all built around the concept of a packet that holds other information. This architecture allows for the packet's internal data, allocated by contained classes, to be valid as long as the packet is alive. Thus, memory optimization is possible through the use of sub-allocation.
</p>
<h4>Solution</h4>
<p class="cr">
The concept of sub-allocation is quite simple: a large memory block is allocated and smaller memory blocks are returned from it. The CSubAllocator class added by this CR does just that. The goal being to allocate the memory only once. The use of the sub-allocator is advisable only in scenarios where the allocated memory will not change often. In scenarios where the allocated data changes a lot the CSubAllocator will behave poorly by consuming more and more memory. This is because it lacks the property of reusing sub-allocation spaces that are no longer used. This is by design to reduce memory management overhead to the bare minimum.
</p>
<p class="cr">
The MXD_CAP_SUBALLOCATOR_ENABLE_SUPPORT, MXD_CAP_SUBALLOCATOR_STATISTICS_ENABLE_SUPPORT and MXD_CAP_SUBALLOCATOR_DEFAULT_MEMORY_BLOCK_SIZE_IN_BYTES macros have been added to control the activation of the CSubAllocator class. When MXD_CAP_SUBALLOCATOR_ENABLE_SUPPORT is not defined, the class becomes a wrapper on MX_NEW_ARRAY/MX_DELETE_ARRAY.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Added the CSubAllocator class.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
Added the API Reference documentation for the CSubAllocator class and MXD_CAP_SUBALLOCATOR_ENABLE_SUPPORT, MXD_CAP_SUBALLOCATOR_STATISTICS_ENABLE_SUPPORT and MXD_CAP_SUBALLOCATOR_DEFAULT_MEMORY_BLOCK_SIZE_IN_BYTES macros.
</p>

</div>
<br><a name="CR21785"><div class="synopsis" id="CR21785_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21785')">CR#21785</a> :</b> Reimplement XML Parser files to allow a broader implementation and make it easier to use.
</div>
<div class="detail" id="CR21785_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21785')">CR#21785</a> :</b> Reimplement XML Parser files to allow a broader implementation and make it easier to use.
<h4>Description</h4>
<p class="cr">
XML is used by many components to create or parse the message exchanged. However, the current XML implementation is somewhat limited and is not easy to use. Thus, the files in the XML folder need to be reimplemented to account for the new requirements.
</p>
<h4>Solution</h4>
<p class="cr">
Reimplemented the XML parser files. The new implementation defines an abstraction layer that can be reimplemented depending on which XML parser is used, thus not forcing partners to use Expat.
</p>
<p class="cr">
The new implementation is compiled using the define MXD_XML_ENABLE_SUPPORT, while the old files are compiled if MXD_XML_DEPRECATED_ENABLE_SUPPORT is defined. Both implementations can be enabled at the same time without problems.
</p>
</div>
<br><a name="CR21802"><div class="synopsis" id="CR21802_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21802')">CR#21802</a> :</b> CFile must allow to delete a file with WinCE.
</div>
<div class="detail" id="CR21802_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21802')">CR#21802</a> :</b> CFile must allow to delete a file with WinCE.
<h4>Description</h4>
<p class="cr">
Deleting files is currently not possible with WinCE, this must be supported.
</p>
<h4>Solution</h4>
<p class="cr">
The MxRemove function has been implemented for WinCE.
</p>
</div>
<br><a name="CR21833"><div class="synopsis" id="CR21833_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21833')">CR#21833</a> :</b> Reimplement the XML writer to allow a broader implemention and make it easier to use.
</div>
<div class="detail" id="CR21833_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21833')">CR#21833</a> :</b> Reimplement the XML writer to allow a broader implemention and make it easier to use.
<h4>Description</h4>
<p class="cr">
XML is used by many components to create or parse the message exchanged. However, the current XML implementation is somewhat limited and is not easy to use. Thus, the files in the XML folder need to be reimplemented to account for the new requirements.
</p>
<h4>Solution</h4>
<p class="cr">
Reimplemented the XML writer files. The new implementation is an ECOM object and defines easier to use APIs.
</p>
<p class="cr">
The new implementation is compiled using the define MXD_XML_ENABLE_SUPPORT, while the old files are compiled if MXD_XML_DEPRECATED_ENABLE_SUPPORT is defined. Both implementations can be enabled at the same time without problems.
</p>
</div>
<br><a name="CR21845"><div class="synopsis" id="CR21845_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21845')">CR#21845</a> :</b> CFile must allow to open binary files.
</div>
<div class="detail" id="CR21845_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21845')">CR#21845</a> :</b> CFile must allow to open binary files.
<h4>Description</h4>
<p class="cr">
CFile must allow to manipulate binary files.
</p>
<h4>Solution</h4>
<p class="cr">
The eBINARY and eTEXT attributes are now available when opening a file.
</p>
</div>
<br><a name="CR21884"><div class="synopsis" id="CR21884_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21884')">CR#21884</a> :</b> Implement IXmlDocument and CXmlElement for easier high level handling of XML document.
</div>
<div class="detail" id="CR21884_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21884')">CR#21884</a> :</b> Implement IXmlDocument and CXmlElement for easier high level handling of XML document.
<h4>Description</h4>
<p class="cr">
There needs to be an easier way to create and handle an XML document. While parsing and writing were made easier with the last implementation of the XML parser and writer, there still is nothing that embeds those in one single class making it easy to create and handle any XML document.
</p>
<h4>Solution</h4>
<p class="cr">
Implemented a new ECOM interface, IXmlDocument, that can handle a single document and uses another new CXmlElement to make it easy to create from scratch or edit an XML document.
</p>
<p class="cr">
The new files are compiled using the define MXD_XML_ENABLE_SUPPORT.
</p>
<p class="cr">
Fixed a problem with a special namespace not being added in the CXmlParserExpat files.
</p>
</div>
<br><a name="CR21980"><div class="synopsis" id="CR21980_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21980')">CR#21980</a> :</b> Add a macro in FW 2.1 to convert a 64 bits word to/from network/host byte order.
</div>
<div class="detail" id="CR21980_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21980')">CR#21980</a> :</b> Add a macro in FW 2.1 to convert a 64 bits word to/from network/host byte order.
<h4>Description</h4>
<p class="cr">
MxMacro.h must have a host to network and network to host conversion macro for 64 bits integers.
</p>
<h4>Solution</h4>
<p class="cr">
The MX_NTOH64 and MX_HTON64 marco are now available.
</p>
</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR17955"><div class="synopsis" id="CR17955_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17955')">CR#17955</a> :</b> A GetHostByName query for .1.1.1 using the portable resolver issues a malformed request.
</div>
<div class="detail" id="CR17955_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17955')">CR#17955</a> :</b> A GetHostByName query for .1.1.1 using the portable resolver issues a malformed request.
<h4>Description</h4>
<p class="cr">
When the portable resolver is enabled and GetHostByName is called for host .1.1.1, a malformed DNS packet is sent to the DNS server.
</p>
<p class="cr">
Since a FQDN cannot start with a '.', a query for such a host should fail immediately. Minimal parsing should be done before issuing a DNS query to the server. See RFC952 and RFC1123 section 2.1 on what constitutes a valid FQDN.
</p>
<h4>Solution</h4>
<p class="cr">
The ResolverDNCompress function called in ResolverMkQuery returns -1 instead of the header size when it is passed an invalid host name like .1.1.1.
</p>
<p class="cr">
CR16981 used to fix a crash caused by the header size of -1 by simply adding the uncompressed header to the query. This prevented the crash in that CR but caused a malformed DNS query to go out on the network and be replied by the DNS server that it is an invalid request. In this case, a -1 result code for the error is returned.
</p>
<p class="cr">
As stated in RFC952 and RFC1123 section 2.1, a valid FQDN must start with a letter or number. It can also contain minus (-) and period (.) but it cannot start with them. All the parsing tests are done in the ResolverDNCompress method for the portable resolver. This method returns -1 if it cannot compress the invalid host. ResolverDNCompress is not at fault and is correct to return an error because a host name must start with a letter or a number and cannot start with a period.
</p>
</div>
<br><a name="CR20638"><div class="synopsis" id="CR20638_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20638')">CR#20638</a> :</b> Add TOS and TOA macros and deprecate TO.
</div>
<div class="detail" id="CR20638_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20638')">CR#20638</a> :</b> Add TOS and TOA macros and deprecate TO.
<h4>Description</h4>
<p class="cr">
All TO macros must be replaced by TOS (take ownership on success) or TOA (take onwership always) depending of the situation.
</p>
<p class="cr">
TO Macro must be deprecated.
</p>
<h4>Solution</h4>
<ul>
<li class="cr"> Modified MxDef.h to deprecate TO and to add TOS and TOA.</li>
<li class="cr"> Replaced all TO by the appropriate macro.
</ul>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The TO Macro is now deprecated. TOA (Take Ownership Always) and TOS (Take Ownership Success) are now used instead.
</p>

</div>
<br><a name="CR20833"><div class="synopsis" id="CR20833_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20833')">CR#20833</a> :</b> Duplicated traces when using CUdpTracing.
</div>
<div class="detail" id="CR20833_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20833')">CR#20833</a> :</b> Duplicated traces when using CUdpTracing.
<h4>Description</h4>
<p class="cr">
When activating CUdpTracing with the code below, all the traces will be outputted twice on the network.
</p>

<pre class="cr">
    // Make sure we have a node registered and enabled.
    STraceNode stTestUdpTracing;
    MxTraceRegisterNode(g_stTraceRoot, stTestUdpTracing, "TestUdpTracing");

    CFqdn fqdn("IP", 6002);
    CUdpTracing::Initialize(&amp;fqdn);
    MX_TRACE2(0, stTestUdpTracing, "Hello");
    MxTraceRemoveOutputHandler(MxTraceToStdout);
    MX_TRACE2(0, stTestUdpTracing, "Hello - 2");
    CUdpTracing::Finalize();
    MxTraceUnregisterNode(g_stTraceRoot, stTestUdpTracing);
</pre>

<p class="cr">
If  MxTraceRemoveOutputHandler(MxTraceToStdout); is called before CUdpTracing::Initialize(&amp;fqdn); it is OK.
</p>

<p class="cr">
The bug is in MxTraceRemoveOutputHandler. The method does not handle the case were there is an output handler at the last available position in the array and the remove is made at the beginning. The array is compressed correctly but the last element is not replaced by a NULL which creates a duplicate entry. e.g. Capacity of the array is two elements in the array then we remove the first will produce:
</p>

<pre class="cr">
 A B
 B B
</pre>

<p class="cr">
while it should produce
</p>

<pre class="cr">
 B NULL
</pre>
<h4>Solution</h4>
<p class="cr">
Modified the MxTraceRemoveOutputHandler function in MxTrace.cpp. When the last output handler is moved one position toward the beginning of the array during compression, the actual position of the last output handler is correctly set to NULL.
</p>
</div>
<br><a name="CR21050"><div class="synopsis" id="CR21050_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21050')">CR#21050</a> :</b> In certain circumstances, the DNS cache trashes valid responses that were not valid for caching.
</div>
<div class="detail" id="CR21050_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21050')">CR#21050</a> :</b> In certain circumstances, the DNS cache trashes valid responses that were not valid for caching.
<h4>Description</h4>
<p class="cr">
When the portable resolver and the DNS cache are enabled, there is a possibility that a valid response is not reported when it is not valid for caching.
</p>
<p class="cr">
This problem has been observed in very specific circumstances when MXD_PORTABLE_RESOLVER_ENABLE_SUPPORT and MXD_RESOLVER_CACHE_ENABLE_SUPPORT are both defined and MXD_RESOLVER_CACHE_POSITIVE_MAX_TTL_BEFORE_REJECTION_S is left to its default value of 1 day.
</p>
<p class="cr">
The problem has been observed under thefollowing circumstances: the DNS resolution of the "example.com" domain is performed and returns a valid response with a TTL superior to 86400 seconds (1 day).
</p>
<p class="cr">
The IsAnswerValidForCaching function will return false since the TTL is too long to be cached according to the configuration. It will set the TTL variable provided as an OUT parameter to a non-zero value. When the IsAnswerValidForCaching function returns false, a check is performed on the TTL value and if it is non-zero, the answer length returned by ResolverCachedQuery will be 0. This effectively removes the valid response that was not cached.
</p>
<p class="cr">
The problem is that the response was valid and could have been used even if it was not cached. The response rejection should be only for the cache and not for the DNS response.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">MXD_RESOLVER_CACHE_POSITIVE_MAX_TTL_BEFORE_REJECTION_S and MXD_RESOLVER_CACHE_NEGATIVE_MAX_TTL_BEFORE_REJECTION_S macros have been removed.</li>
<li class="cr">IsAnswerValidForCaching has been modified to remove handling of TTL limits. From now, when an answer has a positive TTL higher than 1 hour, the TTL value will be capped to 1 hour and will be cached instead of being dropped.</li>
</ul>
<h4 class="red">Interface Change</h4>
<p class="cr">
MXD_RESOLVER_CACHE_POSITIVE_MAX_TTL_BEFORE_REJECTION_S and MXD_RESOLVER_CACHE_NEGATIVE_MAX_TTL_BEFORE_REJECTION_S macros have been removed.
</p>

</div>
<br><a name="CR21081"><div class="synopsis" id="CR21081_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21081')">CR#21081 (Incident 2661)</a> :</b> CPair does not compile with const args.
</div>
<div class="detail" id="CR21081_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21081')">CR#21081 (Incident 2661)</a> :</b> CPair does not compile with const args.
<h4>Description</h4>
<p class="cr">
"CPair&lt;const CString, const CString&gt; testPairStr1;" does not compile under Linux with the following error:
</p>

<pre class="cr">
../../Sources/Cap/CPair.h: In constructor `m5t::CPair&lt;_Type, _Type2&gt;::CPair()
   [with _Type = const int, _Type2 = const m5t::CString]':
../../TfwTestCases/CapTests/CTestCPair.cpp:327:   instantiated from here
../../Sources/Cap/CPair.h:232: invalid conversion from `const void*' to `void*'
../../Sources/Cap/CPair.h:232:   initializing argument 2 of `void* operator
   new(unsigned int, void*)'
../../Sources/Cap/CPair.h:232: uninitialized const in `new' of `const int'
../../TfwTestCases/CapTests/CTestCPair.cpp:327:   instantiated from here
../../Sources/Cap/CPair.h:233: invalid conversion from `const void*' to `void*'
../../Sources/Cap/CPair.h:233:   initializing argument 2 of `void* operator
   new(unsigned int, void*)'
</pre>

<p class="cr">
Investigation shows that the problem exists since CPair uses CAlignedVariableStorage for its members. Below, you will find a proposed fix and more information.
</p>

<pre class="cr">
template&lt;class _Type, class _Type2&gt;
inline
CPair&lt;_Type, _Type2&gt;::CPair()
{
    new ((void*)m_first.Instance()) _Type();
    new ((void*)m_second.Instance()) _Type2();
}
</pre>

<p class="cr">
The fix above does not compile on MSVC 6. The problem was also present before CPair was using CAlignedVariableStorage and was not detected because there was no test case with a const argument. The reported error by MSVC 6 is error C2468. The fix seems to fail only on MSVC 6 but needs to be validated.
</p>
<h4>Solution</h4>
<p class="cr">
In CPair.h, the implementation of various constructors was modified. The value returned by the new operator is now c-style typecast into a void*.
</p>

<p class="cr">
In the constructor of CPair.h, the parenthesis ?()? were added after ?_Type? and ?_Type2?. This allows calling the constructor for basic types.
</p>

<p class="cr">
With the msvc6 compiler, the operator new can't be called for const or volatile types (compiler error C2468). Thus, the CPair class can not be used with const classes under msvc6. This is a limitation of the msvc6 compiler, not of the CPair class.
</p>
</div>
<br><a name="CR21163"><div class="synopsis" id="CR21163_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21163')">CR#21163</a> :</b> Add support for changing EOL in XmlWriter.
</div>
<div class="detail" id="CR21163_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21163')">CR#21163</a> :</b> Add support for changing EOL in XmlWriter.
<h4>Description</h4>
<p class="cr">
The end of line character in buffers written by CXmlWriter is always LF. This character needs to be configurable to LF, CR, CRLF or none.
</p>
<h4>Solution</h4>
<p class="cr">
Added a parameter to one of CXmlWriter's constructors and to CXmlWriter::Initialize(). This parameters allows specifying either LF, CR, CRLF or none as end of line characters. The default value of this parameter is LF, so the default behavior is unchanged and no update to existing code is necessary.
</p>
</div>
<br><a name="CR21267"><div class="synopsis" id="CR21267_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21267')">CR#21267</a> :</b> Problem in CPollSocket if a signal (SIGINT, SIGCHLD, etc) is received.
</div>
<div class="detail" id="CR21267_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21267')">CR#21267</a> :</b> Problem in CPollSocket if a signal (SIGINT, SIGCHLD, etc) is received.
<h4>Description</h4>
<p class="cr">
When an application tries to use signals under Linux or Solaris (issued with the kill command), the call to select() in CPollSocket::Poll exits immediately.
</p>
<p class="cr">
The CPollSocket must correctly reset itself in this case and continue waiting as if nothing had occurred.
</p>
<h4>Solution</h4>
<p class="cr">
Added an additional do/while loop around the call to select for Linux and Solaris platforms in the CPollSocket:Poll method. This retries the call to select if select exited with -1 and with errno set to EINTR.
</p>
</div>
<br><a name="CR21280"><div class="synopsis" id="CR21280_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21280')">CR#21280</a> :</b> Connection lost on Symbian causes an assert.
</div>
<div class="detail" id="CR21280_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21280')">CR#21280</a> :</b> Connection lost on Symbian causes an assert.
<h4>Description</h4>
<p class="cr">
When a TCP socket detects a connection lost event, CloseA is called on the socket. InternalCloseA then calls SetSockOptLinger which can not be set on Symbian when the socket has been disconnected. Under such conditions, SetSockOptLinger returns an error which results in an assertion in InternalCloseA.
</p>
<h4>Solution</h4>
<p class="cr">
SetSockOptLinger now always returns resS_OK when the operating system is Symbian.
</p>
</div>
<br><a name="CR21000"><div class="synopsis" id="CR21000_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21000')">CR#21000 (Incident 2548)</a> :</b> Review and add return codes for TLS errors for Open SSL only.
</div>
<div class="detail" id="CR21000_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21000')">CR#21000 (Incident 2548)</a> :</b> Review and add return codes for TLS errors for Open SSL only.
<h4>Description</h4>
<p class="cr">
Review the current TLS errors and return codes. Add some errors and return codes for the different TLS alerts, for Open SSL only.
</p>
<h4>Solution</h4>
<p class="cr">
Added the following TLS error return codes:
</p>
<ul>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_CONNECTIONTIMEREXPIRED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGACCESSDENIED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGACCESSDENIED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGBADCERTIFICATE  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGBADCERTIFICATE  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGBADRECORDMAC  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGBADRECORDMAC  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGCERTIFICATEEXPIRED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGCERTIFICATEEXPIRED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGCERTIFICATEREVOKED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGCERTIFICATEREVOKED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGCERTIFICATEUNKNOWN  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGCERTIFICATEUNKNOWN,
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGDECODEERROR  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGDECODEERROR  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGDECOMPRESSIONFAILED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGDECOMPRESSIONFAILED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGDECRYPTERROR  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGDECRYPTERROR  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGDECRYPTIONFAILED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGDECRYPTIONFAILED  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGEXPORTRESTRICTION  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGEXPORTRESTRICTION  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGHANDSHAKEFAILURE  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGHANDSHAKEFAILURE  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGILLEGALPARAMETER  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGILLEGALPARAMETER  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGINSUFFICIENTSECURITY  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGINSUFFICIENTSECURITY  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGINTERNALERROR  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGINTERNALERROR  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGPROTOCOLVERSION  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGPROTOCOLVERSION  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGRECORDOVERFLOW  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGRECORDOVERFLOW  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGUNEXPECTEDMESSAGE  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGUNEXPECTEDMESSAGE  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGUNKNOWN  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGUNKNOWN  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGUNKNOWNCA  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGUNKNOWNCA  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_INCOMINGUNSUPPORTEDCERTIFICATE  </li>
<li class="cr"> resFE_MITOSFW_TLS_SOCK_OUTGOINGUNSUPPORTEDCERTIFICATE,
<li class="cr"> resFE_MITOSFW_TLS_SOCK_RENEGOTIATIONTIMEREXPIRED  </li>
</ul>
<p class="cr">
Added the various defines for TLS alerts that openssl did not have in CAsyncTlsSocket, for open SSL only.
</p>
<p class="cr">
CAsyncTlsSocket::ConnectingTls, CAsyncTlsSocket::ReceivingTls and CAsyncTlsSocket::SendingTls now return the various TLS alerts through EvAsyncSocketMgrErrorDetected using the new return codes.
</p>
<p class="cr">
CAsyncTlsSocket::TlsMessageCallback was modified to return the new TLS alert return codes.
</p>
</div>
<br><a name="CR21472"><div class="synopsis" id="CR21472_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21472')">CR#21472</a> :</b> Occasional assert in CPollRequestStatus::Poll on Symbian. 
</div>
<div class="detail" id="CR21472_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21472')">CR#21472</a> :</b> Occasional assert in CPollRequestStatus::Poll on Symbian. 
<h4>Description</h4>
<p class="cr">
There is a race condition in CPollRequestStatus::Poll on Symbian that can cause occasional assertions.
</p>
<h4>Solution</h4>
<p class="cr">
Removed the assert since the return value is not important. The return value can be something else than KErrCancel in the case where the timer expires before the Cancel method is called.
</p>
</div>
<br><a name="CR21482"><div class="synopsis" id="CR21482_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21482')">CR#21482 (Incident 2727)</a> :</b> Compilation errors on gcc 4.1.1 compiler.
</div>
<div class="detail" id="CR21482_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21482')">CR#21482 (Incident 2727)</a> :</b> Compilation errors on gcc 4.1.1 compiler.
<h4>Description</h4>
<p class="cr">
There are build errors under GCC 4.1.1 in the following files:
</p>
<ul>
<li class="cr">CFrameworkInitializer.cpp: CMemoryAllocator initializer and finalizer not declared inside namespace. </li>
<li class="cr">CMarshaler.h: InitializeCMarshaler and FinalizeCMarshaler not forward declared</li>
</ul>
<h4>Solution</h4>
<p class="cr">
The following methods are now forward declared inside the CMarshaler.h file:
</p>
<ul>
<li class="cr">InitializeCMarshaler</li>
<li class="cr">FinalizeCMarshaler</li>
</ul>
<p class="cr">
The following methods are now declared inside the namespace inside the CFrameworkInitializer.cpp file:
</p>
<ul>
<li class="cr">InitializeCMemoryAllocator</li>
<li class="cr">FinalizeCMemoryAllocator</li>
</ul>
</div>
<br><a name="CR21503"><div class="synopsis" id="CR21503_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21503')">CR#21503 (Incident 2697)</a> :</b> Problem with setpriority() when using NPTL library instead of LinuxThreads.
</div>
<div class="detail" id="CR21503_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21503')">CR#21503 (Incident 2697)</a> :</b> Problem with setpriority() when using NPTL library instead of LinuxThreads.
<h4>Description</h4>
<p class="cr">
When using the NPTL library instead of LinuxThreads, the CThread::StartThread changes the process priority instead of the thread priority. The problem is linked to the fact that each thread under LinuxThreads has a different PID and that under NPTL, each thread from an application share the same PID. Calling setpriority() using the returned PID from getpid() changes the process priority.
</p>
<h4>Solution</h4>
<p class="cr">
The call to setpriority() under Linux in CThread::ThreadEntry has been removed since it was only used with SCHED_OTHER and the only allowed priority value is 0.
</p>
</div>
<br><a name="CR21563"><div class="synopsis" id="CR21563_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21563')">CR#21563</a> :</b> WinCE crashes when resolving an invalid host name.
</div>
<div class="detail" id="CR21563_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21563')">CR#21563</a> :</b> WinCE crashes when resolving an invalid host name.
<h4>Description</h4>
<p class="cr">
The execution of the tests for WinCE will abruptly stop due to a crash. This occurs on a regular basis during the daily build. The crash occurs when executing TestInvalidGetHostByName(), this test ensures that the resolving of an invalid host name behaves as expected.
</p>
<p class="cr">
The crash occurs when we attempt to get the TTL from the DNS query even if no DNS query were made. We should not attempt to read the TTL value from the answer when no query was made.
</p>
<h4>Solution</h4>
<p class="cr">
When we detect a non-conformant host name we set the global variable ?g_uResolverErrorCode? to ?uRESOLVER_TEMPORARY_FAILURE_ERROR? instead of leaving it un-initialized. Setting this error code ensures that we will not try to get the TTL value from the answer.
</p>
</div>
<br><a name="CR21628"><div class="synopsis" id="CR21628_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21628')">CR#21628 (Incident 2710)</a> :</b> Connecting an UDP socket must be faster for STUN to work properly.
</div>
<div class="detail" id="CR21628_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21628')">CR#21628 (Incident 2710)</a> :</b> Connecting an UDP socket must be faster for STUN to work properly.
<h4>Description</h4>
<p class="cr">
Connecting an UDP socket must be faster for STUN to work properly.
</p>
<h4>Solution</h4>
<p class="cr">
CAsyncUdpSocket::ConnectA has been modified on all platforms (except Symbian) to perform the call to connect synchronously and to report the result asynchronously when it is performed in the current context of execution.  This avoids to delay the call to connect and allows to change the connection of an UDP socket much faster.  This optimization was needed because of the particular way that the STUN client uses connected UDP sockets.  It is an up-port of a modification in the M5T Framework SAFE v2.0.
</p>
</div>
<br><a name="CR21435"><div class="synopsis" id="CR21435_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21435')">CR#21435 (Incident 2724)</a> :</b> Negative DNS answer not cached as per RFC2308
</div>
<div class="detail" id="CR21435_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21435')">CR#21435 (Incident 2724)</a> :</b> Negative DNS answer not cached as per RFC2308
<h4>Description</h4>
<p class="cr">
Negative DNS answers, as described by RFC2308, are not cached. Except for the referral responses, the negative DNS answers should be cached. The referral responses must not be cached because resolver delegation is not currently supported.
</p>
<h4>Solution</h4>
<p class="cr">
ResolverHelpers.h: uRESOLVER_DELEGATION_DETECTED was renamed to uRESOLVER_NODATA_RESPONSE.
</p>

<p class="cr">
ResolverHelpers.cpp: In the ParseTtl function, 0 is now returned for referral responses. From the IsAnswerValidForCaching function, the value returned by the ParseTtl function is used to decide if the response should be cached. When 0 is returned, the response is not cached. Referral responses are not cached because resolver delegation is currently not supported. This behaviour was already implemented before the modifications for this CR.
</p>

<p class="cr">
Resolver.cpp: Modifications to the ResolverParseAnswerHeader function. When the RDCODE is "no error" and the answer section is empty, the response is negative. The response is a no data response if there is a SOA record in the authority records section or if the authority and additional records sections are empty. "No data" responses must be cached. The response is a referral response if there are authoritative name server records in the authority and additional records sections (but no SOA records). Referral responses must not be cached. In both cases, uRESOLVER_NODATA_RESPONSE is now returned. The IsAnswerValidForCaching function verifies if the response is a referral response.
</p>

<p class="cr">
Resolver.cpp: In the ResolverSend function, the case for uRESOLVER_DELEGATION_DETECTED was replaced with a case for uRESOLVER_NODATA_RESPONSE. For the uRESOLVER_NODATA_RESPONSE value, the response is considered as received (the blob containing the answer is not cleared). This way the response will be cached (if the response is not a referral response).
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Negative DNS answers, as described by RFC2308, are now cached. Referral responses are an exception and are not cached because resolver delegation is not currently supported.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
In ResolverHelpers.h, uRESOLVER_DELEGATION_DETECTED was renamed to uRESOLVER_NODATA_RESPONSE.
</p>

</div>
<br><a name="CR21698"><div class="synopsis" id="CR21698_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21698')">CR#21698 (Incident 2704)</a> :</b> GNU CPP version 2.96-mips compiler error
</div>
<div class="detail" id="CR21698_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21698')">CR#21698 (Incident 2704)</a> :</b> GNU CPP version 2.96-mips compiler error
<h4>Description</h4>
<p class="cr">
A compiler error was found with the Tornado 2.2 compiler for MIPS (GNU CPP version 2.96-mips3264-010729 (2.96+) VxWorks 5.5). With this compiler, when compiling the pkg_Framework 2.1 for VxWorks 5.5 and MIPS, the following error occurs:
</p>

<pre class="cr">
    ..\Sources\Basic\Result.h:361: syntax error before `;
</pre>

<p class="cr">
Line 361 of Result.h is the following:
</p>

<pre class="cr">
    typedef MX_NAMESPACE(MXD_GNS)CAlignedVariableStorage&lt;SResultPkgMsg&gt; SResultPkgMsgAlignedStorage;
</pre>

<p class="cr">
We found that by defining MXD_ENABLE_NAMESPACE the problem disappears. But it must be possible to compile the application without enabling the namespaces.
</p>

<p class="cr">
When namespaces are disabled, MX_NAMESPACE and MXD_GNS are both expanded to nothing. So MX_NAMESPACE(MXD_GNS) is simply expanded to nothing. We found out that by adding a space between ?MX_NAMESPACE(MXD_GNS)? and ?CAlignedVariableStorage? the problem disappears. This is certainly a compiler problem and it is probably related to macro expansion.
</p>

<p class="cr">
The problem couldn?t be reproduced with any other combination of operation systems and targets (for example VxWorks 5.5 and Pentium or VxWorks 5.4 and MIPS).
</p>
<h4>Solution</h4>
<p class="cr">
Result.h : At line 361, a space was added between ?MX_NAMESPACE(MXD_GNS)? and ?CAlignedVariableStorage?.
</p>
</div>
<br><a name="CR21714"><div class="synopsis" id="CR21714_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21714')">CR#21714 (Incident 2791)</a> :</b> Hard reset by remote peer leads to SIG13 broken pipe in CAsyncTlsSocket.
</div>
<div class="detail" id="CR21714_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21714')">CR#21714 (Incident 2791)</a> :</b> Hard reset by remote peer leads to SIG13 broken pipe in CAsyncTlsSocket.
<h4>Description</h4>
<p class="cr">
A Signal 13 / broken pipe is generated when a persistent TLS connection is closed by the remote peer using a hard reset.
</p>
<h4>Solution</h4>
<p class="cr">
A member was added to the CAsyncTlsClientSocket class to keep track of the closed by peer state of the socket. When calling the CloseA method on the socket, that member is checked to determine if it received a close by peer event. This is necessary when closed by a peer by receiving a RST. In that case, we must not call SSL_shutdown(), since that can lead to a SIGPIPE exception on some systems. When a RST is received, SSL_get_shutdown() will return 0, which allows to determine whether to a call to SSL_shutdown() is necessary or not.
</p>
</div>
<br><a name="CR21724"><div class="synopsis" id="CR21724_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21724')">CR#21724</a> :</b> CBlob::EraseAll() should reset CBlob members value.
</div>
<div class="detail" id="CR21724_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21724')">CR#21724</a> :</b> CBlob::EraseAll() should reset CBlob members value.
<h4>Description</h4>
<p class="cr">
By default, the blob read index should be set back to 0 when CBlob::EraseAll is called since there is no more data in the blob. There is no reason to keep an index at the last read position. All CBlob members are kept to their current value when EraseAll is called and they should not.
</p>
<h4>Solution</h4>
<p class="cr">
CBlob's members m_uReadIndex, m_uBitsRead, m_uWriteIndex and m_uBitsWritten are set to 0 before calling CVectorBase::EraseAll().
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Calling CBlob::EraseAll() now resets m_uReadIndex, m_uBitsRead, m_uWriteIndex and m_uBitsWritten to 0. A call to CBlob::SetReadIndex(0) is not needed anymore to set back the read index at the beginning of the blob.
</p>

</div>
<br><a name="CR21735"><div class="synopsis" id="CR21735_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21735')">CR#21735 (Incident 2798)</a> :</b> Stack size too small for VxTaskTerm.
</div>
<div class="detail" id="CR21735_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21735')">CR#21735 (Incident 2798)</a> :</b> Stack size too small for VxTaskTerm.
<h4>Description</h4>
<p class="cr">
Under some circumstances, the stack size of the VxTaskTerm thread in CThread.cpp is not large enough. A configuration mechanism allowing to override the default value of 1024 bytes is necessary.
</p>
<h4>Solution</h4>
<p class="cr">
Added a define, MXD_VXTASKTERM_STACK_SIZE, which allows overriding the stack size of the VxTaskTerm thread. The default value is 1024 bytes.
</p>
</div>
<br><a name="CR21948"><div class="synopsis" id="CR21948_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21948')">CR#21948</a> :</b> CFile::Read return values must be uniform across platforms.
</div>
<div class="detail" id="CR21948_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21948')">CR#21948</a> :</b> CFile::Read return values must be uniform across platforms.
<h4>Description</h4>
<p class="cr">
CFile::Read currently returns 0 when the end of file is reached and -1 in the case of errors on all platforms except for WinCE and Symbian.  For WinCE -1 is returned in both cases and for Symbian 0 is returned in the same situations.
</p>
<h4>Solution</h4>
<p class="cr">
CFile::Read has been modified to always return 0 when the end of file is encountered and -1 when an error occurs.
</p>
<p class="cr">
A lot of CFile functions are also not inlined anymore following this modification.  Since CFile's methods are not performance critical, inlining them was not necessary.
</p>
</div>
<br><a name="CR22004"><div class="synopsis" id="CR22004_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22004')">CR#22004</a> :</b> GetLocalAddress crash on closed async TCP server socket.
</div>
<div class="detail" id="CR22004_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22004')">CR#22004</a> :</b> GetLocalAddress crash on closed async TCP server socket.
<h4>Description</h4>
<p class="cr">
Calling GetLocalAddress() or GetLocalInterfaceAddress() after a TCP server socket has been closed causes a crash.
</p>
<h4>Solution</h4>
<p class="cr">
Properly reset the m_bBound state to false when CAsyncTcpServerSocket::ReleaseResources is called.
</p>
</div>
<br><a name="CR22035"><div class="synopsis" id="CR22035_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22035')">CR#22035 (Incident 2864)</a> :</b> Manager cannot be set to NULL on TLS sockets.
</div>
<div class="detail" id="CR22035_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22035')">CR#22035 (Incident 2864)</a> :</b> Manager cannot be set to NULL on TLS sockets.
<h4>Description</h4>
<p class="cr">
It should be possible to set the managers to NULL in the TLS client and server socket.
</p>
<h4>Solution</h4>
<p class="cr">
In CAsyncTlsServerSocketBase, updated SetAsyncSocketMgr and SetAsyncServerSocketMgr so it can be set to NULL when the manager is no longer needed.
</p>
<p class="cr">
In CAsyncTlsSocketBase, updated SetAsyncClientSocketMgr, SetAsyncIoSocketMgr, SetAsyncSocketMgr and SetAsyncTlsSocketMgr so it can be set to NULL when the manager is no longer needed. Note that SetAsyncTlsRenegotiationMgr was already allowing the manager to be change.
</p>
</div>
<br><a name="CR22065"><div class="synopsis" id="CR22065_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR22065')">CR#22065</a> :</b> GetSocketType crash on closed TLS Socket and SetSocketType does not completely copy the socket type.
</div>
<div class="detail" id="CR22065_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR22065')">CR#22065</a> :</b> GetSocketType crash on closed TLS Socket and SetSocketType does not completely copy the socket type.
<h4>Description</h4>
<p class="cr">
Calling GetSocketType after a TLS socket has been closed causes a crash. SetSocketType does not completely copy the socket type.
</p>
<h4>Solution</h4>
<p class="cr">
The TLS socket implements GetSocketType itself to avoid crashes.
UDP, TCP and TLS sockets SetSocketType copy all the values in the array of the socket type.
</p>
</div>
<br><br><h3>Documentation Updates</h3>
<a name="CR21104"><div class="synopsis" id="CR21104_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21104')">CR#21104</a> :</b> Add documentation to MX_DELETE and a test to validate delete(NULL)
</div>
<div class="detail" id="CR21104_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21104')">CR#21104</a> :</b> Add documentation to MX_DELETE and a test to validate delete(NULL)
<h4>Description</h4>
<p class="cr">
The documentation of MX_DELETE macro should be updated to confirm that a call to MX_DELETE(NULL) will not perform any operation.
</p>
<h4>Solution</h4>
<p class="cr">
The MX_DELETE documentation has been updated to mention that MX_DELETE(NULL) performs no operation.
</p>
</div>
<br><a name="CR21124"><div class="synopsis" id="CR21124_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21124')">CR#21124</a> :</b> Framework FS-5 Test plan must be re-created.
</div>
<div class="detail" id="CR21124_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21124')">CR#21124</a> :</b> Framework FS-5 Test plan must be re-created.
<h4>Description</h4>
<p class="cr">
During the release process for Framework 2.1.4.7, the test plan document could not be generated because the documentation tool project was broken. It needs to be recreated and reviewed. The test plan document is part of the delivered product and must be kept up to date.
</p>
<h4>Solution</h4>
<p class="cr">
The fix for this can be split in multiple phases.
</p>
<ul>
<li class="cr">Phase 1: Update the documentation tool project file to use the latest one available.</li>
<li class="cr">Phase 2: Create a structure file for the test plan document.</li>
<li class="cr">Phase 3: Adapt the existing documentation to the new document structure.</li>
<li class="cr">Phase 4: Complete and review existing documentation.</li>
</ul>

<p class="cr">
&lt;B&gt;Phase 1: Update the documentation tool project file to use the latest one available.&lt;/B&gt;
</p>
<p class="cr">
The documentation tool project file has been updated to the latest template and it is now possible to control the document structure directly from the in-source documentation.
</p>

<p class="cr">
&lt;B&gt;Phase 2: Create a structure file for the test plan document.&lt;/B&gt;
</p>
<p class="cr">
The TestPlanStructure.h file has been created to establish the basic structure of the document.
</p>

<p class="cr">
&lt;B&gt;Phase 3: Adapt the existing documentation to the new document structure.&lt;/B&gt;
</p>
<p class="cr">
This phase is simply to add the necessary keywords to the in-source documentation to place the required documentation correctly in the document structure and exclude the code that is not to be documented at all. All test cases have been updated to the new structure.
</p>

<p class="cr">
&lt;B&gt;Phase 4: Complete and review the existing documentation.&lt;/B&gt;
</p>
<p class="cr">
This phase consists in making sure that all test cases have proper and correct documentation. The objective is to do the minimal modifications required to get the test case properly documented.
</p>
<p class="cr">
The following folders are up-to-date:
<ul>
<li class="cr">BasicStubs</li>
<li class="cr">BasicTests</li>
<li class="cr">CapTests</li>
<li class="cr">CryptoOverrides</li>
<li class="cr">CryptoTests</li>
<li class="cr">EComExample</li>
<li class="cr">EComTests</li>
</ul>
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The test plan document has been re-created and reviewed.
</p>

</div>
<br></div>
<br>
<hr>
<div id="label2.1.4.7_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.4.7')">Version 2.1.4</a> (build 7): Created on December 06, 2007
</div>
<div id="label2.1.4.7_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.4.7')">Version 2.1.4</a> (build 7): Created on December 06, 2007
<br><br><h3>New Features and Improvements</h3>
<a name="CR18122"><div class="synopsis" id="CR18122_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18122')">CR#18122 (Incidents 1576, 1737)</a> :</b> Add support for the Symbian 9.1 operating system.
</div>
<div class="detail" id="CR18122_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18122')">CR#18122 (Incidents 1576, 1737)</a> :</b> Add support for the Symbian 9.1 operating system.
<h4>Description</h4>
<p class="cr">
Support for the Symbian 9.1 operating system must be added in the Framework. More specifically, it must support the Nokia series 60 3rd edition Maintenance Release SDK for execution on a Nokia N80 phone.
</p>
<h4>Solution</h4>
<p class="cr">
Added the Symbian91_arm_gcc343_sis, Symbian91_arm_gcc343_sis_d, and Symbian91_emu_winscw_d targets in m5tmake.cfg.
</p>
<p class="cr">
Added support for Symbian 9.1 via the MXD_OS_SYMBIAN define in MxConfig.h.
</p>
<p class="cr">
Created a handler, MxSymbianPrintf, to redirect everything that is sent to stdout to a file. The name  and path of that file is configurable using the MXD_SYMBIAN_TRACE_FILENAME macro.
</p>
<p class="cr">
Added a method to CFrameworkInitializer, InitializeSymbianNetwork. This method MUST be called before calling CFrameworkInitializer::Initialize to specify a RConnection and RSocketServ object. Note that the RSocketServ must be created with enough slots to accommodate all sockets used by the application. See the Symbian documentation for more details.
</p>
<p class="cr">
The MxVsnprintf method has been modified to use the AppendFormatList method from the Symbian API. Also added special treatment when a "%p" is encountered in a format string since it is treated differently on Symbian.
</p>
<p class="cr">
Fixed compilation issue when MXD_CAP_ENABLE_SUPPORT was not defined.
</p>
<p class="cr">
In the CListBase::Sort method, changed the way in which to delete the array of pointers since Symbian does not allow to call delete on a pointer to a pointer.
</p>
<p class="cr">
Modified the CSemaphore class so that it uses the RSemaphore class from the Symbian SDK.
</p>
<p class="cr">
Modified the CMutex class so that it uses the RCriticalSection class from the Symbian SDK.
</p>
<p class="cr">
Modified the CThread class so that it uses the RThread class and the thread local storage from the Symbian SDK.
</p>
<p class="cr">
Modified the CTimer class so that it uses the methods provided by the Symbian SDK.
</p>
<p class="cr">
Modified the Crypto folder so that enabling the MitosFw crypto engine works under Symbian.
</p>
<p class="cr">
Modified the CServicingThread class so that it uses Symbian's Request Status instead of select on BSD sockets. This is necessary since the select() method is not implemented in Symbian. To that end, a new interface, IRequestStatusService, has been created.
</p>
<p class="cr">
Created a new class, CPollRequestStatus, in the Network folder. This class has the same functionality as the CPollSocket class, except that it uses Symbian's Request Status instead of select() on BSD sockets. This class is only implemented for Symbian.
</p>
<p class="cr">
The CAsyncTcpServerSocket, CAsyncTcpSocket, CAsyncUdpSocket, and CUdpSocket classes have been modified to use Symbian's RSocket class.
</p>
<p class="cr">
The CSocketAddr class has been modified to use the TInetAddr class from the Symbian SDK.
</p>
<p class="cr">
The GetAddress method from CSocketAddr that returned a buffer to the address has been replaced by a version to which the user passes a buffer.
</p>
<p class="cr">
The portable resolver has been modified to make sure it builds and works on Symbian. To that end, it uses Symbian's RSocket class instead of a select() on a BSD socket.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Added the following method to CFrameworkInitializer:
<pre class="cr">
static void InitializeSymbianNetwork(RConnection* pConnection,
                                     RSocketServ* pSocketServ);
</pre>
</p>
<p class="cr">
The following method in CSocketAddr has been removed:
<pre class="cr">
void GetIPAddr( OUT const uint8_t** ppuAddr,
                OUT unsigned int* puAddrSize) const ;
</pre>
And replaced by:
<pre class="cr">
mxt_result GetAddress(IN const unsigned int uAddressCapacity,
                      OUT uint8_t* puAddress,
                      OUT unsigned int* puAddressSize) const;
</pre>
</p>
<p class="cr">
The ISocketServiceMgr class has been replaced by the IRequestStatusServiceMgr class in CEventDriven's derived interfaces for Symbian.
</p>
<p class="cr">
The ISocketService and IPolledSocketMgr classes have been replaced by the IRequestStatusService and IPolledRequestStatusMgr classes in CServicingThread's derived interfaces for Symbian.
</p>

</div>
<br><a name="CR18727"><div class="synopsis" id="CR18727_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18727')">CR#18727</a> :</b> Update to the latest tracing guideline.
</div>
<div class="detail" id="CR18727_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18727')">CR#18727</a> :</b> Update to the latest tracing guideline.
<h4>Description</h4>
<p class="cr">
Traces in the Framework must be adapted to the latest tracing guideline. Notably, entry and exit traces must be added where appropriate, and the right tracing must be used. Also, tracing nodes must be created where appropriate.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">Added entry and exit traces to all methods in the Framework, except for the files located in the Cap, Kernel, and Basic folder.</li>
<li class="cr">Added tracing nodes for each folder. Moreover, more nodes have been created for sockets and CServicingThread.</li>
<li class="cr">Added Initialization/Finalization of tracing nodes in CFrameworkInitializer.</li>
</ul>
</p>
</div>
<br><a name="CR18821"><div class="synopsis" id="CR18821_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18821')">CR#18821</a> :</b> Dynamically test the Endian type at run time.
</div>
<div class="detail" id="CR18821_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18821')">CR#18821</a> :</b> Dynamically test the Endian type at run time.
<h4>Description</h4>
<p class="cr">
It would be useful to test the endianness at run time to determine if it matches the endianness selected with MXD_LITTLE_ENDIAN or MXD_BIG_ENDIAN at compile time.
</p>
<h4>Solution</h4>
<p class="cr">
The endianness validation is implemented in CFrameworkInitializer. If it is determined that the compile time configuration is different from the actual run-time endianness, a trace is outputted and an error is returned. This is supported on all operating systems.
</p>
</div>
<br><a name="CR18849"><div class="synopsis" id="CR18849_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18849')">CR#18849</a> :</b> Add native atomic operations support to Linux x86 and Linux PPC. 
</div>
<div class="detail" id="CR18849_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18849')">CR#18849</a> :</b> Add native atomic operations support to Linux x86 and Linux PPC. 
<h4>Description</h4>
<p class="cr">
        This new feature adds native implementation of atomic operations for the Linux operating system running on the x86 and PPC architectures.
</p>
<p class="cr">
        Added Atomic operations unit tests to check the validity and atomicity of atomic operations.
</p>
<p class="cr">
        The native Windows implementation has also been improved for performance purposes.
</p>
<h4>Solution</h4>
<p class="cr">
        Changed the implementation of the native atomic operations on Windows to use naked functions and __fastcall convention to speed up execution.
</p>
<p class="cr">
        Created a CTestCAtomic class that tests the atomic operations for validity and atomicity using varied basic types and user defined types.
</p>
<p class="cr">
        Added implementation of native operations for Linux/GCC/x86 and Linux/GCC/PPC platforms. Here are the types supported by the two implementations:
<pre class="cr">
            // Linux / GCC / x86:
            // - int16_t
            // - uint16_t
            // - int32_t
            // - uint32_t
            // Linux / GCC / PPC:
            // - int32_t
            // - uint32_t
</pre>
</p>
<p class="cr">
        Changed the CString class to use a 32 bit ref-count if native atomic operations are enabled and the current platform is Linux/GCC/PPC. This is done because PPC architectures don't support native atomic operation on 16 bit integers.
</p>
</div>
<br><a name="CR18873"><div class="synopsis" id="CR18873_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18873')">CR#18873</a> :</b> Socket factory must be supported by the framework.
</div>
<div class="detail" id="CR18873_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18873')">CR#18873</a> :</b> Socket factory must be supported by the framework.
<h4>Description</h4>
<p class="cr">
This CR adds an extendable socket factory feature to the Framework v2.1.
</p>
<h4>Solution</h4>
<p class="cr">
The CAsyncSocketFactory class has been added. This class allows the creation of any type of socket through a unified interface. Along with it are added the IAsyncSocketFactoryConfigurationMgr and IAsyncSocketFactoryCreationMgr interfaces. These two interfaces are the ones to use to extend the socket factory's behaviour. An application requiring the socket factory to create a custom type of socket will realize these interfaces and register its implementation with the socket factory. In turn, the socket factory will call the application's implementation at appropriate times.
</p>
<p class="cr">
The Framework's static initializer class CFrameworkInitializer has been revised to include the CAsyncSocketFactory in its initialization and finalization procedures.
</p>
<p class="cr">
The CAsyncTlsSocketFactoryCreationMgr class has been added to integrate the TLS socket creation with the CAsyncSocketFactory without introducing a dependency in the Network folder over the TLS folder. This class can also serve as an example for extending the CAsyncSocketFactory.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The two following manager interfaces have been added to render the asynchronous socket factory feature extendable:
<ul>
<li class="cr">IAsyncSocketFactoryConfigurationMgr</li>
<li class="cr">IAsyncSocketFactoryCreationMgr</li>
</ul>
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The Framework's API reference document has been updated to document the socket factory feature.
</p>

</div>
<br><a name="CR18213"><div class="synopsis" id="CR18213_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18213')">CR#18213</a> :</b> Add support for Solaris.
</div>
<div class="detail" id="CR18213_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18213')">CR#18213</a> :</b> Add support for Solaris.
<h4>Description</h4>
<p class="cr">
Support for the Solaris 8 and 10 operating systems must be added in the Framework.
</p>
<h4>Solution</h4>
<p class="cr">
Added #if defined(MXD_OS_SOLARIS) where needed. Up-ported CRs from Framework 2.0 and pre-release CRs.
</p>
<p class="cr">
Added a Solaris implementation of the GetLocalIPAddr method from NetworkTools that examines the routing table to return the right local address.
</p>
</div>
<br><a name="CR18910"><div class="synopsis" id="CR18910_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18910')">CR#18910</a> :</b> Review the location of Framework configuration macros 
</div>
<div class="detail" id="CR18910_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18910')">CR#18910</a> :</b> Review the location of Framework configuration macros 
<h4>Description</h4>
<p class="cr">
Some configuration macros need to be relocated from MxConfig.h to FrameworkCfg.h. These configuration macros do not need to be published outside of the Framework configuration.
</p>
<h4>Solution</h4>
<p class="cr">
The documentation sections of MXD_DEFAULT_THREAD_STACK_SIZE and MXD_RESULT_ENABLE_MITOSFW_ERROR_MESSAGES have been moved from MxConfig.h to FrameworkCfg.h.
</p>
</div>
<br><a name="CR19000"><div class="synopsis" id="CR19000_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19000')">CR#19000</a> :</b> Add MXD_RESULT_ENABLE_ERROR_MESSAGES define to pkg_Framework. 
</div>
<div class="detail" id="CR19000_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19000')">CR#19000</a> :</b> Add MXD_RESULT_ENABLE_ERROR_MESSAGES define to pkg_Framework. 
<h4>Description</h4>
<p class="cr">
    To enable all result strings that can be obtained using MxResultGetMsgStr in every package, a new #define is required.
</p>
<h4>Solution</h4>
<p class="cr">
    Added the MXD_RESULT_ENABLE_ALL_ERROR_MESSAGES define to enable result strings in FW 2.1. This string will be added to other packages independently.
</p>
</div>
<br><a name="CR19220"><div class="synopsis" id="CR19220_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19220')">CR#19220</a> :</b> OpenSSL 0.9.8e needs to be compiled on Symbian
</div>
<div class="detail" id="CR19220_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19220')">CR#19220</a> :</b> OpenSSL 0.9.8e needs to be compiled on Symbian
<h4>Description</h4>
<p class="cr">
The OpenSSL library (version 0.9.8e) must be compiled on the Symbian operating system.
</p>
<h4>Solution</h4>
<p class="cr">
In the DllEntry.cfg file, UTI_MAKEFILE_VIEW, UTI_MAKEFILE_CONFIG and PKG_TESTFRAMEWORK have been updated.
</p>

<p class="cr">
In the m5tmake.cfg file, the labels of various packages have been updated. The OpenSSL libraries are now included for the Symbian operating system.
</p>

<p class="cr">
In the PreFrameworkCfgOpenSslStubs.h file, MXD_CRYPTO_ALL_OPENSSL is now defined for MXD_OS_SYMBIAN.
</p>
</div>
<br><a name="CR19221"><div class="synopsis" id="CR19221_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19221')">CR#19221</a> :</b> OpenSSL 0.9.8e needs to be supported
</div>
<div class="detail" id="CR19221_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19221')">CR#19221</a> :</b> OpenSSL 0.9.8e needs to be supported
<h4>Description</h4>
<p class="cr">
Version 0.9.8e of the OpenSSL library needs to be supported for the following targets:
</p>

<ul>
<li class="cr">Linux24_i386_gcc311</li>
<li class="cr">Linux24_i386_gcc311_d</li>
<li class="cr">Linux24_Mx1124_ppc_gcc311</li>
<li class="cr">Linux24_Mx1124_ppc_gcc311_d</li>
<li class="cr">VxWorks54_Mx1102_mips_gcc295</li>
<li class="cr">VxWorks54_Mx1102_mips_gcc295_d</li>
<li class="cr">VxWorks55_pentium_gcc296</li>
<li class="cr">VxWorks55_pentium_gcc296_d</li>
<li class="cr">Win32_i386_msvc6</li>
<li class="cr">Win32_i386_msvc6_d</li>
<li class="cr">Win32_i386_msvc7</li>
<li class="cr">Win32_i386_msvc7_d</li>
<li class="cr">Win32_i386_msvc8</li>
<li class="cr">Win32_i386_msvc8_d</li>
<li class="cr">WinCE5_arm_msvc8</li>
<li class="cr">WinCE5_arm_msvc8_d</li>
<li class="cr">Solaris8_sparcv9_gcc323</li>
<li class="cr">Solaris8_sparcv9_gcc323_d</li>
<li class="cr">Solaris10_sparcv9_gcc343</li>
<li class="cr">Solaris10_sparcv9_gcc343_d</li>
</ul>

<p class="cr">
The Symbian operating system is not included in this CR.
</p>
<h4>Solution</h4>
<p class="cr">
For this CR, there were no modifications in the pkg_Framework other than changing the label of LIB_OPENSSL in the m5tmake.cfg file. The modification to the m5tmake.cfg file was made in the context of other CRs.
</p>

<p class="cr">
This CR is linked with the following CRs in lib_OpenSsl (view 1.1):
</p>

<ul>
<li class="cr">CR 19448 - Build OpenSsl 0.9.8e for Linux 2.4</li>
<li class="cr">CR 19449 - Build OpenSsl 0.9.8e for MSVC 6, 7 and 8</li>
<li class="cr">CR 19450 - Build OpenSsl 0.9.8e for VxWorks 5.4 and 5.5</li>
<li class="cr">CR 19391 - Build OpenSsl 0.9.8 for WinCE 5.0.</li>
<li class="cr">CR 19394 - Build OpenSsl 0.9.8e for Solaris</li>
</ul>
</div>
<br><a name="CR19129"><div class="synopsis" id="CR19129_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19129')">CR#19129</a> :</b> Support for Vista.
</div>
<div class="detail" id="CR19129_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19129')">CR#19129</a> :</b> Support for Vista.
<h4>Description</h4>
<p class="cr">
Framework 2.1 must compile with msvc8 and must execute under Windows Vista.
</p>
<h4>Solution</h4>
<p class="cr">
Support for Windows Vista has been added in FW 2.1. The COsVersion class is now able to detect Windows Vista.
</p>
<p class="cr">
A behavioural difference has been observed in the Windows GetBestInterfaceEx() API with regards to Windows XP and 2003. While the latter correctly handles ambiguous Link-Local IPv6 addresses without scope-id fields by failing the call to GetBestInterfaceEx(), Windows Vista lets the call succeed by returning what seems to be the first interface found in its search. In order to keep the behaviour of the Framework's GetLocalIPv6Addr() function the same on all supported platforms, an additional check is done for this ambiguity condition under Windows Vista. This change affects the NetworkTools.cpp file.
</p>
<p class="cr">
Notes:
<ul>
<li class="cr">TC QOS is supported as long as "User Account Control" is disabled.</li>
</ul>
</p>
<p class="cr">
Remaining known issues (CR19931 &amp; CR19941 will address them at a future time):
<ul>
<li class="cr">GQOS is not supported. Regressions have been observed in the Windows QOS API even though Microsoft states that Vista supports it correctly. This API issue should be resolved in Windows Vista SP1.<li class="cr">
<li class="cr">Succeeding DNS NAPTR queries crash inside the Windows DNS API. There is no documentation stating whether or not it will be corrected in Windows Vista SP1. As a work around, the portable resolver can be used.
</ul>
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The "Known issues" section in the release notes has been updated to add the issues stated in the detailed fix section of this CR. The dependencies stated in the release notes have also been updated.
</p>
<p class="cr">
The QOS feature documentation has been updated to state that TC QOS is supported when "User Account Control" is disabled and that GQOS is not supported under Windows Vista.
</p>

</div>
<br><a name="CR19464"><div class="synopsis" id="CR19464_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19464')">CR#19464</a> :</b> Asynchronous socket must be implemented as ECOM.
</div>
<div class="detail" id="CR19464_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19464')">CR#19464</a> :</b> Asynchronous socket must be implemented as ECOM.
<h4>Description</h4>
<p class="cr">
The CR18873 adds an extendable socket factory feature to the Framework v2.1. In order to implement this feature and allow it to create any type of sockets, the conversion of existing asynchronous sockets (UDP, TCP and, TLS) to ECOM imposes itself. The socket factory will need to determine the socket's class at run-time and create it. This is easily done using ECOM.
</p>
<p class="cr">
Thus, it follows that existing framework's asynchronous sockets (UDP, TCP and, TLS) needs to be converted to ECOM to correctly integrate with the socket factory.
</p>
<h4>Solution</h4>
<p class="cr">
The solution of this CR touched quite a few files. An overview of all the changes that have been made is given here.
</p>
<p class="cr">
All asynchronous sockets types now implement standardized interfaces. Each socket type implements only those interfaces that are relevant to its type. A simple ECOM QueryIf call will tell the user if a given interface is supported by a given socket. Here is the list of the standard interfaces with a brief description of their respective usage (see the interfaces's respective documentation for more details):
<ul>
<li class="cr">IAsyncSocket</li>
<ul>
<li class="cr">This interface is implemented by all socket types, it defines the basic behaviour of a socket.</li>
</ul>
<li class="cr">IAsyncClientSocket</li>
<ul>
<li class="cr">This interface is implemented by all client socket types, it defines the basic behaviour of a client socket.</li>
</ul>
<li class="cr">IAsyncIoSocket</li>
<ul>
<li class="cr">This interface is implemented by all socket types on which connected I/O (Send / Recv) can be performed.</li>
</ul>
<li class="cr">IAsyncUnconnectedIoSocket</li>
<ul>
<li class="cr">This interface is implemented by all socket types on which unconnected I/O (SendTo/RecvFrom) can be performed.</li>
</ul>
<li class="cr">IAsyncServerSocket</li>
<ul>
<li class="cr">This interface is implemented by all server socket types, it defines the basic behaviour of a server socket. One important change in this interface is the way in which the options for accepted sockets are set. The user must now call the QueryAcceptedOptionsIf method to query one of the options interface (listed later on). The user then uses the returned interface to set socket options for the accepted sockets. Implementation wise, the socket options are cached in the server socket and used when required, that is at creation time of an accepted socket. This means that all accepted sockets should use the same socket options. It is still possible to change these options, for any accepted socket, on reception of the IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionAccepted event. However, doing so is not recommended. The only operation that should be done in this event is setting the various managers of the accepted socket.</li>
</ul>
<li class="cr">IAsyncTlsSocket</li>
<ul>
<li class="cr">This interface is implemented by TLS sockets.</li>
</ul>
<li class="cr">IAsyncTlsRenegotiation</li>
<ul>
<li class="cr">This interface is implemented by TLS sockets on which TLS renegotiation is possible.</li>
</ul>
<li class="cr">IAsyncTlsServerSocket</li>
<ul>
<li class="cr">This interface is implemented by TLS server sockets, it allows to specify and retrieve the TLS context that will be used by all accepted sockets.</li>
</ul>
</ul>
</p>
<p class="cr">
Most of these interfaces can report events. They do so through the manager interfaces listed here. See the interfaces's respective documentation to get more details on its manager interface and the events it reports.
<ul>
<li class="cr">IAsyncSocketMgr</li>
<li class="cr">IAsyncClientSocketMgr</li>
<li class="cr">IAsyncIoSocketMgr</li>
<li class="cr">IAsyncUnconnectedIoSocketMgr</li>
<li class="cr">IAsyncServerSocketMgr</li>
<li class="cr">IAsyncTlsSocketMgr</li>
<li class="cr">IAsyncTlsRenegotiationMgr</li>
</ul>
</p>
<p class="cr">
There are also new interfaces to set the different socket options on a given socket. Here is the list of the options interfaces:
<ul>
<li class="cr">IAsyncSocketBufferSizeOptions</li>
<li class="cr">IAsyncSocketQualityOfServiceOptions</li>
<li class="cr">IAsyncSocketTcpOptions</li>
<li class="cr">IAsyncSocketUdpOptions</li>
</ul>
</p>
<p class="cr">
The Framework's static initializer class CFrameworkInitializer has been revised to include the ECOM sockets in its initialization and finalization procedures.
</p>
<p class="cr">
The traces in all code updated by this CR have been revised to be compliant to the latest M5T tracing guidelines.
</p>
<p class="cr">
There are a few bug fixes included in this CR. Here is an overview:
<ul>
<li class="cr">The CTcpServerSocket::GetLocalAddress() now correctly sets the address type (IPv6 or IPv4) in the returned CSocketAddr.</li>
<li class="cr">The entry trace in the CEventDriven destructor has been corrected to output the correct method name.</li>
<li class="cr">The CFrameworkInitializer::PartialFinalize method has been revised to correct inconsistencies in the order in which the Framework is finalized.</li>
</ul>
</p>
<p class="cr">
A new TCP socket configuration interface, ITcpSocketOptionsConfigure, has been added. This interface allows setting socket options on a given TCP socket. See the interface's documentation for more details.
</p>
<p class="cr">
Along with all these interface changes, the synchronous socket's Create method has been revised to receive an address family and derive the corresponding protocol family from it. Since the asynchronous sockets were modified as such, it is logical that the synchronous sockets does the same.
</p>
<p class="cr">
There are two new interfaces that are for private and internal use of the Framework only. They are used to allow the server sockets to configure the accepted sockets it creates. These are only mentionned for CR documentation completeness.
<ul>
<li class="cr">IPrivateAsyncTcpSocket</li>
<li class="cr">IPrivateAsyncTlsSocket</li>
</ul>
<h4 class="red">Interface Change</h4>
<p class="cr">
This CR modified many socket interfaces; methods have been moved around, others have been added. The user is urged to consult the socket interfaces in the API reference document to determine to what extent these changes affect him. The interfaces for which the documentation should be consulted are listed below.
</p>
<p class="cr">
The following interfaces are now ECOM interfaces. Note that in an effort to standardize and split the interfaces in a logical fashion, some methods have been stripped from these interfaces and regrouped in new ECOM interfaces.
<ul>
<li class="cr">IAsyncSocket</li>
<li class="cr">IAsyncClientSocket</li>
<li class="cr">IAsyncIoSocket</li>
<li class="cr">IAsyncServerSocket</li>
</ul>
</p>
<p class="cr">
The following ECOM interfaces are brand new and regroup, in a logical fashion, the methods that have been stripped from the converted interfaces.
<ul>
<li class="cr">IAsyncUnconnectedIoSocket</li>
<li class="cr">IAsyncTlsSocket</li>
<li class="cr">IAsyncTlsRenegotiation</li>
<li class="cr">IAsyncTlsServerSocket</li>
<li class="cr">IAsyncSocketBufferSizeOptions</li>
<li class="cr">IAsyncSocketQualityOfServiceOptions</li>
<li class="cr">IAsyncSocketTcpOptions</li>
<li class="cr">IAsyncSocketUdpOptions</li>
</ul>
</p>
<p class="cr">
Some of the events reported through the manager interfaces have been moved around to regroup them in a more logical fashion following the modifications to the interfaces. The list of manager interfaces is the following:
<ul>
<li class="cr">IAsyncSocketMgr</li>
<li class="cr">IAsyncClientSocketMgr</li>
<li class="cr">IAsyncIoSocketMgr</li>
<li class="cr">IAsyncUnconnectedIoSocketMgr</li>
<li class="cr">IAsyncServerSocketMgr</li>
<li class="cr">IAsyncTlsSocketMgr</li>
<li class="cr">IAsyncTlsRenegotiationMgr</li>
</ul>
</p>
<p class="cr">
The CUdpSocket::Create and CTcpSocket::Create methods now require a CSocketAddr::EAddressFamily parameter instead of an ISocket::EProtocolFamily parameter. They derive one from the other as there is a 1-to-1 correspondance between the two.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The Framework's API reference document has been updated to document the ECOM asynchronous sockets.
</p>

</div>
<br><a name="CR19549"><div class="synopsis" id="CR19549_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19549')">CR#19549</a> :</b> CAsyncTlsSocket and CAsyncTlsServerSocket MUST support Symbian.
</div>
<div class="detail" id="CR19549_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19549')">CR#19549</a> :</b> CAsyncTlsSocket and CAsyncTlsServerSocket MUST support Symbian.
<h4>Description</h4>
<p class="cr">
This CR adds support for TLS using OpenSSL on Symbian. This support is added by the use of the BIO interface of OpenSSL which is to be redirected to the asynchronous socket classes of the Framework.
</p>
<h4>Solution</h4>
<p class="cr">
The most important changes done to the source code are the following:
<ul>
<li class="cr">The CAsyncTlsSocket class now uses the asynchronous TCP socket instead of the synchronous one.</li>
<li class="cr">The CAsyncTlsSocket class now overrides the BIO layer of OpenSSL. This is for OpenSSL to also use the Framework's asynchronous TCP socket instead of its own platform dependent ones.</li>
<li class="cr">The CAsyncTlsServerSocket class now uses the asynchronous TCP sockets (server and client) instead of synchronous sockets.</li>
</ul>
</p>
<p class="cr">
Other modifications done to the source code:
<ul>
<li class="cr">The CAsyncTcpSocket class had a few issues with event handling and reporting under Symbian, these have been corrected.</li>
<li class="cr">Some traces level were not right in the CAsyncTcpSocket class, they have also been corrected.</li>
<li class="cr">Some of the test cases have been found to fail on platforms other than Symbian. Those test cases were known to always succeed prior to the modifications of this CR. Further investigation showed that the test cases overflowed the available heap memory. These memory overflows have been discovered to be caused by memory leaks in the asynchronous TLS sockets (server and client) code. These leaks have also been corrected.</li>
<li class="cr">A memory leak has also been corrected in the CTls::Uninitialize() method.</li>
</ul>
</p>
</div>
<br><a name="CR19435"><div class="synopsis" id="CR19435_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19435')">CR#19435</a> :</b> FW 2.1 must support WinCE5.0.
</div>
<div class="detail" id="CR19435_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19435')">CR#19435</a> :</b> FW 2.1 must support WinCE5.0.
<h4>Description</h4>
<p class="cr">
   Framework must support WinCE 5.0 and deprecate WinCE 4.2.
</p>
<h4>Solution</h4>
<p class="cr">
  Modified CThread.cpp to change the way to detect whether or not memory is increasing because the  existing method was not working with msvc8 WinCE compiler optimizations.
</p>

<p class="cr">Test case modifications:</p>
<ul>
<li class="cr">Modified CTestCAsyncTlsSocketCloseDuringRenegotiation.cpp to limit the MaxTimeoutMs when the OS is WinCE.</li>
<li class="cr">Modified TestCAsyncTlsSocketRenegotiationDeterministic.cpp to limit the uClientMaximumPayloadToSend when the OS is WinCE.</li>
<li class="cr">Modified CTestCAsyncTlsSocketRenegotiationNonDeterministic.cpp to limit the uClientMaximumPayloadToSend when the OS is WinCE.</li>
<li class="cr">Modified CTestCAsyncTlsSocketRenegotiationSendBlast.cpp to limit the uClientMaximumPayloadToSend when the OS is WinCE.</li>
<li class="cr">Modified CTestCThread.cpp to limit the number of concurrent threads when the OS is WinCE.</li>
<li class="cr">Modified CTestCSemaphore.cpp to limit the number of concurrent threads when the OS is WinCE.</li>
<li class="cr">Updated m5tmake.cfg and m5ttest.cfg to support WinCE and also modified the lib/include paths to support the new library tree.</li>
</ul>
</div>
<br><a name="CR19621"><div class="synopsis" id="CR19621_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19621')">CR#19621</a> :</b> Must remove warnings when building using msvc8.
</div>
<div class="detail" id="CR19621_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19621')">CR#19621</a> :</b> Must remove warnings when building using msvc8.
<h4>Description</h4>
<p class="cr">
New warning flags have been introduced in the m5tmake build tool when building for msvc8. Some minor modifications are necessary to remove warnings generated as a result of these flags.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">Fixed various unused function parameter warnings by using the MX_REMOVE_UNUSED_FUNCTION_PARAM_WARNING() macro.</li>
<li class="cr">Removed unused variables in Windows-only code.</li>
<li class="cr">Fixed various signed/unsigned mismatch warnings when initializing to ~0 by using ~0U instead.</li>
<li class="cr">Reworked some part of code to avoid the assignment within conditional warning.</li>
</ul>
</div>
<br><a name="CR19655"><div class="synopsis" id="CR19655_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19655')">CR#19655</a> :</b> support TLS session caching.
</div>
<div class="detail" id="CR19655_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19655')">CR#19655</a> :</b> support TLS session caching.
<h4>Description</h4>
<p class="cr">
Support of TLS session caching is required to speed up TLS handshaking on subsequent connections.
</p>
<h4>Solution</h4>
<ol>
<li class="cr">Server-side TLS session caching: added the possibility to pass an SSL context to an accepted TLS socket. This allows the accepted socket to add its SSL session to the server's session cache.</li>
<li class="cr">Client-side TLS session caching: added the use of the CTlsSession member to set an SSL session on the SSL socket. This allows the client socket to reuse the session ID of a previous connection.</li>
<li class="cr">Added a session ID accessor on CTlsSession.</li>
</ol>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Client-side TLS session caching has always been the application's responsibility. This means the application needs to store the CTlsSession object received in IAsyncTlsSocketMgr::EvAsyncTlsSocketMgrNewTlsSession and call CAsyncTlsSocket::SetTlsSession. It has to be done prior to CAsyncTlsSocket::ConnectA, in order for the ClientHello to contain the correct SSL session's ID.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
CTlsSession::GetId and CAsyncTlsSocket::AcceptInitialize docuemntation has been updated.
</p>

</div>
<br><a name="CR19757"><div class="synopsis" id="CR19757_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19757')">CR#19757</a> :</b> It should be possible to have a XML element with attributes and a value.
</div>
<div class="detail" id="CR19757_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19757')">CR#19757</a> :</b> It should be possible to have a XML element with attributes and a value.
<h4>Description</h4>
<p class="cr">
At the moment, XML only allows these types of elements:
</p>

<ul>
<li class="cr">&lt;text&gt;This is a nice text&lt;/text&gt;  (element with a value)</li>
<li class="cr">&lt;text font="Arial"&gt;&lt;/text&gt;  (element with one or more attributes)</li>
</ul>

<p class="cr">
But the following does not work and is necessary:
</p>

<ul>
<li class="cr">&lt;text font="Arial"&gt;This is a nice text&lt;/text&gt;  (element with a value AND one or more attributes)</li>
</ul>
<h4>Solution</h4>
<p class="cr">
Added a new parameter to the EndElementAttribute, which represents the value of the element. By default this parameter is NULL.
</p>
<p class="cr">
Removed two unnecessary asserts in CXmlParser.cpp.
</p>
</div>
<br><a name="CR19801"><div class="synopsis" id="CR19801_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19801')">CR#19801</a> :</b> Implement SetSockOptBlocking for Symbian. 
</div>
<div class="detail" id="CR19801_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19801')">CR#19801</a> :</b> Implement SetSockOptBlocking for Symbian. 
<h4>Description</h4>
<p class="cr">
Support of SetSockOptBlocking is required for pkg_RtpStack on Symbian OS.
</p>
<h4>Solution</h4>
<p class="cr">
Implemented SetSockOptBlocking on Symbian OS. The method CUdpSocket::Recv will now return resFE_MITOSFW_NET_SOCK_WOULDBLOCK if SetSockOptBlocking(false) has been called on the socket. The behaviour is now similar to the one on the other OSes.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Symbian UDP sockets can be blocking or non-blocking. CUdpSocket::Recv will now return resFE_MITOSFW_NET_SOCK_WOULDBLOCK if SetSockOptBlocking(false) has been called on the socket and there is no data to receive instead of blocking.
</p>

</div>
<br><a name="CR20297"><div class="synopsis" id="CR20297_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20297')">CR#20297</a> :</b> Add support for CRC-32C.
</div>
<div class="detail" id="CR20297_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20297')">CR#20297</a> :</b> Add support for CRC-32C.
<h4>Description</h4>
<p class="cr">
The support of the CRC-32C algorithm (Castagnoli) as per RFC 3309 needs to be added to the M5T Framework because it is required in other M5T products.
</p>
<h4>Solution</h4>
<p class="cr">
An implementation of the CRC-32C algorithm has been made available in the M5T Framework. In order to select this algorithm, you need to use the CCrc::eCRC32C CRC type when calling the CCrc::Begin method.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The CCrc::eCRC32C value has been added to the CCrc::ECrcType enum.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The API reference document has been updated to document the new CCrc::eCRC32C enumeration value.
</p>

</div>
<br><a name="CR19829"><div class="synopsis" id="CR19829_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19829')">CR#19829</a> :</b> Add support for the HMAC SHA-2 hashing algorithm.
</div>
<div class="detail" id="CR19829_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19829')">CR#19829</a> :</b> Add support for the HMAC SHA-2 hashing algorithm.
<h4>Description</h4>
<p class="cr">
The support of the HMAC-SHA-2 (256 bits) hashing algorithm as per RFC 4634 needs to be added to the M5T Framework.
</p>
<h4>Solution</h4>
<p class="cr">
An implementation of the HMAC-SHA-2 algorithm has been made available in the M5T Framework. Since the HMAC algorithm is the same for all hash functions (HMAC-MD5, HMAC-SHA-1, HMAC-SHA-2), a common implementation has been made. An implementation based on the OpenSSL library is also available.
</p>
<p class="cr">
Note that the HMAC-SHA-2 algorithm has four versions: 224, 256, 384, 512 bits. As of now only the 256 bits version is implemented both directly in the Framework and based on the OpenSSL library.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
New macros have been added to support HMAC-SHA-2 (at least one of them MUST be defined for the Framework to compile properly):
</p>
<ul>
<li class="cr">MXD_CRYPTO_SHA2MAC_NONE: Specifies that no HMAC SHA-2 implementation is used. HMAC SHA-2 is not compiled when this macro is defined.</li>
<li class="cr">MXD_CRYPTO_SHA2MAC_MITOSFW: Specifies that the implementation of HMAC SHA-2 of the M5T Framework is used.</li>
<li class="cr">MXD_CRYPTO_SHA2MAC_OPENSSL: Specifies that the implementation of HMAC SHA-2 based on the OpenSSL library is used.</li>
<li class="cr">MXD_CRYPTO_SHA2MAC_OVERRIDE: Specifies to use a user-defined implementation of HMAC SHA-2 by using the overloading mechanism.</li>
<li class="cr">MXD_CRYPTO_SHA2MAC_INCLUDE: Specifies the location of the header file when overriding the HMAC SHA-2 algorithm.</li>
<li class="cr">MXD_CRYPTO_SHA2MAC_CLASSNAME: Specifies the name of the class used when overriding the HMAC SHA-2 algorithm.</li>
</ul>
<p class="cr">
A CSha2Mac class has been added to use the HMAC-SHA-2 hashing algorithm.
</p>
<p class="cr">
The CHMac::Begin method now takes a new parameter to specify which hashing algorithm to use. It defaults to CHMac::eALGORITHM_DEFAULT so calls to CHMac::Begin that omit the new parameter will work the same.
</p>

</div>
<br><a name="CR19776"><div class="synopsis" id="CR19776_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19776')">CR#19776</a> :</b> Add support for the SHA-256 algorithm.
</div>
<div class="detail" id="CR19776_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19776')">CR#19776</a> :</b> Add support for the SHA-256 algorithm.
<h4>Description</h4>
<p class="cr">
The support of the SHA-2 (256 bits) hashing algorithm as per RFC 4634 needs to be added to the M5T Framework.
</p>
<h4>Solution</h4>
<p class="cr">
An implementation of the SHA-2 algorithm has been made available in the M5T Framework. Like the other hashing algorithms, the CSha2 class inherits from CHash and it is possible to override it with a user-defined implementation. Note that the SHA-2 algorithm defines four digest bit lengths (i.e. 224, 256, 384 and, 512 bits) but only the 256 bits flavor is currently implemented in both the M5T Framework and OpenSsl based versions.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
New macros have been added to support SHA-2 (at least one of them MUST be defined for the framework to compile properly):
</p>
<ul>
<li class="cr">MXD_CRYPTO_SHA2_NONE: Specifies that no SHA-2 implementation will be used. SHA-2 is not compiled when this macro is defined.</li>
<li class="cr">MXD_CRYPTO_SHA2_MITOSFW: Specifies that the implementation of SHA-2 of the M5T Framework will be used.</li>
<li class="cr">MXD_CRYPTO_SHA2_OPENSSL: Specifies that the implementation of SHA-2 based on the OpenSsl library will be used.</li>
<li class="cr">MXD_CRYPTO_SHA2_OVERRIDE: Specifies to use a user-defined implementation of SHA-2 by using the overloading mechanism.</li>
<li class="cr">MXD_CRYPTO_SHA2_INCLUDE: Specifies the location of the header file when overriding the SHA-2 algorithm.</li>
<li class="cr">MXD_CRYPTO_SHA2_CLASSNAME: Specifies the name of the class used when overriding the SHA-2 algorithm.</li>
</ul>
<p class="cr">
A CSha2 class has been added to use the SHA-256 hashing algorithm.
</p>
<p class="cr">
The CHash::Begin method now takes a parameter specifying the hashing algorithm to use. This parameter defaults to CHash::eALGORITHM_DEFAULT.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The API reference document has been updated to document the new configuration macros.
</p>

</div>
<br><a name="CR19652"><div class="synopsis" id="CR19652_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19652')">CR#19652 (Incident 2001)</a> :</b> Add ZRTP to the package list.
</div>
<div class="detail" id="CR19652_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19652')">CR#19652 (Incident 2001)</a> :</b> Add ZRTP to the package list.
<h4>Description</h4>
<p class="cr">
ZRTP needs to be added to the M5T Framework's package list to make it possible, for example, to associate a trace with that package.
</p>
<h4>Solution</h4>
<p class="cr">
eMX_PKG_ZRTP has been added to the EMxPackageId enumeration in the M5T Framework.
</p>
</div>
<br><a name="CR20355"><div class="synopsis" id="CR20355_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20355')">CR#20355</a> :</b> Tracing level should be outputted in each trace.
</div>
<div class="detail" id="CR20355_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20355')">CR#20355</a> :</b> Tracing level should be outputted in each trace.
<h4>Description</h4>
<p class="cr">
A tracing field reperesenting the trace level is needed in traces since the syslog PRI field shows the same value for trace level 7,8,9.
</p>
<h4>Solution</h4>
<p class="cr">
The default format handler has been modified to store the tracing level at position &lt;04&gt; of each trace. Other fields have been shifted right by one position.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
The trace format has been modified. The tracing level has been inserted at position &lt;04&gt;. The existing fields have been shifted to the right. By default, the tracing level is enabled and it will be outputted in traces.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
A new field type has been added in MxTrace: eMXTFIELD_TRACINGLEVEL. This enum value can be used to enable or disable the printing of the field in traces.
</p>

</div>
<br><a name="CR20546"><div class="synopsis" id="CR20546_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20546')">CR#20546 (Incident 1641)</a> :</b> Implement asynchronous socket modifications to allow TLS renegotiation.
</div>
<div class="detail" id="CR20546_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20546')">CR#20546 (Incident 1641)</a> :</b> Implement asynchronous socket modifications to allow TLS renegotiation.
<h4>Description</h4>
<p class="cr">
This CR adds the possibility to change the credentials used on any TLS connection (existing or upcoming) and the possibility to start a renegotiation manually on any existing TLS connection.
</p>
<p class="cr">
To achieve this, numerous modifications must be made to various parts of the Network and Tls folders. Briefly:
<ol>
<li class="cr">The asynchronous socket factory needs to be modified to keep a list of sockets it created and set the socket type of created sockets.</li>
<li class="cr">The asynchronous server sockets must use the socket factory to create the accepted sockets. This will ensure that the accepted sockets are available in the factory's socket list.</li>
<li class="cr">The user must be able to access the factory's socket list.</li>
<li class="cr">The user must be able to set and retrieve custom information in the sockets to identify the connections of interest to him.</li>
<li class="cr">The user must be able to get the type of the socket he retrieved from the factory's list.</li>
</ol>
</p>
<h4>Solution</h4>
<p class="cr">
To solve point #1 and #3 of the description, the CAsyncSocketFactory class has been augmented with three new static methods and the IAsyncSocket interface has been augmented with one method.
<ul>
<li class="cr">CAsyncSocketFactory::AddSocketToFactoryList: Only for internal use, it adds a socket to the list after its creation.</li>
<li class="cr">CAsyncSocketFactory::RemoveSocketFromFactoryList: Mostly for internal use, but will be used by users who implement custom socket types.</li>
<li class="cr">CAsyncSocketFactory::GetSocketList: The method that is really useful to the user. It copies the list of sockets to the one provided as a parameter. Note that the returned list is only a snapshot of the real list, the list will get modified over time and one should not keep its copy for a long time in order to always access the most recent snapshot.</li>
<li class="cr">IAsyncSocket::SetSocketType: Allows the socket factory or server socket to change the type information of the socket. All asynchronous socket classes have been modified to implement this method. This method only changes internal information and does not actually modify the network behaviour. For example, setting the socket type information to TCP will not make a CAsyncUdpSocket behave like a TCP socket.</li>
</ul>
</p>
<p class="cr">
To solve point #2 of the description, the CAsyncTcpServerSocket and the CAsyncTlsServerSocket classes connection acceptation process have been revised to use the socket factory instead of creating the CAsyncTcpSocket or CAsyncTlsSocket instance manually, with CreateEComInstance. These classes have also been modified to derive a socket type information from the server socket type information and change the "m=" parameter to "accepted" before setting this modified socket type information in the accepted socket.
</p>
<p class="cr">
A possible race condition in the connection acceptation process of the CAsyncTlsServerSocket has been identified and fixed during the modifications of the server socket's connection acceptation process. This race condition fix required changes in the IPrivateAsyncTlsSocket interface and the CAsyncTlsSocket class as well. This is only mentioned for CR documentation completeness.
</p>
<p class="cr">
To solve points #4 and #5 of the description, the IAsyncSocket interface has been augmented with the methods listed below. Furthermore, all asynchronous socket classes have been modified to implement these new methods.
<ul>
<li class="cr">IAsyncSocket::GetSocketType(OUT unsigned int*)</li>
<li class="cr">IAsyncSocket::EraseAllUserInfo</li>
<li class="cr">IAsyncSocket::EraseUserInfo</li>
<li class="cr">IAsyncSocket::GetUserInfo</li>
<li class="cr">IAsyncSocket::InsertUserInfo</li>
</ul>
</p>
<p class="cr">
The addition of IAsyncSocket::GetSocketType renders the apszType parameter of CAsyncSocketFactory::CallConfigurationMgr obsolete. The CAsyncSocketFactory::CallConfigurationMgr has been modified to make use of that new method.
</p>
<p class="cr">
In all modifications cases cited above, the related documentation has been adapted to the changes. The user should review the new documentation for the modified classes and interfaces in the API reference document.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The IAsyncSocket interface has been augmented with the following methods:
<ul>
<li class="cr">IAsyncSocket::SetSocketType</li>
<li class="cr">IAsyncSocket::GetSocketType(OUT unsigned int*)</li>
<li class="cr">IAsyncSocket::EraseAllUserInfo</li>
<li class="cr">IAsyncSocket::EraseUserInfo</li>
<li class="cr">IAsyncSocket::GetUserInfo</li>
<li class="cr">IAsyncSocket::InsertUserInfo</li>
</ul>
</p>
<p class="cr">
The CAsyncSocketFactory has been augmented with the following methods:
<ul>
<li class="cr">CAsyncSocketFactory::AddSocketToFactoryList</li>
<li class="cr">CAsyncSocketFactory::RemoveSocketFromFactoryList</li>
<li class="cr">CAsyncSocketFactory::GetSocketList</li>
</ul>
</p>
<p class="cr">
The CAsyncSocketFactory::CallConfigurationMgr method has been modified to make use of the new IAsyncSocket::GetSocketType method.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The API reference document has been updated to reflect the modifications of this CR.
</p>

</div>
<br><a name="CR20553"><div class="synopsis" id="CR20553_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20553')">CR#20553</a> :</b> Add stubbing of PKI.
</div>
<div class="detail" id="CR20553_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20553')">CR#20553</a> :</b> Add stubbing of PKI.
<h4>Description</h4>
<p class="cr">
The classes CCertificate, CCertificateChain, CCertificateChainValidation, CCertificateExtension, CCertificateIssuer, and CCertificateSubject need to be stubbed to allow their use with either OpenSSL or MocanaSS.
</p>
<h4>Solution</h4>
<p class="cr">
MXD_PKI_MOCANA_SS needs to be defined in PreFrameworkCfg.h in order to activate PKI with the Mocana SS stack.
MXD_PKI_OPENSSL needs to be defined in PreFrameworkCfg.h in order to activate PKI with the OpenSSL stack. Only one PKI stack can be used at the same time. The two defines must not be declared at the same time.
MXD_PKI_ENABLE_SUPPORT is no longer used,  MXD_PKI_MOCANA_SS or MXD_PKI_OPENSSL can be used instead.
</p>
<p class="cr">
The class CCertificate has been modified to support either Mocana SS or OpenSSL through inclusion and use of the proper base class.  The CCertificate base class can be either CCertificateOpenSsl or CCertificateMocanaSs.
The class CCertificateChain has been modified to support either Mocana SS or OpenSSL through inclusion and use of the proper base class.  The CCertificateChain base class can be either CCertificateChainOpenSsl or CCertificateChainMocanaSs.
The class CCertificateChainValidation has been modified to support either Mocana SS or OpenSSL through inclusion and use of the proper base class.  The CCertificateChainValidation base class can be either CCertificateChainValidationOpenSsl or CCertificateChainValidationMocanaSs.
The class CCertificateExtension has been modified to support either Mocana SS or OpenSSL through inclusion and use of the proper base class.  The CCertificateExtension base class can be either CCertificateExtensionOpenSsl or CCertificateExtensionMocanaSs.
The class CCertificateIssuer has been modified to support either Mocana SS or OpenSSL through inclusion and use of the proper base class.  The CCertificateIssuer base class can be either CCertificateIssuerOpenSsl or CCertificateIssuerMocanaSs.
The class CCertificateSubject has been modified to support either Mocana SS or OpenSSL through inclusion and use of the proper base class.  The CCertificateSubject base class can be either CCertificateSubjectOpenSsl or CCertificateSubjectMocanaSs.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
MXD_PKI_MOCANA_SS is now documented in FrameworkCfg.h.
MXD_PKI_OPENSSL is now documented in FrameworkCfg.h.
</p>

</div>
<br><a name="CR20564"><div class="synopsis" id="CR20564_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20564')">CR#20564</a> :</b> Need to split TLS socket code to support multiple implementation.
</div>
<div class="detail" id="CR20564_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20564')">CR#20564</a> :</b> Need to split TLS socket code to support multiple implementation.
<h4>Description</h4>
<p class="cr">
TLS sockets need to be split in a way that it will be possible to use TLS sockets with OpenSsl or MocanaSs.
</p>
<h4>Solution</h4>
<p class="cr">
MXD_TLS_MOCANA_SS needs to be defined in PreFrameworkCfg.h in order to activate TLS sockets with the Mocana SS stack. MXD_TLS_ENABLE_SUPPORT has been renamed MXD_TLS_OPENSSL and must be defined at the same place in order to activate TLS sockets with the OpenSsl stack. Only one TLS stack can be used at the same time. The two defines must not be declared at the same time.
</p>
<p class="cr">
CAsyncTlsServerSocket and CAsyncTlsServerSocket have been split in two different TLS implementations. For each one there is a common base class. For example, CAsyncTlsServerSocket has now been split into CAsyncTlsServerSocketBase.cpp, CAsyncTlsServerSocketOpenSsl, and CAsyncTlsServerSocketMocanaSs. Depending on which define is present, one or the other implementation will be used when a TLS socket is created. All code that was referring to CT TLS has been removed from the sources. Since sockets are now using the ECOM mechanism, there is nothing to change for the user. Depending of which define is used, one or the other socket implementation will be used but it will be completely transparent since the same CLSID must be used when creating the socket.
</p>
<p class="cr">
CTls now inherits from CTlsMocanaSs of CTlsOpenSsl depending on which TLS stack is enabled.
</p>
<p class="cr">
CTlsSession now inherits from CTlsSessionMocanaSs of CTlsSessionOpenSsl depending on which TLS stack is enabled.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
MXD_TLS_MOCANA_SS is now documented in Framework.h. MXD_TLS_ENABLE_SUPPORT has been renamed MXD_TLS_OPENSSL in the documentation of Framework.h.
</p>

</div>
<br><a name="CR20655"><div class="synopsis" id="CR20655_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20655')">CR#20655</a> :</b> Implement CPublicKey for Mocana SS.
</div>
<div class="detail" id="CR20655_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20655')">CR#20655</a> :</b> Implement CPublicKey for Mocana SS.
<h4>Description</h4>
<p class="cr">
Implement CPublicKeyMocanaSs with the functionality provided by the Mocana SS library.
</p>
<h4>Solution</h4>
<p class="cr">
<ul>
<li class="cr">The class CPublicKeyMocanaSs now provides its intended functionality by using the Mocana SS library.</li>
<li class="cr">The Store, StoreDer, and StorePem functions have not been implemented.</li>
<li class="cr">The SetKey and GetKey functions have been provided to allow easy access to the internal key structure attribute member.</li>
</ul>
</p>
</div>
<br><a name="CR20685"><div class="synopsis" id="CR20685_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20685')">CR#20685</a> :</b> Integrate Mocana TLS implementation.
</div>
<div class="detail" id="CR20685_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20685')">CR#20685</a> :</b> Integrate Mocana TLS implementation.
<h4>Description</h4>
<p class="cr">
The TLS sockets need to be capable of using the Mocana SS implementation of the TLS protocol.
</p>
<h4>Solution</h4>
<p class="cr">
When MXD_TLS_MOCANA_SS is defined, the implementation of the Mocana SS library is used. Take note that MXD_PKI_MOCANA_SS must also be defined. The following are the implementation notes of the Mocana library integration:
<ul>
<li class="cr">the Mocana stack is used in its asynchronous mode. Therefore, SSL_ASYNC_init needs to be called. If MXD_TLS_MOCANA_SS_INIT_STACK is defined, then the Framework will start up and shut down the asynchronism mechanism of the library, using the values defined by MXD_TLS_MOCANA_SS_MAX_CLIENT_CONNECTIONS and MXD_TLS_MOCANA_SS_MAX_SERVER_CONNECTIONS</li>
<li class="cr">the Framework defines MOC_TCP_WRITE to be able to use its TCP socket implementation. Therefore, the Mocana library has been built using __MOCANA_IPSTACK__</li>
<li class="cr">the ciphersuites offered in the ClientHello are dynamically set by the Framework and are limited to TLS_RSA_WITH_AES_256_CBC_SHA and TLS_RSA_WITH_AES_128_CBC_SHA</li>
<li class="cr">alerts are sent and managed by the Framework. It sends a close_notify alert when closing the connection</li>
<li class="cr">the certificate validation is still left to the application. The Framework implemented the necessary callbacks to retrieve the certificates and on the client side, it fills a certficate chain. When the handshake is completed, it notifies the application through EvAsyncTlsSocketMgrTlsHandshakingCompletedAwaitingApproval. If the application disapproves the authentication, the Framework sends a certificate_unknown fatal alert and resets the TCP connection</li>
<li class="cr">session caching is supported</li>
<li class="cr">limited support for mutual authentication is provided</li>
<li class="cr">the application can use different certificates for different services. The certificate chain is set in the CTlsContext and the latter is set on the TLS server socket</li>
<li class="cr">the Mocanca library tracing mechanism is integrated in the Framework's, using __ENABLE_CUSTOM_DEBUG_CONSOLE_DEFS__ in debug builds. A specific node is assigned ot the Mocana library, under /Framework/Crypto/Mocana</li>
<li class="cr">the Mocana memory debugger is enabled</li>
</ul>
</p>
<p class="cr">
The following are the mandatory flags to use the Framework with the Mocana SS library:
<ul>
<li class="cr">__ENABLE_MOCANA_SSL_ALERTS__: to send and receive alerts</li>
<li class="cr">__ENABLE_MOCANA_SSL_ASYNC_CLIENT_API__: to use the library's client-side asynchronous mechanism</li>
<li class="cr">__ENABLE_MOCANA_SSL_ASYNC_SERVER_API__: to use the library's server-side asynchronous mechanism</li>
<li class="cr">__ENABLE_MOCANA_SSL_MUTUAL_AUTH_SUPPORT__: to enable the mutual authentication at compile-time. It has to be activated dynamically in the CTlsContext class</li>
<li class="cr">__ENABLE_SSL_DYNAMIC_CERTIFICATE__: to provide the Mocana library with the server certificate at run-time</li>
<li class="cr">__ENABLE_MOCANA_DEBUG_MEMORY__: when building in debug configuration, to use the Mocana memory debugger</li>
<li class="cr">__RTOS_LINUX__, __RTOS_WIN32__, or __RTOS_VXWORS__: to allow application to perform SSL_ASYNC_connect and SSL_ASYNC_start independently of the Framework</li>
</ul>
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
There are two significant differences between the TLS socket implementation using the Mocana library, versus the OpenSSL library:
<ul>
<li class="cr">close_notify alerts are sent by the Framework</li>
<li class="cr">validation of the peer certificate chain is done when the handshake is completed. If the application rejects it, the Framework sends a certificate_unknown fatal alert</li>
</ul>
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
section 2.5.1 of the API reference has been updated with the documentation regarding the Mocana asynchronous mechanism start-up and shutdown.
</p>

</div>
<br><a name="CR20731"><div class="synopsis" id="CR20731_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20731')">CR#20731</a> :</b> Integrate Mocana PKI implementation.
</div>
<div class="detail" id="CR20731_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20731')">CR#20731</a> :</b> Integrate Mocana PKI implementation.
<h4>Description</h4>
<p class="cr">
Continue implementation of CCertificateMocanaSs by adding extension, issuer and subject basic functionality and by completing the CCertificateChainMocanaSs and CCertificateChainValidationMocanaSs classes.
</p>
<h4>Solution</h4>
<p class="cr">
When MXD_PKI_MOCANA_SS is defined, the Framework PKI implementation uses the Mocana SS library. Take note that MXD_CRYPTO_ALL_MOCANA_SS must also be defined. The following are the modifications performed to the Framework PKI to support the Mocana SS library:
<ul>
<li class="cr">The certDescriptor structure provided by Mocana has been encapsulated in a reference counting class named CCertificateDescriptorMocanaSs.</li>
<li class="cr">The class CCertificateChainMocanaSs and CCertificateChainOpenSsl have been regrouped under the same base class where most of the logic previously located in CCertificateChainOpenSsl has been moved.  The created base class is CCertificateChainBase.</li>
<li class="cr">The class CCertificateChainValidationMocanaSs and CCertificateChainValidationOpenSsl have been regrouped under the same base class where most of the logic previously located in CCertificateChainValidationOpenSsl has been moved.  The created base class is CCertificateChainValidationBase.</li>
<li class="cr">The functions SetRelativeNames and GetName of CCertificateSubjectMocanaSs have been implemented.</li>
<li class="cr">The functions SetRelativeNames and GetName of CCertificateIssuerMocanaSs have been implemented.</li>
<li class="cr">The functions GetTypes, Initialize, and FindExtension of CCertificateExtensionMocanaSs have been implemented.</li>
<li class="cr">Most of the CCertificateMocanaSs class has been implemented.  More complete extensions support is yet to come.</li>
</ul>
</p>
<p class="cr">
The following flag must be activated to use the Framework PKI with the Mocana SS library:
<ul>
<li class="cr">__ENABLE_MOCANA_CERTIFICATE_SEARCH_SUPPORT__: for certificates parsing utilities.</li>
</ul>
</p>
</div>
<br><a name="CR20787"><div class="synopsis" id="CR20787_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20787')">CR#20787 (Incident 2519)</a> :</b> Call Stack Trace for all supported versions of VxWorks.
</div>
<div class="detail" id="CR20787_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20787')">CR#20787 (Incident 2519)</a> :</b> Call Stack Trace for all supported versions of VxWorks.
<h4>Description</h4>
<p class="cr">
The current implementation for tracing a callstack does not support all versions of VxWorks. Implement a mechanism to trace a callstack with all supported versions of VxWorks.
</p>
<h4>Solution</h4>
<p class="cr">
Coded a new implementation that uses the trcStack() method to trace a call stack, trcStack() is supported on all versions of VxWorks.
</p>
</div>
<br><a name="CR20944"><div class="synopsis" id="CR20944_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20944')">CR#20944</a> :</b> Integrate Mocana X.509 certificate extentions implementation. 
</div>
<div class="detail" id="CR20944_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20944')">CR#20944</a> :</b> Integrate Mocana X.509 certificate extentions implementation. 
<h4>Description</h4>
<p class="cr">
Integrate implementation of certificate extensions for Mocana.
</p>
<h4>Solution</h4>
<p class="cr">
When MXD_PKI_MOCANA_SS is defined, the Framework PKI certificate extension implementation uses the Mocana SS library. The following modifications have been performed to the Framework PKI:
<ul>
<li class="cr">The following classes have been stubbed to allow compilation for either OpenSSL or Mocana SS: CSubjectKeyIdentifier, CKeyUsage, CExtendedKeyUsage, CBasicConstraints, CAuthorityKeyIdentifier, CAlternateName.</li>
<li class="cr">The following classes have been provided for use with Open SSl: CSubjectKeyIdentifierOpenSsl, CKeyUsageOpenSsl, CExtendedKeyUsageOpenSsl, CBasicConstraintsOpenSsl, CAuthorityKeyIdentifierOpenSsl, CAlternateNameOpenSsl.</li>
<li class="cr">The following classes have been provided for use with Mocana SS: CSubjectKeyIdentifierMocanaSs, CKeyUsageMocanaSs, CExtendedKeyUsageMocanaSs, CBasicConstraintsMocanaSs, CAuthorityKeyIdentifierMocanaSs, CAlternateNameMocanaSs.</li>
<li class="cr">The class CCertificateExtensionMocanaSs has been modified to add a comparaison operator, and some utility functions used by derived extension classes.</li>
<li class="cr">The file FrameworkCfg.h has been modified to define the include file locations required by the newly stubbed extension classes.</li>
</ul>
</p>
</div>
<br><a name="CR21016"><div class="synopsis" id="CR21016_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21016')">CR#21016</a> :</b> Provide implementation for CertificateMocanaSs::StoreDer.
</div>
<div class="detail" id="CR21016_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21016')">CR#21016</a> :</b> Provide implementation for CertificateMocanaSs::StoreDer.
<h4>Description</h4>
<p class="cr">
Provide implementation for CCertificateMocanaSs::StoreDer.
</p>
<h4>Solution</h4>
<p class="cr">
In CCertificateMocanaSs::StoreDer; we verify if the attribute pCertDescriptorCounted and its member attribute m_blobCertificateDer are valid and if these verifications are correct we returned m_blobCertificateDer.
</p>
</div>
<br><a name="CR21028"><div class="synopsis" id="CR21028_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21028')">CR#21028 (Incident 2824)</a> :</b> CSocketAddr must parse IPv6 address even if not supported by the OS.
</div>
<div class="detail" id="CR21028_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21028')">CR#21028 (Incident 2824)</a> :</b> CSocketAddr must parse IPv6 address even if not supported by the OS.
<h4>Description</h4>
<p class="cr">
IPv6 address must be parsed by CSocketAddr even if the OS does not support IPv6 address.
</p>
<h4>Solution</h4>
<p class="cr">
Data members have been added to CSocketAddr to contain the IP address, the port, the family, and the scope ID. An OS specific structure is generated when one of these data is changed. The structure is then used in a different call to OS method like bind or connect via the cast operator of CSocketAddr. Some of the calls to the OS methods can change the structure. Hence, when a socket uses the cast operators of the CSocketAddr class, it regenerates the corresponding data members based on the OS specific structure that has potentially been modified through the cast.
</p>
<p class="cr">
Parsing and generation of IPv6 address are now completely done in CSocketAddr with portable code that does not rely on any OS methods.
</p>
<p class="cr">
IsInet6AddressUnspecified, IsInet6AddressLoopback, IsInet6AddressMulticast, IsInet6AddressLinkLocal, IsInet6AddressSiteLocal, IsInet6AddressV4Mapped, IsInet6AddressGlobal and IsInet6AddressUniqueLocal have been rewritten with portable code and no longer rely on OS methods.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
All IPv6 specific methods are now available on CSocketAddr even if it's not supported by the OS. An IPv6 address will now be successfully parsed without having to rely on the OS support of IPv6.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
CSocketAddr::EAddressFamily now always defines eINET6. CSocketAddr::EStandardAddress now always defines eINET6_ANY and eINET6_LOOPBACK.
</p>
<p class="cr">
CSocketAddr::IsEqualScopeId, IsInet6AddressUnspecified, IsInet6AddressLoopback, IsInet6AddressMulticast, IsInet6AddressLinkLocal, IsInet6AddressSiteLocal, IsInet6AddressV4Mapped, IsInet6AddressGlobal, IsInet6AddressUniqueLocal, IsEqualScope, SetScopeId, GetScopeId, and Inet6AnyAddress are now available even if MXD_IPV6_ENABLE_SUPPORT is not defined.
</p>

</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR17008"><div class="synopsis" id="CR17008_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17008')">CR#17008</a> :</b> A few warnings appear when compiling the "Aes" folder of the Framework package.
</div>
<div class="detail" id="CR17008_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17008')">CR#17008</a> :</b> A few warnings appear when compiling the "Aes" folder of the Framework package.
<h4>Description</h4>
<p class="cr">
A few warnings occur when compiling the "Aes" folder of the Framework 2.1 package.
</p>
<h4>Solution</h4>
<p class="cr">
The problem occurs because the declarations of "_lrotl" and "_lrotr" are missing.  Since a macro definition in aes_locl.h uses them, they need to be declared beforehand.  This is  fixed by adding the standard "Config/MxConfig.h" include file. Also, "#define assert(cond)" lines are now under MXD_DISABLE_EXTERNAL_ASSERT_OVERRIDE scope to prevent potential macro collision.
</p>
</div>
<br><a name="CR17227"><div class="synopsis" id="CR17227_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17227')">CR#17227</a> :</b> Seeding process is incorrect in CCrypto::Initialize.
</div>
<div class="detail" id="CR17227_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17227')">CR#17227</a> :</b> Seeding process is incorrect in CCrypto::Initialize.
<h4>Description</h4>
<ol>
<li class="cr">
The mutex and initialization count must always be available, not only for MXD_CRYPTO_USE_ENGINE_OPENSSL.
</li>
<li class="cr">
Call to CSecurePrng::Generate must be made systematically when the following condition is true: #if !defined(MXD_CRYPTO_SECUREPRNG_NONE).
</li>
<li class="cr">When #if defined(MXD_CRYPTO_USE_ENGINE_OPENSSL) is true, Rand_seed must be called only if this condition was true: #if !defined(MXD_CRYPTO_SECUREPRNG_NONE).
</li>
</ol>
<h4>Solution</h4>
<p class="cr">
Modified the CCrypto::Initialize() method to match the specified requirements.
</p>
</div>
<br><a name="CR17157"><div class="synopsis" id="CR17157_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17157')">CR#17157 (Incident 1165)</a> :</b> Alignment problem on ARM and Nucleus. May occur with other architecture.
</div>
<div class="detail" id="CR17157_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17157')">CR#17157 (Incident 1165)</a> :</b> Alignment problem on ARM and Nucleus. May occur with other architecture.
<h4>Description</h4>
<p class="cr">
A byte array is often used to instantiate an object using the placement new command. On most platforms (CPU architecture + tool chain), the byte arrays are aligned on byte boundary. If the instantiated object in this array has a member that requires a different alignment (such as a pointer), a crash, an exception, or a bus error may occur when accessing this pointer. Note that some hardware architectures do support unaligned accesses.
</p>
<p class="cr">
For instance, let's take a structure defined with two byte arrays with he size of the first array being 2 bytes and the size of the second being 4 bytes. If the structure is instantiated at address = 0, the first byte array is at address 0 and the second at address 2. If this second byte array contains a four bytes pointer, when it will be accessed using a pointer type, it may crash because the memory access is not aligned on its type size boundary.
</p>
<h4>Solution</h4>
<p class="cr">
All bytes arrays used to instanciate objects are now aligned on uint32_t boundary (uint64_t for Solaris because void* is 32-bit and does not guarantee correct alignment). To ease handling this alignment, the CAlignedVariableStorage class template has been added to the FW and used in all FW classes to force alignment when required.
</p>
</div>
<br><a name="CR17944"><div class="synopsis" id="CR17944_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17944')">CR#17944</a> :</b> The GetEnumUri function crash unless it support a NULL pszZone parameter.
</div>
<div class="detail" id="CR17944_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17944')">CR#17944</a> :</b> The GetEnumUri function crash unless it support a NULL pszZone parameter.
<h4>Description</h4>
<p class="cr">
The GetEnumUri function documentation states that the pszZone parameter can be NULL, in which case the default value (i.e. "e164.arpa") will be used. Yet, passing NULL in that parameter causes a crash. The pszZone parameter defaults to "e164.arpa" when omitted but there is no check in the function for the NULL value.
</p>
<h4>Solution</h4>
<p class="cr">
Since the documentation is already stating that if the parameter is NULL, the default value will be used, the fix is simply to default the pszZone parameter to NULL and check for NULL in the function. When the parameter is NULL, it is assigned g_szENUM_DEFAULT_ZONE.
</p>
</div>
<br><a name="CR17637"><div class="synopsis" id="CR17637_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17637')">CR#17637 (Incident 1330)</a> :</b> DNS cache will negatively cache a query when no network under windows. 
</div>
<div class="detail" id="CR17637_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17637')">CR#17637 (Incident 1330)</a> :</b> DNS cache will negatively cache a query when no network under windows. 
<h4>Description</h4>
<p class="cr">
The negative caching implemented in ResolverCache.cpp peforms negative caching even when network error codes are returned (versus DNS negative answers), e.g., when the cable is unplugged prior to sending the request. This is valid for all operating systems.
</p>
<h4>Solution</h4>
<p class="cr">
Additional checks have been added, depending on the operating system, to validate that the error returned by the system call is consequent of a negative response from the DNS server.
</p>
<p class="cr">
Hence, caching is only made on these error codes:
</p>
<ol>
<li class="cr"> Windows:
<ol>
<li class="cr">DNS_ERROR_RCODE_NO_ERROR</li>
<li class="cr">DNS_ERROR_RCODE_NAME_ERROR</li>
<li class="cr">DNS_ERROR_RCODE_YXDOMAIN</li>
<li class="cr">DNS_ERROR_RCODE_YXRRSET</li>
<li class="cr">DNS_ERROR_RCODE_NXRRSET</li>
<li class="cr">DNS_ERROR_TRY_AGAIN_LATER</li>
</ol>
</li>
<li class="cr"> Linux:
<ol>
<li class="cr">NETDB_SUCCESS</li>
<li class="cr">HOST_NOT_FOUND</li>
<li class="cr">TRY_AGAIN</li>
<li class="cr">NO_DATA</li>
<li class="cr">NO_ADDRESS</li>
</ol>
</li>
<li class="cr"> VxWorks:
<ol>
<li class="cr">S_resolvLib_HOST_NOT_FOUND</li>
<li class="cr">S_resolvLib_TRY_AGAIN</li>
<li class="cr">S_resolvLib_NO_DATA</li>
</ol>
</li>
<li class="cr">
    Portable resolver:
<ol>
<li class="cr">uRESOLVER_RCODE_NO_ERROR</li>
<li class="cr">uRESOLVER_RCODE_NAME_ERROR</li>
<li class="cr">uRESOLVER_RCODE_NOT_IMPLEMENTED</li>
<li class="cr">uRESOLVER_RCODE_REFUSED</li>
<li class="cr">uRESOLVER_NO_ERROR</li>
<li class="cr">uRESOLVER_DELEGATION_DETECTED</li>
<li class="cr">uRESOLVER_CNAME_DETECTED</li>
</ol>
</li>
</ol>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
DNS negative caching is performed only when receiving negative responses from DNS servers. This excludes, for example, network or DNS servers being down.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
Added documentation for IsAnswerValidForCaching.
</p>

</div>
<br><a name="CR18357"><div class="synopsis" id="CR18357_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18357')">CR#18357</a> :</b> CSecurePrngMitosFw always generates a zero when numbers are less than 20 bytes.
</div>
<div class="detail" id="CR18357_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18357')">CR#18357</a> :</b> CSecurePrngMitosFw always generates a zero when numbers are less than 20 bytes.
<h4>Description</h4>
<p class="cr">
It was assumed that the minimal hash seed size was at least SHA1_HASH_SIZE, so when a hash seed smaller than 20 bytes was requested, a null hash seed was generated.
</p>
<h4>Solution</h4>
<p class="cr">
Set ms_uBytesRemaining = 0 in CSecurePrngMitosFw::InitializeCSecurePrngMitosFw to allow the hash seed to be generated properly.
</p>
</div>
<br><a name="CR18370"><div class="synopsis" id="CR18370_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18370')">CR#18370</a> :</b> Must not wait for the Sem if the task isn't spawn.
</div>
<div class="detail" id="CR18370_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18370')">CR#18370</a> :</b> Must not wait for the Sem if the task isn't spawn.
<h4>Description</h4>
<p class="cr">
The callstack trace under VxWorks is made using another task. The task that asks for the callstack trace waits on a semaphore for the spawned task to finish. It always waits on the semaphore but there might be limit conditions in which the spawning of a new task will fail. In such a case, the process will be locked up on the semaphore. It would be better, in limit conditions, to continue the execution if the callstack trace cannot be made. That is, the wait on the semaphore must not be made if the callstack trace task is not spawned.
</p>
<h4>Solution</h4>
<p class="cr">
Modified the VxWorks version of the MxTraceKernel.cpp:TraceCallStack function to receive and handle the return value of the VxWorks taskSpawn function. According to the documentation (found here: http://ladd00.triumf.ca/~daqweb/doc/vxworks/tornado2/docs/vxworks/ref/taskLib.html), the taskSpawn function will return ERROR if the task cannot be spawned. Thus, the wait on the semaphore is now done only if the taskSpawn value is not ERROR.
</p>
</div>
<br><a name="CR18643"><div class="synopsis" id="CR18643_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18643')">CR#18643</a> :</b> memset shouldn't be used to zero an entire CSocketAddr class in CUdpSocket::Connect.
</div>
<div class="detail" id="CR18643_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18643')">CR#18643</a> :</b> memset shouldn't be used to zero an entire CSocketAddr class in CUdpSocket::Connect.
<h4>Description</h4>
<p class="cr">
memset should not be used to zero an entire CSocketAddr class in CUdpSocket::Connect.
</p>
<h4>Solution</h4>
<p class="cr">
A zeroed out "sockaddr" structure has been used instead of using a CSocketAddr class.
</p>
</div>
<br><a name="CR17916"><div class="synopsis" id="CR17916_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17916')">CR#17916</a> :</b> CAsyncTcpServerSocket::InternalAcceptA may leak CTcpSocket.
</div>
<div class="detail" id="CR17916_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17916')">CR#17916</a> :</b> CAsyncTcpServerSocket::InternalAcceptA may leak CTcpSocket.
<h4>Description</h4>
<p class="cr">
CAsyncTcpServerSocket::InternalAcceptA could leak a CTcpSocket if the call to pAsyncTcpSocket-&gt;Activate() failed.
</p>
<h4>Solution</h4>
<p class="cr">
A failure check has been moved right after pAsyncTcpSocket-&gt;AcceptInitialize() to cover both pAsyncTcpSocket-&gt;Activate() and pAsyncTcpSocket-&gt;AcceptInitialize() failure paths.
</p>
</div>
<br><a name="CR18820"><div class="synopsis" id="CR18820_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18820')">CR#18820</a> :</b> Removing #include MxTraceBasic.h in CPool.h is causing link error with MSDEV for all traces using the g_stFramework node. 
</div>
<div class="detail" id="CR18820_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18820')">CR#18820</a> :</b> Removing #include MxTraceBasic.h in CPool.h is causing link error with MSDEV for all traces using the g_stFramework node. 
<h4>Description</h4>
<p class="cr">
Removing #include MxTraceBasic.h in CPool.h is causing a compile error with file ResolverCache.cpp because it is using a tracing system node that is included in the file CPool.h.
</p>
<p class="cr">
Removing #include MxTraceBasic.h from CPool.h is causing link errors that are caused by the TestCCompilation.c file. That test case is using the g_stFramework node that was declared as a C++ variable inside a C file to verify that the tracing system is working fine with the C file.
</p>
<h4>Solution</h4>
<p class="cr">
An #include MxTraceBasic.h has been added in ResolverCache.cpp to include it directly instead of using the one in CPool.h as it should have been.
</p>
<p class="cr">
The g_stFramework tracing node has been removed from the test case since that node can only be used for a file from the framework. A new node can be declared as a C variable, but it MUST be declared as a child of the g_stRoot node. The test case was not doing the good behaviour by using the g_stFramework node. A new node has been declared and registered to g_stRoot in the case to test the wanted behaviour.
</p>
</div>
<br><a name="CR18843"><div class="synopsis" id="CR18843_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18843')">CR#18843 (Incident 1729)</a> :</b> Some permutation of MXD_CRYPTO_ defines do not compile.
</div>
<div class="detail" id="CR18843_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18843')">CR#18843 (Incident 1729)</a> :</b> Some permutation of MXD_CRYPTO_ defines do not compile.
<h4>Description</h4>
<p class="cr">
    When using the following list of crypto defines, the framework fails to build:
</p>
<pre class="cr">
    #define MXD_CRYPTO_AES_MITOSFW
    #define MXD_CRYPTO_DIFFIEHELLMAN_OPENSSL
    #define MXD_CRYPTO_MD5_OPENSSL
    #define MXD_CRYPTO_MD5MAC_OPENSSL
    #define MXD_CRYPTO_RSA_OPENSSL
    #define MXD_CRYPTO_SHA1_MITOSFW
    #define MXD_CRYPTO_SHA1MAC_OPENSSL
    #define MXD_CRYPTO_PRIVATEKEY_OPENSSL
    #define MXD_CRYPTO_PUBLICKEY_OPENSSL
    #define MXD_CRYPTO_SECUREPRNG_MITOSFW
    #define MXD_CRYPTO_SECURESEED_MITOSFW
    #define MXD_CRYPTO_UUIDGENERATOR_MITOSFW
    #define MXD_CRYPTO_BASE64_MITOSFW
</pre>
<p class="cr">
    For the framework to build, it seems that:
</p>
<ul>
<li class="cr">If MXD_CRYPTO_SHA1_OPENSSL is defined then MXD_CRYPTO_SHA1MAC_OPENSSL must be defined.</li>
<li class="cr">If MXD_CRYPTO_SHA1_MITOSFW is defined then MXD_CRYPTO_SHA1MAC_MITOSFW must be defined.</li>
</ul>
<p class="cr">
    Mix and matching of those two defines should work but it does not. This must be fixed and tests to validate this sort of build failures must be integrated in the framework test suite.
</p>
<h4>Solution</h4>
<p class="cr">
    The problem was related to the "openssl/rand.h" include which was only included when MXD_CRYPTO_SHA1_OPENSSL was defined but is required in other cases also. The include was moved to be included in all required cases.
</p>
</div>
<br><a name="CR17915"><div class="synopsis" id="CR17915_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17915')">CR#17915</a> :</b> Variables that are initialized as the result of a marshaler >> operator must be explicitely initialized.
</div>
<div class="detail" id="CR17915_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17915')">CR#17915</a> :</b> Variables that are initialized as the result of a marshaler >> operator must be explicitely initialized.
<h4>Description</h4>
<p class="cr">
Variables that are initialized as the result of a marshaler output stream (i.e.: the &gt;&gt; operator) need to be explicitly initialized to prevent error messages from a static code analysis tool.
</p>
<h4>Solution</h4>
<p class="cr">
Variables that are initialized as the result of a marshaler &gt;&gt; operator are now explicitly initialized.
</p>
</div>
<br><a name="CR18993"><div class="synopsis" id="CR18993_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18993')">CR#18993</a> :</b> Inserting list A into list B always puts list A element at the beginning of list B.
</div>
<div class="detail" id="CR18993_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18993')">CR#18993</a> :</b> Inserting list A into list B always puts list A element at the beginning of list B.
<h4>Description</h4>
<p class="cr">
In CListBase::Insert(IN unsigned int uIndex, IN const CListBase&amp; rListBase), uIndex is not used when copying rListBase and 0 is used instead, which makes it impossible to insert the list anywhere else than at the beginning of the other list.
</p>
<h4>Solution</h4>
<p class="cr">
Change the second parameter of the call to Copy from 0 to uIndex.
</p>
</div>
<br><a name="CR18997"><div class="synopsis" id="CR18997_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18997')">CR#18997 (Incident 1580)</a> :</b> In CServicingThread avoid socket starvation during lengthly processing of messages and timers.
</div>
<div class="detail" id="CR18997_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18997')">CR#18997 (Incident 1580)</a> :</b> In CServicingThread avoid socket starvation during lengthly processing of messages and timers.
<h4>Description</h4>
<p class="cr">
Socket events are not being processed until there are no more messages or timer events to process.
</p>
<h4>Solution</h4>
<p class="cr">
In CServicingThread ::Activate, the while statement of the internal loop has been modified.
Before the internal loop, the uIterationCount local variable is set to one.
At the end of the internal loop the uIterationCount local variable is incremented.
The while statement now terminates the loop if the number of consecutive iterations is greater than MXD_SERVICING_THREAD_MAX_CONSECUTIVE_ITERATIONS.
Two wait statements have been added to allow processing of socket events in these situations.
</p>
</div>
<br><a name="CR19001"><div class="synopsis" id="CR19001_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19001')">CR#19001 (Incident 1867)</a> :</b> inet_ntoa is not thread safe.
</div>
<div class="detail" id="CR19001_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19001')">CR#19001 (Incident 1867)</a> :</b> inet_ntoa is not thread safe.
<h4>Description</h4>
<p class="cr">
The inet_ntoa function used by CSocketAddr::GetSinAddressAscii() is not thread safe on Linux.  It uses a static array to keep the strings that represent the addresses, and this array can be corrupted if many threads access it simultaneously.
</p>
<h4>Solution</h4>
<p class="cr">
CSocketAddr::GetSinAddrAscii() has been changed for Linux, inet_ntop() is now used to ensure thread safety.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
CSocketAddr::GetSinAddrAscii() is now thread safe on Linux.
</p>

</div>
<br><a name="CR19103"><div class="synopsis" id="CR19103_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19103')">CR#19103 (Incident 1641)</a> :</b> Memory leaks due to incomplete usage of OpenSsl API
</div>
<div class="detail" id="CR19103_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19103')">CR#19103 (Incident 1641)</a> :</b> Memory leaks due to incomplete usage of OpenSsl API
<h4>Description</h4>
<p class="cr">
Some OpenSsl APIs used by the Framework allocate memory that is never freed.
</p>
<h4>Solution</h4>
<p class="cr">
In CAlternateName::GetStackOfName, the pointer returned by X509V3_EXT_d2i(pX509Extension) is now kept in a local variable in order to be able to release the memory once the method completes.  Also, in CAlternateName::GetNameValue, the call to sk_CONF_VALUE_pop_free(pStackOfName, X509V3_conf_free) has been changed of scope, so it is also called for the error case.
</p>

<p class="cr">
In CDiffieHellmanOpenSsl::SetParameters, the member structure is now systematically freed by using DH_free and reallocated using DH_new, before the new information is stored in the structure.
</p>
</div>
<br><a name="CR19104"><div class="synopsis" id="CR19104_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19104')">CR#19104 (Incident 1641)</a> :</b> TLS renegotiation issues.
</div>
<div class="detail" id="CR19104_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19104')">CR#19104 (Incident 1641)</a> :</b> TLS renegotiation issues.
<h4>Description</h4>
<p class="cr">
Renegotiations were not handled correctly by the CAsyncTlsSocket class, causing the socket to hang in some cases.  Also, renegotiations could rarely be completed successfully.  This is mainly because of an incomplete implementation.
</p>
<p class="cr">
It was also impossible to update the credentials on a client socket once the TLS session was enabled, making it impossible to update the credentials and force a renegotiation on active sessions.
</p>
<h4>Solution</h4>
<p class="cr">
CCrypto now uses GetThreadId instead of GetThreadSelf.  GetThreadId returns an ID that is unique for a certain period of time where GetThreadSelf could return the same ID (thread pointer) in a short period of time.
</p>
<p class="cr">
Functionality regarding the possibility to switch between TCP and TLS socket has been removed.  See the updated interface section and modified behaviour section for more details.
</p>
<p class="cr">
The internal state machine of the CAsyncTlsSocket has been completely rewritten to take renegotiations into account.  This also implies being able to receive data while renegotiating but disallowing sending.  Changes are fairly complex and there would be no added value enumerating them all here.
</p>
<p class="cr">
With regards to renegotiation, if an explicit renegotiation is requested while an implicit renegotiation is proceeding, the explicit renegotiation will be made once the implicit renegotiation succeeds.  Events cannot occur the other way around since renegotiation timers are stopped during renegotiations, and data sending is disallowed.
</p>
<p class="cr">
CAsyncTlsSocket::SetTlsContext has been rewritten to allow updating members of the context, including the certificates.  This method cannot be called while an explicit renegotiation is proceeding.
</p>
<p class="cr">
MXD_FAULT_HANDLER_ENABLE has also been defined since it is required to handle the SIGPIPE exception under Linux, and avoid program termination.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
IAsyncTlsSocketMgr::EvAsyncTlsSocketMgrSwitchedInTcp and IAsyncTlsSocketMgr::EvAsyncTlsSocketMgrSwitchedInTls virtual methods were obsolete and removed from the interface.
</p>
<p class="cr">
A new CAsyncTlsSocket::Create method overload has been created without the obsolete bAlwaysInTls parameter.   The CAsyncTlsSocket::Create method with three parameters has been deprecated.
</p>
<p class="cr">
The CAsyncTlsSocket::SwitchInTcpA and CAsyncTlsSocket::SwitchInTlsA  methods were obsolete and removed from the class.
</p>
<p class="cr">
A new CAsynTlsServerSocket::Create method overload has been created without the obsolete bAcceptedAlwaysInTls parameter.  The CAsynTlsServerSocket::Create method with three parameters has been deprecated.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
Documentation of CAsyncTlsSocket::SetTlsContext has been modified to reflect the possibility that it can now be called after the session is established.
</p>

</div>
<br><a name="CR19270"><div class="synopsis" id="CR19270_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19270')">CR#19270 (Incident 1956)</a> :</b> CTlsContext::SetCipher is too restrictive.
</div>
<div class="detail" id="CR19270_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19270')">CR#19270 (Incident 1956)</a> :</b> CTlsContext::SetCipher is too restrictive.
<h4>Description</h4>
<p class="cr">
The CTlsContext::SetCiphers method needs to do a minimum of validation on the syntax of the cipher description string it was given as parameter.  This is to minimize the occurrences of failure on the server side, when a new connection is accepted.  When the latter occurs, there is no way to handle the error condition and the establishment fails late in the process.
</p>
<p class="cr">
Currently, the validation is based on the OpenSsl syntax, since the string will be passed directly through the OpenSsl API on session establishment.   However, not all the possible non-alphanumeric characters are handled by SetCiphers.
</p>
<h4>Solution</h4>
<p class="cr">
The parsing loop in CTlsContext:;SetCiphers has been modified to handle '!', ';', ',', ' ' and "@STRENGTH" tokens in addition to the already supported '+', '-' and ':' tokens.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
It is now possible to permanently remove ciphers from the list, to prioritize a certain cipher, or to use alternative separators.
</p>

</div>
<br><a name="CR19231"><div class="synopsis" id="CR19231_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19231')">CR#19231 (Incident 1881)</a> :</b> Remove timezone Posix strings from CTimeZone().
</div>
<div class="detail" id="CR19231_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19231')">CR#19231 (Incident 1881)</a> :</b> Remove timezone Posix strings from CTimeZone().
<h4>Description</h4>
<p class="cr">
Remove timezone POSIX strings from CTimeZone.
</p>
<p class="cr">
Add tests for these time zones:
<ol>
<li class="cr">Hawaii.</li>
<li class="cr">2 Alaskan timezones.</li>
<li class="cr">Newfoundland.</li>
<li class="cr">Yukon.</li>
</ol>
</p>
<p class="cr">
Ensure that existing and new time zones are consistent with the new daylight saving time legislation.
</p>
<p class="cr">
Refer to IEEE 1003.1 POSIX for more details.
</p>
<h4>Solution</h4>
<p class="cr">
The POSIX strings for the time zones have been removed from CTimeZone.
The ETimeZone has also been removed.
</p>
</div>
<br><a name="CR19399"><div class="synopsis" id="CR19399_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19399')">CR#19399</a> :</b> Move static inline functions to .cpp
</div>
<div class="detail" id="CR19399_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19399')">CR#19399</a> :</b> Move static inline functions to .cpp
<h4>Description</h4>
<p class="cr">
Static inline methods must be eliminated by moving them to a .cpp file. This is necessary since some compilers will warn that symbols are defined but not used when including a .h file that contains static inline methods from a .c file.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">Moved all static inline functions implementations from MxTrace.h to MxTrace.cpp.</li>
<li class="cr">Moved MxRGetWorstOf() implementation from MxResult.h to MxResult.cpp.</li>
<li class="cr">Moved MxStringCaseCompare() implementation from MxStringFormat.h to MxStringFormat.cpp.</li>
<li class="cr">Moved MxRemoveUnusedFunctionParamWarning() implementation from MxMacro.h to MxMacro.cpp.</li>
</ul>
</div>
<br><a name="CR18952"><div class="synopsis" id="CR18952_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18952')">CR#18952 (Incident 1546)</a> :</b> Errors when building using the M5T portable resolver.
</div>
<div class="detail" id="CR18952_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18952')">CR#18952 (Incident 1546)</a> :</b> Errors when building using the M5T portable resolver.
<h4>Description</h4>
<p class="cr">
Building using the M5T portable resolver results in errors on some platforms because of a wrong define in ResolverCache.cpp.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">Fixed a #if defined condition in ResolverCache.cpp.</li>
</ul>
</div>
<br><a name="CR19413"><div class="synopsis" id="CR19413_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19413')">CR#19413 (Incident 2005)</a> :</b> ParseSrvRecord() can try to access a NULL pointer in certain circumstances. 
</div>
<div class="detail" id="CR19413_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19413')">CR#19413 (Incident 2005)</a> :</b> ParseSrvRecord() can try to access a NULL pointer in certain circumstances. 
<h4>Description</h4>
<p class="cr">
ParseSrvRecords (Windows version) will crash on the line:
</p>
<pre class="cr">
else
{
    pCurrent = pCurrent-&gt;pNext;
}
</pre>
<p class="cr">
When parsing a DNS answer like this one and the asked family is IPv4:
</p>
<pre class="cr">
Answer record:
_sip._udp.tfw.m5t.com IN SRV 5 75 5060 a.ipv6.tfw.m5t.com
_sip._udp.tfw.m5t.com IN SRV 2 25 5060 b.ipv6.tfw.m5t.com

Additionnal record:
a.ipv6.tfw.m5t.com AAAA fedc:ba98:7654:3210:fedc:ba98:7654:3210
b.ipv6.tfw.m5t.com AAAA fedc:ba98:7654:3210:fedc:ba98:7654:3211
</pre>
<p class="cr">
The problem is the following:
</p>
<p class="cr">
ParseSrvRecord() will call RetreiveAddress(), which in turn will call ParseAAAARecord(). This call chain is done using PDNS_RECORD&amp;, thus ParseAAAARecord() can modify the pCurrent pointer of ParseSrvRecord(). And in fact it does when it correctly parses the record.
</p>
<p class="cr">
Now imagine the case where ParseAAAARecord() just parsed the last entry of the additional AAAA records. Since it is an IPv6 address, it successfully parses it and then advances to the next record. This will in fact put NULL in the pCurrent pointer of ParseSrvRecord(). Since the family check fails, the method tries to advance again to the next record, this generates a NULL pointer access and it crashes.
</p>
<p class="cr">
It must also be validated that this kind of problem can not occur on other platforms (i.e. portable resolver, etc.).
</p>
<h4>Solution</h4>
<p class="cr">
Added a validation against NULL for pCurrent before advancing to the next record.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
The ParseSrvRecord() function will no longer crash if the RetreiveAddress() function call succeeds and sets the pCurrent pointer to NULL.
</p>

</div>
<br><a name="CR19286"><div class="synopsis" id="CR19286_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19286')">CR#19286 (Incident 1962)</a> :</b> Wrong usage of OpenSSL leads to problems if used alongside third party software.
</div>
<div class="detail" id="CR19286_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19286')">CR#19286 (Incident 1962)</a> :</b> Wrong usage of OpenSSL leads to problems if used alongside third party software.
<h4>Description</h4>
<p class="cr">
The current usage of OpenSSL is that for each instance of CCrypto, OpenSSL is wiped clean (instance destruction) before being enabled again (instance creation). This leads to problems with third party software that uses OpenSSL.
</p>
<h4>Solution</h4>
<p class="cr">
OpenSSL is now initialized when CFrameworkInitializer::Initialize is called and finalized with  CFrameworkInitializer::Finalize. Also, the CCrypto instance initialize and finalize methods have been removed.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
OpenSSL is now properly initialized/finalized in CFrameworkInitializer.
</p>

</div>
<br><a name="CR19422"><div class="synopsis" id="CR19422_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19422')">CR#19422</a> :</b> Warnings when compiling for gcc 4.0.2 for the mips architecture.
</div>
<div class="detail" id="CR19422_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19422')">CR#19422</a> :</b> Warnings when compiling for gcc 4.0.2 for the mips architecture.
<h4>Description</h4>
<p class="cr">
There are warnings when building using the gcc 4.0.2 compiler for the mips architecture.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">Added protected virtual destructors to IMemoryBlockAccumulator and IMemoryTracker and IExternalTimeSource.</li>
</ul>
</div>
<br><a name="CR19472"><div class="synopsis" id="CR19472_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19472')">CR#19472</a> :</b> Merge StringToAddress in SetSinAddress to remove code duplication and uniformise interface behaviour. 
</div>
<div class="detail" id="CR19472_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19472')">CR#19472</a> :</b> Merge StringToAddress in SetSinAddress to remove code duplication and uniformise interface behaviour. 
<h4>Description</h4>
<p class="cr">
There is important code duplication with complex code branching in the SetSinAddr method, which results in a different return code for identical addresses. A success is returned when the mode is eMODE_AUTO but the same string results in an error when the mode is specified explicitly by using the right base.
</p>
<h4>Solution</h4>
<p class="cr">
CSockAddr.h
</p>
<ul>
<li class="cr"> Removed StringToAddress </li>
<li class="cr"> Removed one of the SetSinAddress </li>
</ul>
<p class="cr">
CSockAddr.cpp
</p>
<ul>
<li class="cr"> Moved the code from StringToAddress to SetSInAddress </li>
<li class="cr"> Added base specific code </li>
<li class="cr"> Replaced strtoul with MxStringToUint </li>
</ul>
<h4 class="red">Interface Change</h4>
<p class="cr">
SetSinAddress() from CSockAddr will now always allow address 255.255.255.255 to be set although this address is considered invalid by IsValidAddr().
</p>

</div>
<br><a name="CR19631"><div class="synopsis" id="CR19631_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19631')">CR#19631</a> :</b> The Crypto\Aes folder is compiled even if the OpenSSL implementation of AES is used.
</div>
<div class="detail" id="CR19631_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19631')">CR#19631</a> :</b> The Crypto\Aes folder is compiled even if the OpenSSL implementation of AES is used.
<h4>Description</h4>
<p class="cr">
When the M5T Framework is compiled with no support for AES (MXD_CRYPTO_AES_NONE) or OpenSSL AES support (MXD_CRYPTO_AES_OPENSSL) or AES overriding (MXD_CRYPTO_AES_OVERRIDE), the Framework's AES implementation from Crypto/Aes is compiled even if it is not used.
</p>
<h4>Solution</h4>
<p class="cr">
Conditional compilation has been added to the ".c" files of Crypto/Aes to specify to compile the related source code only when the macro MXD_CRYPTO_AES_MITOSFW is defined.
</p>
</div>
<br><a name="CR19676"><div class="synopsis" id="CR19676_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19676')">CR#19676</a> :</b> UDP/TCP/TLS Asynchronous Sockets must notify all events with respect to its manager's execution context.
</div>
<div class="detail" id="CR19676_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19676')">CR#19676</a> :</b> UDP/TCP/TLS Asynchronous Sockets must notify all events with respect to its manager's execution context.
<h4>Description</h4>
<p class="cr">
Most of the asynchronous sockets's methods are asynchronous with the exception of Send and Recv. The fact that those methods are synchronous can have unexpected effects when it comes to event reporting to the socket's managers. There are cases where the event gets reported asynchronously (i.e. in a different execution context or through the manager's message queue, depending on the threading configuration) but there are also cases where the events are reported synchronously (i.e. in the manager's execution context). This can lead to serious problems depending on how the manager is implemented and puts a supplemental responsibility on the manager and might end in a deadlock.
</p>
<p class="cr">
To prevent this, all asynchronous sockets must report ALL of their events asynchronously to their managers (i.e. in a different execution context or through the message queue, depending on the threading configuration). Thus, the asynchronous sockets's code must be revised to ensure that all reported events are done in the proper manner.
</p>
<p class="cr">
The asynchronous event reporting behaviour is more important on some platforms than others (i.e. Symbian) but all platforms will benefit from this change in the end.
</p>
<h4>Solution</h4>
<p class="cr">
The code of all asynchronous sockets has been revised and particular attention has been given to the execution context in which the managers? events callbacks are called. Where the execution context had the slightest chances of being the same as that of the manager, thus possibly reporting the event synchronously, the call has been replaced by a PostMessage call. The posted message depends on the event to be reported. Where required, internal helper methods have been added to process these new messages.
</p>
<p class="cr">
When the execution context could not be the same as that of the manager, the direct call to the manager has been left in place. This is to prevent overusing the message queue.
</p>
<p class="cr">
Also, simplifications to the message ID constants have been made. Instead of declaring constants in all sockets independently, all constants have been moved to the MxAsyncSocketConstants.h file. This file defines all message IDs and constants that are shared among the different asynchronous sockets. The constants that are specific to TLS sockets are regrouped in a similar manner. The TLS specific file is MxTlsSocketConstants.h.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
All events reported to the asynchronous sockets' managers are now asynchronous with respect to the managers' execution context.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The API reference document has been updated to state that the events are now asynchronous with respect to the managers' execution context.
</p>

</div>
<br><a name="CR19719"><div class="synopsis" id="CR19719_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19719')">CR#19719</a> :</b> GetAllLocalIpAddresses does not return both IPv4 and IPv6 addresses under Linux
</div>
<div class="detail" id="CR19719_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19719')">CR#19719</a> :</b> GetAllLocalIpAddresses does not return both IPv4 and IPv6 addresses under Linux
<h4>Description</h4>
<p class="cr">
GetAllLocalIpAddresses does not return both IPv4 and IPv6 addresses under Linux when MXD_IPV6_ENABLE_SUPPORT is defined. It only returns IPv6 addresses.
</p>
<h4>Solution</h4>
<p class="cr">
Fixed GetAllLocalIpAddresses to return both IPv6 and IPv4 addresses when MXD_IPV6_ENABLE_SUPPORT is defined.
</p>
<p class="cr">
That is achieved by always checking for IPv4 addresses first, and then checking for IPv6 addresses if MXD_IPV6_ENABLE_SUPPORT is defined.
</p>
<p class="cr">
Fixed issue with Scope Id of link-local addresses returned by GetAllLocalIpAddresses.
</p>
</div>
<br><a name="CR18453"><div class="synopsis" id="CR18453_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18453')">CR#18453 (Incident 2257)</a> :</b> CServicingThread displays a warning at destruction about forgotten timers when it is not the case.
</div>
<div class="detail" id="CR18453_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18453')">CR#18453 (Incident 2257)</a> :</b> CServicingThread displays a warning at destruction about forgotten timers when it is not the case.
<h4>Description</h4>
<p class="cr">
In CServicingThread::~CServicingThread, the warning should only de outputted when there are really timers that were forgotten instead of always.
</p>
<h4>Solution</h4>
<p class="cr">
In CServicingThread's destructor, check if there are still timers attached to the CServicingThread before deleting them and tracing a warning.
</p>
</div>
<br><a name="CR19807"><div class="synopsis" id="CR19807_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19807')">CR#19807 (Incident 2151)</a> :</b> CSecurePrngMitosFw::Generate() should not go outside the boundaries of the buffer used.
</div>
<div class="detail" id="CR19807_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19807')">CR#19807 (Incident 2151)</a> :</b> CSecurePrngMitosFw::Generate() should not go outside the boundaries of the buffer used.
<h4>Description</h4>
<p class="cr">
When the buffer ms_auCurrentBytes was changed to unsigned int from uint8_t, the current byte buffer was not changed to take into consideration the new size. Since the buffer's lenght is now 6, and not 24, the pointer of the buffer would point into memory that may or may not be used.
</p>
<h4>Solution</h4>
<p class="cr">
Added a divisor to make sure the constant scales with the size of the array.
</p>
</div>
<br><a name="CR19792"><div class="synopsis" id="CR19792_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19792')">CR#19792 (Incidents 2168, 2376)</a> :</b> Add GetHandle() method in Tls sockets.
</div>
<div class="detail" id="CR19792_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19792')">CR#19792 (Incidents 2168, 2376)</a> :</b> Add GetHandle() method in Tls sockets.
<h4>Description</h4>
<p class="cr">
The GetHandle() method must be added to CAsyncTlsSocket and CAsyncTlsServerSocket.
</p>
<h4>Solution</h4>
<p class="cr">
Added the GetHandle() method in the CAsyncTlsSocket and CAsyncTlsServerSocket classes. These methods return the handle associated with the internal TCP socket used by these classes.
</p>
</div>
<br><a name="CR19232"><div class="synopsis" id="CR19232_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19232')">CR#19232 (Incident 1881)</a> :</b> Add a default polling interval to SNTP.
</div>
<div class="detail" id="CR19232_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19232')">CR#19232 (Incident 1881)</a> :</b> Add a default polling interval to SNTP.
<h4>Description</h4>
<p class="cr">
Add a default polling interval to SNTP requests. The default interval should be 6 as some server implementations ignore a request with a polling interval of zero.
</p>
<p class="cr">
RFC 2030 states: "Poll Interval: This is an eight-bit signed integer indicating the maximum interval between successive messages, in seconds to the nearest power of two. The values that can appear in this field presently range from 4 (16 s) to 14 (16284); however, most applications use only the sub-range 6 (64 s) to 10 (1024 s)."
</p>
<h4>Solution</h4>
<p class="cr">
A polling interval of 6 (2^6=64 seconds) is now used instead of 0. Some server implementations will ignore a request with a poll interval of 0.
</p>
<p class="cr">
CSntpClient::ProtectedQueryServer() has been modified to use a polling interval of 6 instead of 0.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Previously, the SNTP requests had a poll interval of 0. They now have a poll interval of 6 (2^6=64 seconds).
</p>

</div>
<br><a name="CR20012"><div class="synopsis" id="CR20012_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20012')">CR#20012 (Incident 2288)</a> :</b> Missing assignation when MXD_ASSERT_FINAL_BEHAVIOR_OVERRIDE is defined.
</div>
<div class="detail" id="CR20012_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20012')">CR#20012 (Incident 2288)</a> :</b> Missing assignation when MXD_ASSERT_FINAL_BEHAVIOR_OVERRIDE is defined.
<h4>Description</h4>
<p class="cr">
When MXD_ASSERT_FINAL_BEHAVIOR_OVERRIDE  is defined,  the user-provided implementation for the final behaviour method is not called correctly, since a pointer is not set correctly at initialization time.  Worst, it will cause a NULL pointer access when an assertion fails.
</p>
<h4>Solution</h4>
<p class="cr">
Added the global pointer assignation to the user declare structure when MXD_ASSERT_FINAL_BEHAVIOR_OVERRIDE  is defined.
</p>
</div>
<br><a name="CR20404"><div class="synopsis" id="CR20404_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20404')">CR#20404</a> :</b> Wrong finalization sequence in CFrameworkInitializer::Finalize
</div>
<div class="detail" id="CR20404_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20404')">CR#20404</a> :</b> Wrong finalization sequence in CFrameworkInitializer::Finalize
<h4>Description</h4>
<p class="cr">
The finalization sequence in CFrameworkInitializer::Finalize is wrong in two places.
</p>

<ul>
<li class="cr"> SymbianFinalize( ) is called at the complete end of CFrameworkInitializer::PartialFinalize( ), which does not match with its initialization order. If the initialization fails before SymbianInitialize( ), then SymbianFinalize( ) will be called while it should not, possibly leading to an execution error.
</li>
<li class="cr">If, during the execution CFrameworkInitializer::Initialize, there was an error after the tracing node registration, the tracing nodes would never unregister because the corresponding logic is not in CFrameworkInitializer::PartialFinalize( )..
</li>
</ul>
<h4>Solution</h4>
<p class="cr">
CFrameworkInitializer::PartialFinalize( ) now calls SymbianFinalize( ) at reverse chronological order with respect to its initialization order.
</p>
<p class="cr">
Tracing node un-registration is moved from CFrameworkInitializer::Finalize( ) to  CFrameworkInitializer::PartialFinalize( ).
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
The method CFrameworkInitializer::Finalize now returns an unsigned integer to report the updated initialization count.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
Updated CFrameworkInitializer::Finalize to add its return value documentation.
</p>

</div>
<br><a name="CR19759"><div class="synopsis" id="CR19759_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19759')">CR#19759</a> :</b> StartTimer should validate that uDivBy is not zero.
</div>
<div class="detail" id="CR19759_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19759')">CR#19759</a> :</b> StartTimer should validate that uDivBy is not zero.
<h4>Description</h4>
<p class="cr">
CServicingThread::StartTimer should validate that the uDivBy parameter is not zero.
</p>
<h4>Solution</h4>
<p class="cr">
CServicingThread::StartTimer now returns resFE_INVALID_ARGUMENT if uDivBy is 0.
</p>
</div>
<br><a name="CR20420"><div class="synopsis" id="CR20420_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20420')">CR#20420</a> :</b> CSocketAddr::IsInet6* methods do not safely validate the family prior to using a cast of the internal address structure.
</div>
<div class="detail" id="CR20420_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20420')">CR#20420</a> :</b> CSocketAddr::IsInet6* methods do not safely validate the family prior to using a cast of the internal address structure.
<h4>Description</h4>
<p class="cr">
All CSocketAddr::IsInet6* methods do not validate the family prior to casting the internal representation to a sockaddr_in6. This has two impacts:
<ol>
<li class="cr">It is dangerous since the sockaddr_in and sockaddr_in6 structures are not necessarily of the same sizes.</li>
<li class="cr">It makes the methods behave unreliably in the presence of a true IPv4 that is stored in the CSocketAddr class. Depending on the IPv4 address, the methods might return true, which would lead to problematic situations.
</ol>
</p>
<h4>Solution</h4>
<p class="cr">
The fix is to add a check for the contained address family in the CSocketAddr::IsInet6* methods. This additional check will make the methods return false when the contained address is not an IPv6 address altogether.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
All CSocketAddr::IsInet6* methods now reliably return false when the contained address is an IPv4 address. Affected methods are:
<ul>
<li class="cr">CSocketAddr::IsInet6AddressUnspecified</li>
<li class="cr">CSocketAddr::IsInet6AddressLoopback</li>
<li class="cr">CSocketAddr::IsInet6AddressMulticast</li>
<li class="cr">CSocketAddr::IsInet6AddressLinkLocal</li>
<li class="cr">CSocketAddr::IsInet6AddressSiteLocal</li>
<li class="cr">CSocketAddr::IsInet6AddressV4Mapped</li>
<li class="cr">CSocketAddr::IsInet6AddressGlobal</li>
<li class="cr">CSocketAddr::IsInet6AddressUniqueLocal</li>
</ul>
</p>

</div>
<br><a name="CR20505"><div class="synopsis" id="CR20505_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20505')">CR#20505</a> :</b> Move SetWindowsReceivingFlowspec / SetWindowsSendingFlowspec to separate ECOM interface
</div>
<div class="detail" id="CR20505_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20505')">CR#20505</a> :</b> Move SetWindowsReceivingFlowspec / SetWindowsSendingFlowspec to separate ECOM interface
<h4>Description</h4>
<p class="cr">
For compliance with the latest M5T coding guidelines, ECOM interfaces must not have a different number of methods on different platforms. That is, conditional compilation must not be used inside ECOM interfaces declaration. Therefore, the IAsyncSocketQualityOfServiceOptions::SetWindowsReceivingFlowspec and IAsyncSocketQualityOfServiceOptions::SetWindowsSendingFlowspec methods must be moved to their own interface.
</p>
<h4>Solution</h4>
<p class="cr">
The IAsyncSocketWindowsGqosOptions interface has been added to declare these two methods. The framework's asynchronous sockets now conditionally compile the support for this interface. Using the ECOM mechanism (i.e QueryIf method), the application can detect, at run-time, if the support for this interface has been enabled at compilation time. This and the fact that the interface is always completely defined allows the application to compile without the need to synchronize its use of the interface with the compilation macros.
</p>
<p class="cr">
The Framework's asynchronous sockets have been modified to conditionally support the new IAsyncSocketWindowsGqosOptions interface. Support for this interface is compiled-in on Windows platforms (MXD_OS_WINDOWS defined) when MXD_OS_WINDOWS_ENABLE_GQOS_QOS is defined. Please refer to the MXD_OS_WINDOWS_ENABLE_GQOS_QOS macro documentation for further details on its use.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The IAsyncSocketQualityOfServiceOptions interface has been stripped of the conditionally compiled methods SetWindowsSendingFlowspec and SetWindowsReceivingFlowspec.
</p>
<p class="cr">
The IAsyncSocketWindowsGqosOptions interface has been added to declare these methods.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The Framework's API reference has been updated to include the documentation for the new interface.
</p>

</div>
<br><a name="CR20506"><div class="synopsis" id="CR20506_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20506')">CR#20506</a> :</b> Remove opaque parameters from IAsyncServerSocket::AcceptA.
</div>
<div class="detail" id="CR20506_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20506')">CR#20506</a> :</b> Remove opaque parameters from IAsyncServerSocket::AcceptA.
<h4>Description</h4>
<p class="cr">
With the introduction of standard ECOM interfaces for the asynchronous sockets, it has become illogical to have two means of setting the accepted socket opaque value: either through the IAsyncServerSocket::AcceptA method or through the IAsyncSocket::SetOpaque method in the IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionAccepted event.
</p>
<p class="cr">
To keep things logical and as simple as possible, the opqAcceptedOpaque of the IAsyncServerSocket::AcceptA method must be removed. This will force the use of the IAsyncSocket::SetOpaque method in the IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionAccepted event to set the accepted socket opaque value. This is logical with the asynchronous socket's design because all managers of the accepted socket must also be set in this event.
</p>
<h4>Solution</h4>
<p class="cr">
The opqAcceptedOpaque parameter of the following methods has been removed:
<ul>
<li class="cr">IAsyncServerSocket::AcceptA</li>
<li class="cr">IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionAccepted</li>
<li class="cr">IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionFailed</li>
</ul>
</p>
<p class="cr">
The classes implementing the above interfaces have been modified to no longer use the opqAcceptedOpaque parameter. They are:
<ul>
<li class="cr">CAsyncTcpServerSocket</li>
<li class="cr">CAsyncTlsServerSocket</li>
</ul>
</p>
<p class="cr">
The IAsyncTcpSocketAcceptMgr private interface also needed modifications. This induced modifications in the CAsyncTcpSocket also. This is not important for the end user as it only impacts on internal mechanisms but it is mentionned for CR documentation completeness.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The IAsyncServerSocket::AcceptA method has been stripped of its opqAcceptedOpaque. This means an application can no longer provide an opaque value to be set in the accepted socket that will be returned in the IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionAccepted event. The accepted socket opaque value must, instead, be set in the proccessing of the IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionAccepted along with the various managers of the accepted socket.
</p>
<p class="cr">
The IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionAccepted and IAsyncServerSocketMgr::EvAsyncServerSocketMgrConnectionFailed events no longer return the opqAcceptedOpaque value. This means that code that relied on this value must be revised to be done only in the EvAsyncServerSocketMgrConnectionAccepted event. For example, if an application is keeping a vector of accepted socket and used to pre-allocate the memory for the upcoming accepted socket just before the call to AcceptA and then relied on the accepted opaque value to find the pre-allocated memory, it should wait for the EvAsyncServerSocketMgrConnectionAccepted event before allocating that memory.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The deprecation and removal of the opqAcceptedOpaque parameter has been documented in the API reference for the affected ECOM interfaces.
</p>

</div>
<br><a name="CR19922"><div class="synopsis" id="CR19922_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19922')">CR#19922</a> :</b> Add option tu use static buffers in CString objects.
</div>
<div class="detail" id="CR19922_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19922')">CR#19922</a> :</b> Add option tu use static buffers in CString objects.
<h4>Description</h4>
<p class="cr">
Creating many CString objects that contain small strings is slow. It is necessary to provide a way to increase the performance of the CString object in such use cases.
</p>
<p class="cr">
This can be done by using a static buffer in the CString object to hold the string, instead of using dynamic memory allocation. Dynamic memory allocation only needs to be used if the stored string is larger than the static buffer.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">Added a define, MXD_CSTRING_MINIMUM_BUFFER, that enables the static buffer in CString objects. This define is to be placed in PreFrameworkCfg.h when the feature is needed.</li>
<li class="cr">Modified the CString class to use a static buffer when MXD_CSTRING_MINIMUM_BUFFER is defined.</li>
</ul>
</div>
<br><a name="CR20516"><div class="synopsis" id="CR20516_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20516')">CR#20516</a> :</b> CMemoryAllocator.h does not compile when only MXD_MEMORY_ALLOCATOR_ENABLE_SUPPORT is defined.
</div>
<div class="detail" id="CR20516_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20516')">CR#20516</a> :</b> CMemoryAllocator.h does not compile when only MXD_MEMORY_ALLOCATOR_ENABLE_SUPPORT is defined.
<h4>Description</h4>
<p class="cr">
The CMemoryAllocator.h file fails to build when the only memory allocator macro present is MXD_MEMORY_ALLOCATOR_ENABLE_SUPPORT. This is due to a missing include of the "Basic/CAlignedVariableStorage.h" file.
</p>
<h4>Solution</h4>
<p class="cr">
Modified the "#if defined" directives so that the "Basic/CAlignedVariableStorage.h" file is always included when MXD_MEMORY_ALLOCATOR_ENABLE_SUPPORT is defined.
</p>
</div>
<br><a name="CR20521"><div class="synopsis" id="CR20521_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20521')">CR#20521</a> :</b> Mocana SSL: CRYPTO : SHA1 (based on Mocana, HMAC is MitosFw)
</div>
<div class="detail" id="CR20521_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20521')">CR#20521</a> :</b> Mocana SSL: CRYPTO : SHA1 (based on Mocana, HMAC is MitosFw)
<h4>Description</h4>
<p class="cr">
CSha1 must allow the use of the Mocana SS library implementation of the SHA-1 algorithm.
</p>
<h4>Solution</h4>
<p class="cr">
Implemented CSha1MocanaSs from which CSha1 derives when MXD_CRYPTO_SHA1_MOCANA_SS is defined.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Added documentation for the MXD_CRYPTO_SHA1_MOCANA_SS macro definition in section 2.5.1 of the Programmer's Guide.
</p>

</div>
<br><a name="CR20522"><div class="synopsis" id="CR20522_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20522')">CR#20522</a> :</b> Mocana SSL: CRYPTO: AES CBC and CTR (based on Mocana)
</div>
<div class="detail" id="CR20522_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20522')">CR#20522</a> :</b> Mocana SSL: CRYPTO: AES CBC and CTR (based on Mocana)
<h4>Description</h4>
<p class="cr">
CAes must allow the use of the Mocana SS library implementation of the AES algorithm.
</p>
<p class="cr">
Note that since Mocana SS only supports the CBC mode, we are using the modes implemented in the Framework (CBC, CFB, CTR, ECB, OFB) and Mocana SS for the core AES algortihm implementation.
</p>
<h4>Solution</h4>
<p class="cr">
Since the Mocana SS library only supports the CBC mode, the Framework modes are used, but the core AES algorithm from the Mocana SS library is used.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Added documentation for the MXD_CRYPTO_AES_MOCANA_SS macro definition in section 2.5.1 of the Programmer's Guide.
</p>

</div>
<br><a name="CR20523"><div class="synopsis" id="CR20523_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20523')">CR#20523</a> :</b> Mocana SSL: CRYPTO : CPrivateKey
</div>
<div class="detail" id="CR20523_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20523')">CR#20523</a> :</b> Mocana SSL: CRYPTO : CPrivateKey
<h4>Description</h4>
<p class="cr">
CPrivateKey must allow the use of the Mocana SS library DER and PEM parser for private keys.
</p>
<p class="cr">
Note that the private key storage and the DSA private key parsing are not implemented.
</p>
<h4>Solution</h4>
<p class="cr">
Implemented CPrivateKeyMocanaSs from which CPrivateKey derives when MXD_CRYPTO_PRIVATEKEY_MOCANA_SS is defined.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Added documentation for the MXD_CRYPTO_PRIVATEKEY_MOCANA_SS macro definition in section 2.5.1 of the Programmer's Guide.
</p>

</div>
<br><a name="CR20526"><div class="synopsis" id="CR20526_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20526')">CR#20526</a> :</b> Under Symbian the resolution of CTimer::GetSystemUpTimeMs is limited to 15.625 msec which is too low.
</div>
<div class="detail" id="CR20526_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20526')">CR#20526</a> :</b> Under Symbian the resolution of CTimer::GetSystemUpTimeMs is limited to 15.625 msec which is too low.
<h4>Description</h4>
<p class="cr">
Under Symbian, the resolution of CTimer::GetSystemUpTimeMs is limited to 15.625 ms, which is too low. For example, two or more successive calls to CTimer::GetSystemUpTimeMs inside the same period of 15.625 ms will return the same value.
</p>
<p class="cr">
In the Framework, CServicingThread and CTimer rely on CTimer::GetSystemUpTimeMs to compute the moment when a timer should fire reducing the natural distribution of events in time.
</p>
<p class="cr">
Of course, for long duration this resolution is almost negligible but the Framework must be able to give a resolution of at least 10 ms.
</p>
<h4>Solution</h4>
<p class="cr">
Under the Symbian operating system only, the implementation of CTimer::GetSystemUpTimeMs has been changed from User::TickCount() to User::NTickCount(), which has a 1 ms resolution. The latter is referred to as the ms tick counter in the Symbian documentation.
</p>
<p class="cr">
At the same time the Symbian implementation of CTimer::GetSystemUpTimeMs was slightly modified to use the same computations as most other operating systems.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Under Symbian, successive calls to CTimer::GetSystemUpTimeMs will increment every 1 ms instead of 15.625 ms.
</p>

</div>
<br><a name="CR20548"><div class="synopsis" id="CR20548_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20548')">CR#20548 (Incident 2449)</a> :</b> CServicingThread will not run in a IPv6 only target.
</div>
<div class="detail" id="CR20548_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20548')">CR#20548 (Incident 2449)</a> :</b> CServicingThread will not run in a IPv6 only target.
<h4>Description</h4>
<p class="cr">
The CServicingThread initializes its internal UDP socket at creation time. The initialization is done using the following code:
</p>
<pre class="cr">
    CSocketAddr localSocketAddr(CSocketAddr::eINET_LOOPBACK);
    CSocketAddr effectiveLocalSocketAddr;

    m_pUdpSocket = MX_NEW(CUdpSocket);

    res = m_pUdpSocket-&gt;Create(localSocketAddr.GetFamily());
</pre>
<p class="cr">
This code will always work in an environment where the IP stack is IPv4 only or IPv4 and IPv6. But it will fail in an environment where the IP stack is IPv6 only. It must be revised to work in that last environment as well.
</p>
<h4>Solution</h4>
<p class="cr">
The initialization code has been revised to try the initialization again when IPv6 is enabled and the IPv4 try fails.
</p>
</div>
<br><a name="CR20549"><div class="synopsis" id="CR20549_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20549')">CR#20549 (Incident 2366)</a> :</b> Provide better size reduction granularity.
</div>
<div class="detail" id="CR20549_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20549')">CR#20549 (Incident 2366)</a> :</b> Provide better size reduction granularity.
<h4>Description</h4>
<p class="cr">
It is required to provide better size reduction granularity in the Framework. This can be useful when building the Framework in a shared object library (.so or .dll), and some functionalities are not needed. For example, if the application using the shared object library makes no use of the network features of the Framework, then a lot of unused code ends up in the library.
</p>
<h4>Solution</h4>
<ul>
<li class="cr">Added a new define, MXD_NETWORK_ENABLE_SUPPORT, that enables compilation of all source files under the /Network folder. By default this define is disabled.</li>
<li class="cr">Modified CServicingThread to remove its dependency on CUdpSocket when MXD_NETWORK_ENABLE_SUPPORT is not enabled.</li>
</ul>
<li class="cr">Modified the CUuidGenerator class so that it uses the Crypto override mechanism. This allows to disable compilation of the class when it is not needed.</li>
</div>
<br><a name="CR20565"><div class="synopsis" id="CR20565_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20565')">CR#20565 (Incident 2400)</a> :</b> External thread tracing with the memory queue drops latest trace.
</div>
<div class="detail" id="CR20565_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20565')">CR#20565 (Incident 2400)</a> :</b> External thread tracing with the memory queue drops latest trace.
<h4>Description</h4>
<p class="cr">
External thread tracing with the memory queue needs to keep the most recent trace instead of dropping it when the memory queue is full.
</p>
<h4>Solution</h4>
<p class="cr">
When MXD_TRACE_USE_EXTERNAL_THREAD is defined, the MxTraceNewMemoryQueueBuffer method ensures that the returned trace buffer is valid even if the memory queue is full. This ensures that the newest trace entries is kept while the oldest is dropped.
</p>
<p class="cr">
When MXD_TRACE_USE_EXTERNAL_THREAD is defined, the MxTraceCallOutputHandler method locks the memory queue for the duration of its processing to ensure the integrity of the traces, this ensures MxTraceNewMemoryQueueBuffer returns a valid trace buffer.This results in more code being thread safe and can result in a slowdown of the system.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
When MXD_TRACE_USE_EXTERNAL_THREAD is defined and the memory queue is full, the oldest trace entries are dropped to ensure that the most recent entries are queued.
</p>

</div>
<br><a name="CR20749"><div class="synopsis" id="CR20749_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20749')">CR#20749</a> :</b> The Tls Renegotiation Mgr can be called even if it's NULL and other bugs.
</div>
<div class="detail" id="CR20749_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20749')">CR#20749</a> :</b> The Tls Renegotiation Mgr can be called even if it's NULL and other bugs.
<h4>Description</h4>
<p class="cr">
A few bugs have been identified in the asynchronous UDP and TLS sockets.
<ol>
<li class="cr">The Unconnected IO manager is not checked to activate the reception of data event. This results in the IAsyncUnconnectedIoSocketMgr::EvAsyncUnconnectedIoSocketMgrReadyToRecv event never being reported when only the unconnected interface of the socket is used.</li>
<li class="cr">The IAsyncTlsRenegotiationMgr interface can be used even if it is NULL. This is due to a check prior to reporting the IAsyncTlsRenegotiationMgr::EvAsyncTlsRenegotiationMgrRenegotiated event being done on the wrong manager interface pointer in the asynchronous TLS socket.</li>
<li class="cr">The IAsyncTlsSocketMgr interface can be used even if it is NULL. This is due to the lack of validation before reporting the IAsyncTlsSocketMgr::EvAsyncTlsSocketMgrNewTlsSession event.</li>
<li class="cr">There is a possible deadlock with the socket factory list when releasing the sockets. The deadlock can occur if two threads try to release a socket at the same time.</li>
</ol>
</p>
<h4>Solution</h4>
<p class="cr">
&lt;B&gt;Bug 1: The Unconnected IO manager is not checked to activate the reception of data event.&lt;/B&gt;
</p>
<p class="cr">
The fix for this bug is to add the necessary check in the CAsyncUdpSocket::InternalBindA method.
</p>
<p class="cr">
&lt;B&gt;Bug 2: The IAsyncTlsRenegotiationMgr interface can be used even if it is NULL.&lt;/B&gt;
</p>
<p class="cr">
The fix for this bug is to validate the correct interface before reporting the IAsyncTlsRenegotiationMgr::EvAsyncTlsRenegotiationMgrRenegotiated event.
</p>
<p class="cr">
&lt;B&gt;Bug 3: The IAsyncTlsSocketMgr interface can be used even if it is NULL.&lt;/B&gt;
</p>
<p class="cr">
The fix for this bug is to add a check for the IAsyncTlsSocketMgr before reporting the IAsyncTlsSocketMgr::EvAsyncTlsSocketMgrNewTlsSession event.
</p>
<p class="cr">
&lt;B&gt;Bug 4: There is a possible deadlock with the socket factory list when releasing the sockets.&lt;/B&gt;
</p>
<p class="cr">
The fix for this bug is to release the reference that once counted for the copy of the interface pointer kept in the socket factory's list outside of the critical section in the CAsyncSocketFactory::RemoveSocketFromFactoryList method.
</p>
</div>
<br><a name="CR20775"><div class="synopsis" id="CR20775_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20775')">CR#20775</a> :</b> Purify no longer detects memory leak when memory tracking is enabled.
</div>
<div class="detail" id="CR20775_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20775')">CR#20775</a> :</b> Purify no longer detects memory leak when memory tracking is enabled.
<h4>Description</h4>
<p class="cr">
When enabling memory tracking in the CMemoryAllocator class, via the MXD_MEMORY_ALLOCATOR_MEMORY_TRACKING_ENABLE_SUPPORT macro, Purify no longer reports memory leaks.
</p>
<h4>Solution</h4>
<p class="cr">
Added a destructor for the CMemoryAllocator::CMemoryBlockList object. This destructor makes sure to reset its pointer to the head of the list of currently allocated blocks to NULL. This is necessary since Purify has problems detecting leaks when pointers to allocated blocks are still valid in static objects.
</p>
<p class="cr">
Fixed an issue with the deletion of the CMemoryTracker static member in CMemoryAllocator, which was not deleted when memory tracking is enabled and memory statistics are disabled.
</p>
</div>
<br><a name="CR20813"><div class="synopsis" id="CR20813_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20813')">CR#20813</a> :</b> Memory allocator leaks tracing mechanism is not available on the Symbian platform.
</div>
<div class="detail" id="CR20813_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20813')">CR#20813</a> :</b> Memory allocator leaks tracing mechanism is not available on the Symbian platform.
<h4>Description</h4>
<p class="cr">
The memory allocator leaks detection feature does not report memory leaks on the Symbian platform. This is due to the initialization order of the Framework's various parts in CFrameworkInitializer. The Symbian platform should be initialized very early in the intialization process and finalized last in the finalization process. Doing so will ensure that the trace mechanism is still available to the memory allocator.
</p>
<h4>Solution</h4>
<p class="cr">
The static initialization/finalization order in the CFrameworkInitializer class has been revised to perform the operations in the correct order.
</p>
</div>
<br><a name="CR20792"><div class="synopsis" id="CR20792_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20792')">CR#20792 (Incidents 2549, 3547)</a> :</b> DNS Query Refused
</div>
<div class="detail" id="CR20792_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20792')">CR#20792 (Incidents 2549, 3547)</a> :</b> DNS Query Refused
<h4>Description</h4>
<p class="cr">
DNS Queries are refused because the Truncated bit is set the outgoing query. SDnsMsgHeader stHeader, in ResolverMkQuery(),  is not properly initialized, this may cause the query to go out with the Truncated flag set. SDnsMsgHeader stHeader needs to be properly initialized.
</p>
<h4>Solution</h4>
<p class="cr">
Initialized SDnsMsgHeader stHeader, in ResolverMkQuery(),  to zero.
</p>
</div>
<br><a name="CR20820"><div class="synopsis" id="CR20820_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20820')">CR#20820</a> :</b> When traces use a memory queue it is possible that traces are lost without anyway to detect the loss.
</div>
<div class="detail" id="CR20820_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20820')">CR#20820</a> :</b> When traces use a memory queue it is possible that traces are lost without anyway to detect the loss.
<h4>Description</h4>
<p class="cr">
Traces output by the Framework's trace system have a sequence number that allows detection of missing traces. The sequence number is incremented in the format handler. Yet, when a memory queue is used and it is full, the trace is not formatted and added to the buffer and the trace is lost. The trace not being formatted implies that the sequence number is not incremented since this operation is done in the format handler. This results in the impossibility of detecting the trace loss since the next trace will be assigned the same sequence number than the lost one.
</p>
<h4>Solution</h4>
<p class="cr">
A simple way of fixing this is to increment the sequence number outside of the format handler. This operation has been moved in the MxTracePrivateVaList function, which performs the validation on the trace buffer. The increment is performed before the buffer check, this will ensure that all trace lines will get assigned a different sequence number and missing trace lines will be detectable. To make sure that the incremented sequence number is used, either by user overridden format handlers or by the Framework's default, a new parameter specifying the sequence number for the trace to be formatted has been added. This new parameter is now used in the default format handler. Users that override the format handler must expect compilation failures when upgrading to this Framework version. The failure will be caused by the mxt_PFNTraceFormatHandler definition not matching the function's implementation. Simply add an unsigned int parameter after the va_list parameter to solve the error.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The mxt_PFNTraceFormatHandler type has been modified to accept a new parameter that specifies the sequence number of the trace to be formatted.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The mxt_PFNTraceFormatHandler type documentation in the API Reference document has been augmented with the new parameter description.
</p>

</div>
<br><a name="CR20860"><div class="synopsis" id="CR20860_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20860')">CR#20860</a> :</b> Implement Issuer/Subject for Mocana SS.
</div>
<div class="detail" id="CR20860_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20860')">CR#20860</a> :</b> Implement Issuer/Subject for Mocana SS.
<h4>Description</h4>
<p class="cr">
Implementation of Issuer and Subject using Mocana SS.
</p>
<h4>Solution</h4>
<p class="cr">
When MXD_PKI_MOCANA_SS is defined, the class CCertificateNameMocanaSs is used as the base class for CCertificateIssuer and CCertificateSubject.
<ul>
<li class="cr">The files CCertificateNameMocanaSs.h and CCertificateNameMocanaSs.cpp have been added to implement CCertificateNameMocanaSs.</li>
<li class="cr">The file FrameworkCfg.h has been modified to define MXD_PKI_CCERTIFICATEISSUER_INCLUDE and MXD_PKI_CCERTIFICATESUBJECT_INCLUDE using CCertificateNameMocanaSs.h.</li>
<li class="cr">The file CCertificateChainMocanaSs.h has been modified to use CCertificateNameMocanaSs::EName instead of CCertificateSubjectMocanaSs::EName.</li>
<li class="cr">The files CCertificateSubjectMocanaSs.h, CCertificateSubjectMocanaSs.cpp, CCertificateIssuerMocanaSs.h, and CCertificateIssuerMocanaSs.cpp have been removed.</li>
</ul>
</p>
</div>
<br><a name="CR20865"><div class="synopsis" id="CR20865_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20865')">CR#20865</a> :</b> Implement Diffie-Hellman using Mocana SS
</div>
<div class="detail" id="CR20865_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20865')">CR#20865</a> :</b> Implement Diffie-Hellman using Mocana SS
<h4>Description</h4>
Implement the Diffie-Hellman key exchange using the Mocana SS library functions.
<h4>Solution</h4>
<ol>
<li class="cr">Added the class CDiffieHellmanMocanaSs implemeting the DH using the Mocana library. Note that it uses the mathematical functions directly, instead of the utility functions</li>
<li class="cr">CDiffieHellman::GeneratePublicAndPrivateKeys now takes an optional private key size (in bits). This is commonly used to increase the performance of the protocol, since the modular exponentiation is made with a smaller exponent</li>
<li class="cr">In addition to DH groups 1, 2 and 5, groups 14, 15, 16, 17 and 18 are now supported</li>
<li class="cr">Prime generation is not supported, so it MUST be set. You may generate your own, or more conveniently use a DH group.</li>
</ol>
<h4 class="red">Behaviour Change</h4>
<ol>
<li class="cr">CDiffieHellman::SetParameters no longer allows a generator value of one. This is breaking the protocol.</li>
</ol>

<h4 class="red">Interface Change</h4>
CDiffieHellman::GeneratePublicAndPrivateKeys now takes an optional private key size (in bits)

<h4 class="red">Documentation Update</h4>
The API reference, section 2.7.1.6 on CDiffieHellman has been reviewed and updated.

</div>
<br><a name="CR20896"><div class="synopsis" id="CR20896_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20896')">CR#20896</a> :</b> Implement RSA using Mocana SS
</div>
<div class="detail" id="CR20896_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20896')">CR#20896</a> :</b> Implement RSA using Mocana SS
<h4>Description</h4>
Implement the RSA algorithm using the Mocana SS library functions.
<h4>Solution</h4>
<ol>
<li class="cr">implemented public-key and private-key encryption</li>
<li class="cr">implemented private-key decryption</li>
<li class="cr">implemented key generation</li>
<li class="cr">implemented digital signatures and digital signatures verification</li>
<li class="cr">augmented Mocana key structures encapsulation</li>
</ol>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Mocana SS restricts some of the features provided by the Framework's interface of the RSA algorithm:
<ol>
<li class="cr">the public exponent is hardcoded to 65537</li>
<li class="cr">it is not possible to decrypt a message encrypted with a private key without using the signature verification. Therefore CRsa::PublicKeyDecrypt is not supported</li>
</ol>
</p>

</div>
<br><a name="CR20903"><div class="synopsis" id="CR20903_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20903')">CR#20903</a> :</b> Fix WinCE CThread limitation.
</div>
<div class="detail" id="CR20903_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20903')">CR#20903</a> :</b> Fix WinCE CThread limitation.
<h4>Description</h4>
<p class="cr">
Under Windows CE, the flag STACK_SIZE_PARAM_IS_A_RESERVATION must be used when creating a thread in order to use the specified stack size.
</p>
<h4>Solution</h4>
<p class="cr">
Added the STACK_SIZE_PARAM_IS_A_RESERVATION  parameter to CreateThread to force it to use the stack size parameter instead of taking the default linker stack size.
</p>
</div>
<br><a name="CR20920"><div class="synopsis" id="CR20920_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20920')">CR#20920</a> :</b> IP addresses of GPRS interfaces are not returned by GetAllLocalIpAddresses on Windows CE.
</div>
<div class="detail" id="CR20920_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20920')">CR#20920</a> :</b> IP addresses of GPRS interfaces are not returned by GetAllLocalIpAddresses on Windows CE.
<h4>Description</h4>
<p class="cr">
When calling GetAllLocalIpAddresses() on Windows CE with IPv6 disabled and a GPRS link established, the IP address of the GPRS link is not returned by GetAllLocalIpAddresses().
</p>
<h4>Solution</h4>
<p class="cr">
Changed a condition in the IPv4 implementation of GetAllLocalIpAddresses() so that all interfaces that are not of type loopback have their IP returned.
</p>
</div>
<br><a name="CR20940"><div class="synopsis" id="CR20940_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20940')">CR#20940</a> :</b> Add padding to DH keys when necessary
</div>
<div class="detail" id="CR20940_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20940')">CR#20940</a> :</b> Add padding to DH keys when necessary
<h4>Description</h4>
Instead of delegating the task to the application, add appropriate padding when necessary.
<h4>Solution</h4>
<p class="cr">
The padding behaviour has only been added in the CDiffieHellmanMocanaSs class.  For the CDiffieHellmanOpenSsl class, this padding behaviour was not required because the OpenSSL 0.9.8e library does not show this padding problem. However, an assertion has been added in the CDiffieHellmanOpenSsl class to detect the erroneous situation where the keys are not padded appropriately.
</p>
<h4 class="red">Behaviour Change</h4>
Padding is now made by the Framework.

<h4 class="red">Documentation Update</h4>
The API reference of CDiffieHellman has been updated to reflect the fact that the keys are not padded by the Framework.

</div>
<br><a name="CR20978"><div class="synopsis" id="CR20978_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20978')">CR#20978</a> :</b> Fix certifcate validation in TLS sockets
</div>
<div class="detail" id="CR20978_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20978')">CR#20978</a> :</b> Fix certifcate validation in TLS sockets
<h4>Description</h4>
Peer certificates are not checked for their trust in the trusted certificate list.
<h4>Solution</h4>
The peer certificates are checked for their presence within the list of the trusted certificates, then appended in the peer certificate chain, if trusted. If they are not trusted, the handshake is aborted.
</div>
<br><a name="CR20990"><div class="synopsis" id="CR20990_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20990')">CR#20990</a> :</b> ECom Async sockets should inherit from their interfaces with the protected keyword and wrong TLS sockets manager setter behavior.
</div>
<div class="detail" id="CR20990_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20990')">CR#20990</a> :</b> ECom Async sockets should inherit from their interfaces with the protected keyword and wrong TLS sockets manager setter behavior.
<h4>Description</h4>
<p class="cr">
The old implementation of the asynchronous sockets allowed a pointer to the interfaces (IAsyncSocket, IAsyncClientSocket, ...) class to be freely casted to any implementation classes (CAsyncUdpSocket, CAsyncTcpSocket, ...) as long as sufficient care was taken to make sure this conversion is correct. This should be no longer true with the ECOM implementation, but the current implementation inherits publicly from its interfaces and all implemented interfaces methods are in its public section. This prevents the compiler from detecting this unsupported casting of pointers, which in turn can lead to bugs that are hard to find in code that uses this scheme.
</p>
<p class="cr">
All asynchronous sockets must inherit from their interface with the protected keyword and implement their interfaces in their protected section. Very few methods should be in the public section of the ECOM implementation of asynchronous sockets. Acceptable public methods are those defined with MX_DECLARE_DELEGATING_IECOMUNKNOWN and the like or methods with particular uses such as static methods required to interact with C code. The asynchronous TLS socket (MocanaSs version) has such methods.
</p>
<p class="cr">
It has been detected that the managers setter methods of the asynchronous TLS client and server sockets refuses to set the managers to NULL. This behavior is not identical to asynchronous UDP and TCP sockets. It must be changed.
</p>
<h4>Solution</h4>
<p class="cr">
<ul>
<li class="cr">Made sure all interfaces and classes inheritance in the asynchronous sockets use the protected scheme.</li>
<li class="cr">Made sure all implemented interfaces methods are in the protected section of the implementation classes, except for those rare methods that are required to be public.</li>
</p>
<p class="cr">
Also, to keep all asynchronous sockets's behaviour identical, all managers of the TLS client and server sockets can now be set to NULL.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
To keep all asynchronous sockets's behaviour identical, all managers of the TLS client and server sockets can now be set to NULL.
</p>

</div>
<br><a name="CR20998"><div class="synopsis" id="CR20998_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20998')">CR#20998</a> :</b> CUuidGeneratorMitosFw always generates the same uuid for Symbian.
</div>
<div class="detail" id="CR20998_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20998')">CR#20998</a> :</b> CUuidGeneratorMitosFw always generates the same uuid for Symbian.
<h4>Description</h4>
<p class="cr">
Running CTestCUuidGenerator::TestCUuidGenerator fails on Symbian, the same uuid is always generated.
</p>
<p class="cr">
This problem comes from the use of a ?static_cast&lt;long int&gt;? to convert and print the uTime, a uint64_t value obtained through CTimer::GetSystemUpTimeMs().
</p>
<h4>Solution</h4>
<p class="cr">
Changed the MxSnprintf format.
</p>
</div>
<br><a name="CR20999"><div class="synopsis" id="CR20999_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR20999')">CR#20999</a> :</b> EvAsyncTlsSocketMgrTlsHandshakingCompletedAwaitingApproval must not be called when a cached TLS session was used.
</div>
<div class="detail" id="CR20999_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR20999')">CR#20999</a> :</b> EvAsyncTlsSocketMgrTlsHandshakingCompletedAwaitingApproval must not be called when a cached TLS session was used.
<h4>Description</h4>
<p class="cr">
EvAsyncTlsSocketMgrTlsHandshakingCompletedAwaitingApproval must not be called when a cached TLS session is used. In that case, the certificate chain will be empty and there will not be anything to approve. The load of checking if a cached TLS session is used is done by the framework instead of every other package.
</p>
<h4>Solution</h4>
<p class="cr">
EvAsyncTlsSocketMgrTlsHandshakingCompletedAwaitingApproval is now only called when the TLS session ID and the cached TLS session ID are different. Note that  TlsHandshakingApprovalCompletedA is now called directly when the IDs are the same. This change was made in CAsyncTlsSocket::EvTlsHandshakingSucceeded for Mocana and in CAsyncTlsSocket::ConnectingTls for OpenSsl.
</p>
</div>
<br><a name="CR21037"><div class="synopsis" id="CR21037_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR21037')">CR#21037</a> :</b> Remove C4345 warning when compiling using msvc6/7/8.
</div>
<div class="detail" id="CR21037_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR21037')">CR#21037</a> :</b> Remove C4345 warning when compiling using msvc6/7/8.
<h4>Description</h4>
<p class="cr">
The following code generates a C4345 warning when it is compiled with msvc6/7/8:
</p>
<pre class="cr">
CVList&lt;myStruct&gt;* pvlistMyStruct  = MX_NEW(CVList&lt;myStruct&gt;);
</pre>
<p class="cr">
The msvc C4345 warning reports a behaviour change in the Visual C++ compiler. When a POD object  is initialized with ?( )?, the compiler will default-initialize the object.
</p>
<p class="cr">
For details, see http://msdn2.microsoft.com/en-us/library/wewb47ee(vs.71).aspx.
</p>
<h4>Solution</h4>
<p class="cr">
In the file SVList.h, the "( )" after "new (pvoid) _Type" was identified as the origin of the problem and it was removed.
</p>
<p class="cr">
The modified code must remain as follows:
</p>
<pre class="cr">
template&lt;class _Type&gt;
void CVList&lt;_Type&gt;::Construct(OUT void* pvoid)
{
 new (pvoid) _Type;
}
</pre>
</div>
<br><br><h3>Documentation Updates</h3>
<a name="CR18312"><div class="synopsis" id="CR18312_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18312')">CR#18312</a> :</b> The CTlsContext::SetCiphers documentation in the .cpp is not in the API Reference.
</div>
<div class="detail" id="CR18312_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18312')">CR#18312</a> :</b> The CTlsContext::SetCiphers documentation in the .cpp is not in the API Reference.
<h4>Description</h4>
<p class="cr">
  The declaration of the function CTlsContext::SetCiphers does not match its definition and this causes a compilation error as well as Doc-o-Matic to not include it in the API Reference.
</p>
<h4>Solution</h4>
<p class="cr">
Changed the method's signature so that both declaration and definition match.  The method now takes a const reference to a CString as parameter.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
  The interface of CTlsContext::SetCiphers has been changed from:
</p>
<pre class="cr">
  mxt_result SetCiphers(IN const CString strCiphers);
</pre>
<p class="cr">
  to:
</p>
<pre class="cr">
  mxt_result SetCiphers(IN const CString&amp; rstrCiphers);
</pre>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The documentation of CTlsContext::SetCiphers has been updated for the new signature of the method. The description of this method has also been improved.
</p>

</div>
<br><a name="CR19052"><div class="synopsis" id="CR19052_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19052')">CR#19052</a> :</b> Write Programmer's Guide, config section.
</div>
<div class="detail" id="CR19052_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19052')">CR#19052</a> :</b> Write Programmer's Guide, config section.
<h4>Description</h4>
<p class="cr">
Wrote the configuration section of the Programmer's Guide for Framework 2.1 using information acquired from the source code, discussions with Charles-Antoine and Francis Bradley and the Framework API reference guide.
</p>
<h4>Solution</h4>
<p class="cr">
Used Programmer's Guide template and created a configuration section for Framework 2.1.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Configuration Section added to the Programmer's Guide.
</p>

</div>
<br><a name="CR19081"><div class="synopsis" id="CR19081_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19081')">CR#19081</a> :</b> Make test plan documentation doc-O-matic compliant.
</div>
<div class="detail" id="CR19081_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19081')">CR#19081</a> :</b> Make test plan documentation doc-O-matic compliant.
<h4>Description</h4>
<p class="cr">
The in-code documentation for the framework testcases need to be modified to follow the requirements of Doc-O-Matic, such that proper documentation can be automatically generated.
</p>
<p class="cr">
Testcase documentation includes:
- A high-level description of the test case must be provided.
- Each test scenario was documented with the appropriate header.
</p>
<h4>Solution</h4>
<p class="cr">
The new headers and more detailed documentation needed to be added to the testcases.
</p>
<p class="cr">
The RunUnitTests() function has been added and all grouped testcases have been moved into this funciton.  RunUnitTests() was then called from the point the testcases used to be ran (i.e. in the main()).
</p>
</div>
<br><a name="CR19137"><div class="synopsis" id="CR19137_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19137')">CR#19137</a> :</b> The programmer's guide Startup section needs to be written.
</div>
<div class="detail" id="CR19137_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19137')">CR#19137</a> :</b> The programmer's guide Startup section needs to be written.
<h4>Description</h4>
<p class="cr">
Wrote the Startup guide section of the Programmer's Guide for Framework 2.1 using information acquired from the source code, discussions Francis Bradley, and the Framework API reference guide.
</p>
<h4>Solution</h4>
<p class="cr">
Used Programmer's Guide template and created a startup section for Framework 2.1.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Startup Section added to the Programmer's Guide.
</p>

</div>
<br><a name="CR19277"><div class="synopsis" id="CR19277_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19277')">CR#19277</a> :</b> Write Programmer's Guide, ECOM section.
</div>
<div class="detail" id="CR19277_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19277')">CR#19277</a> :</b> Write Programmer's Guide, ECOM section.
<h4>Description</h4>
<p class="cr">
Wrote the ECOM section of the Programmer's Guide for Framework 2.1 using information acquired from the source code, discussions with Francis Bradley, and the Framework API reference guide.
</p>
<h4>Solution</h4>
<p class="cr">
Used Programmer's Guide template and created an ECOM section for Framework 2.1 and merged it in with the most recent version of the Programmer's Guide.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
ECOM Section added to the Programmer's Guide.
</p>

</div>
<br><a name="CR19384"><div class="synopsis" id="CR19384_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19384')">CR#19384 (Incident 1995)</a> :</b> MXD_VXWORKS_VERSION is not documented in Framework 2.1
</div>
<div class="detail" id="CR19384_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19384')">CR#19384 (Incident 1995)</a> :</b> MXD_VXWORKS_VERSION is not documented in Framework 2.1
<h4>Description</h4>
<p class="cr">
The documentation for MXD_VXWORKS_VERSION is missing from the API reference guide.
</p>
<h4>Solution</h4>
<p class="cr">
Added API documentation for MXD_VXWORKS_VERSION in MxConfig.h.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Preprocessor macro used to specify the version of the VxWorks operating system for which we are building.
</p>
<p class="cr">
Must take a value of 0x50400 for VxWorks 5.4 and 0x050500 for VxWorks 5.5.
</p>
<p class="cr">
Define this in "PreMxConfig.h".
</p>

</div>
<br><a name="CR19602"><div class="synopsis" id="CR19602_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19602')">CR#19602</a> :</b> Add CServicingThread section to Framework programmer's guide. 
</div>
<div class="detail" id="CR19602_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19602')">CR#19602</a> :</b> Add CServicingThread section to Framework programmer's guide. 
<h4>Description</h4>
<p class="cr">
        This CR adds a new section to the M5T Framework Programmer's Guide document to describe the functionality and usage of the CServicingThread and CEventDriven classes.
</p>
<h4>Solution</h4>
<p class="cr">
        Reconciled the Programmer's Guide documents styles to minimize the amount of styles in use.
</p>
<p class="cr">
        Formatted most of the document for consistency.
</p>
<p class="cr">
        Added a short introduction to both CServicingThread and CEventDriven.
</p>
<p class="cr">
        Added Messaging Service Introduction.
</p>
<p class="cr">
        Added detailed usage for the IMessageServiceMgr interface with a coding example of a typical way to capture events from the CServicingThread.
</p>
<p class="cr">
        Added detailed usage for calling PostMessage.
</p>
<p class="cr">
        Added sequence diagram for synchronous and asynchronous PostMessage processing.
</p>
<p class="cr">
        Added a section describing processing order rules (Issues when using synchronous calls when calling from the same thread as the CServicingThread).
</p>
<p class="cr">
        Detailed Code Sample for the CServicingThread IMessageService service.
</p>
<p class="cr">
        Added Timer Service Introduction.
</p>
<p class="cr">
        Added a section for detailed usage of timer services.
</p>
<p class="cr">
        Added a sequence diagram of usage of timer service as well as a code sample.
</p>
<p class="cr">
        Added socket service detailed description and intro.
</p>
<p class="cr">
        Added CEventDriven section describing its uses and usage.
</p>
</div>
<br><a name="CR18887"><div class="synopsis" id="CR18887_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18887')">CR#18887</a> :</b> Internal symbols shouldn't be documented in the API Reference.
</div>
<div class="detail" id="CR18887_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18887')">CR#18887</a> :</b> Internal symbols shouldn't be documented in the API Reference.
<h4>Description</h4>
<p class="cr">
The API Reference document is quite large and it includes documentation for symbols that are not useful to the end user. The excess of documentation should be removed to ease the readability of the API Reference document.
</p>
<p class="cr">
Among other things, the MXD_STUB_* macros, the constructors/destructors of interfaces, the protected/private members of classes, the specialized implementations of interfaces should not be documented in the API Reference document has they cannot or should not be accessed directly by the end user.
</p>
<h4>Solution</h4>
<p class="cr">
To fix this CR many files have been modified. For the most part, the modifications have been to add M5T_INTERNAL_USE_BEGIN / M5T_INTERNAL_USE_END comments to keep the existing documentation of all symbols but prevent some of it from appearing in the API Reference document.
<p class="cr">
The QA section of the Doc-O-Matic software has also been used to solve this CR. All red squares, representing undocumented code, have been removed. It happens that all undocumented code was code that should not be documented, so the QA view no longer shows any red squares.
</p>
<p class="cr">
A second part to the CR fix has been to review the document structure and its base template. The Doc-O-Matic template is now the most recent one and allows for the API Reference document generation with the command 'm5tmake apiref'. This structure review implies that the source code documentation specifies the grouping of topics with the '&lt;GROUP &gt;' tag. The 'TestCases/ApiRefStructure.h' file has been added to specify the document structure and special topics. The '.dtx' file for the API Reference has been removed because it was no longer useful.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The API Reference document has been revised to present only relevant information to the user.
</p>

</div>
<br><a name="CR19967"><div class="synopsis" id="CR19967_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR19967')">CR#19967</a> :</b> It should be documented to not rely on puSizeSent when the retuned mxt_result is not resS_OK.
</div>
<div class="detail" id="CR19967_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR19967')">CR#19967</a> :</b> It should be documented to not rely on puSizeSent when the retuned mxt_result is not resS_OK.
<h4>Description</h4>
<p class="cr">
It should be documented to not rely on puSizeSent when the returned mxt_result is not resS_OK.
</p>
<h4>Solution</h4>
<p class="cr">
The IIoSocket, IAsyncIoSocket, and IAsyncUnconnectedIoSocket interfaces documentation has been revised to document that the puSizeSent parameter is not reliable if the Send/SendTo methods return anything else than resS_OK.
</p>
<p class="cr">
While at it, all asynchronous sockets interfaces documentation has been revised to ensure its correctness and completeness along with documentation guideline compliance.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The API reference document has been updated with all changes described in the detailed fix section.
</p>

</div>
<br></div>
<br>
<hr>
<div id="label2.1.3.3_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.3.3')">Version 2.1.3</a> (build 3): Created on December 19, 2006
</div>
<div id="label2.1.3.3_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.3.3')">Version 2.1.3</a> (build 3): Created on December 19, 2006
<br><br><h3>New Features and Improvements</h3>
<a name="CR18037"><div class="synopsis" id="CR18037_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18037')">CR#18037</a> :</b> Add package IDs for new products.
</div>
<div class="detail" id="CR18037_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18037')">CR#18037</a> :</b> Add package IDs for new products.
<h4>Description</h4>
<p class="cr">
Package IDs must be added for the following new products:
<ul>
<li class="cr">UA SSP Integration</li>
<li class="cr">UA SSP</li>
</ul>
</p>
<h4>Solution</h4>
<p class="cr">
Added the following packages to the enum, in PkgId.h:
</p>
<ul>
<li class="cr">eMX_PKG_UASSPINTEGRATION</li>
<li class="cr">eMX_PKG_UASSP</li>
</ul>
</div>
<br><a name="CR18134"><div class="synopsis" id="CR18134_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18134')">CR#18134</a> :</b> GetLocalIPAddr(IPv4/IPv6) must support multiple interfaces
</div>
<div class="detail" id="CR18134_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18134')">CR#18134</a> :</b> GetLocalIPAddr(IPv4/IPv6) must support multiple interfaces
<h4>Description</h4>
<p class="cr">
The GetLocalIPv4Addr function returns the first IP address of the first interface found in VxWorks, Windows, and WindowsCE. Since no check is made against the routing table, the best local IP address is not always returned. This slows down the transmission of data in UDP or TCP. This problem also occurs in the GetLocalIPv6Addr function in VxWorks.
</p>
<h4>Solution</h4>
<p class="cr">
For GetLocalIPv4Addr in VxWorks, Windows, and WindowsCE, and GetLocalIPv6Addr in VxWorks, a check for the best route to the peer address is now made against the routing table. The local IP of the interface corresponding to the best route is now returned.
</p>
</div>
<br><a name="CR18203"><div class="synopsis" id="CR18203_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18203')">CR#18203</a> :</b> All CMemoryAllocator allocation routines need to have same allocation overhead for the realization of REQ-292.
</div>
<div class="detail" id="CR18203_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18203')">CR#18203</a> :</b> All CMemoryAllocator allocation routines need to have same allocation overhead for the realization of REQ-292.
<h4>Description</h4>
<p class="cr">
        Currently, the CMemoryAllocator has two different memory allocation routines. These two routines have different memory overhead. To allow for the implementation of the upcoming memory pooling mechanism, it would be a problem because the application would need to be told which of the method is being called to correctly calculate.
</p>
<p class="cr">
        The code for CMemoryAllocator::AllocateWithAlignment needs to become the only way to allocate memory as it is the most common denominator that works in all cases.
</p>
<h4>Solution</h4>
<p class="cr">
        Removed the CMemoryAllocator::Allocate and CMemoryAllocator::Deallocate methods.
</p>
<p class="cr">
        Renamed the CMemoryAllocator::AllocateWithAlignmnent and CMemoryAllocator::DeallocateWithAlignment to CMemoryAllocator::Allocate and CMemoryAllocator::Deallocate respectively.
</p>
<p class="cr">
        Added the g_uMEMORY_BLOCK_OVERHEAD_SIZE global variable to have a central location from which to get the per-block memory overhead size.
</p>
<p class="cr">
        Changed the MX_NEW, MX_DELETE, MX_NEW_ARRAY, and MX_DELETE_ARRAY to all use CMemoryAllocator::Allocate and CMemoryAllocator::Deallocate.
</p>
<p class="cr">
        Updated the CTestCMemoryAllocator test case to use the new overhead (using g_uMEMORY_BLOCK_OVERHEAD_SIZE) to calculate proper allocation and deallocation.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
        The following methods have been removed from CMemoryAllocator:
<pre class="cr">
            static void* GO AllocateWithAlignment(IN size_t size);
</pre>
<pre class="cr">
            static void DeallocateWithAlignment(IN TO void* pvoidBlock);
</pre>
<pre class="cr">
            static void DeallocateWithAlignment(IN TO const void* pvoidBlock);
</pre>
</p>
<p class="cr">
        The following global variable has been added to CMemoryAllocator:
<pre class="cr">
             const size_t g_uMEMORY_BLOCK_OVERHEAD_SIZE;
</pre>
</p>

</div>
<br><a name="CR18266"><div class="synopsis" id="CR18266_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18266')">CR#18266</a> :</b> Added memory tracking support and memory allocation extra information collection to CMemoryAllocator. 
</div>
<div class="detail" id="CR18266_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18266')">CR#18266</a> :</b> Added memory tracking support and memory allocation extra information collection to CMemoryAllocator. 
<h4>Description</h4>
<p class="cr">
        The CMemoryAllocator currently does not track allocated memory. To allow for easier debugging of memory leaks and memory related issues, a memory tracking mechanism needs to be added to the CMemoryAllocator.
</p>
<p class="cr">
        Part of this CR also includes the addition of the ability to retrieve extra information about an allocated memory block. This is coupled with the memory tracking to offer even more information about currently allocated blocks.
</p>
<h4>Solution</h4>
<p class="cr">
        Added the MXD_MEMORY_ALLOCATOR_MEMORY_TRACKING_ENABLE_SUPPORT compiler flag to enable the support for memory tracking.
</p>
<p class="cr">
        Added the MXD_MEMORY_ALLOCATOR_EXTRA_INFORMATION_ENABLE_SUPPORT compiler flag to enable support for the keeping of extra information about a memory allocation.
</p>
<p class="cr">
        Added the MXD_FRAMEWORK_FINALIZE_INFO_NUMBER_OF_STORED_LEAKED_MEMORY_BLOCKS compiler flag to enable the user to decide how many memory blocks are part of the CFrameworkInitializer::SFrameworkFinalizeInfo structure.
</p>
<p class="cr">
        Added the CMemoryAllocator::CMemoryBlock class, which represents a memory block and its header. The CMemoryBlock class has accessors for all the information it contains.
</p>
<p class="cr">
        The CMemoryAllocator::CMemoryBlock contains next and previous pointers to other CMemoryBlocks headers, which allows them to become part of a doubly linked list, which is the mechanism used to track the memory.
</p>
<p class="cr">
        Added the CMemoryAllocator::SMemoryBlockExtraInfo structure, which holds all the extra information contained in a memory block. This structure is only used when MXD_MEMORY_ALLOCATOR_EXTRA_INFORMATION_ENABLE_SUPPORT is defined.
</p>
<p class="cr">
        Added the CMemoryAllocator::SMemoryBlockHeader struture, which contains all the header information about a memory allocation. A memory block contains the user memory and the header.
</p>
<p class="cr">
        Added the CMemoryAllocator::GetMemoryBlock method, which is used to get the pointer to the CMemoryAllocator::CMemoryBlock corresponding to a user allocated memory location.
</p>
<p class="cr">
        Added the CMemoryAllocator::Allocate method overload taking an SMemoryBlockExtraInfo as a parameter. Then, if the MXD_MEMORY_ALLOCATOR_EXTRA_INFORMATION_ENABLE_SUPPORT compiler flag is defined, the CMemoryAllocator keeps a copy of the SMemoryBlockExtraInfo along with the memory block.
</p>
<p class="cr">
        Added the CMemoryAllocator::EnumMemoryBlocks method used to enumerate through all the currently allocated memory blocks by passing in a CMemoryAllocator::IMemoryBlockAccumulator pointer.
</p>
<p class="cr">
        Changed the CMemoryAllocator::Allocate and CMemoryAllocator::Deallocate methods to use the new CMemoryBlock mechanism for allocating blocks.
</p>
<p class="cr">
        Added the CMemoryAllocator::InsertMemoryBlock and CMemoryAllocator::RemoveMemoryBlock helper functions to facilitate the double linked list manipulations.
</p>
<p class="cr">
        Changed the MX_NEW, MX_NEW_ARRAY, MX_DELETE, and MX_DELETE_ARRAY macros to use the new CMemoryAllocator::Allocate method for storing extra information when the MXD_MEMORY_ALLOCATOR_EXTRA_INFORMATION_ENABLE_SUPPORT macro is defined.
</p>
<p class="cr">
        Fixed issue in CFrameworkInitializer where MXD_MEMORY_ALLOCATOR_STATISTICS_ENABLE_SUPPORT was needed to be defined instead of MXD_MEMORY_ALLOCATOR_ENABLE_SUPPORT for initializing/finalizing the CMemoryAllocator.
</p>
<p class="cr">
        Added the CFrameworkInitializer::SFrameworkFinalizeInfo structure, which holds some information about the current state of the framework when the finalization is performed.
</p>
<p class="cr">
        Changed CFrameworkInitializer::Finalize to take one optional OUT parameter that can contain a pointer to a SFrameworkFinalizeInfo structure.
</p>
<p class="cr">
        Added unit testing to the CTestCMemoryAllocator.cpp file for all the new features.
</p>
<p class="cr">
        Added unit testing to the CTestCFrameworkInitialize.cpp file for all the new features.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
        The following methods have been added to CMemoryAllocator:
<pre class="cr">
            static CMemoryBlock* GetMemoryBlock(IN void* pv);
</pre>
<pre class="cr">
            static void* GO Allocate(IN size_t uSize, IN SMemoryBlockExtraInfo const&amp; rExtraInfo);
</pre>
<pre class="cr">
            static void EnumMemoryBlocks(IN IMemoryBlockAccumulator* pAccumulator);
</pre>
</p>
<p class="cr">
        The following data types have been added to CMemoryAllocator:
<pre class="cr">
            class CMemoryBlock
</pre>
<pre class="cr">
            struct SMemoryBlockExtraInfo
</pre>
<pre class="cr">
            struct SMemoryBlockHeader
</pre>
<pre class="cr">
            class IMemoryBlockAccumulator
</pre>
</p>
<p class="cr">
        The following MxConfig compiler flags have been added:
<pre class="cr">
            #define MXD_MEMORY_ALLOCATOR_MEMORY_TRACKING_ENABLE_SUPPORT
</pre>
<pre class="cr">
            #define MXD_MEMORY_ALLOCATOR_EXTRA_INFORMATION_ENABLE_SUPPORT
</pre>
<pre class="cr">
            #define MXD_FRAMEWORK_FINALIZE_INFO_NUMBER_OF_STORED_LEAKED_MEMORY_BLOCKS
</pre>
</p>
<p class="cr">
        The following structure has been added to the CFrameworkInitializer class:
<pre class="cr">
            struct SFrameworkFinalizeInfo
</pre>
</p>
<p class="cr">
        The following function in CFrameworkInitializer has been changed to include a new optional parameter:
<pre class="cr">
            static void Finalize(OUT SFrameworkFinalizeInfo* pstFinalizeInfo = NULL);
</pre>
</p>

</div>
<br><a name="CR18232"><div class="synopsis" id="CR18232_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18232')">CR#18232</a> :</b> Add the new package ID eMX_PKG_TR_111_PART_2_SERVER.
</div>
<div class="detail" id="CR18232_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18232')">CR#18232</a> :</b> Add the new package ID eMX_PKG_TR_111_PART_2_SERVER.
<h4>Description</h4>
    A new package ID ( eMX_PKG_TR_111_PART_2_SERVER ) is required in the 2.1 Framework
    since a new product has been added.
<h4>Solution</h4>
    Defined the package ID in Basic\PkgId.h.
<h4 class="red">Interface Change</h4>
<p class="cr">
        eMX_PKG_TR_111_PART_2_SERVER is now available for traces and results.
</p>

</div>
<br><a name="CR18319"><div class="synopsis" id="CR18319_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18319')">CR#18319</a> :</b> Add MX_MAKE_STRING_NULL_SAFE.
</div>
<div class="detail" id="CR18319_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18319')">CR#18319</a> :</b> Add MX_MAKE_STRING_NULL_SAFE.
<h4>Description</h4>
<p class="cr">
    When tracing c-style strings with the Framework's trace mechanism, the application may crash on some systems if the string is NULL. This is due to the lack of NULL strings validation in the run-time libraries functions (like printf) of those systems (i.e. Symbian).
</p>
<p class="cr">
    There should be a macro or function in the framework that helps to manage the case where the string is NULL. Such a macro or function would verify the pointer value and when it is NULL, would return a replacement string (e.g. "(null)").
</p>
<p class="cr">
    The macro could look like the following.
</p>
<pre class="cr">
    const char g_szNULL[] = "NULL";
    #define MX_MAKE_STRING_NULL_SAFE(pszValue) (pszValue != NULL ? pszValue : g_szNULL)
</pre>
<p class="cr">
    Then to make sure a string does not crash the system, calls to run-time libraries are made like the following.
</p>
<pre class="cr">
    // Suppose that in the code where this call is made and at the point where it is made, pszSomeString
    // can either be NULL or a valid string. To prevent crashes, the call will be made like this:
    printf("%s", MX_MAKE_STRING_NULL_SAFE(pszSomeString));
</pre>
<h4>Solution</h4>
<p class="cr">
    To fix this issue, the macro MX_MAKE_STRING_NULL_SAFE(pszValue) has been defined in the Basic/MxMacro.h Framework source file. The global constant string "(null)" has been declared in the Basic/MxDef.h file and defined in the Basic/MxDef.cpp file. Doing this allows the macro to be used easily throughout the framework and code that uses the framework through the inclusion of MxConfig.h.
</p>
<p class="cr">
    Framework calls to run-time libraries functions, that required it, have been modified to make use of the new macro.
</p>
<p class="cr">
    The macro is actually only active (testing the pointer) on the Symbian platform. For other platforms, it only returns the given pointer.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
    Added documentation for the new macro in the source code. Updated the Framework API reference.
</p>

</div>
<br><a name="CR18362"><div class="synopsis" id="CR18362_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18362')">CR#18362</a> :</b> Removed Ping support in NetworkTools
</div>
<div class="detail" id="CR18362_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18362')">CR#18362</a> :</b> Removed Ping support in NetworkTools
<h4>Description</h4>
<p class="cr">
The Ping() function is only supported on VxWorks. Since it is not used and the OS provides the same functionality, remove it.
</p>
<h4>Solution</h4>
<p class="cr">
Removed the code of the ping method in NetworkTools.
</p>
</div>
<br><a name="CR18363"><div class="synopsis" id="CR18363_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18363')">CR#18363</a> :</b> Add GetAllLocalIpAddresses support.
</div>
<div class="detail" id="CR18363_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18363')">CR#18363</a> :</b> Add GetAllLocalIpAddresses support.
<h4>Description</h4>
<p class="cr">
It would be useful to know all the local IP addresses and their associated interface name for the local machine.
</p>
<h4>Solution</h4>
<p class="cr">
The GetAllLocalIpAddresses function has been implemented in NetworkTools. GetAllLocalIpAddresses returns all the IP addresses and their associated interface name for the local machine.  GetAllLocalIpAddresses supports both IPv4 and IPv6 addresses. It has been implemented for the following OSes:
</p>
<ul>
<li class="cr">Linux</li>
<li class="cr">Symbian</li>
<li class="cr">Nucleus</li>
<li class="cr">VxWorks 5.4</li>
<li class="cr">VxWorks 5.5</li>
<li class="cr">Windows 2000</li>
<li class="cr">Windows 2003</li>
<li class="cr">Windows XP</li>
<li class="cr">Windows CE</li>
</ul>
</div>
<br><a name="CR18383"><div class="synopsis" id="CR18383_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18383')">CR#18383</a> :</b> MxStringToUnsignedIntXX and MxUnsignedIntXXToString must be supported.
</div>
<div class="detail" id="CR18383_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18383')">CR#18383</a> :</b> MxStringToUnsignedIntXX and MxUnsignedIntXXToString must be supported.
<h4>Description</h4>
<p class="cr">
Conversion from string to int and int to string is code that is repeated often in higher level products. There should be helper methods to facilitate this in the framework.
</p>
<h4>Solution</h4>
<p class="cr">
Added the MxUintToString, MxIntToString, MxStringToUint, and MxStringToInt functions to the MxStringFormat file.
</p>
<p class="cr">
Added the EMxBase enum to MxDef.h
</p>
<p class="cr">
Updated MxTrace.cpp and MxTraceKernel.cpp to use the new functions.
</p>
<p class="cr">
Updated the CSocketAddr class to use the EMxBase enum and the new functions.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Removed the following functions from MxStringFormat:
</p>
<pre class="cr">
int MxUnsignedInt64ToString(OUT char *pszBuffer,
                            IN int nSize,
                            IN uint64_t nValue,
                            IN int nBase);
uint64_t MxStringToUnsignedInt64(IN const char* pszBuffer,
                                 OUT char** ppszEndbuffer,
                                 IN int nBase);
int MxUnsignedInt32ToString(OUT char *pszBuffer,
                            IN int nSize,
                            IN uint32_t nValue,
                            IN int nBase);
</pre>
<p class="cr">
Added the following functions in MxStringFormat:
</p>
<pre class="cr">
char* MxUintToString(IN uint64_t uValue,
                     IN unsigned int uCapacity,
                     OUT char* pszBuffer,
                     OUT unsigned int* puSize,
                     IN EMxBase eBase = eBASE_DECIMAL);
char* MxIntToString(IN int64_t nValue,
                    IN unsigned int uCapacity,
                    OUT char* pszBuffer,
                    OUT unsigned int* puSize,
                    IN EMxBase eBase = eBASE_DECIMAL);
uint64_t MxStringToUint(IN const char* pcBuffer,
                        IN unsigned int uSize,
                        IN EMxBase eBase = eBASE_DECIMAL,
                        OUT mxt_result* pRes = NULL,
                        OUT unsigned int* puSizeParsed = NULL);
uint64_t MxStringToUint(IN const char* pszBuffer,
                        IN EMxBase eBase = eBASE_DECIMAL,
                        OUT mxt_result* pRes = NULL,
                        OUT unsigned int* puSizeParsed = NULL);
int64_t MxStringToInt(IN const char* pcBuffer,
                      IN unsigned int uSize,
                      IN EMxBase eBase = eBASE_DECIMAL,
                      OUT mxt_result* pRes = NULL,
                      OUT unsigned int* puSizeParsed = NULL);
int64_t MxStringToInt(IN const char* pszBuffer,
                      IN EMxBase eBase = eBASE_DECIMAL,
                      OUT mxt_result* pRes = NULL,
                      OUT unsigned int* puSizeParsed = NULL);
</pre>
<p class="cr">
Removed the following enum from CSocketAddr:
</p>
<pre class="cr">
    enum EDottedAddressBase
    {
        eBASE_AUTO          = 0,
        eBASE_OCTAL         = 8,
        eBASE_DECIMAL       = 10,
        eBASE_HEXADECIMAL   = 16,
        eBASE_INVALID
    };
</pre>
<p class="cr">
Added the following enum in MxDef:
</p>
<pre class="cr">
typedef enum
{
    eBASE_AUTO        = 0,
    eBASE_BINARY      = 2,
    eBASE_OCTAL       = 8,
    eBASE_DECIMAL     = 10,
    eBASE_HEXADECIMAL = 16,
    eBASE_INVALID
} EMxBase;
</pre>

</div>
<br><a name="CR18388"><div class="synopsis" id="CR18388_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18388')">CR#18388</a> :</b> mxt_opaque must be defined as void*.
</div>
<div class="detail" id="CR18388_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18388')">CR#18388</a> :</b> mxt_opaque must be defined as void*.
<h4>Description</h4>
<p class="cr">
For the code to be safe on 32 bit and 64 bit architectures, mxt_opaque must be defined as a void*. This way, it is big enough to hold a pointer no matter the architecture of the machine on which it runs.
</p>
<h4>Solution</h4>
<p class="cr">
Changed the declaration of the mxt_opaque type to a void* on all platforms.
</p>
<p class="cr">
Changed traces that show the value of a mxt_opaque to now use the %p format modifier.
</p>
<p class="cr">
Changed assignations of mxt_opaque to use a reinterpret_cast.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
It is now necessary to use a reinterpret_cast to assign a non pointer value to a mxt_opaque. For example, use the following to assign an integer to a mxt_opaque:
</p>
<pre class="cr">
mxt_opaque opq = reinterpret_cast&lt;mxt_opaque&gt;(1);
</pre>
<p class="cr">
Since it is not permitted to do arithmetics on a void*, it is not permitted on mxt_opaque either. For example, the following is no longer valid:
</p>
<pre class="cr">
mxt_opaque opq = 0;
opq++;
</pre>
<p class="cr">
One should use a variation of the following code instead:
</p>
<pre class="cr">
mxt_opaque opq = NULL;
unsigned int uValue = 0;
uValue++;
opq = reinterpret_cast&lt;mxt_opaque&gt;(uValue);
</pre>
<p class="cr">
When assigning a mxt_opaque to a pointer to a member variable of a class from within a const method, it is necessary to do a const cast followed by a reinterpret_cast, as follows:
</p>
<pre class="cr">
class CExample
{
public:
    void GetOpaqueCount(OUT mxt_opaque opq) const;
private:
    unsigned int m_uCount;
};

void CExample::GetOpaqueCount(OUT mxt_opaque opq) const
{
    opq = reinterpret_cast&lt;mxt_opaque&gt;(const_cast&lt;unsigned int*&gt;(&amp;m_uCount));
}
</pre>

<h4 class="red">Documentation Update</h4>
<p class="cr">
Added a section on the mxt_opaque custom data type in the M5T Framework API Reference.
</p>

</div>
<br><a name="CR18403"><div class="synopsis" id="CR18403_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18403')">CR#18403</a> :</b> Add memory pooling mechanism to CMemoryAllocator 
</div>
<div class="detail" id="CR18403_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18403')">CR#18403</a> :</b> Add memory pooling mechanism to CMemoryAllocator 
<h4>Description</h4>
<p class="cr">
    This CR adds a new memory pooling mechanism to the CMemoryAllocator class. This is done to increase performance for the allocation of small objects.
</p>
<h4>Solution</h4>
<p class="cr">
    Added the MXD_astMEMORY_ALLOCATOR_POOL_INFO compiler flag to enable and configure the memory pooling mechanism.
</p>
<p class="cr">
    Added a new flag to EMemoryBlockFlags for the tracking of pooled object. This flag is also accessible from the IsPooled/SetPooled methods of the CMemoryBlock class.
</p>
<p class="cr">
    Moved alignment signature and bound checking magic numbers to the CMemoryBlock class. The CMemoryBlock class is now more complete as it can initialize itself using the Initialize method (note: Not allocate).
</p>
<p class="cr">
    Added CMemoryAllocator::mxt_pfnAllocateFunction and mxt_pfnDeallocateFunction function pointer types to the CMemoryAllocator. These are used as part of the new SMemoryPoolInfo structure and the memory pooling mechanism.
</p>
<p class="cr">
    Added the SMemoryPoolInfo structure, which is used to hold the configuration parameters of a memory pool.
</p>
<p class="cr">
    Added the CMemoryAllocator::CMemoryBlockList class, which encapsulates the functionality of a CMemoryBlock list. This same class is used for both the memory tracking feature and the memory pooling mechanism.
</p>
<p class="cr">
    Added the IMemoryTracker class, which defines the interface for an object that tracks memory allocation.
</p>
<p class="cr">
    Created the CMemoryTracker object, which is the default IMemoryTracker used by the CMemoryAllocator. Also moved the implementation of the memory tracking and memory statistics to this object.
</p>
<p class="cr">
    Added the CMemoryBlockAllocatorBase class, which is an abstract class that needs to be implemented by memory block allocators.
</p>
<p class="cr">
    Created CDefaulMemoryBlockAllocator, which is used as the default allocator when no other allocator can satisfy the requirements.
</p>
<p class="cr">
    Created CPooledMemoryAllocator, which is the pooled implementation of the allocator. It is used for the memory pooling mechanism.
</p>
<p class="cr">
    Added the GetMemoryBlockAllocator method to the CMemoryAllocator, which is used to retrieve the correct memory block allocator to satisfy the size requested for the allocation.
</p>
<p class="cr">
    Changed the CMemoryAllocator's Allocate/Deallocate methods to take into account the new memory pooling mechanism.
</p>
<p class="cr">
    Changed the CMemoryAllocator::EnumMemoryBlocks method to also enumerate pooled memory blocks.
</p>
<p class="cr">
    Fixed test cases to take into consideration memory pooling features.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
    The following methods have been added to CMemoryAllocator::CMemoryBlock:
<pre class="cr">
      bool IsPooled() const;
</pre>
<pre class="cr">
      void SetPooled(IN bool bIsPooled);
</pre>
</p>
<p class="cr">
    The following public data types have been added to CMemoryAllocator:
<pre class="cr">
      typedef GO void* (*mxt_pfnAllocateFunction)(IN size_t uSize);
</pre>
<pre class="cr">
      typedef void (*mxt_pfnDeallocateFunction)(IN TO void* pvoidBlock);
</pre>
<pre class="cr">
      struct SMemoryPoolInfo
</pre>
</p>
<p class="cr">
    The following MxConfig compiler flag has been added:
<pre class="cr">
      #define MXD_astMEMORY_ALLOCATOR_POOL_INFO
</pre>
</p>

</div>
<br><a name="CR17204"><div class="synopsis" id="CR17204_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17204')">CR#17204 (Incident 720)</a> :</b> ntohs must always return 16 bits value.
</div>
<div class="detail" id="CR17204_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17204')">CR#17204 (Incident 720)</a> :</b> ntohs must always return 16 bits value.
<h4>Description</h4>
<p class="cr">
ntohs does not always return a 16 bits value. This causes problems on some platforms. For example, CBlob &lt;&lt; operator. The wrong overloaded version of the operator is used if the user lets the compiler decide which one to use. On some platforms, the 32 bits version is used instead. A macro MX_NTOHS must be created that systematically casts into uint16_t the return of ntohs.
Additionally, the macros MX_HTONS, MX_HTONL and MX_NTONL must be created, which could easily have the same problem.
</p>
<h4>Solution</h4>
<p class="cr">
Added the following macros to MxMacro.h:
</p>
<pre class="cr">
MX_NTOHL
MX_NTOHS
MX_HTONL
MX_HTONS
</pre>
<p class="cr">
Modified all files that used ntohl(), ntohs(), htonl(), or htons() to use the new macros instead.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Added the following macros:
</p>
<pre class="cr">
MX_NTOHL
MX_NTOHS
MX_HTONL
MX_HTONS
</pre>
<p class="cr">
They MUST be used instead of the system methods to ensure uniformity across different platforms.
</p>

</div>
<br><a name="CR18685"><div class="synopsis" id="CR18685_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18685')">CR#18685</a> :</b> Add atomic operations to the framework to be used in CString and ECOM ref-counting.
</div>
<div class="detail" id="CR18685_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18685')">CR#18685</a> :</b> Add atomic operations to the framework to be used in CString and ECOM ref-counting.
<h4>Description</h4>
<p class="cr">
        This new feature adds both portable and native atomic operations support to the Framework. These new operations are used in CString and ECom objects to increase performance.
</p>
<p class="cr">
        The new feature is implemented by adding two new classes in the Kernel folder of the Framework, which are used to provide atomic operations. The current implementation also includes native atomic operations support for the Windows operating system. The design is easily extensible to other platforms that support native atomic operations.
</p>
<h4>Solution</h4>
<p class="cr">
        Added a templated CAtomicOperations class that abstracts the atomic operations Increment, Decrement, Exchange, and Retreive. It also contains a portable implementation using a CMutex to enforce atomicity.
</p>
<p class="cr">
        To support native atomic operations,  which perform much better than a mutex, the CAtomicWin32.h file has been created to add specialization to the CAtomicOperations class for the Windows operating system.
</p>
<p class="cr">
        In addition to the CAtomicOperations class, the CAtomicValue class that wraps the value on which to perform atomic operations for safety has been created. The usage of this class can be summarized as follows:
<pre class="cr">
        class RefCountedClass
        {
            RefCountedClass()
            :   m_atomicRefCount(1)
            {
            }

            uint32_t AddRef()
            {
                return m_atomicRefCount.Increment();
            }

            uint32_t Release()
            {
                uint32_t uResult = m_atomicRefCount.Decrement();
                if (uResult &lt; 1)
                {
                    delete this;
                }
                return result;
            }

        protected:
            virtual ~RefCountedClass()
            {
                MX_ASSERT(m_atomicRefCount.Get() == 0);
            }

        private:
            CAtomicValue&lt;uint32_t&gt; m_atomicRefCount;
        };
</pre>
</p>
<p class="cr">
        Updated the CString class to use CAtomic to synchronize the CString reference count instead of using a mutex.
</p>
<p class="cr">
        Updated the CEComUnknown class to use CAtomic to synchronize its reference count instead of using a mutex.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
        Added the CAtomicOperations class in Source/Kernel/CAtomic.h:
<pre class="cr">
            template&lt;class _Type&gt;
            class CAtomicOperations
</pre>
</p>
<p class="cr">
        Added the CAtomicValue class in Source/Kernel/CAtomic.h:
<pre class="cr">
            template&lt;class _Type&gt;
            class CAtomicOperations
</pre>
</p>
<p class="cr">
         Added the MXD_ATOMIC_NATIVE_ENABLE_SUPPORT configuration macro to enable native atomic operations support on supported platforms. Currently, only Windows is supported.
</p>

</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR17559"><div class="synopsis" id="CR17559_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17559')">CR#17559</a> :</b> Circular refences in CNAME records are not handled
</div>
<div class="detail" id="CR17559_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17559')">CR#17559</a> :</b> Circular refences in CNAME records are not handled
<h4>Description</h4>
<p class="cr">
DNS responses are not checked for circular references in CNAME chains.
</p>
<h4>Solution</h4>
<p class="cr">
The response parser now keeps a history of the parsed names and verifies that the CNAME rdata is not present in the history.
</p>
<p class="cr">
The Windows Platform SDK already provides such a verification and returns DNS_ERROR_CNAME_LOOP.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Added CNAME loop verifiation. If a DNS response has one, the DNS query is considered to have failed.
</p>

</div>
<br><a name="CR18174"><div class="synopsis" id="CR18174_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18174')">CR#18174 (Incident 1568)</a> :</b> Some usage of MXD_IPV6_ENABLE_SUPPORT is not paired with the inclusion of FrameworkCfg.h
</div>
<div class="detail" id="CR18174_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18174')">CR#18174 (Incident 1568)</a> :</b> Some usage of MXD_IPV6_ENABLE_SUPPORT is not paired with the inclusion of FrameworkCfg.h
<h4>Description</h4>
<p class="cr">
In specific cases, the usage of MXD_IPV6_ENABLE_SUPPORT has not been paired with the inclusion of the framework configuration file.
</p>
<h4>Solution</h4>
<p class="cr">
The related files have been modified to include the framework configuration file.
</p>
</div>
<br><a name="CR18222"><div class="synopsis" id="CR18222_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18222')">CR#18222</a> :</b> Servicing Thread timer mechanism consumes too much time when many timer are used.
</div>
<div class="detail" id="CR18222_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18222')">CR#18222</a> :</b> Servicing Thread timer mechanism consumes too much time when many timer are used.
<h4>Description</h4>
<p class="cr">
Timer finding is ultra fast when the full information is passed (manager, timerid, ms)
Timer finding is iterative when part of the information is passed (only the manager or only the manager and the timerid).
</p>
<p class="cr">
Timer insertion/deletion is very slow when a lot of timers exist.
Removal of all the timers of a manager is slower because the list is not ordered by manager. Once a timer is found, the cost is the same as above plus the list interation overhead.
An iterative find is required in a CAATree in addition to the already available find functions.
This requires the possibility of setting an iterative comparaison function, such as available in CVector.
</p>
<h4>Solution</h4>
<p class="cr">
This CR is a duplicate of CR 18130.
</p>
</div>
<br><a name="CR18233"><div class="synopsis" id="CR18233_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18233')">CR#18233</a> :</b> MXD_COMPILER_GNU_GGG is used in CPool.h.
</div>
<div class="detail" id="CR18233_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18233')">CR#18233</a> :</b> MXD_COMPILER_GNU_GGG is used in CPool.h.
<h4>Description</h4>
<p class="cr">
MXD_COMPILER_GNU_GGG is used in CPool.h (line 765).  Currently, the #if is always true because of that, it is now false if the compiler is GCC 2.96 so please test this configuration.
</p>
<h4>Solution</h4>
<p class="cr">
Changed MXD_COMPILER_GNU_GGG to MXD_COMPILER_GNU_GCC in CPool.h. Also searched for other occurrences of MXD_COMPILER_GNU_GGG in the sources. None have been found.
</p>
</div>
<br><a name="CR18286"><div class="synopsis" id="CR18286_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18286')">CR#18286 (Incident 1557)</a> :</b> GCC 2.96+ identification is not always the same.
</div>
<div class="detail" id="CR18286_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18286')">CR#18286 (Incident 1557)</a> :</b> GCC 2.96+ identification is not always the same.
<h4>Description</h4>
<p class="cr">
GCC 2.96+ (supplied by Wind River Systems) does not always identify itself with the same minor version number.  The M5T version internally used and compiled for a Pentium has a minor version number of 9 while some clients have a version that identifies itself with a minor version number of 96.
</p>
<h4>Solution</h4>
<p class="cr">
The MXD_COMPILER_GNU_GCC_2_96 macro that was set using a minor version of 9 has been modified to use a minor version of 96 except if the compiler reports itself as being gcc 2.9, i.e., when  __GNUC__ == 2 and __GNUC_MINOR__ == 9.
</p>
</div>
<br><a name="CR17917"><div class="synopsis" id="CR17917_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17917')">CR#17917</a> :</b> Small defect found with a static analysis tool must be fixed.
</div>
<div class="detail" id="CR17917_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17917')">CR#17917</a> :</b> Small defect found with a static analysis tool must be fixed.
<h4>Description</h4>
<p class="cr">
<ol>
<li class="cr">
A memory leak in CAsyncTcpServerSocket.cpp has been reported by the static code analysis tool Tango.
M5T is trying to prevent this tool from reporting an error message for pAsyncTcpSocket by setting
the variable to NULL before it gets out of scope.
</li>
<li class="cr">
NetworkTools.cpp line 491 - Suspicious dereference of pointer 'szHostName' by passing the hostname argument to the 'strcmp' function. Although the hostname parameter should never be null, the method is protected by checking the parameters.
</li>
</ol>
</p>
<h4>Solution</h4>
<p class="cr">
<ol>
<li class="cr">
Added the requested pAsyncTcpSocket = NULL to prevent static code analysis tool warning.
</li>
<li class="cr">
Added szHostName NULL sanity check.  Also made sure the rlstHostAddr CSocketAddr is empty when the function returns.
</li>
<li class="cr">
szHostName has been renamed pszHostName to follow the coding guidelines.
</li>
</ol>
</p>
</div>
<br><a name="CR18231"><div class="synopsis" id="CR18231_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18231')">CR#18231</a> :</b> ServicingThread timer struct can be removed in a socket callback, causing a crash.
</div>
<div class="detail" id="CR18231_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18231')">CR#18231</a> :</b> ServicingThread timer struct can be removed in a socket callback, causing a crash.
<h4>Description</h4>
<p class="cr">
Under some circumstances, it is possible that a socket callback (from the CPollSocket that is used in CServicingThread::Wait()) can remove the next timer to be fired in the timer vector. If this is the case, then the timer manager pointer becomes invalid and causes the application to crash when the timer manager callback is called.
</p>
<h4>Solution</h4>
<p class="cr">
Moved the call to GetNextTimer() to the start of the 2nd do...while loop. This gets the new timer after the socket events instead of just before it, fixing the problem.
</p>
</div>
<br><a name="CR18329"><div class="synopsis" id="CR18329_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18329')">CR#18329</a> :</b> CBlob::SetReadIndex(...) does not work correctly.
</div>
<div class="detail" id="CR18329_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18329')">CR#18329</a> :</b> CBlob::SetReadIndex(...) does not work correctly.
<h4>Description</h4>
<p class="cr">
    The CBlob::SetReadIndex() method does not allow to set the read index to 0 when the CBlob size is also 0. This is a totally valid operation and needs to be allowed.
</p>
<h4>Solution</h4>
<p class="cr">
    The CBlob::SetReadIndex() now allows an index of 0 when the CBlob size is 0.
</p>
<h4 class="red">Behaviour Change</h4>
<ul>
<li class="cr">A call to CBlob::SetReadIndex() with an index of 0 when the CBlob size is not 0 still succeeds.</li>
<li class="cr">A call to CBlob::SetReadIndex() with an index of 0 when the CBlob size is 0 now succeeds.</li>
</ul>

</div>
<br><a name="CR18346"><div class="synopsis" id="CR18346_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18346')">CR#18346 (Incident 1284)</a> :</b> CThread::StartThread does not startup successfully on Linux.
</div>
<div class="detail" id="CR18346_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18346')">CR#18346 (Incident 1284)</a> :</b> CThread::StartThread does not startup successfully on Linux.
<h4>Description</h4>
<p class="cr">
Under some Linux distributions, it can occur that, after setting the thread scheduling policy to SCHED_OTHER, the scheduling priority must be to 0, otherwise pthread_create fails with EINVAL.
</p>
<h4>Solution</h4>
<p class="cr">
When the scheduling policy is SCHED_OTHER, now always calls pthread_attr_setschedparam with the sched_priority = 0.
</p>
<p class="cr">
Modified the MXD_astPOSIX_THREAD_SCHEDULING_INFO sctruct in FrameworkCfg.h to set the priority member to 0. Redid the example also in the same file to correspond with the code.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
2.5.1.20 - MXD_astVXWORKS_THREAD_SCHEDULING_INFO of the API reference has been updated to reflect the new changes of the default structure.
</p>

</div>
<br><a name="CR18409"><div class="synopsis" id="CR18409_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18409')">CR#18409</a> :</b> MxEventNotifier can be used before it is initialized.
</div>
<div class="detail" id="CR18409_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18409')">CR#18409</a> :</b> MxEventNotifier can be used before it is initialized.
<h4>Description</h4>
<p class="cr">
Depending on its configuration, the CMemoryAllocator class can use a MxEventNotifier before it has been initialized. This occurs when memory statistics are enabled and a big block of memory is allocated by one of the initializers before InitializeMxEventNotifier is called. This has been observed on Windows, with the CThread Initializer creating a big block of memory when it starts the WinThreadTerminationHandler thread.
</p>
<h4>Solution</h4>
<p class="cr">
Changed the order of the MxEventNotifier initialization. It is now initialized right before CMemoryAllocator, and finalized right after CMemoryAllocator.
</p>
<p class="cr">
Modified FinalizeMxEventNotifier so that it no longer uses MX_DELETE_ARRAY. Instead, the array is deleted in UnregisterEventObserver, when all events observers have been unregistered.
</p>
</div>
<br><a name="CR18624"><div class="synopsis" id="CR18624_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18624')">CR#18624 (Incident 1709)</a> :</b> Wrong wording in preprocessor directive for Windows version
</div>
<div class="detail" id="CR18624_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18624')">CR#18624 (Incident 1709)</a> :</b> Wrong wording in preprocessor directive for Windows version
<h4>Description</h4>
<p class="cr">
The error preprocessor directive is misleading with regards to identifying the minimal Windows version supported by the Framework. It specifies the version must be greater than Windows 2000. It should rather state that it needs to be greater than or equal to Windows 2000.
</p>
<h4>Solution</h4>
<p class="cr">
Corrected the error preprocessor directive string.
</p>
</div>
<br><a name="CR18337"><div class="synopsis" id="CR18337_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18337')">CR#18337 (Incident 1510)</a> :</b> CTTLS CAsyncTlsSocket does not bind 
</div>
<div class="detail" id="CR18337_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18337')">CR#18337 (Incident 1510)</a> :</b> CTTLS CAsyncTlsSocket does not bind 
<h4>Description</h4>
<p class="cr">
The partner using CTTLS encountered problems in which the CAsyncTlsSocket instances do not bind when used in a thread other than the Framework.
</p>
<h4>Solution</h4>
<p class="cr">
In this version of the Framework, the main issue was only a possible memory leak in CAsyncTlsSocket::Create(). Onwership of the argument "pstrServerName" was taken but the resource was never released.
</p>
<p class="cr">
Corrected compilation error in CTlsServerSocket and warning in trace.
</p>
</div>
<br><a name="CR18754"><div class="synopsis" id="CR18754_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18754')">CR#18754</a> :</b> Memory leak in ParseCnameRecord.
</div>
<div class="detail" id="CR18754_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18754')">CR#18754</a> :</b> Memory leak in ParseCnameRecord.
<h4>Description</h4>
<p class="cr">
A memory leak in the DNS resolver has been found while running Rational Purify for the 2.1.3.3 release. The ParseCnameRecord allocates a CList using MX_NEW that is never deleted.
</p>
<h4>Solution</h4>
<p class="cr">
Made the pvecParsedNames argument of the RetreiveAddress function in ResolverHelpers mandatory. This forces the caller of that method to pass a pointer to a valid CList&lt;CString&gt;.
</p>
<p class="cr">
Removed the dynamic allocation of a CList&lt;CString&gt; from the ParseCnameRecord function. The caller must now supply a pointer to a valid CList&lt;CString&gt;.
</p>
<p class="cr">
Updated calls to RetreiveAddress and ParseCnameRecord so that they now pass a pointer to a valid CList&lt;CString&gt;.
</p>
</div>
<br><a name="CR18777"><div class="synopsis" id="CR18777_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18777')">CR#18777</a> :</b> Memory tracking always reports memory leaks.
</div>
<div class="detail" id="CR18777_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18777')">CR#18777</a> :</b> Memory tracking always reports memory leaks.
<h4>Description</h4>
<p class="cr">
When MXD_MEMORY_ALLOCATOR_MEMORY_TRACKING_ENABLE_SUPPORT is enabled, memory leaks are always reported after calling CFrameworkInitializer::Finalize.
This is because CFrameworkInitializer::Finalize gathers memory statistics before finalizing the Framework. Thus, all memory blocks deleted during the finalization process are seen as leaked.
</p>
<h4>Solution</h4>
<p class="cr">
Moved the call to CMemoryAllocator::GetMemoryStatistics and CMemoryAllocator::EnumMemoryBlocks. These are now called in CFrameworkInitializer::PartialFinalize, just before calling FinalizeCMemoryAllocator. This ensures that no calls to MX_DELETE are missed when gathering statistics.
</p>
</div>
<br><a name="CR18798"><div class="synopsis" id="CR18798_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR18798')">CR#18798</a> :</b> Memory leak in CPool.h.
</div>
<div class="detail" id="CR18798_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR18798')">CR#18798</a> :</b> Memory leak in CPool.h.
<h4>Description</h4>
<p class="cr">
A memory leak has been found in CPool.h, in the Initialize() method for a CPool of CMarshaler.
This occurs only when building with MSVC6 in debug. This is caused by the way the InitializeCPool() method is called in the CMarshaler static initialization method and in the CPool testcase. This results in the wrong templated InitializeCPool() method being called for the first CPool in the CPool testcase. It wrongly calls the method for the CMarshaler CPool. This overwites templated static members for the CMarshaler instance of CPool and results in a memory leak when calling FinalizeCPool(), which cannot delete allocated objects because their pointers have been overwritten.
</p>
<h4>Solution</h4>
<p class="cr">
Changed the way the InitializeCPool() method is called in the InitializeCMarshaler method and CPool testcase. Previously, the method was called as follows:
</p>
<pre class="cr">
InitializeCPool&lt;CMarshaler&gt;();
</pre>
<p class="cr">
It is now called as follows:
</p>
<pre class="cr">
CPool&lt;CMarshaler&gt;::InitializeCPool();
</pre>
</div>
<br><br><h3>Documentation Updates</h3>
<a name="CR17842"><div class="synopsis" id="CR17842_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17842')">CR#17842</a> :</b> M5T Framework SAFE - Programmer's Guide is referenced in M5T Framework SAFE - API Reference though it does not exist.
</div>
<div class="detail" id="CR17842_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17842')">CR#17842</a> :</b> M5T Framework SAFE - Programmer's Guide is referenced in M5T Framework SAFE - API Reference though it does not exist.
<h4>Description</h4>
<p class="cr">
References to the Framework Programmer's guide should be removed from the API Reference Guide.
</p>
<h4>Solution</h4>
<p class="cr">
<ul>
<li class="cr">Modified the Introduction section in the file Documentation/Doc-o-Matic/MitosFw-DOM040318-API Reference_SpecialTopics.dtx</li>
<li class="cr">Removed references to the Programmer's Guide.</li>
</ul>
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Changes to the API reference:
<ul>
<li class="cr">Removed all references to the "Programmer's Guide" in the sections:
      Introduction,
      MX_ASSERT,
      MX_ASSERT_EX,
      MX_ASSERT_RT,
      MX_ASSERT_RT_EX,
      MX_ASSERT_PERROR,
      MX_ASSERT_PERROR_EX,
      MX_ASSERT_PERROR_RT,
      MX_ASSERT_PERROR_RT_EX,
      CUdpTracing</li>
</ul>
</p>

</div>
<br></div>
<br>
<hr>
<div id="label2.1.2.2_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.2.2')">Version 2.1.2</a> (build 2): Created on August 14, 2006
</div>
<div id="label2.1.2.2_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.2.2')">Version 2.1.2</a> (build 2): Created on August 14, 2006
<br><br><h3>New Features and Improvements</h3>
<a name="CR17596"><div class="synopsis" id="CR17596_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17596')">CR#17596</a> :</b> Add a class to wrap a regular expression library.
</div>
<div class="detail" id="CR17596_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17596')">CR#17596</a> :</b> Add a class to wrap a regular expression library.
<h4>Description</h4>
<p class="cr">
Must add a class that wil wrap calls to a  regular expression library. This is needed by ENUM.
</p>
<h4>Solution</h4>
<p class="cr">
The  CRegExp class has been added. It uses the regex library to compile and execute regular expressions. It can be used to:
</p>
<ul>
<li class="cr">validate that a string matches a regular expression</li>
<li class="cr">get sub-expressions from a string matched against a regular expression</li>
<li class="cr">format sub-expressions of a matched string</li>
</ul>
<p class="cr">
To enable this feature, MXD_REGEXP_ENABLE_SUPPORT must be defined.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The CRegExp class has been created with the following methods:
<pre class="cr">
mxt_result Find(IN const char* pszRegExp,
                IN bool bCaseSensitivity,
                IN const char* pszString);

mxt_result FindSubExpressions(IN const char* pszRegExp,
                              IN bool bCaseSensitivity,
                              IN const char* pszString,
                              IN unsigned int uSubExpCapacity,
                              OUT unsigned int* puSubExpSize,
                              OUT SSubExpression* pstSubExpressions);

mxt_result FindAndReplace(IN const char* pszRegExp,
                          IN bool bCaseSensitivity,
                          IN const char* pszString,
                          IN const char* pszFormat,
                          IN unsigned int uResultCapacity,
                          OUT char* pszResult);
</pre>
</p>

<p class="cr">
Added the following define:
</p>
<ul>
<li class="cr">
MXD_REGEXP_ENABLE_SUPPORT
</li>
</ul>



<h4 class="red">Documentation Update</h4>
<p class="cr">
Documentation for the CRegExp class and each of it's public methods has been created.
</p>

</div>
<br><a name="CR17605"><div class="synopsis" id="CR17605_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17605')">CR#17605</a> :</b> Add support of MS Dev 2005.
</div>
<div class="detail" id="CR17605_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17605')">CR#17605</a> :</b> Add support of MS Dev 2005.
<h4>Description</h4>
<p class="cr">
The Framework must support compilation under Microsoft Visual Studio 2005.
</p>
<h4>Solution</h4>
<p class="cr">
 Added a missing const in CString.cpp.
</p>
<p class="cr">
 Changed int32_t to time_t in CFile.h since time_t has now 64 bits in MS Dev 2005.
</p>

<p class="cr">
Added defines _CRT_SECURE_NO_DEPRECATE and _CRT_NONSTDC_NO_DEPRECATE to MxConfig.h to remove the 4996 deprecated warnings. These defines must be undefined in PostMxConfig.h for these warnings to appear.
</p>
</div>
<br><a name="CR17672"><div class="synopsis" id="CR17672_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17672')">CR#17672</a> :</b> Add support for ENUM.
</div>
<div class="detail" id="CR17672_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17672')">CR#17672</a> :</b> Add support for ENUM.
<h4>Description</h4>
<p class="cr">
Support for ENUM, as defined in RFC 3761, is needed in the Framework.
</p>
<h4>Solution</h4>
<p class="cr">
A new method, GetEnumUri, has been added in NetworkTools. That method uses helpers located in the EnumHelpers file. These implement the DDDS algorithm for ENUM as defined in RFC 3401, RFC 3402, RFC 3403, RFC 3404, RFC 3405, and RFC 3761.
</p>
<p class="cr">
 To enable this feature, MXD_ENUM_ENABLE_SUPPORT must be defined.
</p>

<p class="cr">
Since ENUM needs regular expressions to process the REGEXP field of the NAPTR response, MXD_REGEXP_ENABLE_SUPPORT must be defined if ENUM is enabled.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The following method has been added to NetworkTools:
<pre class="cr">
mxt_result GetEnumUri(IN const char* pszE164Number,
                      IN const CList&lt;SEnumService&gt;* plstSupportedServices,
                      OUT CList&lt;SEnumUri&gt;* plstEnumUri,
                      IN const char* pszZone = NULL);
</pre>
</p>
<p class="cr">
Added the following define:
</p>
<ul>
<li class="cr">
MXD_ENUM_ENABLE_SUPPORT
</li>
</ul>


<h4 class="red">Documentation Update</h4>
<p class="cr">
Documentation for the GetEnumUri and its helper methods has been created.
</p>

</div>
<br><a name="CR17583"><div class="synopsis" id="CR17583_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17583')">CR#17583 (Incident 1306)</a> :</b> Should be possible to retrieve the context from an CAsyncTlsSocket
</div>
<div class="detail" id="CR17583_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17583')">CR#17583 (Incident 1306)</a> :</b> Should be possible to retrieve the context from an CAsyncTlsSocket
<h4>Description</h4>
<p class="cr">
It must be possible to retrieve the CTlsContext from the TLS socket to get additional information contained therein.
</p>
<h4>Solution</h4>
<p class="cr">
Added a GetTlsContext method in CAsyncTlsSocket and CAsyncTlsServerSocket that retrieves a const CTlsContext pointer. This pointer may be NULL.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
    A new method GetTlsContext has been added to the CAsyncTlsSocket and to CAsyncTlsServerSocket.
</p>

</div>
<br><a name="CR17827"><div class="synopsis" id="CR17827_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17827')">CR#17827</a> :</b> Add package IDs for new products.
</div>
<div class="detail" id="CR17827_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17827')">CR#17827</a> :</b> Add package IDs for new products.
<h4>Description</h4>
<p class="cr">
Package IDs must be added for the following new products:
<ul>
<li class="cr">MTEI</li>
<li class="cr">Command Digits Interface</li>
<li class="cr">FXS Callmanager</li>
</ul>
</p>
<h4>Solution</h4>
<p class="cr">
Added the following packages to the enum, in PkgId.h:
</p>
<ul>
<li class="cr">eMX_PKG_MTEI</li>
<li class="cr">eMX_PKG_COMMAND_DIGITS_INTERFACE</li>
<li class="cr">eMX_PKG_FXSCALLMANAGER</li>
</ul>
</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR17014"><div class="synopsis" id="CR17014_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17014')">CR#17014</a> :</b> Remove MXD_ARCH_OTHER_32BITS.
</div>
<div class="detail" id="CR17014_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17014')">CR#17014</a> :</b> Remove MXD_ARCH_OTHER_32BITS.
<h4>Description</h4>
<p class="cr">
MXD_ARCH_OTHER_32BITS must be removed.
</p>
<h4>Solution</h4>
<p class="cr">
Removed the MXD_ARCH_OTHER_32BITS macro. It is no longer necessary for users to have this define when compiling on a different platform than the supported ones.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Removed the MXD_ARCH_OTHER_32BITS documentation.
</p>

</div>
<br><a name="CR17301"><div class="synopsis" id="CR17301_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17301')">CR#17301</a> :</b> The macros defined in the configuration files are not seen by aes_core.c.
</div>
<div class="detail" id="CR17301_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17301')">CR#17301</a> :</b> The macros defined in the configuration files are not seen by aes_core.c.
<h4>Description</h4>
<p class="cr">
The MxConfig.h and FrameworkCfg.h files are not included by aes_core.c and this prevents the macro MXD_CRYPTO_AES_CORE_ALLOW_CONSTANTS_TABLE_RELOCATION from being defined in this file even if it is in PreFrameworkCfg.h.  The consequence is that the global variables g_pstAesConstTable and g_stAesConstTableSize are not defined when compiling SRTP for Code Composer and this causes a link error when these variables are referenced.
</p>
<h4>Solution</h4>
<p class="cr">
Include MxConfig.h and FrameworkCfg.h in aes_core.c and adapt MxTrace.h and aes.h to compile correctly with a C compiler.
</p>
</div>
<br><a name="CR17508"><div class="synopsis" id="CR17508_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17508')">CR#17508 (Incident 1274)</a> :</b> CAsyncTlsSocket socket will not send EvAsyncIoSocketMgrReadyToSend. 
</div>
<div class="detail" id="CR17508_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17508')">CR#17508 (Incident 1274)</a> :</b> CAsyncTlsSocket socket will not send EvAsyncIoSocketMgrReadyToSend. 
<h4>Description</h4>
<p class="cr">
After a partial SSL_write the socket does not re-register itself for write events and EvAsyncIoSocketMgrReadyToSend is never sent.
</p>
<h4>Solution</h4>
<p class="cr">
Register the socket to receive notifications for write events after a successful partial SSL_write.
</p>
</div>
<br><a name="CR17554"><div class="synopsis" id="CR17554_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17554')">CR#17554</a> :</b> Compilation problem with C compiler when including MxConfig.h in aes_core.c.
</div>
<div class="detail" id="CR17554_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17554')">CR#17554</a> :</b> Compilation problem with C compiler when including MxConfig.h in aes_core.c.
<h4>Description</h4>
<p class="cr">
When including MxConfig.h in aes_core.c (See CR 17301), the compilation fails.
</p>
<h4>Solution</h4>
<p class="cr">
Modified MxConfig.h to use __inline keyword  when building with C compiler under Windows OS.
</p>
<p class="cr">
Modified MxConfig.h so that it does not include CMemoryAllocator.h when building with a C compiler.
</p>
<p class="cr">
Modified MxConfig.h so that it does not include #include "npp/npp.h" when building for Nucleus using a C compiler.
</p>
<p class="cr">
Undefine MXD_ENABLE_NAMESPACE in MxMacro.h when building using a C comiler.
</p>
<p class="cr">
Declared all methods in MxTrace.h as extern "C" when building with a C++ compiler.
</p>
</div>
<br><a name="CR17593"><div class="synopsis" id="CR17593_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17593')">CR#17593 (Incident 672)</a> :</b> Code Composer must compile without remarks about the use of undefined macros.
</div>
<div class="detail" id="CR17593_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17593')">CR#17593 (Incident 672)</a> :</b> Code Composer must compile without remarks about the use of undefined macros.
<h4>Description</h4>
<p class="cr">
When compiling with Code Composer, there must be no remarks about the use of undefined macros.
</p>
<h4>Solution</h4>
<p class="cr">
The files MxMacro.h and MxConfig.h have been modified to avoid to use any undefined macro.
</p>
</div>
<br><a name="CR17608"><div class="synopsis" id="CR17608_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17608')">CR#17608</a> :</b> Tracing node declaration in the framework must follow tracing guideline.
</div>
<div class="detail" id="CR17608_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17608')">CR#17608</a> :</b> Tracing node declaration in the framework must follow tracing guideline.
<h4>Description</h4>
<p class="cr">
According to the tracing guideline, tracing nodes must be declared in the Startup files of their package and exported in files named after their folders. This is not currently the case in the Framework, as g_stFramework, g_stAssert and g_stTraceRoot are declared in MxTrace.cpp and exported through MxTraceFramework.h and MxAssert.h.

One exception to the tracing guideline is that g_stTraceRoot MUST be exported through MxTrace.h for it to be available everywhere.

The following should be done to bring the framework in line with the tracing guideline:
</p>

<ul>
<li class="cr">Move g_stFramework, g_stAssert and g_stTraceRoot declaration in FrameworkInitializer.cpp.</li>
<li class="cr">Rename MxTraceFramework.h to MxTraceBasic.h.</li>
<li class="cr">Move the tracing node registration from MxTrace.cpp to FrameworkInitializer.cpp.</li>
</ul>

<h4>Solution</h4>
<ul>
<li class="cr">Moved g_stFramework, g_stAssert, and g_stTraceRoot declaration in FrameworkInitializer.cpp.</li>
<li class="cr">Renamed MxTraceFramework.h to MxTraceBasic.h.</li>
<li class="cr">Moved the tracing node registration from MxTrace.cpp to FrameworkInitializer.cpp.</li>
<li class="cr">Changed test cases tracing node to g_stTfwTestCase.</li>
</ul>
<h4 class="red">Interface Change</h4>
<p class="cr">Renamed MxTraceFramework.h to MxTraceBasic.h.
</p>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The documentation of the g_stTraceRoot and g_stFramework tracing nodes has been moved to the Startup/CFrameworkInitializer.cpp file.
</p>

</div>
<br><a name="CR17611"><div class="synopsis" id="CR17611_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17611')">CR#17611</a> :</b> Must be able to compile the Framework using Code Composer without removing files.
</div>
<div class="detail" id="CR17611_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17611')">CR#17611</a> :</b> Must be able to compile the Framework using Code Composer without removing files.
<h4>Description</h4>
<p class="cr">
The Framework must be able to compile with Code Composer without having to remove files.
</p>
<h4>Solution</h4>
<p class="cr">
The code that does not compile under Code Composer and/or is not needed by SRtp is now protected by different defines that will not be enabled for Code Composer compilations.
</p>

<p class="cr">
Added the following defines:
</p>

<ul>
<li class="cr">MXD_CAP_ENABLE_SUPPORT ? Protects the initialization and compilation of container-related code under the Cap directory.</li>
<li class="cr">MXD_ECOM_ENABLE_SUPPORT ? Protects the initialization and compilation of  ECOM-related code under the Ecom directory.</li>
<li class="cr">MXD_EVENT_NOTIFIER_ENABLE_SUPPORT ? Protects the initialization and compilation of  the Event Notifier-related code from the Basic/MxEventNotifier file. </li>
<li class="cr">MXD_FAULT_HANDLER_ENABLE_SUPPORT ? Protects the initialization and compilation of  the Fault Handler-related code from the Basic/MxFaultHandler file. </li>
<li class="cr">MXD_CRYPTO_UUIDGENERATOR_MITOSFW ? Protects the initialization and compilation of  Uuid Generator-related code from the Crypto/CUuidGenerator file. This define is enabled automatically if the define MXD_CRYPTO_ MITOSFW_ALL or the define MXD_CRYPTO_ OPENSLL_ALL is defined.</li>
<li class="cr">MXD_CRYPTO_BASE64_MITOSFW ? Protects the initialization and compilation of  Base64-related code from the Crypto/CBase64 file. This define is enabled automatically if the define MXD_CRYPTO_ MITOSFW_ALL or the define MXD_CRYPTO_ OPENSLL_ALL is defined.</li>
</ul>

<p class="cr">
The CVersion class has been moved under the Cap directory.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
Applications must enable the added defines in order to enable the code they protect. For example, if container-related code is used, MXD_CAP_ENABLE_SUPPORT must be defined.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
Added the following defines:
</p>

<ul>
<li class="cr">MXD_CAP_ENABLE_SUPPORT </li>
<li class="cr">MXD_ECOM_ENABLE_SUPPORT </li>
<li class="cr">MXD_EVENT_NOTIFIER_ENABLE_SUPPORT </li>
<li class="cr">MXD_FAULT_HANDLER_ENABLE_SUPPORT </li>
<li class="cr">MXD_CRYPTO_UUIDGENERATOR_MITOSFW </li>
<li class="cr">MXD_CRYPTO_BASE64_MITOSFW </li>
</ul>

&lt;p&gt;The CVersion class has been moved  from the Basic directory to the Cap directory.&lt;/p&gt;


<h4 class="red">Documentation Update</h4>
<p class="cr">
All newly added defines are also documented in the API Reference.
</p>

</div>
<br><a name="CR17585"><div class="synopsis" id="CR17585_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17585')">CR#17585 (Incident 1306)</a> :</b> CAsyncTlsSocket and CAsyncTlsServerSocket private methods and members should be protected.
</div>
<div class="detail" id="CR17585_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17585')">CR#17585 (Incident 1306)</a> :</b> CAsyncTlsSocket and CAsyncTlsServerSocket private methods and members should be protected.
<h4>Description</h4>
<p class="cr">
In both CAsyncUdpSocket and CAsyncTcpSocket, all non public interfaces and data members are protected to help with inheritence. This should also be applied to CAsyncTlsSocket and CAsyncTlsServerSocket.
</p>
<h4>Solution</h4>
<p class="cr">
Changed all private declarations to be protected in both CAsyncTlsServerSocket and CAsyncTlsSocket
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
    All private methods and data members in both CAsyncTlsSocket and CAsyncTlsServerSocket are now protected.
</p>

</div>
<br><a name="CR17764"><div class="synopsis" id="CR17764_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17764')">CR#17764</a> :</b> CSocketAddr must automaticaly detect the family of the address.
</div>
<div class="detail" id="CR17764_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17764')">CR#17764</a> :</b> CSocketAddr must automaticaly detect the family of the address.
<h4>Description</h4>
<p class="cr">
The CSocketAddr methods that set an adress from a string must be able to automatically detect the family of the address contained in the string.
</p>
<h4>Solution</h4>
<p class="cr">
Removed the following constructors/methods because it is no longer necessary to specify the address family when passing the address as a string.
<pre class="cr">
CSocketAddr::CSocketAddr(IN const uint8_t* puAddress,
                         IN unsigned int uAddrSize,
                         IN uint16_t uPort = 0);

CSocketAddr::CSocketAddr(IN EAddressFamily eFamily,
                         IN const char* pszAddress,
                         IN uint16_t uPort = 0,
                         IN EDottedAddressBase eBase = eBASE_AUTO);

CSocketAddr::SetFamily(IN EAddressFamily eFamily);
</pre>
</p>
<p class="cr">
The following interfaces have been modified because it is now mandatory to specify the address family when passing the address as a byte array.
<pre class="cr">
CSocketAddr::CSocketAddr(IN const uint8_t* puAddr,
                         IN unsigned int uAddrSize,
                         IN EAddressFamily eFamily,
                         IN uint16_t uPort = 0);

mxt_result CSocketAddr::SetAddress(IN const uint8_t* puAddress,
                                   IN unsigned int uAddressSize,
                                   IN EAddressFamily eFamily,
                                   IN uint16_t uPort = 0);
</pre>
</p>
<p class="cr">
The following interfaces have been modified because it is no longer necessary to specify the address family when specifying the address as a EStandardAddress.
<pre class="cr">
CSocketAddr::CSocketAddr(IN EStandardAddress eType,
                         IN uint16_t uPort = 0);

mxt_result CSocketAddr::SetAddress(IN const char* pszAddress,
                                   IN uint16_t uPort = 0,
                                   IN EDottedAddressBase eBase = eBASE_AUTO);

mxt_result CSocketAddr::SetAddress(IN EStandardAddress eType,
                                   IN uint16_t uPort = 0);
</pre>
</p>
<p class="cr">
The following method has been moved from public to private, and renamed to StringToAddress:
<pre class="cr">
static bool CSocketAddr::IsValidDottedAddress(IN const char* pszDottedAddr,
                                              OUT mxt_in_addr* pDestination);
</pre>
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Removed the following constructors/methods:
<pre class="cr">
CSocketAddr::CSocketAddr(IN const uint8_t* puAddress,
                         IN unsigned int uAddrSize,
                         IN uint16_t uPort = 0);

CSocketAddr::CSocketAddr(IN EAddressFamily eFamily,
                         IN const char* pszAddress,
                         IN uint16_t uPort = 0,
                         IN EDottedAddressBase eBase = eBASE_AUTO);

CSocketAddr::SetFamily(IN EAddressFamily eFamily);
</pre>
</p>
<p class="cr">
The following interfaces have been modified so that specifying the family is mandatory:
<pre class="cr">
CSocketAddr::CSocketAddr(IN const uint8_t* puAddr,
                         IN unsigned int uAddrSize,
                         IN EAddressFamily eFamily,
                         IN uint16_t uPort = 0);

mxt_result CSocketAddr::SetAddress(IN const uint8_t* puAddress,
                                   IN unsigned int uAddressSize,
                                   IN EAddressFamily eFamily,
                                   IN uint16_t uPort = 0);
</pre>
</p>
<p class="cr">
The following interfaces have been modified so that specifying the family is no longer mandatory:
<pre class="cr">
CSocketAddr::CSocketAddr(IN EStandardAddress eType,
                         IN uint16_t uPort = 0);

mxt_result CSocketAddr::SetAddress(IN const char* pszAddress,
                                   IN uint16_t uPort = 0,
                                   IN EDottedAddressBase eBase = eBASE_AUTO);

mxt_result CSocketAddr::SetAddress(IN EStandardAddress eType,
                                   IN uint16_t uPort = 0);
</pre>
</p>
<p class="cr">
The following method has been moved from public to private and renamed to StringToAddress:
<pre class="cr">
static bool CSocketAddr::IsValidDottedAddress(IN const char* pszDottedAddr,
                                              OUT mxt_in_addr* pDestination);
</pre>
</p>

</div>
<br><a name="CR17813"><div class="synopsis" id="CR17813_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17813')">CR#17813</a> :</b> CCallDestructor in CMemoryAllocator should have a specialised constructor.
</div>
<div class="detail" id="CR17813_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17813')">CR#17813</a> :</b> CCallDestructor in CMemoryAllocator should have a specialised constructor.
<h4>Description</h4>
<p class="cr">
The utilization of the memory allocator implementation requires that pInstance referenced type contains a default constructor if it also contains a specialized constructor (one which has parameters). Compiler will display errors if this is not the case. This need must be removed.
</p>
<h4>Solution</h4>
<p class="cr">
Removed the need to have a default constructor in the classes when it has a specialized constructor (one which has parameters) by adding a constructor in CCallDestructor.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Updated the documentation of MX_DELETE_ARRAY, MX_DELETE, MX_NEW, and MX_NEW_ARRAY in the Framework API.
</p>

</div>
<br><br><h3>Documentation Updates</h3>
<a name="CR17336"><div class="synopsis" id="CR17336_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17336')">CR#17336</a> :</b> CAATree.h, the = operator is not documented. 
</div>
<div class="detail" id="CR17336_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17336')">CR#17336</a> :</b> CAATree.h, the = operator is not documented. 
<h4>Description</h4>
<p class="cr">
The CAATree assignment operator is not documented.
</p>
<h4>Solution</h4>
<p class="cr">
Documented the CAATree assignment operator.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The CAATree assignment operator is documented in the Framework API.
</p>

</div>
<br><a name="CR17595"><div class="synopsis" id="CR17595_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17595')">CR#17595</a> :</b> CUncmp documentation is erroneous.
</div>
<div class="detail" id="CR17595_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17595')">CR#17595</a> :</b> CUncmp documentation is erroneous.
<h4>Description</h4>
<p class="cr">
The CUncmp example is erroneous. It is missing the cast operator.
</p>
<h4>Solution</h4>
<p class="cr">
Added the cast operator in the CUncmp example.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Fixed the CUncmp example.
</p>

</div>
<br><a name="CR17533"><div class="synopsis" id="CR17533_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17533')">CR#17533</a> :</b> Minor corrections for the Framework API Reference.
</div>
<div class="detail" id="CR17533_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17533')">CR#17533</a> :</b> Minor corrections for the Framework API Reference.
<h4>Description</h4>
<p class="cr">
The following documentation errors must be corrected in the Framework API:
</p>

<ul>
<li class="cr">In the MxStringFormat documentation, the summaries for AsciiToHex and HexToAscii are reversed.</li>
<li class="cr">In the CBlockAllocator documentation, CBlockAllocator is spelled CblockAllocator. </li>
<li class="cr"> The CList::Erase (IN unsigned int, IN unsigned int) documentation summary says ?Erases one element.? instead of ?Erases multiple elements.?.</li>
<li class="cr">Sentences sometimes end with two periods instead of one.</li>
<li class="cr">In the CString documentation, ?CString::? appears sometimes twice.</li>
<li class="cr">In the CVector::FindSorted and CVList::FindSorted documentation, there is the phrase ?The behavior is undefined in the container was not sorted.? Replace "in the container" by "if the container".</li>
<li class="cr">In the IAllocator documentation, there is the phrase ?If Allocate ( see page 197) fails because of an out of memory condition. The partially allocated blocks must be freed and NULL must be returned.?. Replace "condition. The partially" by "condition, the partially". </li>
<li class="cr">In the MX_DELETE_ARRAY documentation, replace "array objects" by "array of objects" </li>
</ul>

<h4>Solution</h4>
<p class="cr">
The documentation errors have been fixed.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Updated the Framework API.
</p>

</div>
<br><a name="CR17038"><div class="synopsis" id="CR17038_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17038')">CR#17038</a> :</b> CEvenDriven::StartTimer description need to be updated.
</div>
<div class="detail" id="CR17038_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17038')">CR#17038</a> :</b> CEvenDriven::StartTimer description need to be updated.
<h4>Description</h4>
<p class="cr">
The CEvenDriven::StartTimer and CEvenDriven::StopTimer documentation do not mention the same information as in the CServicingThread.
</p>
<h4>Solution</h4>
<p class="cr">
The documentation of CEvenDriven::StartTimer and CEvenDriven::StopTimer has been updated to follow that of the same methods in the CServicingThread.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
Updated the documentation of CEvenDriven::StartTimer and CEvenDriven::StopTimer in the Framework API.
</p>

</div>
<br></div>
<br>
<hr>
<div id="label2.1.1.1_LabelCollapsed" style="visibility:visible;display:inline;">
<a class="label" href="javascript:show_hide_label('label2.1.1.1')">Version 2.1.1</a> (build 1): Created on June 20, 2006
</div>
<div id="label2.1.1.1_LabelExpanded" style="visibility:hidden;display:none;">
<a class="label" href="javascript:show_hide_label('label2.1.1.1')">Version 2.1.1</a> (build 1): Created on June 20, 2006
<br><br><h3>New Features and Improvements</h3>
<a name="CR17163"><div class="synopsis" id="CR17163_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17163')">CR#17163</a> :</b> Add support for VxWorks 5.5.
</div>
<div class="detail" id="CR17163_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17163')">CR#17163</a> :</b> Add support for VxWorks 5.5.
<h4>Description</h4>
<p class="cr">
Add support for VxWorks 5.5.
</p>
<h4>Solution</h4>
<p class="cr">
Added preprocessor defines in MxConfig.h to support the following WindRiver products:  VxWorks 5.5 gcc 2.96+.
</p>
<p class="cr">
Modified the way static members of templated classes are initialised when building using gcc 2.96+.
</p>
<p class="cr">
Keep a copy of the requested local address when issuing a Bind() on all types of sockets when using VxWorks 5.5, since it changes the values in the address structure when binding.
</p>
<p class="cr">
Various warning fixes.
</p>
</div>
<br><a name="CR17172"><div class="synopsis" id="CR17172_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17172')">CR#17172</a> :</b> Add support for IPv6.
</div>
<div class="detail" id="CR17172_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17172')">CR#17172</a> :</b> Add support for IPv6.
<h4>Description</h4>
<p class="cr">
Add support for IPv6 in all the socket classes as well as in NetworkTools.
</p>
<h4>Solution</h4>
<p class="cr">
IPv6 support has been implemented for the following OSes:
</p>
<ul>
<li class="cr">Linux</li>
<li class="cr">VxWorks 5.5</li>
<li class="cr">Windows XP and up</li>
<li class="cr">Windows CE</li>
</ul>
<p class="cr">
Added support for addresses of the AF_INET6 family in CSocketAddr.
</p>
<p class="cr">
Added support for sockets of the PF_INET6 family in CUdpSocket, CAsyncUdpSocket, CTcpSocket, CTcpServerSocket, CAsyncTcpSocket, and CPoolSocket.
</p>
<p class="cr">
Added support for IPv6 in NetworkTools for GetLocalIPAddr.
</p>
<p class="cr">
Added support for AAAA DNS queries and IPv6 reverse lookup queries.
</p>
</div>
<br><a name="CR17228"><div class="synopsis" id="CR17228_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17228')">CR#17228</a> :</b> Update CRsa interface and documentation
</div>
<div class="detail" id="CR17228_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17228')">CR#17228</a> :</b> Update CRsa interface and documentation
<h4>Description</h4>
<p class="cr">
The interface of class CRsa needs to be updated. Three methods of the class exist in three flavours and only one is really useful. Two flavours of each method must be removed.
</p>
<ul>
<li class="cr">GetPrivateKey</li>
<li class="cr">GetPublicKey</li>
<li class="cr">SetParameters</li>
</ul>

<p class="cr">
Moreover, the remaining SetParamters method has two parameters and only the private key is really needed. The public key must be removed. The name of the method SetParameters should be replaced with a better name.
</p>
<p class="cr">
Finally, the documentation of this class is poor and needs to be augmented.
</p>
<h4>Solution</h4>
<p class="cr">
The following methods were removed:
</p>
<pre class="cr">
    mxt_result GetPrivateKey(IN unsigned int uMaxPrivateKeyExponentSize,
                             IN unsigned int uMaxPrivateKeyModulusSize,
                             OUT uint8_t* puPrivateKeyExponent,
                             OUT unsigned int* puPrivateKeyExponentSize,
                             OUT uint8_t* puPrivateKeyModulus,
                             OUT unsigned int* puPrivateKeyModulusSize) const;
    mxt_result GetPrivateKey(OUT CBlob* pblobPrivateKeyExponent,
                             OUT CBlob* pblobPrivateKeyModulus) const;
    mxt_result GetPublicKey(IN unsigned int uMaxPublicKeyExponentSize,
                            IN unsigned int uMaxPublicKeyModulusSize,
                            OUT uint8_t* puPublicKeyExponent,
                            OUT unsigned int* puPublicKeyExponentSize,
                            OUT uint8_t* puPublicKeyModulus,
                            OUT unsigned int* puPublicKeyModulusSize) const;
    mxt_result GetPublicKey(OUT CBlob* pblobPublicKeyExponent,
                            OUT CBlob* pblobPublicKeyModulus) const;
    mxt_result SetParameters(IN const uint8_t* puPublicKeyExponent,
                             IN unsigned int uPublicKeyExponentSize,
                             IN const uint8_t* puPublicKeyModulus,
                             IN unsigned int uPublicKeyModulusSize,
                             IN const uint8_t* puPrivateKey,
                             IN unsigned int uPrivateKeySize);
    mxt_result SetParameters(IN const CBlob* pblobPublicKeyExponent,
                             IN const CBlob* pblobPublicKeyModulus,
                             IN const CBlob* pblobPrivateKey);
</pre>
<p class="cr">
The remaining SetParameters method was renamed to SetKey. This is a better name as it is the companion to the GenerateKey. Also, the CPublicKey* parameter was removed because the other parameter CPrivateKey contains all the information required to set the key information in the CRsa object.
</p>
<p class="cr">
The documentation of each method was augmented with better descriptions.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
Beside method removal, the only interface change is as shown in the following code snippet.
</p>
<pre class="cr">
mxt_result SetParameters(IN const CPublicKey* pPublicKey, IN const CPrivateKey* pPrivateKey);
is now:
    mxt_result SetKey(IN const CPrivateKey* pPrivateKey);
</pre>

<h4 class="red">Documentation Update</h4>
<p class="cr">
All methods now have better documentation.
</p>

</div>
<br><a name="CR17238"><div class="synopsis" id="CR17238_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17238')">CR#17238</a> :</b> Some classes must be moved and others removed
</div>
<div class="detail" id="CR17238_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17238')">CR#17238</a> :</b> Some classes must be moved and others removed
<h4>Description</h4>
<p class="cr">
The following classes must be removed because they were identified as deprecated or useless:
</p>

<ul>
<li class="cr">CObject</li>
<li class="cr">CTimeUpdater</li>
<li class="cr">CSingleton </li>
<li class="cr">CDefaultAllocator </li>
</ul>

<p class="cr">
The following classes must be moved because their logical grouping into Framework folders is incorrect:
</p>
<ul>
<li class="cr">CMemoryQueue</li>
<li class="cr">CPublicKey</li>
<li class="cr">CPrivateKey</li>
<li class="cr">IPassPhrase</li>
</ul>

<p class="cr">
Finally, the class CPkiKey must be renamed and moved to provide a better abstraction.
</p>

<pre class="cr">
</pre>
<h4>Solution</h4>
<p class="cr">
Class removal has been addressed as described bellow:
</p>
<ul>
<li class="cr">CObject was deleted from the project. All references to the CObject in the documentation examples were replaced with another class of the Framework.</li>
<li class="cr">CTimeUpdater was deleted from the project. This class has not been used for many years.</li>
<li class="cr">CSingleton was deleted from the project. The CCrypto, CPki, and CTls classes were slightly modified to implement an equivalent of the pattern.</li>
<li class="cr">CDefaultAllocator was deleted from the project. Its Allocate and Release methods were moved inside the CBlockAllocator class, which used to depend on CDefaultAllocator. All the usage of  CDefaultAllocator were replaced by direct usage of MX_NEW and MX_DELETE.</li>
</ul>

<p class="cr">
Simply update the include files in all the files impacted by the move or rename of some classes.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
Class removal:
</p>
<ul>
<li class="cr">CObject no longer exists.</li>
<li class="cr">CTimeUpdater no longer exists.</li>
<li class="cr">CSingleton no longer exists.</li>
<li class="cr">CDefaultAllocator no longer exists.</li>
</ul>

<p class="cr">
Moved or renamed classes:
</p>
<ul>
<li class="cr">CMemoryQueue formerly in Kernel/CMemoryQueue.h is now available in Cap/CMemoryQueue.h.</li>
<li class="cr">CPublicKey formerly in Pki/CPublicKey.h is now available in Crypto/CPublicKey.h.</li>
<li class="cr">CPrivateKey formerly in Pki/CPrivateKey.h is now available in Crypto/CPrivateKey.h.</li>
<li class="cr">IPassPhrase formerly in Pki/IPassPhrase.h is now available in Crypto/IPassPhrase.h.</li>
<li class="cr">CPkiKey available formerly in Pki/CPkiKey.h is now CAsymetricKey available in Crypto/CAsymetricKey.h.</li>
</ul>

</div>
<br><a name="CR17250"><div class="synopsis" id="CR17250_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17250')">CR#17250</a> :</b> CPublicKey and CPrivateKey must offer the "override" mechanism. 
</div>
<div class="detail" id="CR17250_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17250')">CR#17250</a> :</b> CPublicKey and CPrivateKey must offer the "override" mechanism. 
<h4>Description</h4>
<p class="cr">
All the classes inside the "Crypto" folder MUST implement an override mechanism to give flexibility of increasing the portability. Since CPublicKey and CPrivateKey were moved here, they must follow the same pattern.
</p>

<h4>Solution</h4>
<p class="cr">
CPublicKey and CPrivateKey are modified to inherit from a class that provides the real implementation of the algorithm. CPublicKey and CPrivateKey define the public interface and implement each method by calling the equivalent method from the inherited class. The pattern is implemented with pre-processor defines.
</p>
<p class="cr">
Currently, in addition to the possibility of providing an override implementation for each class, CPublicKey and CPrivateKey provide only the implementation for the OpenSSL cryptographic engine.
</p>
<p class="cr">
Everything is configurable with the following set of defines documented in the API Reference documentation.
</p>

<ul>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_NONE</li>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_OPENSSL</li>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_OVERRIDE</li>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_INCLUDE</li>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_CLASSNAME </li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_NONE</li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_OPENSSL</li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_OVERRIDE</li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_INCLUDE</li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_CLASSNAME </li>
</ul>

<h4 class="red">Interface Change</h4>
<p class="cr">
The class CAsymetricKey (former CPkikey) has been removed. It was accessible from the public interface, which was a wrong idea. The following enumerations, usually available in CAsymetricKey, are now available in CPublicKey or CPrivateKey.
</p>
<ul>
<li class="cr">CAsymetricKey::EAlgorithm is now CPublicKey::EAlgorithm or CPrivateKey::EAlgorithm.</li>
<li class="cr"> CAsymetricKey::EEncoding is now CPublicKey::EEncoding or CPrivateKey::EEncoding.</li>
</ul>

<h4 class="red">Documentation Update</h4>
<p class="cr">
The following defines are now documented in the product API Reference.
</p>
<ul>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_NONE</li>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_OPENSSL</li>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_OVERRIDE</li>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_INCLUDE</li>
<li class="cr">MXD_CRYPTO_PRIVATEKEY_CLASSNAME </li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_NONE</li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_OPENSSL</li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_OVERRIDE</li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_INCLUDE</li>
<li class="cr">MXD_CRYPTO_PUBLICKEY_CLASSNAME </li>
</ul>

</div>
<br><a name="CR17266"><div class="synopsis" id="CR17266_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17266')">CR#17266</a> :</b> CMemoryAllocator API enhancement for statistics
</div>
<div class="detail" id="CR17266_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17266')">CR#17266</a> :</b> CMemoryAllocator API enhancement for statistics
<h4>Description</h4>
<p class="cr">
The class CMemoryAllocator currently provides only one method to get the memory statistics. This is not enough to perform memory diagnostic of particular features or pieces of code. The API of CMemoryAllocator must be enhanced to provide better diagnostic capabilities. For instance, it must be possible to:
</p>
<ul>
<li class="cr">Reset the statistics to their initial values at some point in time.</li>
<li class="cr">Set the statistics to known values at some point in time.</li>
<li class="cr">Stop the acquisition of statistics.</li>
<li class="cr">Resume the acquisition of statistics.</li>
</ul>
<h4>Solution</h4>
<p class="cr">
The above requirements are now fulfilled by the addition of the following four methods:
</p>
<ul>
<li class="cr">ResetMemoryStatistics</li>
<li class="cr">SetMemoryStatistics</li>
<li class="cr">DisableMemoryStatistics</li>
<li class="cr">EnableMemoryStatistics</li>
</ul>

<h4 class="red">Behaviour Change</h4>
<p class="cr">
When CMemoryAllocator is used, no statistics are accumulated if DisableMemoryStatistic was called.
</p>
<p class="cr">
If ResetMemoryStatistics is called, all the preceeding statistics are lost unless previously saved with GetMemoryStatistics. If this is the case, when the condition for calling ResetMemoryStatistics is completed, the statistics can be restored to their initial values with SetMemoryStatistics. Failure to follow this procedure will result in a loss of consistency and render the interpretation of memory statistics completely useless.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
Added methods signatures:
</p>
<ul>
<li class="cr">static void ResetMemoryStatistics()</li>
<li class="cr">static void SetMemoryStatistics(IN SMemoryStatistics* pstMemoryStatistics)</li>
<li class="cr">static void EnableMemoryStatistics()</li>
<li class="cr">static void DisableMemoryStatistics()</li>
</ul>

<h4 class="red">Documentation Update</h4>
<p class="cr">
Documentation of each method was added to the Framework API reference.
</p>

</div>
<br><a name="CR17313"><div class="synopsis" id="CR17313_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17313')">CR#17313</a> :</b> CThread must support peak stack size detection.
</div>
<div class="detail" id="CR17313_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17313')">CR#17313</a> :</b> CThread must support peak stack size detection.
<h4>Description</h4>
<p class="cr">
The CThread class must be modified to allow monitoring of stack information. This is required to acquire stack information.
</p>
<p class="cr">
The following features must be supported:
</p>
<ul>
<li class="cr">Get the stack information of the current thread.</li>
<li class="cr">Reset the stack information of the current thread.</li>
<li class="cr">Get the stack information of a thread with a specific thread name.</li>
<li class="cr">Get the stack information of all the threads.</li>
</ul>
<p class="cr">
The following define must be created:
</p>
<ul>
<li class="cr">MXD_THREAD_STACK_INFO_ENABLE_SUPPORT (enables the feature).</li>
</ul>
<h4>Solution</h4>
<p class="cr">
A new define was created, MXD_THREAD_STACK_INFO_ENABLE_SUPPORT, to enable the peak stack size detection for a CThread.
</p>
<p class="cr">
When MXD_THREAD_STACK_INFO_ENABLE_SUPPORT is defined, the stack of a CThread is filled with a known pattern upon creation. Two new methods, GetThreadStackInfo and ResetThreadStackInfo, allow to interact with the stack information mechanism. When GetThreadStackInfo is called, we check, from the end of the stack to the beginning, up to where the pattern is still valid. It allows to detect the stack information of the thread. When ResetThreadStackInfo is called, we reset the stack by using the same known pattern, from the end of the stack up to the current stack pointer.
</p>
<p class="cr">
Three versions of the GetThreadStackInfo method are available. The first one gets the stack information of the current CThread. The second gets the stack information of a specific CThread based on its name. The third gets the stack information for all CThread and optionally returns the number of CThreads in the system.
</p>
<h4 class="red">Interface Change</h4>
<p class="cr">
The following methods have been added to the public interface of the CThread class:
</p>
<ul>
<li class="cr">GetThreadStackInfo</li>
<li class="cr">ResetThreadStackInfo</li>
</ul>

<h4 class="red">Documentation Update</h4>
<p class="cr">
Documentation has been added for the following methods and defines:
</p>
<ul>
<li class="cr">CThread::GetThreadStackInfo</li>
<li class="cr">CThread::ResetThreadStackInfo</li>
<li class="cr"> MXD_THREAD_STACK_INFO_ENABLE_SUPPORT</li>
<li class="cr"> MXD_DEFAULT_THREAD_STACK_INFO_BUFFER_OFFSET</li>
</ul>

</div>
<br><br><h3>Bug Fixes</h3>
<a name="CR15209"><div class="synopsis" id="CR15209_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR15209')">CR#15209</a> :</b> Memory leak in CCertificate. 
</div>
<div class="detail" id="CR15209_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR15209')">CR#15209</a> :</b> Memory leak in CCertificate. 
<h4>Description</h4>
<p class="cr">
    Any time a CPrivateKey instance is set in a CCertificate, the key is never destroyed in the destructor.
</p>
<h4>Solution</h4>
<p class="cr">
    The CPrivateKey instance is now properly destroyed.
</p>
</div>
<br><a name="CR16908"><div class="synopsis" id="CR16908_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16908')">CR#16908</a> :</b> GetHostByName sometimes crashes on Win2k3 when not using the portable resolver.
</div>
<div class="detail" id="CR16908_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16908')">CR#16908</a> :</b> GetHostByName sometimes crashes on Win2k3 when not using the portable resolver.
<h4>Description</h4>
<p class="cr">
NetworkTools::GetHostByName sometimes crashes on Windows 2003. This is due to the pName being NULL in the DNS_RECORD set returned by DnsQuery for a valid answer. This should never happen and is a bug in the DnsQuery method of Windows 2003.
</p>
<h4>Solution</h4>
<p class="cr">
When a record has a NULL pName, it is skipped. If this happens, one of the answers returned by DnsQuery is lost, as it contains errors.
</p>
</div>
<br><a name="CR16952"><div class="synopsis" id="CR16952_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16952')">CR#16952 (Incident 1004)</a> :</b> GetHostByName fails when requested FQDN is eNONE.
</div>
<div class="detail" id="CR16952_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16952')">CR#16952 (Incident 1004)</a> :</b> GetHostByName fails when requested FQDN is eNONE.
<h4>Description</h4>
<p class="cr">
NetworkTools::GetHostByName fails if it receives a string equivalent to INADDR_ANY  or INADDR_NONE ; i.e., to the IP addresses "0.0.0.0" or "255.255.255.255" or any other decimal/hexadecimal/octal representation. These are valid IP addresses so GetHostByName should return a CSocketAddr with the IP address set to these values without doing a DNS query.
</p>
<h4>Solution</h4>
<p class="cr">
Any string that is passed to NetworkTools::GetHostByName is now verified and, if it is a valid IP address, GetHostByName successfully returns a CSocketAddr with the IP address correctly set. This verification is done with the help of the function inet_aton for Linux and VxWorks. Windows and Nucleus do not have this function so the verification is done manually by translating the string into an address.
</p>
</div>
<br><a name="CR16971"><div class="synopsis" id="CR16971_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16971')">CR#16971 (Incident 672)</a> :</b> Certificate key identifer types are needed.
</div>
<div class="detail" id="CR16971_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16971')">CR#16971 (Incident 672)</a> :</b> Certificate key identifer types are needed.
<h4>Description</h4>
<p class="cr">
The subject key identifier and the authority key identifier extensions are required in certificates. These are used to facilitate the construction of the certificate chain for the specified certificate.
</p>
<h4>Solution</h4>
<p class="cr">
Two new classes have been added: CSubjectKeyIdentifier and CAuthorityKeyIdentifier. These classes handle the related certificate extensions.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
ENameType enumeration has been moved from CAlternateName to CCertificateExtension. This is due to the fact that the CAuthorityKeyIdentifier also uses this enumeration now.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
    The following methods have been added to the CCertificate class.
</p>
<ul>
<li class="cr">GetAuthorityKeyIdentifierExtension</li>
<li class="cr">GetSubjectKeyIdentifierExtension</li>
</ul>

<h4 class="red">Documentation Update</h4>
<p class="cr">
    Documentation for GetAuthorityKeyIdentifierExtension and GetSubjectKeyIdentifierExtension added to CCertificate. Documentation for the new classes has been added.
</p>
<p class="cr">
    Documentation for the basic constraint extension has been updated.
</p>

</div>
<br><a name="CR16977"><div class="synopsis" id="CR16977_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16977')">CR#16977 (Incident 1041)</a> :</b> Template friend declaration syntax is different in MSVC 7.1.
</div>
<div class="detail" id="CR16977_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16977')">CR#16977 (Incident 1041)</a> :</b> Template friend declaration syntax is different in MSVC 7.1.
<h4>Description</h4>
<p class="cr">
The template friend syntax has changed in MSVC 7.1. As a result, when CVectors are used with the CMarshaler operators &lt;&lt; and &gt;&gt;, the compiler will complain about an unresolved symbol.
</p>
<h4>Solution</h4>
<p class="cr">
Updated the syntax to compile on MSVC 7.1.
</p>
</div>
<br><a name="CR16985"><div class="synopsis" id="CR16985_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16985')">CR#16985 (Incident 1031)</a> :</b> Packet may not be sent on a TLS socket.
</div>
<div class="detail" id="CR16985_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16985')">CR#16985 (Incident 1031)</a> :</b> Packet may not be sent on a TLS socket.
<h4>Description</h4>
<p class="cr">
Sending will fail on a CAsyncTlsSocket when trying to send from the EvAsyncClientSocketMgrConnected. This happens because in Send it checks to see if the state is eCONNECTED_IN_TLS, but in InternalTlsHandshakingApprovalCompletedA the state is set to eCONNECTED_IN_TLS after calling EvAsyncClientSocketMgrConnected, instead of before.
</p>
<h4>Solution</h4>
<p class="cr">
Set the state to eCONNECTED_IN_TLS before calling EvAsyncClientSocketMgrConnected in CAsyncTlsSocket::InternalTlsHandshakingApprovalCompletedA().
</p>
</div>
<br><a name="CR16992"><div class="synopsis" id="CR16992_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16992')">CR#16992 (Incident 1068)</a> :</b> CList = operator fails if the List Capacity is Locked.
</div>
<div class="detail" id="CR16992_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16992')">CR#16992 (Incident 1068)</a> :</b> CList = operator fails if the List Capacity is Locked.
<h4>Description</h4>
<p class="cr">
When trying to use the = operator on containers but the containers have their capacity locked, this fails. It is because we try to do a ReserveCapacity and this fails right away if the capacity is locked.
</p>
<h4>Solution</h4>
<p class="cr">
ReserveCapacity returns resS_OK and does nothing if the capacity is locked but the required capacity to be reserved is smaller than or equal to the current capacity.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
The ReserveCapacity method of all the container classes under Cap now returns resS_OK and does nothing if the capacity is locked but the required capacity to be reserved is smaller than or equal to the current capacity.
</p>

</div>
<br><a name="CR16990"><div class="synopsis" id="CR16990_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16990')">CR#16990 (Incident 1068)</a> :</b> Memory Leak in ResolverCache.cpp CompareCacheItems()
</div>
<div class="detail" id="CR16990_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16990')">CR#16990 (Incident 1068)</a> :</b> Memory Leak in ResolverCache.cpp CompareCacheItems()
<h4>Description</h4>
<p class="cr">
There is a memory leak in ResolverCache.cpp CompareCacheItems. In the final else, there is a call to GetQuestion. This call has a memory allocation that is not freed because GetQuestion makes a copy of the question and returns a pointer to it.
</p>
<h4>Solution</h4>
<p class="cr">
Removed memory allocation from GetQuestion. Instead of returning a pointer to a copy of the question, returns a pointer to the question.
</p>
</div>
<br><a name="CR17005"><div class="synopsis" id="CR17005_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17005')">CR#17005 (Incident 1032)</a> :</b> In CTcpSocketServer::Accept, options should not be set for accepted sockets if the user did not request them.
</div>
<div class="detail" id="CR17005_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17005')">CR#17005 (Incident 1032)</a> :</b> In CTcpSocketServer::Accept, options should not be set for accepted sockets if the user did not request them.
<h4>Description</h4>
<p class="cr">
In the CTcpServerSocket::Accept method, some options were automatically set for the newly accepted sockets. This was a problem because if the user did not request to change the default option, we would do it anyways.
</p>

<p class="cr">
This also created a problem if the option we tried to set was one that the user did not have the rights or did not define set right registry key to support this option. In those cases, undesirable errors messages were printed.
</p>
<h4>Solution</h4>
<p class="cr">
A flag keeps track if the user sets the option on the server socket. If he does, then the options are also set for the accepted socket. If the user does not set the options on the server socket, they are not set for the accepted socket either.
</p>
</div>
<br><a name="CR17007"><div class="synopsis" id="CR17007_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17007')">CR#17007 (Incident 1064)</a> :</b> GetHostByName does not walk a CNAME chain to find the A or AAAA record.
</div>
<div class="detail" id="CR17007_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17007')">CR#17007 (Incident 1064)</a> :</b> GetHostByName does not walk a CNAME chain to find the A or AAAA record.
<h4>Description</h4>
<p class="cr">
When a type-A query is answered with CNAME records in it, the resolver does not go
through the chain to get to the type-A record.
</p>
<h4>Solution</h4>
<p class="cr">
Implemented parsing and proper handling of CNAME records. The resolver can now
handle CNAME records returned in DNS answers.
</p>
<p class="cr">
The GetSrvRecord and GetNaptrRecord methods can now walk CNAME in the additional section of their response, as well as interpret both A and AAAA records.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
The resolver now handles CNAME records in DNS answers.
</p>

<h4 class="red">Interface Change</h4>
<p class="cr">
The GetSrvRecord and GetNaptrRecord now take the address family of the addresses to return as a parameter.
</p>

</div>
<br><a name="CR17013"><div class="synopsis" id="CR17013_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17013')">CR#17013</a> :</b> void MX_DELETE_Destruct(IN TO const _Type* pInstance) does not compile under ADS compiler.
</div>
<div class="detail" id="CR17013_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17013')">CR#17013</a> :</b> void MX_DELETE_Destruct(IN TO const _Type* pInstance) does not compile under ADS compiler.
<h4>Description</h4>
<p class="cr">
MX_DELETE_Destruct in CMemoryAllocator does not compile under the ADS compiler. The compiler warns about calling a destructor for a const object.
</p>
<h4>Solution</h4>
<p class="cr">
Used const_cast to remove the compiler error.
</p>
</div>
<br><a name="CR17015"><div class="synopsis" id="CR17015_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17015')">CR#17015 (Incident 1034)</a> :</b> Port partner's TLS stack implementation use.
</div>
<div class="detail" id="CR17015_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17015')">CR#17015 (Incident 1034)</a> :</b> Port partner's TLS stack implementation use.
<h4>Description</h4>
<p class="cr">
Need to port the use of a partner's TLS protocol implementation in M5T Framework SAFE.
</p>
<h4>Solution</h4>
<p class="cr">
Added the MXD_CTTLS_ENABLE_SUPPORT macro to conditionally compile the TLS
sockets of M5T Framework SAFE that uses the partner's TLS protocol
implementation. This macro shall be defined in PreFrameworkCfg.h.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
When the macro MXD_CTTLS_ENABLE_SUPPORT is defined in PreFrameworkCfg.h, the TLS
sockets uses the partner's TLS protocol implmentation. Make sure
MXD_TLS_ENABLE_SUPPORT is not defined.
</p>

</div>
<br><a name="CR17103"><div class="synopsis" id="CR17103_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17103')">CR#17103 (Incident 1028)</a> :</b> Unaligned data access does not work under ARM platform
</div>
<div class="detail" id="CR17103_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17103')">CR#17103 (Incident 1028)</a> :</b> Unaligned data access does not work under ARM platform
<h4>Description</h4>
<p class="cr">
When a reinterpret cast is done on unaligned data, the result is not what is expected on the ARM platform. The packed attribute must be put on the struct definition.
</p>
<h4>Solution</h4>
<p class="cr">
Defined MX_PACK_STRUCT in MxPack.h
</p>
<p class="cr">
Added MX_PACK_STRUCT to each struct that is packing its members.
</p>
</div>
<br><a name="CR17225"><div class="synopsis" id="CR17225_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17225')">CR#17225</a> :</b> Must support the latest Windows Platform SDK.
</div>
<div class="detail" id="CR17225_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17225')">CR#17225</a> :</b> Must support the latest Windows Platform SDK.
<h4>Description</h4>
<p class="cr">
The Framework must support the latest Microsoft Windows Platform SDK released on 3/15/2006.
</p>
<h4>Solution</h4>
<p class="cr">
Fixed a compiler warning in the file CMemoryAllocator.h when building using Microsoft Visual Studio .NET (MSVC7) and the latest Platform SDK.
</p>
</div>
<br><a name="CR17229"><div class="synopsis" id="CR17229_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17229')">CR#17229</a> :</b> Removal of MX_RINSPECT.
</div>
<div class="detail" id="CR17229_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17229')">CR#17229</a> :</b> Removal of MX_RINSPECT.
<h4>Description</h4>
<p class="cr">
The MX_RINSPECT macro must be removed, along with all code related to it.
</p>
<h4>Solution</h4>
<p class="cr">
The MX_RINSPECT macro, as well as the MxResultTrace and MxResultInspect methods, have been removed from Result.cpp and Result.h.
</p>
<p class="cr">
All calls to MX_RINSPECT in all of the Framework code have been removed.
</p>
</div>
<br><a name="CR16284"><div class="synopsis" id="CR16284_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16284')">CR#16284 (Incident 1197)</a> :</b> CServicingThread exponential timer not behaving as documented.
</div>
<div class="detail" id="CR16284_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16284')">CR#16284 (Incident 1197)</a> :</b> CServicingThread exponential timer not behaving as documented.
<h4>Description</h4>
<p class="cr">
For the following call to CServicingThread::StartTimer(pMagager, uTimerId, 500, 500, 32000, 2, 1, false); the following behaviour is expected: 500, 1000, 2000, 4000, 8000, 16000, 32000, 32000, 32000, 32000.
</p>
<p class="cr">
However, the timer produces: 500, 1000, 1500, 2500, 4500, 8500.
</p>
<h4>Solution</h4>
<p class="cr">
After calling EvTimerServiceMgrAwaken on the manager, the current time is now retrieved correctly.
</p>
<p class="cr">
The method ITimerService::StartTimer() that starts an exponential timer no longer has the uFloorTimeoutIncrementMs parameter.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
The exponential timers now correctly behave as documented. For instance, a timer that starts at the floor timeout of 500 ms increases exponentially by a factor of 2 and reaches its ceiling at 32000 ms.
</p>
<pre class="cr">
500, 1000, 2000, 4000, 8000, 16000, 32000, 32000, 32000, 32000
</pre>

<h4 class="red">Interface Change</h4>
<p class="cr">
The method ITimerService::StartTimer() that starts an exponential timer no longer has the uFloorTimeoutIncrementMs parameter.
</p>

</div>
<br><a name="CR17293"><div class="synopsis" id="CR17293_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17293')">CR#17293</a> :</b> Initial thread stack size must be consistent across all platforms.
</div>
<div class="detail" id="CR17293_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17293')">CR#17293</a> :</b> Initial thread stack size must be consistent across all platforms.
<h4>Description</h4>
<p class="cr">
The initial thread stack size must be the same across all platforms. It must be set to the default value g_uDEFAULT_THREAD_STACK_SIZE when 0 is specifed as the stack size in a call to CThread::StartThread, or otherwise to the user-specified size.
</p>
<h4>Solution</h4>
<p class="cr">
The initial thread stack size is now set to g_uDEFAULT_THREAD_STACK_SIZE if 0 is specified as the stack size in a call to CThread::StartThread on all OSes except Linux. If a value other than 0 is specified, that value is used as the initial thread stack size on all OSes except Linux.
</p>
<p class="cr">
On Linux, we do not set an initial stack size, because a call to pthread_attr_setstacksize disables the auto-grow feature of the stack. We let that feature manage the stack size.
</p>
<h4 class="red">Behaviour Change</h4>
<p class="cr">
On all OSes except Linux, CThread objects now use the same default stack size, g_uDEFAULT_THREAD_STACK_SIZE, if 0 is specified as the stack size in a call to CThread::StartThread. If a value other than 0 is passed, then that value is used.
</p>

</div>
<br><a name="CR17303"><div class="synopsis" id="CR17303_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17303')">CR#17303</a> :</b> The macro DECLARE_LOCAL_AES_CONST_TABLE_PTR causes a compilatio error in c in aes_core.c.
</div>
<div class="detail" id="CR17303_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17303')">CR#17303</a> :</b> The macro DECLARE_LOCAL_AES_CONST_TABLE_PTR causes a compilatio error in c in aes_core.c.
<h4>Description</h4>
<p class="cr">
The position of the DECLARE_LOCAL_AES_CONST_TABLE_PTR macro at line 1035 is wrong and hence it causes a compilation error in C. It must be placed before the execution block.
</p>
<h4>Solution</h4>
<p class="cr">
Move the DECLARE_LOCAL_AES_CONST_TABLE_PTR macro just prior to the execution block at the begining of the method.
</p>
</div>
<br><a name="CR17024"><div class="synopsis" id="CR17024_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17024')">CR#17024 (Incident 861)</a> :</b> Select does not return on writable event on Windows CE.
</div>
<div class="detail" id="CR17024_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17024')">CR#17024 (Incident 861)</a> :</b> Select does not return on writable event on Windows CE.
<h4>Description</h4>
<p class="cr">
On Windows CE, the code will not return from the select call when a socket becomes writable. If the select returns because another event happened, such as the socket becoming readable or a timeout elapsed, the write bit is set for the socket that became writable. For all other OSes, select is called with a very large timeout in order to not come out of the call unless an event happened. To work around this problem on Windows CE, select should be called with a timeout value of 500 milliseconds.
</p>
<h4>Solution</h4>
<p class="cr">
For Windows CE, select is called with a max timeout of 500 milliseconds. This means a select call will return after 500 milliseconds even if no events are reported on the sockets that CPollSocket monitors. After select returns, the sockets' flags are verified and, if nothing changed, select will be called again. In the case a socket became writable, the socket's flags will show this.
</p>
</div>
<br><a name="CR17025"><div class="synopsis" id="CR17025_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17025')">CR#17025 (Incident 1079)</a> :</b> MX_DELETE of a void pointer can not compile with Memory Allocator enabled.
</div>
<div class="detail" id="CR17025_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17025')">CR#17025 (Incident 1079)</a> :</b> MX_DELETE of a void pointer can not compile with Memory Allocator enabled.
<h4>Description</h4>
<p class="cr">
Code will not compile if Memory Allocator is enabled and we call MX_DELETE with a void pointer. This is because there is no implementation of MX_DELETE_Destruct for void* and the compiler tries to use the template class version and calls a destructor on it. This may happen if the pointer is cast into void.
</p>
<h4>Solution</h4>
<p class="cr">
Added implementation of MX_DELETE_Destruct for void*.
</p>
</div>
<br><a name="CR17049"><div class="synopsis" id="CR17049_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17049')">CR#17049</a> :</b> Memory Leak in CUdpTracing::Initialize.


</div>
<div class="detail" id="CR17049_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17049')">CR#17049</a> :</b> Memory Leak in CUdpTracing::Initialize.


<h4>Description</h4>
<p class="cr">
CUdpTracing has three internal objects allocated dynamically, a CFqdn, a CSocketAddr, and a CUdpSocket. The CFqdn and the CSocketAddr were allocated each time the CUdpTracing::Initialize was called, instead of being allocated the first time the method is called and changed afterwards. Since the method CUdpTracing::Initialize can be called more than once to change the destination address, this was causing memory leaks.
</p>

<p class="cr">
The three objects should also be freed if the CUdpTracing::Initialize method fails.
</p>
<h4>Solution</h4>
<p class="cr">
Allocate the CFqdn and CSocketAddr objects only the first time the method is called.
</p>

<p class="cr">
Called Finalize method at the end of Initialize if there was a failure.
</p>
</div>
<br><a name="CR16981"><div class="synopsis" id="CR16981_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR16981')">CR#16981</a> :</b> GetHostByName for name ".1.1.1" crashes when the portable resolver is enabled

</div>
<div class="detail" id="CR16981_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR16981')">CR#16981</a> :</b> GetHostByName for name ".1.1.1" crashes when the portable resolver is enabled

<h4>Description</h4>
<p class="cr">
GetHostByName for name ".1.1.1" crashes when the portable resolver is enabled. This happens because ".1.1.1" cannot be compressed due to a bug in the compression function.
</p>
<h4>Solution</h4>
<p class="cr">
When a query is built in the portable resolver, the uncompressed query name is used if the query name cannot be compressed.
</p>
</div>
<br><a name="CR17446"><div class="synopsis" id="CR17446_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17446')">CR#17446</a> :</b> Memory leak in CVlist's assignment operator.
</div>
<div class="detail" id="CR17446_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17446')">CR#17446</a> :</b> Memory leak in CVlist's assignment operator.
<h4>Description</h4>
<p class="cr">
There is a memory leak in the assignment operator of CVlist. If the list being assigned to has any objects in it, their memory is not released properly and they leak.
</p>
<h4>Solution</h4>
<p class="cr">
Release the memory of the objects of the assigned to list.
</p>
</div>
<br><a name="CR17448"><div class="synopsis" id="CR17448_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17448')">CR#17448</a> :</b> Memory leak in CVListBase::Move, moved element's memory is not released.
</div>
<div class="detail" id="CR17448_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17448')">CR#17448</a> :</b> Memory leak in CVListBase::Move, moved element's memory is not released.
<h4>Description</h4>
<p class="cr">
There is a memory leak in the CVListBase::Move method. When moving an object from a list to another, the memory of the moved object from the source list is not properly released.
</p>
<h4>Solution</h4>
<p class="cr">
Release the memory of the object moved.
</p>
</div>
<br><a name="CR17459"><div class="synopsis" id="CR17459_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17459')">CR#17459</a> :</b> Memory leak in CResolverCacheItem.
</div>
<div class="detail" id="CR17459_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17459')">CR#17459</a> :</b> Memory leak in CResolverCacheItem.
<h4>Description</h4>
<p class="cr">
In Windows, calls to DnsRecordSetCopyEx in the CResolverCacheItem object create a PDNS_RECORD object that is never freed, resulting in memory leaks.
</p>
<h4>Solution</h4>
<p class="cr">
Call DnsRecordListFree in the destructor of the object to avoid memory leaks.
</p>
</div>
<br><a name="CR17460"><div class="synopsis" id="CR17460_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17460')">CR#17460</a> :</b> Memory leak in GetHostByName.
</div>
<div class="detail" id="CR17460_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17460')">CR#17460</a> :</b> Memory leak in GetHostByName.
<h4>Description</h4>
<p class="cr">
In Windows, calls to GetHostByName, GetHostByAddr, GetNaptrRecord, and GetSrvRecord that fail result in memory leaks because the data allocated by DnsQuery is never freed.
</p>
<h4>Solution</h4>
<p class="cr">
In Windows, call DnsRecordListFree before exiting from GetHostByName, GetHostByAddr, GetNaptrRecord, and GetSrvRecord.
</p>
</div>
<br><br><h3>Documentation Updates</h3>
<a name="CR17300"><div class="synopsis" id="CR17300_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17300')">CR#17300</a> :</b> API Reference update.
</div>
<div class="detail" id="CR17300_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17300')">CR#17300</a> :</b> API Reference update.
<h4>Description</h4>
<p class="cr">
There are inconsistencies in the documentation of some classes/methods/parameters/varaiables/enums/structures, as well as errors in the layout of the API reference.
</p>
<h4>Solution</h4>
<p class="cr">
Reviewed the global structure of the API reference. Updated topics that were attached to the wrong section. Updated classes/methods/variables documentation to make sure only the public symbols appear in the API reference.
</p>
<p class="cr">
Added missing documentation for some classes/methods/parameters/variables/enums/structures.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The API reference was rebuilt.
</p>

</div>
<br><a name="CR17115"><div class="synopsis" id="CR17115_CrCollapsed" style="visibility:visible;display:inline;"></a>
<b><a href="javascript:show_hide('CR17115')">CR#17115 (Incident 1140)</a> :</b> MXD_TRACE_OUTPUT_HANDLER_OVERRIDE documentation is wrong and incomplete.
</div>
<div class="detail" id="CR17115_CrExpanded" style="visibility:hidden;display:none;">
<b><a href="javascript:show_hide('CR17115')">CR#17115 (Incident 1140)</a> :</b> MXD_TRACE_OUTPUT_HANDLER_OVERRIDE documentation is wrong and incomplete.
<h4>Description</h4>
<p class="cr">
The MXD_TRACE_OUTPUT_HANDLER_OVERRIDE documentation stated that this must be defined in "PreMxConfig.h". This is false, since this cannot work because the output handler's parameters are defined in MxTrace.h. The proper location to define this is in the file "PostMxConfig.h". The documentation also failed to mention that it is necessary to have an extern declaration of the application defined output handler in the "PostMxConfig.h" file as well.
</p>
<h4>Solution</h4>
<p class="cr">
Corrected the documentation of MXD_TRACE_OUTPUT_HANDLER_OVERRIDE.
</p>
<h4 class="red">Documentation Update</h4>
<p class="cr">
The documentation of MXD_TRACE_OUTPUT_HANDLER_OVERRIDE now states to define this in "PostMxConfig.h" instead of "PreMxConfig.h". It also mentions an extern declaration of the application defined output handler is necessary in the same file.
</p>

</div>
<br></div>
<script type="text/javascript">expandFirstLabel()</script>
<br><br><a href="#top">back to top</a>
<hr>
<a name="licensing"></a><h2>Third-Party Licensing Information</h2>
<p><i>*Note: This section covers licensing obligations on Media5's part for using Third-Party (and/or Open Source) source code. For more information on our Third-Party policy, please refer to our <B><I>Open Source and Third-Party support statement</I></B>, available from the Partner Web Portal Knowledge Base.</i></p>
<p>
The M5T Framework includes open source code for the SHA1 algorithm implementation. The code is used by written permission of the authors.
See <a href="ftp://ftp.rfc-editor.org/in-notes/rfc3174.txt">
             ftp://ftp.rfc-editor.org/in-notes/rfc3174.txt</a>.
</p>

<p>
The M5T Framework includes open source code for the SHA-2 (256 bits) algorithm implementation. The Code is used by written permission of the authors.
See <a href="ftp://ftp.rfc-editor.org/in-notes/rfc4634.txt">
             ftp://ftp.rfc-editor.org/in-notes/rfc4634.txt</a>.
</p>

<p>
The M5T Framework includes open source code for the AES algorithm implementation.
See <a href="http://www.openssl.org">
             http://www.openssl.org</a>
for up-to-date license shown hereunder:</p>
<pre><b>
  LICENSE ISSUES
  ==============

  The OpenSSL toolkit stays under a dual license, i.e. both the conditions of
  the OpenSSL License and the original SSLeay license apply to the toolkit.
  See below for the actual license texts. Actually both licenses are BSD-style
  Open Source licenses. In case of any license issues related to OpenSSL
  please contact openssl-core@openssl.org.

  OpenSSL License
  ---------------

/* ====================================================================
 * Copyright (c) 1998-2004 The OpenSSL Project.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in
 *    the documentation and/or other materials provided with the
 *    distribution.
 *
 * 3. All advertising materials mentioning features or use of this
 *    software must display the following acknowledgment:
 *    "This product includes software developed by the OpenSSL Project
 *    for use in the OpenSSL Toolkit. (http://www.openssl.org/)"
 *
 * 4. The names "OpenSSL Toolkit" and "OpenSSL Project" must not be used to
 *    endorse or promote products derived from this software without
 *    prior written permission. For written permission, please contact
 *    openssl-core@openssl.org.
 *
 * 5. Products derived from this software may not be called "OpenSSL"
 *    nor may "OpenSSL" appear in their names without prior written
 *    permission of the OpenSSL Project.
 *
 * 6. Redistributions of any form whatsoever must retain the following
 *    acknowledgment:
 *    "This product includes software developed by the OpenSSL Project
 *    for use in the OpenSSL Toolkit (http://www.openssl.org/)"
 *
 * THIS SOFTWARE IS PROVIDED BY THE OpenSSL PROJECT ``AS IS'' AND ANY
 * EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE OpenSSL PROJECT OR
 * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 * ====================================================================
 *
 * This product includes cryptographic software written by Eric Young
 * (eay@cryptsoft.com).  This product includes software written by Tim
 * Hudson (tjh@cryptsoft.com).
 *
 */

 Original SSLeay License
 -----------------------

/* Copyright (C) 1995-1998 Eric Young (eay@cryptsoft.com)
 * All rights reserved.
 *
 * This package is an SSL implementation written
 * by Eric Young (eay@cryptsoft.com).
 * The implementation was written so as to conform with Netscapes SSL.
 *
 * This library is free for commercial and non-commercial use as long as
 * the following conditions are aheared to.  The following conditions
 * apply to all code found in this distribution, be it the RC4, RSA,
 * lhash, DES, etc., code; not just the SSL code.  The SSL documentation
 * included with this distribution is covered by the same copyright terms
 * except that the holder is Tim Hudson (tjh@cryptsoft.com).
 *
 * Copyright remains Eric Young's, and as such any Copyright notices in
 * the code are not to be removed.
 * If this package is used in a product, Eric Young should be given attribution
 * as the author of the parts of the library used.
 * This can be in the form of a textual message at program startup or
 * in documentation (online or textual) provided with the package.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *    "This product includes cryptographic software written by
 *     Eric Young (eay@cryptsoft.com)"
 *    The word 'cryptographic' can be left out if the rouines from the library
 *    being used are not cryptographic related :-).
 * 4. If you include any Windows specific code (or a derivative thereof) from
 *    the apps directory (application code) you must include an acknowledgement:
 *    "This product includes software written by Tim Hudson (tjh@cryptsoft.com)"
 *
 * THIS SOFTWARE IS PROVIDED BY ERIC YOUNG ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * The licence and distribution terms for any publically available version or
 * derivative of this code cannot be changed.  i.e. this code cannot simply be
 * copied and put under another distribution licence
 * [including the GNU Public Licence.]
 */
</b></pre>

<p>
The M5T Framework includes open source code for the resolver compression algorithm.
License shown here under:</p>
<pre><b>
/* ++Copyright++ 1985, 1993
 * -
 * Copyright (c) 1985, 1993
 *    The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *   This product includes software developed by the University of
 *   California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 * -
 * Portions Copyright (c) 1993 by Digital Equipment Corporation.
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies, and that
 * the name of Digital Equipment Corporation not be used in advertising or
 * publicity pertaining to distribution of the document or software without
 * specific, written prior permission.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND DIGITAL EQUIPMENT CORP. DISCLAIMS ALL
 * WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS.   IN NO EVENT SHALL DIGITAL EQUIPMENT
 * CORPORATION BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
 * DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
 * PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS
 * ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
 * SOFTWARE.
 * -
 * --Copyright--
 */

</b></pre>

<br><a href="#top">back to top</a>
<hr>
<a name="export"></a><h2>Export Restrictions</h2>
<p>Media5 software contains export-restricted material, such as encryption algorithms, classified under Canada ECL Item 1-5.D.2, 1-5.E.2 and United States of America ECCN 5D002, 5E002. In the case your company is located outside of Canada or United States of America, Media5 has acquired a Permit to Export to your company in your country*. The NDA or SLA between your company and Media5 DOES NOT provide and DOES NOT replace any permit to export. Following the Terms and Conditions of the SLA between Media5 and your company, if your company needs to re-export Media5's embedded software or needs to provide access to Media5 software into a third country (even for development purpose in another branch of your own company), your company is solely responsible for requesting and acquiring a Permit to Export from your authoritative government agency. It is very IMPORTANT that, before providing PWP access to contacts from third country, you make sure that your company has received proper authorizations.</p>
<p><i>*The Media5 Permit to Export to your company can be requested by contacting M5T technical support.</i></p>
<p><i>M5T is a division of Media5 Corporation.</i></p>
<hr>
<a name="copyrightnotice"></a><h2>Copyright</h2>
<p>&copy 2010 Media5 Corporation (Media5)</p>
<p>This document contains information that is confidential and proprietary to Media5.</p>
<p>Media5 reserves all rights to this document as well as to the Intellectual Property of the document and the technology and know-how that it includes and represents.</p>
<p>This publication cannot be reproduced, neither in whole nor in part, in any form whatsoever without prior written approval by Media5.</p>
<p>Media5 reserves the right to revise this publication and make changes at any time and without the obligation to notify any person and/or entity of such revisions and/or changes.</p>
<a href="#top">back to top</a>
<br><br>
<p class="copyright">&copy 2010 Media5 Corporation. All rights reserved.</p>
</body>
</html>
